/*! For license information please see main.ebcdfa06.js.LICENSE.txt */
(()=>{var e={11:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(427));class a extends o.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const n=Array.from(new Set(t)).map(e=>"string"===typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}contains(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t){let{config:n,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o="";"plain"===r?o="pl":"phrase"===r?o="ph":"websearch"===r&&(o="w");const a=void 0===n?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(o,"fts").concat(a,".").concat(t)),this}match(e){return Object.entries(e).forEach(e=>{let[t,n]=e;this.url.searchParams.append(t,"eq.".concat(n))}),this}not(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}or(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n?"".concat(n,".or"):"or";return this.url.searchParams.append(r,"(".concat(e,")")),this}filter(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}}t.default=a},47:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(11));t.default=class{constructor(e,t){let{headers:n={},schema:r,fetch:o}=t;this.url=e,this.headers=new Headers(n),this.schema=r,this.fetch=o}select(e){let{head:t=!1,count:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=t?"HEAD":"GET";let a=!1;const i=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",i),n&&this.headers.append("Prefer","count=".concat(n)),new o.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e){let{count:t,defaultToNull:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;if(t&&this.headers.append("Prefer","count=".concat(t)),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new o.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e){let{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(this.headers.append("Prefer","resolution=".concat(n?"ignore":"merge","-duplicates")),void 0!==t&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer","count=".concat(r)),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>'"'.concat(e,'"'));this.url.searchParams.set("columns",e.join(","))}}return new o.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e){let{count:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return t&&this.headers.append("Prefer","count=".concat(t)),new o.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}delete(){let{count:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return e&&this.headers.append("Prefer","count=".concat(e)),new o.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}}},49:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,m(x,g.prototype),x.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,_={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var o,a={},i=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(i=""+t.key),t)k.call(t,o)&&!E.hasOwnProperty(o)&&(a[o]=t[o]);var u=arguments.length-2;if(1===u)a.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(o in u=e.defaultProps)void 0===a[o]&&(a[o]=u[o]);return{$$typeof:n,type:e,key:i,ref:s,props:a,_owner:_.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var N=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,o,a,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return i=i(u=e),e=""===a?"."+T(u,0):a,w(i)?(o="",null!=e&&(o=e.replace(N,"$&/")+"/"),I(i,t,o,"",function(e){return e})):null!=i&&(S(i)&&(i=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,o+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(N,"$&/")+"/")+e)),t.push(i)),1;if(u=0,a=""===a?".":a+":",w(e))for(var l=0;l<e.length;l++){var c=a+T(s=e[l],l);u+=I(s,t,o,c,i)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)u+=I(s=s.value,t,o,c=a+T(s,l++),i);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function R(e,t,n){if(null==e)return e;var r=[],o=0;return I(e,r,"","",function(e){return t.call(n,e,o++)}),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},P={transition:null},j={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:P,ReactCurrentOwner:_};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,n){R(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=o,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=c,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,t.act=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),a=e.key,i=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,s=_.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)k.call(t,l)&&!E.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){u=Array(l);for(var c=0;c<l;c++)u[c]=arguments[c+2];o.children=u}return{$$typeof:n,type:e.type,key:a,ref:i,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},53:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const o=r(n(71));t.PostgrestClient=o.default;const a=r(n(47));t.PostgrestQueryBuilder=a.default;const i=r(n(11));t.PostgrestFilterBuilder=i.default;const s=r(n(427));t.PostgrestTransformBuilder=s.default;const u=r(n(569));t.PostgrestBuilder=u.default;const l=r(n(732));t.PostgrestError=l.default,t.default={PostgrestClient:o.default,PostgrestQueryBuilder:a.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:u.default,PostgrestError:l.default}},71:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(47)),a=r(n(11));class i{constructor(e){let{headers:t={},schema:n,fetch:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=r}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new o.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new i(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{head:n=!1,get:r=!1,count:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;let s;const u=new URL("".concat(this.url,"/rpc/").concat(e));let l;n||r?(s=n?"HEAD":"GET",Object.entries(t).filter(e=>{let[t,n]=e;return void 0!==n}).map(e=>{let[t,n]=e;return[t,Array.isArray(n)?"{".concat(n.join(","),"}"):"".concat(n)]}).forEach(e=>{let[t,n]=e;u.searchParams.append(t,n)})):(s="POST",l=t);const c=new Headers(this.headers);return o&&c.set("Prefer","count=".concat(o)),new a.default({method:s,url:u,headers:c,schema:this.schemaName,body:l,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}}t.default=i},82:()=>{},119:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(345)},224:e=>{var t,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,u=[],l=!1,c=-1;function d(){l&&s&&(l=!1,s.length?u=s.concat(u):c=-1,u.length&&h())}function h(){if(!l){var e=i(d);l=!0;for(var t=u.length;t;){for(s=u,u=[];++c<t;)s&&s[c].run();c=-1,t=u.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||i(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},318:()=>{},325:(e,t,n)=>{"use strict";const r=n(676),o=n(897),a="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.hp=u,t.IS=50;const i=2147483647;function s(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return l(e,t,n)}function l(e,t,n){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let r=s(n);const o=r.write(e,t);o!==n&&(r=r.slice(0,o));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return f(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);const o=function(e){if(u.isBuffer(e)){const t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!==typeof e.length||$(e.length)?s(0):h(e);if("Buffer"===e.type&&Array.isArray(e.data))return h(e.data)}(e);if(o)return o;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return c(e),s(e<0?0:0|p(e))}function h(e){const t=e.length<0?0:0|p(e.length),n=s(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function p(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(e).length;default:if(o)return r?-1:G(e).length;t=(""+t).toLowerCase(),o=!0}}function v(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),$(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,o);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,o){let a,i=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;i=2,s/=2,u/=2,n/=2}function l(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(o){let r=-1;for(a=n;a<s;a++)if(l(e,a)===l(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===u)return r*i}else-1!==r&&(a-=a-r),r=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){let n=!0;for(let r=0;r<u;r++)if(l(e,a+r)!==l(t,r)){n=!1;break}if(n)return a}return-1}function x(e,t,n,r){n=Number(n)||0;const o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;const a=t.length;let i;for(r>a/2&&(r=a/2),i=0;i<r;++i){const r=parseInt(t.substr(2*i,2),16);if($(r))return i;e[n+i]=r}return i}function w(e,t,n,r){return X(G(t,e.length-n),e,n,r)}function k(e,t,n,r){return X(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return X(K(t),e,n,r)}function E(e,t,n,r){return X(function(e,t){let n,r,o;const a=[];for(let i=0;i<e.length&&!((t-=2)<0);++i)n=e.charCodeAt(i),r=n>>8,o=n%256,a.push(o),a.push(r);return a}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);const r=[];let o=t;for(;o<n;){const t=e[o];let a=null,i=t>239?4:t>223?3:t>191?2:1;if(o+i<=n){let n,r,s,u;switch(i){case 1:t<128&&(a=t);break;case 2:n=e[o+1],128===(192&n)&&(u=(31&t)<<6|63&n,u>127&&(a=u));break;case 3:n=e[o+1],r=e[o+2],128===(192&n)&&128===(192&r)&&(u=(15&t)<<12|(63&n)<<6|63&r,u>2047&&(u<55296||u>57343)&&(a=u));break;case 4:n=e[o+1],r=e[o+2],s=e[o+3],128===(192&n)&&128===(192&r)&&128===(192&s)&&(u=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,u>65535&&u<1114112&&(a=u))}}null===a?(a=65533,i=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),o+=i}return function(e){const t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=N));return n}(r)}u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?s(e):void 0!==t?"string"===typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},u.allocUnsafe=function(e){return d(e)},u.allocUnsafeSlow=function(e){return d(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(Y(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let o=0,a=Math.min(n,r);o<a;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=u.allocUnsafe(t);let o=0;for(n=0;n<e.length;++n){let t=e[n];if(Y(t,Uint8Array))o+t.length>r.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(r,o)):Uint8Array.prototype.set.call(r,t,o);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,o)}o+=t.length}return r},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):v.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const n=t.IS;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(u.prototype[a]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,o){if(Y(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(o>>>=0)-(r>>>=0),i=(n>>>=0)-(t>>>=0);const s=Math.min(a,i),l=this.slice(r,o),c=e.slice(t,n);for(let u=0;u<s;++u)if(l[u]!==c[u]){a=l[u],i=c[u];break}return a<i?-1:i<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return k(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const N=4096;function T(e,t,n){let r="";n=Math.min(e.length,n);for(let o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function I(e,t,n){let r="";n=Math.min(e.length,n);for(let o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let o="";for(let a=t;a<n;++a)o+=J[e[a]];return o}function A(e,t,n){const r=e.slice(t,n);let o="";for(let a=0;a<r.length-1;a+=2)o+=String.fromCharCode(r[a]+256*r[a+1]);return o}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,o,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r,o){W(t,r,o,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let i=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,n}function O(e,t,n,r,o){W(t,r,o,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let i=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=i,i>>=8,e[n+2]=i,i>>=8,e[n+1]=i,i>>=8,e[n]=i,n+8}function M(e,t,n,r,o,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,a){return t=+t,n>>>=0,a||M(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,a){return t=+t,n>>>=0,a||M(e,0,n,8),o.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],o=1,a=0;for(;++a<t&&(o*=256);)r+=this[e+a]*o;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e+--t],o=1;for(;t>0&&(o*=256);)r+=this[e+--t]*o;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=Q(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,o=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(o)<<BigInt(32))}),u.prototype.readBigUInt64BE=Q(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],o=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(o)}),u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],o=1,a=0;for(;++a<t&&(o*=256);)r+=this[e+a]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=t,o=1,a=this[e+--r];for(;r>0&&(o*=256);)a+=this[e+--r]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=Q(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),u.prototype.readBigInt64BE=Q(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)}),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||D(e,4,this.length),o.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||D(e,4,this.length),o.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||D(e,8,this.length),o.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||D(e,8,this.length),o.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){P(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=1,a=0;for(this[t]=255&e;++a<n&&(o*=256);)this[t+a]=e/o&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){P(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=n-1,a=1;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=Q(function(e){return j(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Q(function(e){return O(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}let o=0,a=1,i=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===i&&0!==this[t+o-1]&&(i=1),this[t+o]=(e/a|0)-i&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);P(this,e,t,n,r-1,-r)}let o=n-1,a=1,i=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===i&&0!==this[t+o+1]&&(i=1),this[t+o]=(e/a|0)-i&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=Q(function(e){return j(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Q(function(e){return O(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const o=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),o},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(o=t;o<n;++o)this[o]=e;else{const a=u.isBuffer(e)?e:u.from(e,r),i=a.length;if(0===i)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%i]}return this};const B={};function U(e,t,n){B[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(e,"]"),this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return"".concat(this.name," [").concat(e,"]: ").concat(this.message)}}}function z(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t="_".concat(e.slice(n-3,n)).concat(t);return"".concat(e.slice(0,n)).concat(t)}function W(e,t,n,r,o,a){if(e>n||e<t){const r="bigint"===typeof t?"n":"";let o;throw o=a>3?0===t||t===BigInt(0)?">= 0".concat(r," and < 2").concat(r," ** ").concat(8*(a+1)).concat(r):">= -(2".concat(r," ** ").concat(8*(a+1)-1).concat(r,") and < 2 ** ")+"".concat(8*(a+1)-1).concat(r):">= ".concat(t).concat(r," and <= ").concat(n).concat(r),new B.ERR_OUT_OF_RANGE("value",o,e)}!function(e,t,n){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||H(t,e.length-(n+1))}(r,o,a)}function V(e,t){if("number"!==typeof e)throw new B.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,n){if(Math.floor(e)!==e)throw V(e,n),new B.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new B.ERR_BUFFER_OUT_OF_BOUNDS;throw new B.ERR_OUT_OF_RANGE(n||"offset",">= ".concat(n?1:0," and <= ").concat(t),e)}U("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?"".concat(e," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),U("ERR_INVALID_ARG_TYPE",function(e,t){return'The "'.concat(e,'" argument must be of type number. Received type ').concat(typeof t)},TypeError),U("ERR_OUT_OF_RANGE",function(e,t,n){let r='The value of "'.concat(e,'" is out of range.'),o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=z(String(n)):"bigint"===typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=z(o)),o+="n"),r+=" It must be ".concat(t,". Received ").concat(o),r},RangeError);const q=/[^+/0-9A-Za-z-_]/g;function G(e,t){let n;t=t||1/0;const r=e.length;let o=null;const a=[];for(let i=0;i<r;++i){if(n=e.charCodeAt(i),n>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(i+1===r){(t-=3)>-1&&a.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&a.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function K(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function X(e,t,n,r){let o;for(o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function $(e){return e!==e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let o=0;o<16;++o)t[r+o]=e[n]+e[o]}return t}();function Q(e){return"undefined"===typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},340:(e,t,n)=>{"use strict";e.exports=n(761)},345:(e,t,n)=>{"use strict";var r=n(950),o=n(340);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)i.add(t[e])}var c=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,o,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=i}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){v[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){v[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){v[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){v[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){v[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var o=v.hasOwnProperty(t)?v[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),N=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var j=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=j&&e[j]||e["@@iterator"])?e:null}var M,F=Object.assign;function L(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var o=l.stack.split("\n"),a=r.stack.split("\n"),i=o.length-1,s=a.length-1;1<=i&&0<=s&&o[i]!==a[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==a[s]){if(1!==i||1!==s)do{if(i--,0>--s||o[i]!==a[s]){var u="\n"+o[i].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=i&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?L(e):""}function z(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case k:return"Portal";case C:return"Profiler";case E:return"StrictMode";case I:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case N:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function $(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Q(e,t){J(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ie(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ce,de=(ce=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ce(e,t)})}:ce);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ge=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,_e=null,Ee=null;function Ce(e){if(e=xo(e)){if("function"!==typeof ke)throw Error(a(280));var t=e.stateNode;t&&(t=ko(t),ke(e.stateNode,e.type,t))}}function Se(e){_e?Ee?Ee.push(e):Ee=[e]:_e=e}function Ne(){if(_e){var e=_e,t=Ee;if(Ee=_e=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Te(e,t){return e(t)}function Ie(){}var Re=!1;function Ae(e,t,n){if(Re)return e(t,n);Re=!0;try{return Te(e,t,n)}finally{Re=!1,(null!==_e||null!==Ee)&&(Ie(),Ne())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=ko(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Pe=!1;if(c)try{var je={};Object.defineProperty(je,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(ce){Pe=!1}function Oe(e,t,n,r,o,a,i,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Me=!1,Fe=null,Le=!1,Be=null,Ue={onError:function(e){Me=!0,Fe=e}};function ze(e,t,n,r,o,a,i,s,u){Me=!1,Fe=null,Oe.apply(Ue,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(We(e)!==e)throw Error(a(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var i=o.alternate;if(null===i){if(null!==(r=o.return)){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return He(o),e;if(i===r)return He(o),t;i=i.sibling}throw Error(a(188))}if(n.return!==r.return)n=o,r=i;else{for(var s=!1,u=o.child;u;){if(u===n){s=!0,n=o,r=i;break}if(u===r){s=!0,r=o,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=o;break}if(u===r){s=!0,r=i,n=o;break}u=u.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=o.unstable_scheduleCallback,Xe=o.unstable_cancelCallback,Ye=o.unstable_shouldYield,$e=o.unstable_requestPaint,Je=o.unstable_now,Qe=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var lt=64,ct=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,a=e.pingedLanes,i=268435455&n;if(0!==i){var s=i&~o;0!==s?r=dt(s):0!==(a&=i)&&(r=dt(a))}else 0!==(i=n&~o)?r=dt(i):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(a=t&-t)||16===o&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-it(t)),r|=e[n],t&=~o;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,kt,_t,Et,Ct,St=!1,Nt=[],Tt=null,It=null,Rt=null,At=new Map,Dt=new Map,Pt=[],jt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Mt(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=xo(t))&&kt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Ft(e){var t=bo(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ve(n)))return e.blockedOn=t,void Ct(e.priority,function(){_t(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xo(n))&&kt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){Lt(e)&&n.delete(t)}function Ut(){St=!1,null!==Tt&&Lt(Tt)&&(Tt=null),null!==It&&Lt(It)&&(It=null),null!==Rt&&Lt(Rt)&&(Rt=null),At.forEach(Bt),Dt.forEach(Bt)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Ut)))}function Wt(e){function t(t){return zt(t,e)}if(0<Nt.length){zt(Nt[0],e);for(var n=1;n<Nt.length;n++){var r=Nt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&zt(Tt,e),null!==It&&zt(It,e),null!==Rt&&zt(Rt,e),At.forEach(t),Dt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Pt.shift()}var Vt=x.ReactCurrentBatchConfig,Ht=!0;function qt(e,t,n,r){var o=bt,a=Vt.transition;Vt.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=o,Vt.transition=a}}function Gt(e,t,n,r){var o=bt,a=Vt.transition;Vt.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=o,Vt.transition=a}}function Kt(e,t,n,r){if(Ht){var o=Yt(e,t,n,r);if(null===o)Hr(e,t,r,Xt,n),Ot(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Tt=Mt(Tt,e,t,n,r,o),!0;case"dragenter":return It=Mt(It,e,t,n,r,o),!0;case"mouseover":return Rt=Mt(Rt,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return At.set(a,Mt(At.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,Dt.set(a,Mt(Dt.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<jt.indexOf(e)){for(;null!==o;){var a=xo(o);if(null!==a&&wt(a),null===(a=Yt(e,t,n,r))&&Hr(e,t,r,Xt,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Xt=null;function Yt(e,t,n,r){if(Xt=null,null!==(e=bo(e=we(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function $t(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Qt,r=n.length,o="value"in Jt?Jt.value:Jt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var i=r-e;for(t=1;t<=i&&n[r-t]===o[a-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,a){for(var i in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(o):o[i]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,un,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=on(ln),dn=F({},ln,{view:0,detail:0}),hn=on(dn),fn=F({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(fn),mn=on(F({},fn,{dataTransfer:0})),vn=on(F({},dn,{relatedTarget:0})),gn=on(F({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(yn),xn=on(F({},ln,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function Cn(){return En}var Sn=F({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Nn=on(Sn),Tn=on(F({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=on(F({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Rn=on(F({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=F({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(An),Pn=[9,13,27,32],jn=c&&"CompositionEvent"in window,On=null;c&&"documentMode"in document&&(On=document.documentMode);var Mn=c&&"TextEvent"in window&&!On,Fn=c&&(!jn||On&&8<On&&11>=On),Ln=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var Vn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vn[e.type]:"textarea"===t}function qn(e,t,n,r){Se(r),0<(t=Gr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function Xn(e){Lr(e,0)}function Yn(e){if(K(wo(e)))return e}function $n(e,t){if("change"===e)return t}var Jn=!1;if(c){var Qn;if(c){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Qn=Zn}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Kn=Gn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];qn(t,Kn,e,we(e)),Ae(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ar(e,t){if("click"===e)return Yn(t)}function ir(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!d.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,a=Math.min(r.start,o);r=void 0===r.end?a:Math.min(r.end,o),!e.extend&&a>r&&(o=r,r=a,a=o),o=cr(n,a);var i=cr(n,r);o&&i&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=c&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==X(r)||("selectionStart"in(r=vr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Gr(gr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kr={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},_r={},Er={};function Cr(e){if(_r[e])return _r[e];if(!kr[e])return e;var t,n=kr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Er)return _r[e]=n[t];return e}c&&(Er=document.createElement("div").style,"AnimationEvent"in window||(delete kr.animationend.animation,delete kr.animationiteration.animation,delete kr.animationstart.animation),"TransitionEvent"in window||delete kr.transitionend.transition);var Sr=Cr("animationend"),Nr=Cr("animationiteration"),Tr=Cr("animationstart"),Ir=Cr("transitionend"),Rr=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Rr.set(e,t),u(t,[e])}for(var Pr=0;Pr<Ar.length;Pr++){var jr=Ar[Pr];Dr(jr.toLowerCase(),"on"+(jr[0].toUpperCase()+jr.slice(1)))}Dr(Sr,"onAnimationEnd"),Dr(Nr,"onAnimationIteration"),Dr(Tr,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Ir,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,i,s,u,l){if(ze.apply(this,arguments),Me){if(!Me)throw Error(a(198));var c=Fe;Me=!1,Fe=null,Le||(Le=!0,Be=c)}}(r,t,void 0,e),e.currentTarget=null}function Lr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var i=r.length-1;0<=i;i--){var s=r[i],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==a&&o.isPropagationStopped())break e;Fr(o,s,l),a=u}else for(i=0;i<r.length;i++){if(u=(s=r[i]).instance,l=s.currentTarget,s=s.listener,u!==a&&o.isPropagationStopped())break e;Fr(o,s,l),a=u}}}if(Le)throw e=Be,Le=!1,Be=null,e}function Br(e,t){var n=t[vo];void 0===n&&(n=t[vo]=new Set);var r=e+"__bubble";n.has(r)||(Vr(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),Vr(n,e,r,t)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[zr]){e[zr]=!0,i.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||Ur(t,!1,e),Ur(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zr]||(t[zr]=!0,Ur("selectionchange",!1,t))}}function Vr(e,t,n,r){switch($t(t)){case 1:var o=qt;break;case 4:o=Gt;break;default:o=Kt}n=o.bind(null,t,n,e),o=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var i=r.tag;if(3===i||4===i){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===i)for(i=r.return;null!==i;){var u=i.tag;if((3===u||4===u)&&((u=i.stateNode.containerInfo)===o||8===u.nodeType&&u.parentNode===o))return;i=i.return}for(;null!==s;){if(null===(i=bo(s)))return;if(5===(u=i.tag)||6===u){r=a=i;continue e}s=s.parentNode}}r=r.return}Ae(function(){var r=a,o=we(n),i=[];e:{var s=Rr.get(e);if(void 0!==s){var u=cn,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Nn;break;case"focusin":l="focus",u=vn;break;case"focusout":l="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=In;break;case Sr:case Nr:case Tr:u=gn;break;case Ir:u=Rn;break;case"scroll":u=hn;break;case"wheel":u=Dn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Tn}var c=0!==(4&t),d=!c&&"scroll"===e,h=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=De(p,h))&&c.push(qr(p,m,f)))),d)break;p=p.return}0<c.length&&(s=new u(s,l,null,n,o),i.push({event:s,listeners:c}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(l=n.relatedTarget||n.fromElement)||!bo(l)&&!l[mo])&&(u||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(l=(l=n.relatedTarget||n.toElement)?bo(l):null)&&(l!==(d=We(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(u=null,l=r),u!==l)){if(c=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Tn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==u?s:wo(u),f=null==l?s:wo(l),(s=new c(m,p+"leave",u,n,o)).target=d,s.relatedTarget=f,m=null,bo(o)===r&&((c=new c(h,p+"enter",l,n,o)).target=f,c.relatedTarget=d,m=c),d=m,u&&l)e:{for(h=l,p=0,f=c=u;f;f=Kr(f))p++;for(f=0,m=h;m;m=Kr(m))f++;for(;0<p-f;)c=Kr(c),p--;for(;0<f-p;)h=Kr(h),f--;for(;p--;){if(c===h||null!==h&&c===h.alternate)break e;c=Kr(c),h=Kr(h)}c=null}else c=null;null!==u&&Xr(i,s,u,c,!1),null!==l&&null!==d&&Xr(i,d,l,c,!0)}if("select"===(u=(s=r?wo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=$n;else if(Hn(s))if(Jn)v=ir;else{v=or;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ar);switch(v&&(v=v(e,r))?qn(i,v,n,o):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?wo(r):window,e){case"focusin":(Hn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(i,n,o);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(i,n,o)}var y;if(jn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Wn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Wn&&(y=en()):(Qt="value"in(Jt=o)?Jt.value:Jt.textContent,Wn=!0)),0<(g=Gr(r,b)).length&&(b=new xn(b,e,null,n,o),i.push({event:b,listeners:g}),y?b.data=y:null!==(y=zn(n))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!jn&&Un(e,t)?(e=en(),Zt=Qt=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(o=new xn("onBeforeInput","beforeinput",null,n,o),i.push({event:o,listeners:r}),o.data=y))}Lr(i,t)})}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;5===o.tag&&null!==a&&(o=a,null!=(a=De(e,n))&&r.unshift(qr(e,a,o)),null!=(a=De(e,t))&&r.push(qr(e,a,o))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,o){for(var a=t._reactName,i=[];null!==n&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==l&&(s=l,o?null!=(u=De(n,a))&&i.unshift(qr(n,u,s)):o||null!=(u=De(n,a))&&i.push(qr(n,u,s))),n=n.return}0!==i.length&&e.push({event:t,listeners:i})}var Yr=/\r\n?/g,$r=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace($r,"")}function Qr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,ao="function"===typeof Promise?Promise:void 0,io="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ao?function(e){return ao.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout(function(){throw e})}function uo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);Wt(t)}function lo(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function co(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ho=Math.random().toString(36).slice(2),fo="__reactFiber$"+ho,po="__reactProps$"+ho,mo="__reactContainer$"+ho,vo="__reactEvents$"+ho,go="__reactListeners$"+ho,yo="__reactHandles$"+ho;function bo(e){var t=e[fo];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mo]||n[fo]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=co(e);null!==e;){if(n=e[fo])return n;e=co(e)}return t}n=(e=n).parentNode}return null}function xo(e){return!(e=e[fo]||e[mo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function ko(e){return e[po]||null}var _o=[],Eo=-1;function Co(e){return{current:e}}function So(e){0>Eo||(e.current=_o[Eo],_o[Eo]=null,Eo--)}function No(e,t){Eo++,_o[Eo]=e.current,e.current=t}var To={},Io=Co(To),Ro=Co(!1),Ao=To;function Do(e,t){var n=e.type.contextTypes;if(!n)return To;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,a={};for(o in n)a[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Po(e){return null!==(e=e.childContextTypes)&&void 0!==e}function jo(){So(Ro),So(Io)}function Oo(e,t,n){if(Io.current!==To)throw Error(a(168));No(Io,t),No(Ro,n)}function Mo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(a(108,V(e)||"Unknown",o));return F({},n,r)}function Fo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||To,Ao=Io.current,No(Io,e),No(Ro,Ro.current),!0}function Lo(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Mo(e,t,Ao),r.__reactInternalMemoizedMergedChildContext=e,So(Ro),So(Io),No(Io,e)):So(Ro),No(Ro,n)}var Bo=null,Uo=!1,zo=!1;function Wo(e){null===Bo?Bo=[e]:Bo.push(e)}function Vo(){if(!zo&&null!==Bo){zo=!0;var e=0,t=bt;try{var n=Bo;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Bo=null,Uo=!1}catch(o){throw null!==Bo&&(Bo=Bo.slice(e+1)),Ke(Ze,Vo),o}finally{bt=t,zo=!1}}return null}var Ho=[],qo=0,Go=null,Ko=0,Xo=[],Yo=0,$o=null,Jo=1,Qo="";function Zo(e,t){Ho[qo++]=Ko,Ho[qo++]=Go,Go=e,Ko=t}function ea(e,t,n){Xo[Yo++]=Jo,Xo[Yo++]=Qo,Xo[Yo++]=$o,$o=e;var r=Jo;e=Qo;var o=32-it(r)-1;r&=~(1<<o),n+=1;var a=32-it(t)+o;if(30<a){var i=o-o%5;a=(r&(1<<i)-1).toString(32),r>>=i,o-=i,Jo=1<<32-it(t)+o|n<<o|r,Qo=a+e}else Jo=1<<a|n<<o|r,Qo=e}function ta(e){null!==e.return&&(Zo(e,1),ea(e,1,0))}function na(e){for(;e===Go;)Go=Ho[--qo],Ho[qo]=null,Ko=Ho[--qo],Ho[qo]=null;for(;e===$o;)$o=Xo[--Yo],Xo[Yo]=null,Qo=Xo[--Yo],Xo[Yo]=null,Jo=Xo[--Yo],Xo[Yo]=null}var ra=null,oa=null,aa=!1,ia=null;function sa(e,t){var n=Al(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ua(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ra=e,oa=lo(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ra=e,oa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==$o?{id:Jo,overflow:Qo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Al(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ra=e,oa=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(aa){var t=oa;if(t){var n=t;if(!ua(e,t)){if(la(e))throw Error(a(418));t=lo(n.nextSibling);var r=ra;t&&ua(e,t)?sa(r,n):(e.flags=-4097&e.flags|2,aa=!1,ra=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,aa=!1,ra=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ra=e}function ha(e){if(e!==ra)return!1;if(!aa)return da(e),aa=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oa)){if(la(e))throw fa(),Error(a(418));for(;t;)sa(e,t),t=lo(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oa=lo(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oa=null}}else oa=ra?lo(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=oa;e;)e=lo(e.nextSibling)}function pa(){oa=ra=null,aa=!1}function ma(e){null===ia?ia=[e]:ia.push(e)}var va=x.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var o=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=o.refs;null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function ya(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function xa(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Pl(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Fl(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===_?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&ba(a)===t.type)?((r=o(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=jl(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ll(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Ol(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=jl(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case k:return(t=Ll(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Ol(t,e.mode,n,null)).return=e,t;ya(e,t)}return null}function f(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===o?l(e,t,n,r):null;case k:return n.key===o?c(e,t,n,r):null;case D:return f(e,t,(o=n._init)(n._payload),r)}if(te(n)||O(n))return null!==o?null:d(e,t,n,r,null);ya(e,n)}return null}function p(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case D:return p(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||O(r))return d(t,e=e.get(n)||null,r,o,null);ya(t,r)}return null}function m(o,a,s,u){for(var l=null,c=null,d=a,m=a=0,v=null;null!==d&&m<s.length;m++){d.index>m?(v=d,d=null):v=d.sibling;var g=f(o,d,s[m],u);if(null===g){null===d&&(d=v);break}e&&d&&null===g.alternate&&t(o,d),a=i(g,a,m),null===c?l=g:c.sibling=g,c=g,d=v}if(m===s.length)return n(o,d),aa&&Zo(o,m),l;if(null===d){for(;m<s.length;m++)null!==(d=h(o,s[m],u))&&(a=i(d,a,m),null===c?l=d:c.sibling=d,c=d);return aa&&Zo(o,m),l}for(d=r(o,d);m<s.length;m++)null!==(v=p(d,o,m,s[m],u))&&(e&&null!==v.alternate&&d.delete(null===v.key?m:v.key),a=i(v,a,m),null===c?l=v:c.sibling=v,c=v);return e&&d.forEach(function(e){return t(o,e)}),aa&&Zo(o,m),l}function v(o,s,u,l){var c=O(u);if("function"!==typeof c)throw Error(a(150));if(null==(u=c.call(u)))throw Error(a(151));for(var d=c=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=f(o,m,y.value,l);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(o,m),s=i(b,s,v),null===d?c=b:d.sibling=b,d=b,m=g}if(y.done)return n(o,m),aa&&Zo(o,v),c;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=h(o,y.value,l))&&(s=i(y,s,v),null===d?c=y:d.sibling=y,d=y);return aa&&Zo(o,v),c}for(m=r(o,m);!y.done;v++,y=u.next())null!==(y=p(m,o,v,y.value,l))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=i(y,s,v),null===d?c=y:d.sibling=y,d=y);return e&&m.forEach(function(e){return t(o,e)}),aa&&Zo(o,v),c}return function e(r,a,i,u){if("object"===typeof i&&null!==i&&i.type===_&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case w:e:{for(var l=i.key,c=a;null!==c;){if(c.key===l){if((l=i.type)===_){if(7===c.tag){n(r,c.sibling),(a=o(c,i.props.children)).return=r,r=a;break e}}else if(c.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===D&&ba(l)===c.type){n(r,c.sibling),(a=o(c,i.props)).ref=ga(r,c,i),a.return=r,r=a;break e}n(r,c);break}t(r,c),c=c.sibling}i.type===_?((a=Ol(i.props.children,r.mode,u,i.key)).return=r,r=a):((u=jl(i.type,i.key,i.props,null,r.mode,u)).ref=ga(r,a,i),u.return=r,r=u)}return s(r);case k:e:{for(c=i.key;null!==a;){if(a.key===c){if(4===a.tag&&a.stateNode.containerInfo===i.containerInfo&&a.stateNode.implementation===i.implementation){n(r,a.sibling),(a=o(a,i.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Ll(i,r.mode,u)).return=r,r=a}return s(r);case D:return e(r,a,(c=i._init)(i._payload),u)}if(te(i))return m(r,a,i,u);if(O(i))return v(r,a,i,u);ya(r,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==a&&6===a.tag?(n(r,a.sibling),(a=o(a,i)).return=r,r=a):(n(r,a),(a=Fl(i,r.mode,u)).return=r,r=a),s(r)):n(r,a)}}var wa=xa(!0),ka=xa(!1),_a=Co(null),Ea=null,Ca=null,Sa=null;function Na(){Sa=Ca=Ea=null}function Ta(e){var t=_a.current;So(_a),e._currentValue=t}function Ia(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ra(e,t){Ea=e,Sa=Ca=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Aa(e){var t=e._currentValue;if(Sa!==e)if(e={context:e,memoizedValue:t,next:null},null===Ca){if(null===Ea)throw Error(a(308));Ca=e,Ea.dependencies={lanes:0,firstContext:e}}else Ca=Ca.next=e;return t}var Da=null;function Pa(e){null===Da?Da=[e]:Da.push(e)}function ja(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Pa(t)):(n.next=o.next,o.next=n),t.interleaved=n,Oa(e,r)}function Oa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ma=!1;function Fa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function La(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ua(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Tu)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Oa(e,n)}return null===(o=r.interleaved)?(t.next=t,Pa(r)):(t.next=o.next,o.next=t),r.interleaved=t,Oa(e,n)}function za(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Wa(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?o=a=i:a=a.next=i,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Va(e,t,n,r){var o=e.updateQueue;Ma=!1;var a=o.firstBaseUpdate,i=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,l=u.next;u.next=null,null===i?a=l:i.next=l,i=u;var c=e.alternate;null!==c&&((s=(c=c.updateQueue).lastBaseUpdate)!==i&&(null===s?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(null!==a){var d=o.baseState;for(i=0,c=l=u=null,s=a;;){var h=s.lane,f=s.eventTime;if((r&h)===h){null!==c&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=F({},d,h);break e;case 2:Ma=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=o.effects)?o.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===c?(l=c=f,u=d):c=c.next=f,i|=h;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(h=s).next,h.next=null,o.lastBaseUpdate=h,o.shared.pending=null}}if(null===c&&(u=d),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,null!==(t=o.shared.interleaved)){o=t;do{i|=o.lane,o=o.next}while(o!==t)}else null===a&&(o.shared.lanes=0);Mu|=i,e.lanes=i,e.memoizedState=d}}function Ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!==typeof o)throw Error(a(191,o));o.call(r)}}}var qa={},Ga=Co(qa),Ka=Co(qa),Xa=Co(qa);function Ya(e){if(e===qa)throw Error(a(174));return e}function $a(e,t){switch(No(Xa,t),No(Ka,e),No(Ga,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}So(Ga),No(Ga,t)}function Ja(){So(Ga),So(Ka),So(Xa)}function Qa(e){Ya(Xa.current);var t=Ya(Ga.current),n=ue(t,e.type);t!==n&&(No(Ka,e),No(Ga,n))}function Za(e){Ka.current===e&&(So(Ga),So(Ka))}var ei=Co(0);function ti(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ni=[];function ri(){for(var e=0;e<ni.length;e++)ni[e]._workInProgressVersionPrimary=null;ni.length=0}var oi=x.ReactCurrentDispatcher,ai=x.ReactCurrentBatchConfig,ii=0,si=null,ui=null,li=null,ci=!1,di=!1,hi=0,fi=0;function pi(){throw Error(a(321))}function mi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function vi(e,t,n,r,o,i){if(ii=i,si=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oi.current=null===e||null===e.memoizedState?Zi:es,e=n(r,o),di){i=0;do{if(di=!1,hi=0,25<=i)throw Error(a(301));i+=1,li=ui=null,t.updateQueue=null,oi.current=ts,e=n(r,o)}while(di)}if(oi.current=Qi,t=null!==ui&&null!==ui.next,ii=0,li=ui=si=null,ci=!1,t)throw Error(a(300));return e}function gi(){var e=0!==hi;return hi=0,e}function yi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===li?si.memoizedState=li=e:li=li.next=e,li}function bi(){if(null===ui){var e=si.alternate;e=null!==e?e.memoizedState:null}else e=ui.next;var t=null===li?si.memoizedState:li.next;if(null!==t)li=t,ui=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ui=e).memoizedState,baseState:ui.baseState,baseQueue:ui.baseQueue,queue:ui.queue,next:null},null===li?si.memoizedState=li=e:li=li.next=e}return li}function xi(e,t){return"function"===typeof t?t(e):t}function wi(e){var t=bi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=ui,o=r.baseQueue,i=n.pending;if(null!==i){if(null!==o){var s=o.next;o.next=i.next,i.next=s}r.baseQueue=o=i,n.pending=null}if(null!==o){i=o.next,r=r.baseState;var u=s=null,l=null,c=i;do{var d=c.lane;if((ii&d)===d)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(u=l=h,s=r):l=l.next=h,si.lanes|=d,Mu|=d}c=c.next}while(null!==c&&c!==i);null===l?s=r:l.next=u,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{i=o.lane,si.lanes|=i,Mu|=i,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ki(e){var t=bi(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{i=e(i,s.action),s=s.next}while(s!==o);sr(i,t.memoizedState)||(bs=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function _i(){}function Ei(e,t){var n=si,r=bi(),o=t(),i=!sr(r.memoizedState,o);if(i&&(r.memoizedState=o,bs=!0),r=r.queue,Mi(Ni.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==li&&1&li.memoizedState.tag){if(n.flags|=2048,Ai(9,Si.bind(null,n,r,o,t),void 0,null),null===Iu)throw Error(a(349));0!==(30&ii)||Ci(n,t,o)}return o}function Ci(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=si.updateQueue)?(t={lastEffect:null,stores:null},si.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Si(e,t,n,r){t.value=n,t.getSnapshot=r,Ti(t)&&Ii(e)}function Ni(e,t,n){return n(function(){Ti(t)&&Ii(e)})}function Ti(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Ii(e){var t=Oa(e,1);null!==t&&nl(t,e,1,-1)}function Ri(e){var t=yi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xi,lastRenderedState:e},t.queue=e,e=e.dispatch=Xi.bind(null,si,e),[t.memoizedState,e]}function Ai(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=si.updateQueue)?(t={lastEffect:null,stores:null},si.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Di(){return bi().memoizedState}function Pi(e,t,n,r){var o=yi();si.flags|=e,o.memoizedState=Ai(1|t,n,void 0,void 0===r?null:r)}function ji(e,t,n,r){var o=bi();r=void 0===r?null:r;var a=void 0;if(null!==ui){var i=ui.memoizedState;if(a=i.destroy,null!==r&&mi(r,i.deps))return void(o.memoizedState=Ai(t,n,a,r))}si.flags|=e,o.memoizedState=Ai(1|t,n,a,r)}function Oi(e,t){return Pi(8390656,8,e,t)}function Mi(e,t){return ji(2048,8,e,t)}function Fi(e,t){return ji(4,2,e,t)}function Li(e,t){return ji(4,4,e,t)}function Bi(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ui(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ji(4,4,Bi.bind(null,t,e),n)}function zi(){}function Wi(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Vi(e,t){var n=bi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Hi(e,t,n){return 0===(21&ii)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),si.lanes|=n,Mu|=n,e.baseState=!0),t)}function qi(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=ai.transition;ai.transition={};try{e(!1),t()}finally{bt=n,ai.transition=r}}function Gi(){return bi().memoizedState}function Ki(e,t,n){var r=tl(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Yi(e))$i(t,n);else if(null!==(n=ja(e,t,n,r))){nl(n,e,r,el()),Ji(n,t,r)}}function Xi(e,t,n){var r=tl(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yi(e))$i(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var i=t.lastRenderedState,s=a(i,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,i)){var u=t.interleaved;return null===u?(o.next=o,Pa(t)):(o.next=u.next,u.next=o),void(t.interleaved=o)}}catch(l){}null!==(n=ja(e,t,o,r))&&(nl(n,e,r,o=el()),Ji(n,t,r))}}function Yi(e){var t=e.alternate;return e===si||null!==t&&t===si}function $i(e,t){di=ci=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ji(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Qi={readContext:Aa,useCallback:pi,useContext:pi,useEffect:pi,useImperativeHandle:pi,useInsertionEffect:pi,useLayoutEffect:pi,useMemo:pi,useReducer:pi,useRef:pi,useState:pi,useDebugValue:pi,useDeferredValue:pi,useTransition:pi,useMutableSource:pi,useSyncExternalStore:pi,useId:pi,unstable_isNewReconciler:!1},Zi={readContext:Aa,useCallback:function(e,t){return yi().memoizedState=[e,void 0===t?null:t],e},useContext:Aa,useEffect:Oi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pi(4194308,4,Bi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pi(4,2,e,t)},useMemo:function(e,t){var n=yi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=yi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ki.bind(null,si,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yi().memoizedState=e},useState:Ri,useDebugValue:zi,useDeferredValue:function(e){return yi().memoizedState=e},useTransition:function(){var e=Ri(!1),t=e[0];return e=qi.bind(null,e[1]),yi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=si,o=yi();if(aa){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Iu)throw Error(a(349));0!==(30&ii)||Ci(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,Oi(Ni.bind(null,r,i,e),[e]),r.flags|=2048,Ai(9,Si.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=yi(),t=Iu.identifierPrefix;if(aa){var n=Qo;t=":"+t+"R"+(n=(Jo&~(1<<32-it(Jo)-1)).toString(32)+n),0<(n=hi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Aa,useCallback:Wi,useContext:Aa,useEffect:Mi,useImperativeHandle:Ui,useInsertionEffect:Fi,useLayoutEffect:Li,useMemo:Vi,useReducer:wi,useRef:Di,useState:function(){return wi(xi)},useDebugValue:zi,useDeferredValue:function(e){return Hi(bi(),ui.memoizedState,e)},useTransition:function(){return[wi(xi)[0],bi().memoizedState]},useMutableSource:_i,useSyncExternalStore:Ei,useId:Gi,unstable_isNewReconciler:!1},ts={readContext:Aa,useCallback:Wi,useContext:Aa,useEffect:Mi,useImperativeHandle:Ui,useInsertionEffect:Fi,useLayoutEffect:Li,useMemo:Vi,useReducer:ki,useRef:Di,useState:function(){return ki(xi)},useDebugValue:zi,useDeferredValue:function(e){var t=bi();return null===ui?t.memoizedState=e:Hi(t,ui.memoizedState,e)},useTransition:function(){return[ki(xi)[0],bi().memoizedState]},useMutableSource:_i,useSyncExternalStore:Ei,useId:Gi,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=el(),o=tl(e),a=Ba(r,o);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,o))&&(nl(t,e,o,r),za(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=el(),o=tl(e),a=Ba(r,o);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,o))&&(nl(t,e,o,r),za(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),r=tl(e),o=Ba(n,r);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=Ua(e,o,r))&&(nl(t,e,r,n),za(t,e,r))}};function as(e,t,n,r,o,a,i){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,i):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(o,a))}function is(e,t,n){var r=!1,o=To,a=t.contextType;return"object"===typeof a&&null!==a?a=Aa(a):(o=Po(t)?Ao:Io.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Do(e,o):To),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function us(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Fa(e);var a=t.contextType;"object"===typeof a&&null!==a?o.context=Aa(a):(a=Po(t)?Ao:Io.current,o.context=Do(e,a)),o.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&os.enqueueReplaceState(o,o.state,null),Va(e,n,o,r),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function ls(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var o=n}catch(a){o="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:o,digest:null}}function cs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var hs="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Ba(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hu||(Hu=!0,qu=r),ds(0,t)},n}function ps(e,t,n){(n=Ba(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Gu?Gu=new Set([this]):Gu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new hs;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Cl.bind(null,e,t,n),t.then(e,e))}function vs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function gs(e,t,n,r,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ba(-1,1)).tag=2,Ua(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var ys=x.ReactCurrentOwner,bs=!1;function xs(e,t,n,r){t.child=null===e?ka(t,null,n,r):wa(t,e.child,n,r)}function ws(e,t,n,r,o){n=n.render;var a=t.ref;return Ra(t,o),r=vi(e,t,n,r,a,o),n=gi(),null===e||bs?(aa&&n&&ta(t),t.flags|=1,xs(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hs(e,t,o))}function ks(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||Dl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=jl(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,_s(e,t,a,r,o))}if(a=e.child,0===(e.lanes&o)){var i=a.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(i,r)&&e.ref===t.ref)return Hs(e,t,o)}return t.flags|=1,(e=Pl(a,r)).ref=t.ref,e.return=t,t.child=e}function _s(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(ur(a,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=a,0===(e.lanes&o))return t.lanes=e.lanes,Hs(e,t,o);0!==(131072&e.flags)&&(bs=!0)}}return Ss(e,t,n,r,o)}function Es(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},No(Pu,Du),Du|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,No(Pu,Du),Du|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,No(Pu,Du),Du|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,No(Pu,Du),Du|=r;return xs(e,t,o,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ss(e,t,n,r,o){var a=Po(n)?Ao:Io.current;return a=Do(t,a),Ra(t,o),n=vi(e,t,n,r,a,o),r=gi(),null===e||bs?(aa&&r&&ta(t),t.flags|=1,xs(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Hs(e,t,o))}function Ns(e,t,n,r,o){if(Po(n)){var a=!0;Fo(t)}else a=!1;if(Ra(t,o),null===t.stateNode)Vs(e,t),is(t,n,r),us(t,n,r,o),r=!0;else if(null===e){var i=t.stateNode,s=t.memoizedProps;i.props=s;var u=i.context,l=n.contextType;"object"===typeof l&&null!==l?l=Aa(l):l=Do(t,l=Po(n)?Ao:Io.current);var c=n.getDerivedStateFromProps,d="function"===typeof c||"function"===typeof i.getSnapshotBeforeUpdate;d||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s!==r||u!==l)&&ss(t,i,r,l),Ma=!1;var h=t.memoizedState;i.state=h,Va(t,r,i,o),u=t.memoizedState,s!==r||h!==u||Ro.current||Ma?("function"===typeof c&&(rs(t,n,c,r),u=t.memoizedState),(s=Ma||as(t,n,s,r,h,u,l))?(d||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),i.props=r,i.state=u,i.context=l,r=s):("function"===typeof i.componentDidMount&&(t.flags|=4194308),r=!1)}else{i=t.stateNode,La(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:ns(t.type,s),i.props=l,d=t.pendingProps,h=i.context,"object"===typeof(u=n.contextType)&&null!==u?u=Aa(u):u=Do(t,u=Po(n)?Ao:Io.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s!==d||h!==u)&&ss(t,i,r,u),Ma=!1,h=t.memoizedState,i.state=h,Va(t,r,i,o);var p=t.memoizedState;s!==d||h!==p||Ro.current||Ma?("function"===typeof f&&(rs(t,n,f,r),p=t.memoizedState),(l=Ma||as(t,n,l,r,h,p,u)||!1)?(c||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(r,p,u),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),i.props=r,i.state=p,i.context=u,r=l):("function"!==typeof i.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ts(e,t,n,r,a,o)}function Ts(e,t,n,r,o,a){Cs(e,t);var i=0!==(128&t.flags);if(!r&&!i)return o&&Lo(t,n,!1),Hs(e,t,a);r=t.stateNode,ys.current=t;var s=i&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&i?(t.child=wa(t,e.child,null,a),t.child=wa(t,null,s,a)):xs(e,t,s,a),t.memoizedState=r.state,o&&Lo(t,n,!0),t.child}function Is(e){var t=e.stateNode;t.pendingContext?Oo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oo(0,t.context,!1),$a(e,t.containerInfo)}function Rs(e,t,n,r,o){return pa(),ma(o),t.flags|=256,xs(e,t,n,r),t.child}var As,Ds,Ps,js,Os={dehydrated:null,treeContext:null,retryLane:0};function Ms(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var r,o=t.pendingProps,i=ei.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),No(ei,1&i),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=o.children,e=o.fallback,s?(o=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Ml(u,o,0,null),e=Ol(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ms(n),t.memoizedState=Os,e):Ls(t,u));if(null!==(i=e.memoizedState)&&null!==(r=i.dehydrated))return function(e,t,n,r,o,i,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=cs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=Ml({mode:"visible",children:r.children},o,0,null),(i=Ol(i,o,s,null)).flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,0!==(1&t.mode)&&wa(t,e.child,null,s),t.child.memoizedState=Ms(s),t.memoizedState=Os,i);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var u=r.dgst;return r=u,Bs(e,t,s,r=cs(i=Error(a(419)),r,void 0))}if(u=0!==(s&e.childLanes),bs||u){if(null!==(r=Iu)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|s))?0:o)&&o!==i.retryLane&&(i.retryLane=o,Oa(e,o),nl(r,e,o,-1))}return ml(),Bs(e,t,s,r=cs(Error(a(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Nl.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,oa=lo(o.nextSibling),ra=t,aa=!0,ia=null,null!==e&&(Xo[Yo++]=Jo,Xo[Yo++]=Qo,Xo[Yo++]=$o,Jo=e.id,Qo=e.overflow,$o=t),t=Ls(t,r.children),t.flags|=4096,t)}(e,t,u,o,r,i,n);if(s){s=o.fallback,u=t.mode,r=(i=e.child).sibling;var l={mode:"hidden",children:o.children};return 0===(1&u)&&t.child!==i?((o=t.child).childLanes=0,o.pendingProps=l,t.deletions=null):(o=Pl(i,l)).subtreeFlags=14680064&i.subtreeFlags,null!==r?s=Pl(r,s):(s=Ol(s,u,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,u=null===(u=e.child.memoizedState)?Ms(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Os,o}return e=(s=e.child).sibling,o=Pl(s,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Ls(e,t){return(t=Ml({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&ma(r),wa(t,e.child,null,n),(e=Ls(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ia(e.return,t,n)}function zs(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Ws(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(xs(e,t,r.children,n),0!==(2&(r=ei.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(No(ei,r),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ti(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),zs(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ti(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}zs(t,!0,n,null,a);break;case"together":zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Vs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Pl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qs(e,t){if(!aa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ks(e,t,n){var r=t.pendingProps;switch(na(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Po(t.type)&&jo(),Gs(t),null;case 3:return r=t.stateNode,Ja(),So(Ro),So(Io),ri(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ha(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ia&&(il(ia),ia=null))),Ds(e,t),Gs(t),null;case 5:Za(t);var o=Ya(Xa.current);if(n=t.type,null!==e&&null!=t.stateNode)Ps(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Gs(t),null}if(e=Ya(Ga.current),ha(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[fo]=t,r[po]=i,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(o=0;o<Or.length;o++)Br(Or[o],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":$(r,i),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Br("invalid",r);break;case"textarea":oe(r,i),Br("invalid",r)}for(var u in ye(n,i),o=null,i)if(i.hasOwnProperty(u)){var l=i[u];"children"===u?"string"===typeof l?r.textContent!==l&&(!0!==i.suppressHydrationWarning&&Qr(r.textContent,l,e),o=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==i.suppressHydrationWarning&&Qr(r.textContent,l,e),o=["children",""+l]):s.hasOwnProperty(u)&&null!=l&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":G(r),Z(r,i,!0);break;case"textarea":G(r),ie(r);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[fo]=t,e[po]=r,As(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),o=r;break;case"iframe":case"object":case"embed":Br("load",e),o=r;break;case"video":case"audio":for(o=0;o<Or.length;o++)Br(Or[o],e);o=r;break;case"source":Br("error",e),o=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),o=r;break;case"details":Br("toggle",e),o=r;break;case"input":$(e,r),o=Y(e,r),Br("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Br("invalid",e)}for(i in ye(n,o),l=o)if(l.hasOwnProperty(i)){var c=l[i];"style"===i?ve(e,c):"dangerouslySetInnerHTML"===i?null!=(c=c?c.__html:void 0)&&de(e,c):"children"===i?"string"===typeof c?("textarea"!==n||""!==c)&&he(e,c):"number"===typeof c&&he(e,""+c):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(s.hasOwnProperty(i)?null!=c&&"onScroll"===i&&Br("scroll",e):null!=c&&b(e,i,c,u))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),ie(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(i=r.value)?ne(e,!!r.multiple,i,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)js(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ya(Xa.current),Ya(Ga.current),ha(t)){if(r=t.stateNode,n=t.memoizedProps,r[fo]=t,(i=r.nodeValue!==n)&&null!==(e=ra))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}i&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fo]=t,t.stateNode=r}return Gs(t),null;case 13:if(So(ei),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(aa&&null!==oa&&0!==(1&t.mode)&&0===(128&t.flags))fa(),pa(),t.flags|=98560,i=!1;else if(i=ha(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317));i[fo]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),i=!1}else null!==ia&&(il(ia),ia=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ei.current)?0===ju&&(ju=3):ml())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Ja(),Ds(e,t),null===e&&Wr(t.stateNode.containerInfo),Gs(t),null;case 10:return Ta(t.type._context),Gs(t),null;case 19:if(So(ei),null===(i=t.memoizedState))return Gs(t),null;if(r=0!==(128&t.flags),null===(u=i.rendering))if(r)qs(i,!1);else{if(0!==ju||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=ti(e))){for(t.flags|=128,qs(i,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(i=n).flags&=14680066,null===(u=i.alternate)?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,e=u.dependencies,i.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return No(ei,1&ei.current|2),t.child}e=e.sibling}null!==i.tail&&Je()>Wu&&(t.flags|=128,r=!0,qs(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ti(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qs(i,!0),null===i.tail&&"hidden"===i.tailMode&&!u.alternate&&!aa)return Gs(t),null}else 2*Je()-i.renderingStartTime>Wu&&1073741824!==n&&(t.flags|=128,r=!0,qs(i,!1),t.lanes=4194304);i.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=i.last)?n.sibling=u:t.child=u,i.last=u)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Je(),t.sibling=null,n=ei.current,No(ei,r?1&n|2:1&n),t):(Gs(t),null);case 22:case 23:return dl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Du)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Xs(e,t){switch(na(t),t.tag){case 1:return Po(t.type)&&jo(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ja(),So(Ro),So(Io),ri(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(So(ei),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return So(ei),null;case 4:return Ja(),null;case 10:return Ta(t.type._context),null;case 22:case 23:return dl(),null;default:return null}}As=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ps=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Ya(Ga.current);var a,i=null;switch(n){case"input":o=Y(e,o),r=Y(e,r),i=[];break;case"select":o=F({},o,{value:void 0}),r=F({},r,{value:void 0}),i=[];break;case"textarea":o=re(e,o),r=re(e,r),i=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(c in ye(n,r),n=null,o)if(!r.hasOwnProperty(c)&&o.hasOwnProperty(c)&&null!=o[c])if("style"===c){var u=o[c];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(s.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(u=null!=o?o[c]:void 0,r.hasOwnProperty(c)&&l!==u&&(null!=l||null!=u))if("style"===c)if(u){for(a in u)!u.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&u[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(i||(i=[]),i.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(i=i||[]).push(c,l)):"children"===c?"string"!==typeof l&&"number"!==typeof l||(i=i||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(s.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Br("scroll",e),i||u===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(t.updateQueue=c)&&(t.flags|=4)}},js=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,$s=!1,Js="function"===typeof WeakSet?WeakSet:Set,Qs=null;function Zs(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){El(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){El(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var a=o.destroy;o.destroy=void 0,void 0!==a&&eu(t,n,a)}o=o.next}while(o!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ou(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fo],delete t[po],delete t[vo],delete t[go],delete t[yo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function iu(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||iu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var cu=null,du=!1;function hu(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:$s||Zs(n,t);case 6:var r=cu,o=du;cu=null,hu(e,t,n),du=o,null!==(cu=r)&&(du?(e=cu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cu.removeChild(n.stateNode));break;case 18:null!==cu&&(du?(e=cu,n=n.stateNode,8===e.nodeType?uo(e.parentNode,n):1===e.nodeType&&uo(e,n),Wt(e)):uo(cu,n.stateNode));break;case 4:r=cu,o=du,cu=n.stateNode.containerInfo,du=!0,hu(e,t,n),cu=r,du=o;break;case 0:case 11:case 14:case 15:if(!$s&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var a=o,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&eu(n,t,i),o=o.next}while(o!==r)}hu(e,t,n);break;case 1:if(!$s&&(Zs(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){El(n,t,s)}hu(e,t,n);break;case 21:hu(e,t,n);break;case 22:1&n.mode?($s=(r=$s)||null!==n.memoizedState,hu(e,t,n),$s=r):hu(e,t,n);break;default:hu(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach(function(t){var r=Tl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function mu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:cu=u.stateNode,du=!1;break e;case 3:case 4:cu=u.stateNode.containerInfo,du=!0;break e}u=u.return}if(null===cu)throw Error(a(160));fu(i,s,o),cu=null,du=!1;var l=o.alternate;null!==l&&(l.return=null),o.return=null}catch(c){El(o,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vu(t,e),t=t.sibling}function vu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mu(t,e),gu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(v){El(e,e.return,v)}try{nu(5,e,e.return)}catch(v){El(e,e.return,v)}}break;case 1:mu(t,e),gu(e),512&r&&null!==n&&Zs(n,n.return);break;case 5:if(mu(t,e),gu(e),512&r&&null!==n&&Zs(n,n.return),32&e.flags){var o=e.stateNode;try{he(o,"")}catch(v){El(e,e.return,v)}}if(4&r&&null!=(o=e.stateNode)){var i=e.memoizedProps,s=null!==n?n.memoizedProps:i,u=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===u&&"radio"===i.type&&null!=i.name&&J(o,i),be(u,s);var c=be(u,i);for(s=0;s<l.length;s+=2){var d=l[s],h=l[s+1];"style"===d?ve(o,h):"dangerouslySetInnerHTML"===d?de(o,h):"children"===d?he(o,h):b(o,d,h,c)}switch(u){case"input":Q(o,i);break;case"textarea":ae(o,i);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var p=i.value;null!=p?ne(o,!!i.multiple,p,!1):f!==!!i.multiple&&(null!=i.defaultValue?ne(o,!!i.multiple,i.defaultValue,!0):ne(o,!!i.multiple,i.multiple?[]:"",!1))}o[po]=i}catch(v){El(e,e.return,v)}}break;case 6:if(mu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(a(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(v){El(e,e.return,v)}}break;case 3:if(mu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(v){El(e,e.return,v)}break;case 4:default:mu(t,e),gu(e);break;case 13:mu(t,e),gu(e),8192&(o=e.child).flags&&(i=null!==o.memoizedState,o.stateNode.isHidden=i,!i||null!==o.alternate&&null!==o.alternate.memoizedState||(zu=Je())),4&r&&pu(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?($s=(c=$s)||d,mu(t,e),$s=c):mu(t,e),gu(e),8192&r){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!d&&0!==(1&e.mode))for(Qs=e,d=e.child;null!==d;){for(h=Qs=d;null!==Qs;){switch(p=(f=Qs).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:Zs(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){El(r,n,v)}}break;case 5:Zs(f,f.return);break;case 22:if(null!==f.memoizedState){wu(h);continue}}null!==p?(p.return=f,Qs=p):wu(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{o=h.stateNode,c?"function"===typeof(i=o.style).setProperty?i.setProperty("display","none","important"):i.display="none":(u=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,u.style.display=me("display",s))}catch(v){El(e,e.return,v)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){El(e,e.return,v)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mu(t,e),gu(e),4&r&&pu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(iu(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(he(o,""),r.flags&=-33),lu(e,su(e),o);break;case 3:case 4:var i=r.stateNode.containerInfo;uu(e,su(e),i);break;default:throw Error(a(161))}}catch(s){El(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yu(e,t,n){Qs=e,bu(e,t,n)}function bu(e,t,n){for(var r=0!==(1&e.mode);null!==Qs;){var o=Qs,a=o.child;if(22===o.tag&&r){var i=null!==o.memoizedState||Ys;if(!i){var s=o.alternate,u=null!==s&&null!==s.memoizedState||$s;s=Ys;var l=$s;if(Ys=i,($s=u)&&!l)for(Qs=o;null!==Qs;)u=(i=Qs).child,22===i.tag&&null!==i.memoizedState?ku(o):null!==u?(u.return=i,Qs=u):ku(o);for(;null!==a;)Qs=a,bu(a,t,n),a=a.sibling;Qs=o,Ys=s,$s=l}xu(e)}else 0!==(8772&o.subtreeFlags)&&null!==a?(a.return=o,Qs=a):xu(e)}}function xu(e){for(;null!==Qs;){var t=Qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$s||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$s)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&Ha(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ha(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var d=c.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Wt(h)}}}break;default:throw Error(a(163))}$s||512&t.flags&&ou(t)}catch(f){El(t,t.return,f)}}if(t===e){Qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qs=n;break}Qs=t.return}}function wu(e){for(;null!==Qs;){var t=Qs;if(t===e){Qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qs=n;break}Qs=t.return}}function ku(e){for(;null!==Qs;){var t=Qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){El(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(u){El(t,o,u)}}var a=t.return;try{ou(t)}catch(u){El(t,a,u)}break;case 5:var i=t.return;try{ou(t)}catch(u){El(t,i,u)}}}catch(u){El(t,t.return,u)}if(t===e){Qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Qs=s;break}Qs=t.return}}var _u,Eu=Math.ceil,Cu=x.ReactCurrentDispatcher,Su=x.ReactCurrentOwner,Nu=x.ReactCurrentBatchConfig,Tu=0,Iu=null,Ru=null,Au=0,Du=0,Pu=Co(0),ju=0,Ou=null,Mu=0,Fu=0,Lu=0,Bu=null,Uu=null,zu=0,Wu=1/0,Vu=null,Hu=!1,qu=null,Gu=null,Ku=!1,Xu=null,Yu=0,$u=0,Ju=null,Qu=-1,Zu=0;function el(){return 0!==(6&Tu)?Je():-1!==Qu?Qu:Qu=Je()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Tu)&&0!==Au?Au&-Au:null!==va.transition?(0===Zu&&(Zu=mt()),Zu):0!==(e=bt)?e:e=void 0===(e=window.event)?16:$t(e.type)}function nl(e,t,n,r){if(50<$u)throw $u=0,Ju=null,Error(a(185));gt(e,n,r),0!==(2&Tu)&&e===Iu||(e===Iu&&(0===(2&Tu)&&(Fu|=n),4===ju&&sl(e,Au)),rl(e,r),1===n&&0===Tu&&0===(1&t.mode)&&(Wu=Je()+500,Uo&&Vo()))}function rl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=e.pendingLanes;0<a;){var i=31-it(a),s=1<<i,u=o[i];-1===u?0!==(s&n)&&0===(s&r)||(o[i]=ft(s,t)):u<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ht(e,e===Iu?Au:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Uo=!0,Wo(e)}(ul.bind(null,e)):Wo(ul.bind(null,e)),io(function(){0===(6&Tu)&&Vo()}),n=null;else{switch(xt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Il(n,ol.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ol(e,t){if(Qu=-1,Zu=0,0!==(6&Tu))throw Error(a(327));var n=e.callbackNode;if(kl()&&e.callbackNode!==n)return null;var r=ht(e,e===Iu?Au:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vl(e,r);else{t=r;var o=Tu;Tu|=2;var i=pl();for(Iu===e&&Au===t||(Vu=null,Wu=Je()+500,hl(e,t));;)try{yl();break}catch(u){fl(e,u)}Na(),Cu.current=i,Tu=o,null!==Ru?t=0:(Iu=null,Au=0,t=ju)}if(0!==t){if(2===t&&(0!==(o=pt(e))&&(r=o,t=al(e,o))),1===t)throw n=Ou,hl(e,0),sl(e,r),rl(e,Je()),n;if(6===t)sl(e,r);else{if(o=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!sr(a(),o))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=vl(e,r))&&(0!==(i=pt(e))&&(r=i,t=al(e,i))),1===t))throw n=Ou,hl(e,0),sl(e,r),rl(e,Je()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:wl(e,Uu,Vu);break;case 3:if(sl(e,r),(130023424&r)===r&&10<(t=zu+500-Je())){if(0!==ht(e,0))break;if(((o=e.suspendedLanes)&r)!==r){el(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(wl.bind(null,e,Uu,Vu),t);break}wl(e,Uu,Vu);break;case 4:if(sl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-it(r);i=1<<s,(s=t[s])>o&&(o=s),r&=~i}if(r=o,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Eu(r/1960))-r)){e.timeoutHandle=ro(wl.bind(null,e,Uu,Vu),r);break}wl(e,Uu,Vu);break;default:throw Error(a(329))}}}return rl(e,Je()),e.callbackNode===n?ol.bind(null,e):null}function al(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(hl(e,t).flags|=256),2!==(e=vl(e,t))&&(t=Uu,Uu=n,null!==t&&il(t)),e}function il(e){null===Uu?Uu=e:Uu.push.apply(Uu,e)}function sl(e,t){for(t&=~Lu,t&=~Fu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function ul(e){if(0!==(6&Tu))throw Error(a(327));kl();var t=ht(e,0);if(0===(1&t))return rl(e,Je()),null;var n=vl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=al(e,r))}if(1===n)throw n=Ou,hl(e,0),sl(e,t),rl(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wl(e,Uu,Vu),rl(e,Je()),null}function ll(e,t){var n=Tu;Tu|=1;try{return e(t)}finally{0===(Tu=n)&&(Wu=Je()+500,Uo&&Vo())}}function cl(e){null!==Xu&&0===Xu.tag&&0===(6&Tu)&&kl();var t=Tu;Tu|=1;var n=Nu.transition,r=bt;try{if(Nu.transition=null,bt=1,e)return e()}finally{bt=r,Nu.transition=n,0===(6&(Tu=t))&&Vo()}}function dl(){Du=Pu.current,So(Pu)}function hl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Ru)for(n=Ru.return;null!==n;){var r=n;switch(na(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&jo();break;case 3:Ja(),So(Ro),So(Io),ri();break;case 5:Za(r);break;case 4:Ja();break;case 13:case 19:So(ei);break;case 10:Ta(r.type._context);break;case 22:case 23:dl()}n=n.return}if(Iu=e,Ru=e=Pl(e.current,null),Au=Du=t,ju=0,Ou=null,Lu=Fu=Mu=0,Uu=Bu=null,null!==Da){for(t=0;t<Da.length;t++)if(null!==(r=(n=Da[t]).interleaved)){n.interleaved=null;var o=r.next,a=n.pending;if(null!==a){var i=a.next;a.next=o,r.next=i}n.pending=r}Da=null}return e}function fl(e,t){for(;;){var n=Ru;try{if(Na(),oi.current=Qi,ci){for(var r=si.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}ci=!1}if(ii=0,li=ui=si=null,di=!1,hi=0,Su.current=null,null===n||null===n.return){ju=1,Ou=t,Ru=null;break}e:{var i=e,s=n.return,u=n,l=t;if(t=Au,u.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var c=l,d=u,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=vs(s);if(null!==p){p.flags&=-257,gs(p,s,u,0,t),1&p.mode&&ms(i,c,t),l=c;var m=(t=p).updateQueue;if(null===m){var v=new Set;v.add(l),t.updateQueue=v}else m.add(l);break e}if(0===(1&t)){ms(i,c,t),ml();break e}l=Error(a(426))}else if(aa&&1&u.mode){var g=vs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),gs(g,s,u,0,t),ma(ls(l,u));break e}}i=l=ls(l,u),4!==ju&&(ju=2),null===Bu?Bu=[i]:Bu.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,Wa(i,fs(0,l,t));break e;case 1:u=l;var y=i.type,b=i.stateNode;if(0===(128&i.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Gu||!Gu.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,Wa(i,ps(i,u,t));break e}}i=i.return}while(null!==i)}xl(n)}catch(x){t=x,Ru===n&&null!==n&&(Ru=n=n.return);continue}break}}function pl(){var e=Cu.current;return Cu.current=Qi,null===e?Qi:e}function ml(){0!==ju&&3!==ju&&2!==ju||(ju=4),null===Iu||0===(268435455&Mu)&&0===(268435455&Fu)||sl(Iu,Au)}function vl(e,t){var n=Tu;Tu|=2;var r=pl();for(Iu===e&&Au===t||(Vu=null,hl(e,t));;)try{gl();break}catch(o){fl(e,o)}if(Na(),Tu=n,Cu.current=r,null!==Ru)throw Error(a(261));return Iu=null,Au=0,ju}function gl(){for(;null!==Ru;)bl(Ru)}function yl(){for(;null!==Ru&&!Ye();)bl(Ru)}function bl(e){var t=_u(e.alternate,e,Du);e.memoizedProps=e.pendingProps,null===t?xl(e):Ru=t,Su.current=null}function xl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ks(n,t,Du)))return void(Ru=n)}else{if(null!==(n=Xs(n,t)))return n.flags&=32767,void(Ru=n);if(null===e)return ju=6,void(Ru=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ru=t);Ru=t=e}while(null!==t);0===ju&&(ju=5)}function wl(e,t,n){var r=bt,o=Nu.transition;try{Nu.transition=null,bt=1,function(e,t,n,r){do{kl()}while(null!==Xu);if(0!==(6&Tu))throw Error(a(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-it(n),a=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~a}}(e,i),e===Iu&&(Ru=Iu=null,Au=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Ku||(Ku=!0,Il(tt,function(){return kl(),null})),i=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||i){i=Nu.transition,Nu.transition=null;var s=bt;bt=1;var u=Tu;Tu|=4,Su.current=null,function(e,t){if(eo=Ht,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch(w){n=null;break e}var s=0,u=-1,l=-1,c=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==o&&3!==h.nodeType||(u=s+o),h!==i||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++c===o&&(u=s),f===i&&++d===r&&(l=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===u||-1===l?null:{start:u,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Ht=!1,Qs=t;null!==Qs;)if(e=(t=Qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Qs=e;else for(;null!==Qs;){t=Qs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:ns(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(w){El(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Qs=e;break}Qs=t.return}m=tu,tu=!1}(e,n),vu(n,e),pr(to),Ht=!!eo,to=eo=null,e.current=n,yu(n,e,o),$e(),Tu=u,bt=s,Nu.transition=i}else e.current=n;if(Ku&&(Ku=!1,Xu=e,Yu=o),i=e.pendingLanes,0===i&&(Gu=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rl(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Hu)throw Hu=!1,e=qu,qu=null,e;0!==(1&Yu)&&0!==e.tag&&kl(),i=e.pendingLanes,0!==(1&i)?e===Ju?$u++:($u=0,Ju=e):$u=0,Vo()}(e,t,n,r)}finally{Nu.transition=o,bt=r}return null}function kl(){if(null!==Xu){var e=xt(Yu),t=Nu.transition,n=bt;try{if(Nu.transition=null,bt=16>e?16:e,null===Xu)var r=!1;else{if(e=Xu,Xu=null,Yu=0,0!==(6&Tu))throw Error(a(331));var o=Tu;for(Tu|=4,Qs=e.current;null!==Qs;){var i=Qs,s=i.child;if(0!==(16&Qs.flags)){var u=i.deletions;if(null!==u){for(var l=0;l<u.length;l++){var c=u[l];for(Qs=c;null!==Qs;){var d=Qs;switch(d.tag){case 0:case 11:case 15:nu(8,d,i)}var h=d.child;if(null!==h)h.return=d,Qs=h;else for(;null!==Qs;){var f=(d=Qs).sibling,p=d.return;if(au(d),d===c){Qs=null;break}if(null!==f){f.return=p,Qs=f;break}Qs=p}}}var m=i.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}Qs=i}}if(0!==(2064&i.subtreeFlags)&&null!==s)s.return=i,Qs=s;else e:for(;null!==Qs;){if(0!==(2048&(i=Qs).flags))switch(i.tag){case 0:case 11:case 15:nu(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,Qs=y;break e}Qs=i.return}}var b=e.current;for(Qs=b;null!==Qs;){var x=(s=Qs).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Qs=x;else e:for(s=b;null!==Qs;){if(0!==(2048&(u=Qs).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(k){El(u,u.return,k)}if(u===s){Qs=null;break e}var w=u.sibling;if(null!==w){w.return=u.return,Qs=w;break e}Qs=u.return}}if(Tu=o,Vo(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(ot,e)}catch(k){}r=!0}return r}finally{bt=n,Nu.transition=t}}return!1}function _l(e,t,n){e=Ua(e,t=fs(0,t=ls(n,t),1),1),t=el(),null!==e&&(gt(e,1,t),rl(e,t))}function El(e,t,n){if(3===e.tag)_l(e,e,n);else for(;null!==t;){if(3===t.tag){_l(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gu||!Gu.has(r))){t=Ua(t,e=ps(t,e=ls(n,e),1),1),e=el(),null!==t&&(gt(t,1,e),rl(t,e));break}}t=t.return}}function Cl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,Iu===e&&(Au&n)===n&&(4===ju||3===ju&&(130023424&Au)===Au&&500>Je()-zu?hl(e,0):Lu|=n),rl(e,t)}function Sl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=el();null!==(e=Oa(e,t))&&(gt(e,t,n),rl(e,n))}function Nl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Sl(e,n)}function Tl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Sl(e,n)}function Il(e,t){return Ke(e,t)}function Rl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Al(e,t,n,r){return new Rl(e,t,n,r)}function Dl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pl(e,t){var n=e.alternate;return null===n?((n=Al(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function jl(e,t,n,r,o,i){var s=2;if(r=e,"function"===typeof e)Dl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Ol(n.children,o,i,t);case E:s=8,o|=8;break;case C:return(e=Al(12,n,t,2|o)).elementType=C,e.lanes=i,e;case I:return(e=Al(13,n,t,o)).elementType=I,e.lanes=i,e;case R:return(e=Al(19,n,t,o)).elementType=R,e.lanes=i,e;case P:return Ml(n,o,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:s=10;break e;case N:s=9;break e;case T:s=11;break e;case A:s=14;break e;case D:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Al(s,n,t,o)).elementType=e,t.type=r,t.lanes=i,t}function Ol(e,t,n,r){return(e=Al(7,e,r,t)).lanes=n,e}function Ml(e,t,n,r){return(e=Al(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function Fl(e,t,n){return(e=Al(6,e,null,t)).lanes=n,e}function Ll(e,t,n){return(t=Al(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bl(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Ul(e,t,n,r,o,a,i,s,u){return e=new Bl(e,t,n,s,u),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Al(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fa(a),e}function zl(e){if(!e)return To;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Po(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Po(n))return Mo(e,n,t)}return t}function Wl(e,t,n,r,o,a,i,s,u){return(e=Ul(n,r,!0,e,0,a,0,s,u)).context=zl(null),n=e.current,(a=Ba(r=el(),o=tl(n))).callback=void 0!==t&&null!==t?t:null,Ua(n,a,o),e.current.lanes=o,gt(e,o,r),rl(e,r),e}function Vl(e,t,n,r){var o=t.current,a=el(),i=tl(o);return n=zl(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ba(a,i)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ua(o,t,i))&&(nl(e,o,i,a),za(e,o,i)),i}function Hl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function ql(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gl(e,t){ql(e,t),(e=e.alternate)&&ql(e,t)}_u=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ro.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Is(t),pa();break;case 5:Qa(t);break;case 1:Po(t.type)&&Fo(t);break;case 4:$a(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;No(_a,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(No(ei,1&ei.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(No(ei,1&ei.current),null!==(e=Hs(e,t,n))?e.sibling:null);No(ei,1&ei.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),No(ei,ei.current),r)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Hs(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,aa&&0!==(1048576&t.flags)&&ea(t,Ko,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Vs(e,t),e=t.pendingProps;var o=Do(t,Io.current);Ra(t,n),o=vi(null,t,r,e,o,n);var i=gi();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Po(r)?(i=!0,Fo(t)):i=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Fa(t),o.updater=os,t.stateNode=o,o._reactInternals=t,us(t,r,e,n),t=Ts(null,t,r,!0,i,n)):(t.tag=0,aa&&i&&ta(t),xs(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Vs(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"===typeof e)return Dl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===A)return 14}return 2}(r),e=ns(r,e),o){case 0:t=Ss(null,t,r,e,n);break e;case 1:t=Ns(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=ks(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 1:return r=t.type,o=t.pendingProps,Ns(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 3:e:{if(Is(t),null===e)throw Error(a(387));r=t.pendingProps,o=(i=t.memoizedState).element,La(e,t),Va(t,r,null,n);var s=t.memoizedState;if(r=s.element,i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Rs(e,t,r,n,o=ls(Error(a(423)),t));break e}if(r!==o){t=Rs(e,t,r,n,o=ls(Error(a(424)),t));break e}for(oa=lo(t.stateNode.containerInfo.firstChild),ra=t,aa=!0,ia=null,n=ka(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),r===o){t=Hs(e,t,n);break e}xs(e,t,r,n)}t=t.child}return t;case 5:return Qa(t),null===e&&ca(t),r=t.type,o=t.pendingProps,i=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==i&&no(r,i)&&(t.flags|=32),Cs(e,t),xs(e,t,s,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Fs(e,t,n);case 4:return $a(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=wa(t,null,r,n):xs(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,ws(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 7:return xs(e,t,t.pendingProps,n),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,No(_a,r._currentValue),r._currentValue=s,null!==i)if(sr(i.value,s)){if(i.children===o.children&&!Ro.current){t=Hs(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){s=i.child;for(var l=u.firstContext;null!==l;){if(l.context===r){if(1===i.tag){(l=Ba(-1,n&-n)).tag=2;var c=i.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),Ia(i.return,n,t),u.lanes|=n;break}l=l.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(a(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Ia(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}xs(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ra(t,n),r=r(o=Aa(o)),t.flags|=1,xs(e,t,r,n),t.child;case 14:return o=ns(r=t.type,t.pendingProps),ks(e,t,r,o=ns(r.type,o),n);case 15:return _s(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ns(r,o),Vs(e,t),t.tag=1,Po(r)?(e=!0,Fo(t)):e=!1,Ra(t,n),is(t,r,o),us(t,r,o,n),Ts(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return Es(e,t,n)}throw Error(a(156,t.tag))};var Kl="function"===typeof reportError?reportError:function(e){console.error(e)};function Xl(e){this._internalRoot=e}function Yl(e){this._internalRoot=e}function $l(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ql(){}function Zl(e,t,n,r,o){var a=n._reactRootContainer;if(a){var i=a;if("function"===typeof o){var s=o;o=function(){var e=Hl(i);s.call(e)}}Vl(t,i,e,o)}else i=function(e,t,n,r,o){if(o){if("function"===typeof r){var a=r;r=function(){var e=Hl(i);a.call(e)}}var i=Wl(t,r,e,0,null,!1,0,"",Ql);return e._reactRootContainer=i,e[mo]=i.current,Wr(8===e.nodeType?e.parentNode:e),cl(),i}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof r){var s=r;r=function(){var e=Hl(u);s.call(e)}}var u=Ul(e,0,!1,null,0,!1,0,"",Ql);return e._reactRootContainer=u,e[mo]=u.current,Wr(8===e.nodeType?e.parentNode:e),cl(function(){Vl(t,u,n,r)}),u}(n,t,e,o,r);return Hl(i)}Yl.prototype.render=Xl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Vl(e,t,null,null)},Yl.prototype.unmount=Xl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cl(function(){Vl(null,e,null,null)}),t[mo]=null}},Yl.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Ft(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rl(t,Je()),0===(6&Tu)&&(Wu=Je()+500,Vo()))}break;case 13:cl(function(){var t=Oa(e,1);if(null!==t){var n=el();nl(t,e,1,n)}}),Gl(e,1)}},kt=function(e){if(13===e.tag){var t=Oa(e,134217728);if(null!==t)nl(t,e,134217728,el());Gl(e,134217728)}},_t=function(e){if(13===e.tag){var t=tl(e),n=Oa(e,t);if(null!==n)nl(n,e,t,el());Gl(e,t)}},Et=function(){return bt},Ct=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},ke=function(e,t,n){switch(t){case"input":if(Q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=ko(r);if(!o)throw Error(a(90));K(r),Q(r,o)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=ll,Ie=cl;var ec={usingClientEntryPoint:!1,Events:[xo,wo,ko,Se,Ne,ll]},tc={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nc={bundleType:tc.bundleType,version:tc.version,rendererPackageName:tc.rendererPackageName,rendererConfig:tc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:tc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{ot=rc.inject(nc),at=rc}catch(ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ec,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$l(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$l(e))throw Error(a(299));var n=!1,r="",o=Kl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Ul(e,1,!1,null,0,n,0,r,o),e[mo]=t.current,Wr(8===e.nodeType?e.parentNode:e),new Xl(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return cl(e)},t.hydrate=function(e,t,n){if(!Jl(t))throw Error(a(200));return Zl(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$l(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,o=!1,i="",s=Kl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(i=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Wl(t,null,e,1,null!=n?n:null,o,0,i,s),e[mo]=t.current,Wr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Yl(t)},t.render=function(e,t,n){if(!Jl(t))throw Error(a(200));return Zl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jl(e))throw Error(a(40));return!!e._reactRootContainer&&(cl(function(){Zl(null,null,e,!1,function(){e._reactRootContainer=null,e[mo]=null})}),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Zl(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},352:(e,t,n)=>{"use strict";var r=n(119);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},414:(e,t,n)=>{"use strict";e.exports=n(654)},427:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(569));class a extends o.default{select(e){let t=!1;const n=(null!==e&&void 0!==e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e){let{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:o=r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=o?"".concat(o,".order"):"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,"".concat(i?"".concat(i,","):"").concat(e,".").concat(t?"asc":"desc").concat(void 0===n?"":n?".nullsfirst":".nullslast")),this}limit(e){let{foreignTable:t,referencedTable:n=t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="undefined"===typeof n?"limit":"".concat(n,".limit");return this.url.searchParams.set(r,"".concat(e)),this}range(e,t){let{foreignTable:n,referencedTable:r=n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o="undefined"===typeof r?"offset":"".concat(r,".offset"),a="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(o,"".concat(e)),this.url.searchParams.set(a,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain(){let{analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:o=!1,format:a="text"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var i;const s=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,o?"wal":null].filter(Boolean).join("|"),u=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(a,'; for="').concat(u,'"; options=').concat(s,";")),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}t.default=a},569:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(621)),a=r(n(732));t.default=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(n=e.isMaybeSingle)&&void 0!==n&&n,e.fetch?this.fetch=e.fetch:"undefined"===typeof fetch?this.fetch=o.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,n,r,o;let i=null,s=null,u=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const n=await e.text();""===n||(s="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?n:JSON.parse(n))}const o=null===(n=this.headers.get("Prefer"))||void 0===n?void 0:n.match(/count=(exact|planned|estimated)/),a=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");o&&a&&a.length>1&&(u=parseInt(a[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(s)&&(s.length>1?(i={code:"PGRST116",details:"Results contain ".concat(s.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,u=null,l=406,c="Not Acceptable"):s=1===s.length?s[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(s=[],i=null,l=200,c="OK")}catch(d){404===e.status&&""===t?(l=204,c="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(o=null===i||void 0===i?void 0:i.details)||void 0===o?void 0:o.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new a.default(i)}return{error:i,data:s,count:u,status:l,statusText:c}});return this.shouldThrowOnError||(n=n.catch(e=>{var t,n,r;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(n=null===e||void 0===e?void 0:e.stack)&&void 0!==n?n:""),hint:"",code:"".concat(null!==(r=null===e||void 0===e?void 0:e.code)&&void 0!==r?r:"")},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}}},591:()=>{},621:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Headers:()=>i,Request:()=>s,Response:()=>u,default:()=>a,fetch:()=>o});var r=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")}();const o=r.fetch,a=r.fetch.bind(r),i=r.Headers,s=r.Request,u=r.Response},654:(e,t,n)=>{"use strict";var r=n(950),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,c=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,r)&&!u.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:o,type:e,key:l,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},676:(e,t)=>{"use strict";t.byteLength=function(e){var t=s(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=s(e),i=a[0],u=a[1],l=new o(function(e,t,n){return 3*(t+n)/4-n}(0,i,u)),c=0,d=u>0?i-4:i;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===u&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[c++]=255&t);1===u&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,o=r%3,a=[],i=16383,s=0,u=r-o;s<u;s+=i)a.push(l(e,s,s+i>u?u:s+i));1===o?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],r=[],o="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)n[i]=a[i],r[a.charCodeAt(i)]=i;function s(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function l(e,t,n){for(var r,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(u(r));return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},732:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=n},745:()=>{},761:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,i=o>>>1;r<i;){var s=2*(r+1)-1,u=e[s],l=s+1,c=e[l];if(0>a(u,n))l<o&&0>a(c,u)?(e[r]=c,e[l]=n,r=l):(e[r]=u,e[s]=n,r=s);else{if(!(l<o&&0>a(c,n)))break e;e[r]=c,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var l=[],c=[],d=1,h=null,f=3,p=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(c);null!==t;){if(null===t.callback)o(c);else{if(!(t.startTime<=e))break;o(c),t.sortIndex=t.expirationTime,n(l,t)}t=r(c)}}function w(e){if(v=!1,x(e),!m)if(null!==r(l))m=!0,P(k);else{var t=r(c);null!==t&&j(w,t.startTime-e)}}function k(e,n){m=!1,v&&(v=!1,y(S),S=-1),p=!0;var a=f;try{for(x(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!I());){var i=h.callback;if("function"===typeof i){h.callback=null,f=h.priorityLevel;var s=i(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(l)&&o(l),x(n)}else o(l);h=r(l)}if(null!==h)var u=!0;else{var d=r(c);null!==d&&j(w,d.startTime-n),u=!1}return u}finally{h=null,f=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,E=!1,C=null,S=-1,N=5,T=-1;function I(){return!(t.unstable_now()-T<N)}function R(){if(null!==C){var e=t.unstable_now();T=e;var n=!0;try{n=C(!0,e)}finally{n?_():(E=!1,C=null)}}else E=!1}if("function"===typeof b)_=function(){b(R)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,D=A.port2;A.port1.onmessage=R,_=function(){D.postMessage(null)}}else _=function(){g(R,0)};function P(e){C=e,E||(E=!0,_())}function j(e,n){S=g(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,P(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,o,a){var i=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?i+a:i:a=i,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:o,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>i?(e.sortIndex=a,n(c,e),null===r(l)&&e===r(c)&&(v?(y(S),S=-1):v=!0,j(w,a-i))):(e.sortIndex=s,n(l,e),m||p||(m=!0,P(k))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},766:function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),o=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(n,r){t.call(navigator,e,n,r)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return o(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;this.unmounted=!1,s()?(e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")):t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),o=e.minScreenshotWidth!==t.minScreenshotWidth,a=e.minScreenshotHeight!==t.minScreenshotHeight;(r||o||a)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,o=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var a=r/o;o=(r=n.minScreenshotWidth||this.video.clientWidth)/a,n.minScreenshotHeight&&o<n.minScreenshotHeight&&(r=(o=n.minScreenshotHeight)*a)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||o,this.ctx=this.canvas.getContext("2d")}var i=this.ctx,s=this.canvas;return i&&s&&(s.width=(null===e||void 0===e?void 0:e.width)||s.width,s.height=(null===e||void 0===e?void 0:e.height)||s.height,n.mirrored&&(i.translate(s.width,0),i.scale(-1,1)),i.imageSmoothingEnabled=n.imageSmoothing,i.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(i.scale(-1,1),i.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,r=function(r,o){var a={video:"undefined"===typeof o||o};n.audio&&(a.audio="undefined"===typeof r||r),e.requestUserMediaId++;var i=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(a).then(function(n){e.unmounted||i!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)}).catch(function(t){e.handleUserMedia(t)})};if("mediaDevices"in navigator)r(n.audioConstraints,n.videoConstraints);else{var o=function(e){return{optional:[{sourceId:e}]}},a=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources(function(e){var t=null,i=null;e.forEach(function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(i=e.id)});var s=a(n.audioConstraints);s&&(t=s);var u=a(n.videoConstraints);u&&(i=u),r(o(t),o(i))})}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,o=n.audio,s=(n.forceScreenshotSourceSize,n.disablePictureInPicture),u=(n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),l=n.style,c=void 0===l?{}:l,d=n.children,h=i(n,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),f=u?a(a({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c,p={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",a({autoPlay:!0,disablePictureInPicture:s,src:t.src,muted:!o,playsInline:!0,ref:function(t){e.video=t},style:f},h)),d&&d(p))},t.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=u},react:function(t,n){t.exports=e}}).default},e.exports=r(n(950))},897:(e,t)=>{t.read=function(e,t,n,r,o){var a,i,s=8*o-r-1,u=(1<<s)-1,l=u>>1,c=-7,d=n?o-1:0,h=n?-1:1,f=e[t+d];for(d+=h,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+e[t+d],d+=h,c-=8);for(i=a&(1<<-c)-1,a>>=-c,c+=r;c>0;i=256*i+e[t+d],d+=h,c-=8);if(0===a)a=1-l;else{if(a===u)return i?NaN:1/0*(f?-1:1);i+=Math.pow(2,r),a-=l}return(f?-1:1)*i*Math.pow(2,a-r)},t.write=function(e,t,n,r,o,a){var i,s,u,l=8*a-o-1,c=(1<<l)-1,d=c>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,i=c):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),(t+=i+d>=1?h/u:h*Math.pow(2,1-d))*u>=2&&(i++,u/=2),i+d>=c?(s=0,i=c):i+d>=1?(s=(t*u-1)*Math.pow(2,o),i+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,o),i=0));o>=8;e[n+f]=255&s,f+=p,s/=256,o-=8);for(i=i<<o|s,l+=o;l>0;e[n+f]=255&i,f+=p,i/=256,l-=8);e[n+f-p]|=128*m}},950:(e,t,n)=>{"use strict";e.exports=n(49)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&r;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>i[e]=()=>r[e]);return i.default=()=>r,n.d(a,i),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(950),r=n.t(t,2),o=n(352);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const i="popstate";function s(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function u(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(We){}}}function l(e,t){return{usr:e.state,key:e.key,idx:t}}function c(e,t,n,r){return void 0===n&&(n=null),a({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?h(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function h(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function f(t,n,r,o){void 0===o&&(o={});let{window:u=document.defaultView,v5Compat:h=!1}=o,f=u.history,p=e.Pop,m=null,v=g();function g(){return(f.state||{idx:null}).idx}function y(){p=e.Pop;let t=g(),n=null==t?null:t-v;v=t,m&&m({action:p,location:x.location,delta:n})}function b(e){let t="null"!==u.location.origin?u.location.origin:u.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),s(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==v&&(v=0,f.replaceState(a({},f.state,{idx:v}),""));let x={get action(){return p},get location(){return t(u,f)},listen(e){if(m)throw new Error("A history only accepts one active listener");return u.addEventListener(i,y),m=e,()=>{u.removeEventListener(i,y),m=null}},createHref:e=>n(u,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){p=e.Push;let o=c(x.location,t,n);r&&r(o,t),v=g()+1;let a=l(o,v),i=x.createHref(o);try{f.pushState(a,"",i)}catch(s){if(s instanceof DOMException&&"DataCloneError"===s.name)throw s;u.location.assign(i)}h&&m&&m({action:p,location:x.location,delta:1})},replace:function(t,n){p=e.Replace;let o=c(x.location,t,n);r&&r(o,t),v=g();let a=l(o,v),i=x.createHref(o);f.replaceState(a,"",i),h&&m&&m({action:p,location:x.location,delta:0})},go:e=>f.go(e)};return x}var p;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(p||(p={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(e,t,n){return void 0===n&&(n="/"),v(e,t,n,!1)}function v(e,t,n,r){let o=R(("string"===typeof t?h(t):t).pathname||"/",n);if(null==o)return null;let a=g(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(a);let i=null;for(let s=0;null==i&&s<a.length;++s){let e=I(o);i=N(a[s],e,r)}return i}function g(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let o=(e,o,a)=>{let i={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};i.relativePath.startsWith("/")&&(s(i.relativePath.startsWith(r),'Absolute route path "'+i.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(r.length));let u=O([r,i.relativePath]),l=n.concat(i);e.children&&e.children.length>0&&(s(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+u+'".'),g(e.children,t,l,u)),(null!=e.path||e.index)&&t.push({path:u,score:S(u,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of y(e.path))o(e,t,r);else o(e,t)}),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return o?[a,""]:[a];let i=y(r.join("/")),s=[];return s.push(...i.map(e=>""===e?a:[a,e].join("/"))),o&&s.push(...i),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const b=/^:[\w-]+$/,x=3,w=2,k=1,_=10,E=-2,C=e=>"*"===e;function S(e,t){let n=e.split("/"),r=n.length;return n.some(C)&&(r+=E),t&&(r+=w),n.filter(e=>!C(e)).reduce((e,t)=>e+(b.test(t)?x:""===t?k:_),r)}function N(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,o={},a="/",i=[];for(let s=0;s<r.length;++s){let e=r[s],u=s===r.length-1,l="/"===a?t:t.slice(a.length)||"/",c=T({path:e.relativePath,caseSensitive:e.caseSensitive,end:u},l),d=e.route;if(!c&&u&&n&&!r[r.length-1].route.index&&(c=T({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!c)return null;Object.assign(o,c.params),i.push({params:o,pathname:O([a,c.pathname]),pathnameBase:M(O([a,c.pathnameBase])),route:d}),"/"!==c.pathnameBase&&(a=O([a,c.pathnameBase]))}return i}function T(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);u("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))");let a=new RegExp(o,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let a=o[0],i=a.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:o}=t;if("*"===r){let e=s[n]||"";i=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const u=s[n];return e[r]=o&&!u?void 0:(u||"").replace(/%2F/g,"/"),e},{}),pathname:a,pathnameBase:i,pattern:e}}function I(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return u(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function R(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function A(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function D(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function P(e,t){let n=D(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function j(e,t,n,r){let o;void 0===r&&(r=!1),"string"===typeof e?o=h(e):(o=a({},e),s(!o.pathname||!o.pathname.includes("?"),A("?","pathname","search",o)),s(!o.pathname||!o.pathname.includes("#"),A("#","pathname","hash",o)),s(!o.search||!o.search.includes("#"),A("#","search","hash",o)));let i,u=""===e||""===o.pathname,l=u?"/":o.pathname;if(null==l)i=n;else{let e=t.length-1;if(!r&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}i=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:o=""}="string"===typeof e?h(e):e,a=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:a,search:F(r),hash:L(o)}}(o,i),d=l&&"/"!==l&&l.endsWith("/"),f=(u||"."===l)&&n.endsWith("/");return c.pathname.endsWith("/")||!d&&!f||(c.pathname+="/"),c}const O=e=>e.join("/").replace(/\/\/+/g,"/"),M=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),F=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",L=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function B(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const U=["post","put","patch","delete"],z=(new Set(U),["get",...U]);new Set(z),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const V=t.createContext(null);const H=t.createContext(null);const q=t.createContext(null);const G=t.createContext(null);const K=t.createContext({outlet:null,matches:[],isDataRoute:!1});const X=t.createContext(null);function Y(){return null!=t.useContext(G)}function $(){return Y()||s(!1),t.useContext(G).location}function J(e){t.useContext(q).static||t.useLayoutEffect(e)}function Q(){let{isDataRoute:e}=t.useContext(K);return e?function(){let{router:e}=le(se.UseNavigateStable),n=de(ue.UseNavigateStable),r=t.useRef(!1);J(()=>{r.current=!0});let o=t.useCallback(function(t,o){void 0===o&&(o={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,W({fromRouteId:n},o)))},[e,n]);return o}():function(){Y()||s(!1);let e=t.useContext(V),{basename:n,future:r,navigator:o}=t.useContext(q),{matches:a}=t.useContext(K),{pathname:i}=$(),u=JSON.stringify(P(a,r.v7_relativeSplatPath)),l=t.useRef(!1);J(()=>{l.current=!0});let c=t.useCallback(function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof t)return void o.go(t);let a=j(t,JSON.parse(u),i,"path"===r.relative);null==e&&"/"!==n&&(a.pathname="/"===a.pathname?n:O([n,a.pathname])),(r.replace?o.replace:o.push)(a,r.state,r)},[n,o,u,i,e]);return c}()}const Z=t.createContext(null);function ee(e,n){let{relative:r}=void 0===n?{}:n,{future:o}=t.useContext(q),{matches:a}=t.useContext(K),{pathname:i}=$(),s=JSON.stringify(P(a,o.v7_relativeSplatPath));return t.useMemo(()=>j(e,JSON.parse(s),i,"path"===r),[e,s,i,r])}function te(n,r,o,a){Y()||s(!1);let{navigator:i}=t.useContext(q),{matches:u}=t.useContext(K),l=u[u.length-1],c=l?l.params:{},d=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let f,p=$();if(r){var v;let e="string"===typeof r?h(r):r;"/"===d||(null==(v=e.pathname)?void 0:v.startsWith(d))||s(!1),f=e}else f=p;let g=f.pathname||"/",y=g;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=m(n,{pathname:y});let x=ie(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:O([d,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:O([d,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),u,o,a);return r&&x?t.createElement(G.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:e.Pop}},x):x}function ne(){let e=function(){var e;let n=t.useContext(X),r=ce(ue.UseRouteError),o=de(ue.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[o]}(),n=B(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,o="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:o};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:a},r):null,null)}const re=t.createElement(ne,null);class oe extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(K.Provider,{value:this.props.routeContext},t.createElement(X.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ae(e){let{routeContext:n,match:r,children:o}=e,a=t.useContext(V);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(K.Provider,{value:n},o)}function ie(e,n,r,o){var a;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===o&&(o=null),null==e){var i;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(i=o)&&i.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let u=e,l=null==(a=r)?void 0:a.errors;if(null!=l){let e=u.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||s(!1),u=u.slice(0,Math.min(u.length,e+1))}let c=!1,d=-1;if(r&&o&&o.v7_partialHydration)for(let t=0;t<u.length;t++){let e=u[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:n}=r,o=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||o){c=!0,u=d>=0?u.slice(0,d+1):[u[0]];break}}}return u.reduceRight((e,o,a)=>{let i,s=!1,h=null,f=null;var p;r&&(i=l&&o.route.id?l[o.route.id]:void 0,h=o.route.errorElement||re,c&&(d<0&&0===a?(p="route-fallback",!1||he[p]||(he[p]=!0),s=!0,f=null):d===a&&(s=!0,f=o.route.hydrateFallbackElement||null)));let m=n.concat(u.slice(0,a+1)),v=()=>{let n;return n=i?h:s?f:o.route.Component?t.createElement(o.route.Component,null):o.route.element?o.route.element:e,t.createElement(ae,{match:o,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(o.route.ErrorBoundary||o.route.errorElement||0===a)?t.createElement(oe,{location:r.location,revalidation:r.revalidation,component:h,error:i,children:v(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):v()},null)}var se=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(se||{}),ue=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ue||{});function le(e){let n=t.useContext(V);return n||s(!1),n}function ce(e){let n=t.useContext(H);return n||s(!1),n}function de(e){let n=function(){let e=t.useContext(K);return e||s(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||s(!1),r.route.id}const he={};function fe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function pe(e){let{to:n,replace:r,state:o,relative:a}=e;Y()||s(!1);let{future:i,static:u}=t.useContext(q),{matches:l}=t.useContext(K),{pathname:c}=$(),d=Q(),h=j(n,P(l,i.v7_relativeSplatPath),c,"path"===a),f=JSON.stringify(h);return t.useEffect(()=>d(JSON.parse(f),{replace:r,state:o,relative:a}),[d,f,a,r,o]),null}function me(e){return function(e){let n=t.useContext(K).outlet;return n?t.createElement(Z.Provider,{value:e},n):n}(e.context)}function ve(e){s(!1)}function ge(n){let{basename:r="/",children:o=null,location:a,navigationType:i=e.Pop,navigator:u,static:l=!1,future:c}=n;Y()&&s(!1);let d=r.replace(/^\/*/,"/"),f=t.useMemo(()=>({basename:d,navigator:u,static:l,future:W({v7_relativeSplatPath:!1},c)}),[d,c,u,l]);"string"===typeof a&&(a=h(a));let{pathname:p="/",search:m="",hash:v="",state:g=null,key:y="default"}=a,b=t.useMemo(()=>{let e=R(p,d);return null==e?null:{location:{pathname:e,search:m,hash:v,state:g,key:y},navigationType:i}},[d,p,m,v,g,y,i]);return null==b?null:t.createElement(q.Provider,{value:f},t.createElement(G.Provider,{children:o,value:b}))}function ye(e){let{children:t,location:n}=e;return te(be(t),n)}new Promise(()=>{});t.Component;function be(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,o)=>{if(!t.isValidElement(e))return;let a=[...n,o];if(e.type===t.Fragment)return void r.push.apply(r,be(e.props.children,a));e.type!==ve&&s(!1),e.props.index&&e.props.children&&s(!1);let i={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=be(e.props.children,a)),r.push(i)}),r}var xe=n(119),we=n.t(xe,2);function ke(){return ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ke.apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ee=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Ce=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(We){}const Se=t.createContext({isTransitioning:!1});new Map;const Ne=r.startTransition;we.flushSync,r.useId;function Te(e){let{basename:n,children:r,future:o,window:a}=e,i=t.useRef();var s;null==i.current&&(i.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),f(function(e,t){let{pathname:n,search:r,hash:o}=e.location;return c("",{pathname:n,search:r,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:d(t)},null,s)));let u=i.current,[l,h]=t.useState({action:u.action,location:u.location}),{v7_startTransition:p}=o||{},m=t.useCallback(e=>{p&&Ne?Ne(()=>h(e)):h(e)},[h,p]);return t.useLayoutEffect(()=>u.listen(m),[u,m]),t.useEffect(()=>fe(o),[o]),t.createElement(ge,{basename:n,children:r,location:l.location,navigationType:l.action,navigator:u,future:o})}const Ie="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Re=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ae=t.forwardRef(function(e,n){let r,{onClick:o,relative:a,reloadDocument:i,replace:u,state:l,target:c,to:h,preventScrollReset:f,viewTransition:p}=e,m=_e(e,Ee),{basename:v}=t.useContext(q),g=!1;if("string"===typeof h&&Re.test(h)&&(r=h,Ie))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=R(t.pathname,v);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:g=!0}catch(We){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;Y()||s(!1);let{basename:o,navigator:a}=t.useContext(q),{hash:i,pathname:u,search:l}=ee(e,{relative:r}),c=u;return"/"!==o&&(c="/"===u?o:O([o,u])),a.createHref({pathname:c,search:l,hash:i})}(h,{relative:a}),b=function(e,n){let{target:r,replace:o,state:a,preventScrollReset:i,relative:s,viewTransition:u}=void 0===n?{}:n,l=Q(),c=$(),h=ee(e,{relative:s});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==o?o:d(c)===d(h);l(e,{replace:n,state:a,preventScrollReset:i,relative:s,viewTransition:u})}},[c,l,h,o,a,r,e,i,s,u])}(h,{replace:u,state:l,target:c,preventScrollReset:f,relative:a,viewTransition:p});return t.createElement("a",ke({},m,{href:r||y,onClick:g||i?o:function(e){o&&o(e),e.defaultPrevented||b(e)},ref:n,target:c}))});const De=t.forwardRef(function(e,n){let{"aria-current":r="page",caseSensitive:o=!1,className:a="",end:i=!1,style:u,to:l,viewTransition:c,children:d}=e,h=_e(e,Ce),f=ee(l,{relative:h.relative}),p=$(),m=t.useContext(H),{navigator:v,basename:g}=t.useContext(q),y=null!=m&&function(e,n){void 0===n&&(n={});let r=t.useContext(Se);null==r&&s(!1);let{basename:o}=Oe(Pe.useViewTransitionState),a=ee(e,{relative:n.relative});if(!r.isTransitioning)return!1;let i=R(r.currentLocation.pathname,o)||r.currentLocation.pathname,u=R(r.nextLocation.pathname,o)||r.nextLocation.pathname;return null!=T(a.pathname,u)||null!=T(a.pathname,i)}(f)&&!0===c,b=v.encodeLocation?v.encodeLocation(f).pathname:f.pathname,x=p.pathname,w=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;o||(x=x.toLowerCase(),w=w?w.toLowerCase():null,b=b.toLowerCase()),w&&g&&(w=R(w,g)||w);const k="/"!==b&&b.endsWith("/")?b.length-1:b.length;let _,E=x===b||!i&&x.startsWith(b)&&"/"===x.charAt(k),C=null!=w&&(w===b||!i&&w.startsWith(b)&&"/"===w.charAt(b.length)),S={isActive:E,isPending:C,isTransitioning:y},N=E?r:void 0;_="function"===typeof a?a(S):[a,E?"active":null,C?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let I="function"===typeof u?u(S):u;return t.createElement(Ae,ke({},h,{"aria-current":N,className:_,ref:n,style:I,to:l,viewTransition:c}),"function"===typeof d?d(S):d)});var Pe,je;function Oe(e){let n=t.useContext(V);return n||s(!1),n}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Pe||(Pe={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(je||(je={}));function Me(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Le(e){var t=function(e,t){if("object"!=Fe(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Fe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Fe(t)?t:t+""}function Be(e,t,n){return(t=Le(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach(function(t){Be(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let We={data:""},Ve=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||We,He=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,qe=/\/\*[^]*?\*\/|  +/g,Ge=/\n+/g,Ke=(e,t)=>{let n="",r="",o="";for(let a in e){let i=e[a];"@"==a[0]?"i"==a[1]?n=a+" "+i+";":r+="f"==a[1]?Ke(i,a):a+"{"+Ke(i,"k"==a[1]?"":t)+"}":"object"==typeof i?r+=Ke(i,t?t.replace(/([^,])+/g,e=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):a):null!=i&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=Ke.p?Ke.p(a,i):a+":"+i+";")}return n+(t&&o?t+"{"+o+"}":o)+r},Xe={},Ye=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+Ye(e[n]);return t}return e},$e=(e,t,n,r,o)=>{let a=Ye(e),i=Xe[a]||(Xe[a]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(a));if(!Xe[i]){let t=a!==e?e:(e=>{let t,n,r=[{}];for(;t=He.exec(e.replace(qe,""));)t[4]?r.shift():t[3]?(n=t[3].replace(Ge," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(Ge," ").trim();return r[0]})(e);Xe[i]=Ke(o?{["@keyframes "+i]:t}:t,n?"":"."+i)}let s=n&&Xe.g?Xe.g:null;return n&&(Xe.g=Xe[i]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(Xe[i],t,r,s),i};function Je(e){let t=this||{},n=e.call?e(t.p):e;return $e(n.unshift?n.raw?((e,t,n)=>e.reduce((e,r,o)=>{let a=t[o];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":Ke(e,""):!1===e?"":e}return e+r+(null==a?"":a)},""))(n,[].slice.call(arguments,1),t.p):n.reduce((e,n)=>Object.assign(e,n&&n.call?n(t.p):n),{}):n,Ve(t.target),t.g,t.o,t.k)}Je.bind({g:1});let Qe,Ze,et,tt=Je.bind({k:1});function nt(e,t){let n=this||{};return function(){let r=arguments;function o(a,i){let s=Object.assign({},a),u=s.className||o.className;n.p=Object.assign({theme:Ze&&Ze()},s),n.o=/ *go\d+/.test(u),s.className=Je.apply(n,r)+(u?" "+u:""),t&&(s.ref=i);let l=e;return e[0]&&(l=s.as||e,delete s.as),et&&l[0]&&et(s),Qe(l,s)}return t?t(o):o}}var rt,ot,at,it,st,ut,lt,ct,dt,ht,ft,pt,mt,vt,gt,yt,bt=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,xt=(()=>{let e=0;return()=>(++e).toString()})(),wt=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),kt="default",_t=(e,t)=>{let{toastLimit:n}=e.settings;switch(t.type){case 0:return ze(ze({},e),{},{toasts:[t.toast,...e.toasts].slice(0,n)});case 1:return ze(ze({},e),{},{toasts:e.toasts.map(e=>e.id===t.toast.id?ze(ze({},e),t.toast):e)});case 2:let{toast:r}=t;return _t(e,{type:e.toasts.find(e=>e.id===r.id)?1:0,toast:r});case 3:let{toastId:o}=t;return ze(ze({},e),{},{toasts:e.toasts.map(e=>e.id===o||void 0===o?ze(ze({},e),{},{dismissed:!0,visible:!1}):e)});case 4:return void 0===t.toastId?ze(ze({},e),{},{toasts:[]}):ze(ze({},e),{},{toasts:e.toasts.filter(e=>e.id!==t.toastId)});case 5:return ze(ze({},e),{},{pausedAt:t.time});case 6:let a=t.time-(e.pausedAt||0);return ze(ze({},e),{},{pausedAt:void 0,toasts:e.toasts.map(e=>ze(ze({},e),{},{pauseDuration:e.pauseDuration+a}))})}},Et=[],Ct={toasts:[],pausedAt:void 0,settings:{toastLimit:20}},St={},Nt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt;St[t]=_t(St[t]||Ct,e),Et.forEach(e=>{let[n,r]=e;n===t&&r(St[t])})},Tt=e=>Object.keys(St).forEach(t=>Nt(e,t)),It=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kt;return t=>{Nt(t,e)}},Rt={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},At=e=>(t,n)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return ze(ze({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},n),{},{id:(null==n?void 0:n.id)||xt()})}(t,e,n);return It(r.toasterId||(e=>Object.keys(St).find(t=>St[t].toasts.some(t=>t.id===e)))(r.id))({type:2,toast:r}),r.id},Dt=(e,t)=>At("blank")(e,t);Dt.error=At("error"),Dt.success=At("success"),Dt.loading=At("loading"),Dt.custom=At("custom"),Dt.dismiss=(e,t)=>{let n={type:3,toastId:e};t?It(t)(n):Tt(n)},Dt.dismissAll=e=>Dt.dismiss(void 0,e),Dt.remove=(e,t)=>{let n={type:4,toastId:e};t?It(t)(n):Tt(n)},Dt.removeAll=e=>Dt.remove(void 0,e),Dt.promise=(e,t,n)=>{let r=Dt.loading(t.loading,ze(ze({},n),null==n?void 0:n.loading));return"function"==typeof e&&(e=e()),e.then(e=>{let o=t.success?bt(t.success,e):void 0;return o?Dt.success(o,ze(ze({id:r},n),null==n?void 0:n.success)):Dt.dismiss(r),e}).catch(e=>{let o=t.error?bt(t.error,e):void 0;o?Dt.error(o,ze(ze({id:r},n),null==n?void 0:n.error)):Dt.dismiss(r)}),e};var Pt=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",{toasts:r,pausedAt:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt,[r,o]=(0,t.useState)(St[n]||Ct),a=(0,t.useRef)(St[n]);(0,t.useEffect)(()=>(a.current!==St[n]&&o(St[n]),Et.push([n,o]),()=>{let e=Et.findIndex(e=>{let[t]=e;return t===n});e>-1&&Et.splice(e,1)}),[n]);let i=r.toasts.map(t=>{var n,r,o;return ze(ze(ze(ze({},e),e[t.type]),t),{},{removeDelay:t.removeDelay||(null==(n=e[t.type])?void 0:n.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(r=e[t.type])?void 0:r.duration)||(null==e?void 0:e.duration)||Rt[t.type],style:ze(ze(ze({},e.style),null==(o=e[t.type])?void 0:o.style),t.style)})});return ze(ze({},r),{},{toasts:i})}(e,n),a=(0,t.useRef)(new Map).current,i=(0,t.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(a.has(e))return;let n=setTimeout(()=>{a.delete(e),s({type:4,toastId:e})},t);a.set(e,n)},[]);(0,t.useEffect)(()=>{if(o)return;let e=Date.now(),t=r.map(t=>{if(t.duration===1/0)return;let r=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(r<0))return setTimeout(()=>Dt.dismiss(t.id,n),r);t.visible&&Dt.dismiss(t.id)});return()=>{t.forEach(e=>e&&clearTimeout(e))}},[r,o,n]);let s=(0,t.useCallback)(It(n),[n]),u=(0,t.useCallback)(()=>{s({type:5,time:Date.now()})},[s]),l=(0,t.useCallback)((e,t)=>{s({type:1,toast:{id:e,height:t}})},[s]),c=(0,t.useCallback)(()=>{o&&s({type:6,time:Date.now()})},[o,s]),d=(0,t.useCallback)((e,t)=>{let{reverseOrder:n=!1,gutter:o=8,defaultPosition:a}=t||{},i=r.filter(t=>(t.position||a)===(e.position||a)&&t.height),s=i.findIndex(t=>t.id===e.id),u=i.filter((e,t)=>t<s&&e.visible).length;return i.filter(e=>e.visible).slice(...n?[u+1]:[0,u]).reduce((e,t)=>e+(t.height||0)+o,0)},[r]);return(0,t.useEffect)(()=>{r.forEach(e=>{if(e.dismissed)i(e.id,e.removeDelay);else{let t=a.get(e.id);t&&(clearTimeout(t),a.delete(e.id))}})},[r,i]),{toasts:r,handlers:{updateHeight:l,startPause:u,endPause:c,calculateOffset:d}}},jt=tt(rt||(rt=Me(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),Ot=tt(ot||(ot=Me(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Mt=tt(at||(at=Me(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),Ft=nt("div")(it||(it=Me(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),e=>e.primary||"#ff4b4b",jt,Ot,e=>e.secondary||"#fff",Mt),Lt=tt(st||(st=Me(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),Bt=nt("div")(ut||(ut=Me(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),e=>e.secondary||"#e0e0e0",e=>e.primary||"#616161",Lt),Ut=tt(lt||(lt=Me(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),zt=tt(ct||(ct=Me(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),Wt=nt("div")(dt||(dt=Me(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),e=>e.primary||"#61d345",Ut,zt,e=>e.secondary||"#fff"),Vt=nt("div")(ht||(ht=Me(["\n  position: absolute;\n"]))),Ht=nt("div")(ft||(ft=Me(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),qt=tt(pt||(pt=Me(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),Gt=nt("div")(mt||(mt=Me(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),qt),Kt=e=>{let{toast:n}=e,{icon:r,type:o,iconTheme:a}=n;return void 0!==r?"string"==typeof r?t.createElement(Gt,null,r):r:"blank"===o?null:t.createElement(Ht,null,t.createElement(Bt,ze({},a)),"loading"!==o&&t.createElement(Vt,null,"error"===o?t.createElement(Ft,ze({},a)):t.createElement(Wt,ze({},a))))},Xt=e=>"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"),Yt=e=>"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n"),$t=nt("div")(vt||(vt=Me(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),Jt=nt("div")(gt||(gt=Me(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]))),Qt=t.memo(e=>{let{toast:n,position:r,style:o,children:a}=e,i=n.height?((e,t)=>{let n=e.includes("top")?1:-1,[r,o]=wt()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[Xt(n),Yt(n)];return{animation:t?"".concat(tt(r)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(tt(o)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}})(n.position||r||"top-center",n.visible):{opacity:0},s=t.createElement(Kt,{toast:n}),u=t.createElement(Jt,ze({},n.ariaProps),bt(n.message,n));return t.createElement($t,{className:n.className,style:ze(ze(ze({},i),o),n.style)},"function"==typeof a?a({icon:s,message:u}):t.createElement(t.Fragment,null,s,u))});!function(e,t,n,r){Ke.p=t,Qe=e,Ze=n,et=r}(t.createElement);var Zt=e=>{let{id:n,className:r,style:o,onHeightUpdate:a,children:i}=e,s=t.useCallback(e=>{if(e){let t=()=>{let t=e.getBoundingClientRect().height;a(n,t)};t(),new MutationObserver(t).observe(e,{subtree:!0,childList:!0,characterData:!0})}},[n,a]);return t.createElement("div",{ref:s,className:r,style:o},i)},en=Je(yt||(yt=Me(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]))),tn=e=>{let{reverseOrder:n,position:r="top-center",toastOptions:o,gutter:a,children:i,toasterId:s,containerStyle:u,containerClassName:l}=e,{toasts:c,handlers:d}=Pt(o,s);return t.createElement("div",{"data-rht-toaster":s||"",style:ze({position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none"},u),className:l,onMouseEnter:d.startPause,onMouseLeave:d.endPause},c.map(e=>{let o=e.position||r,s=((e,t)=>{let n=e.includes("top"),r=n?{top:0}:{bottom:0},o=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return ze(ze({left:0,right:0,display:"flex",position:"absolute",transition:wt()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:"translateY(".concat(t*(n?1:-1),"px)")},r),o)})(o,d.calculateOffset(e,{reverseOrder:n,gutter:a,defaultPosition:r}));return t.createElement(Zt,{id:e.id,key:e.id,onHeightUpdate:d.updateHeight,className:e.visible?en:"",style:s},"custom"===e.type?bt(e.message,e):i?i(e):t.createElement(Qt,{toast:e,position:o}))}))},nn=Dt;class rn extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",n=arguments.length>2?arguments[2]:void 0;super(e),this.name=t,this.context=n}}class on extends rn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class an extends rn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class sn extends rn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var un;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(un||(un={}));var ln=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};class cn{constructor(e){let{headers:t={},customFetch:r,region:o=un.Any}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.headers=t,this.region=o,this.fetch=(e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Promise.resolve().then(n.bind(n,621)).then(e=>{let{default:n}=e;return n(...t)})}:fetch),function(){return t(...arguments)}})(r)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return ln(this,void 0,void 0,function*(){try{const{headers:r,method:o,body:a}=t;let i={},{region:s}=t;s||(s=this.region);const u=new URL("".concat(this.url,"/").concat(e));let l;s&&"any"!==s&&(i["x-region"]=s,u.searchParams.set("forceFunctionRegion",s)),a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!==typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",l=a):"string"===typeof a?(i["Content-Type"]="text/plain",l=a):"undefined"!==typeof FormData&&a instanceof FormData?l=a:(i["Content-Type"]="application/json",l=JSON.stringify(a)));const c=yield this.fetch(u.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),r),body:l}).catch(e=>{throw new on(e)}),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new an(c);if(!c.ok)throw new sn(c);let h,f=(null!==(n=c.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return h="application/json"===f?yield c.json():"application/octet-stream"===f?yield c.blob():"text/event-stream"===f?c:"multipart/form-data"===f?yield c.formData():yield c.text(),{data:h,error:null,response:c}}catch(r){return{data:null,error:r,response:r instanceof sn||r instanceof an?r.context:void 0}}})}}var dn=n(53);const{PostgrestClient:hn,PostgrestQueryBuilder:fn,PostgrestFilterBuilder:pn,PostgrestTransformBuilder:mn,PostgrestBuilder:vn,PostgrestError:gn}=dn;var yn=n(224);const bn=class{static detectEnvironment(){var e;if("undefined"!==typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket)return{type:"native",constructor:n.g.WebSocket};if("undefined"!==typeof globalThis&&"undefined"!==typeof globalThis.WebSocketPair&&"undefined"===typeof globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!==typeof globalThis&&globalThis.EdgeRuntime||"undefined"!==typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!==typeof yn){const e=yn.versions;if(e&&e.node){const t=e.node,n=parseInt(t.replace(/^v/,"").split(".")[0]);return n>=22?"undefined"!==typeof globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(n," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(n," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(Ih){return!1}}},xn="realtime-js/".concat("2.15.5"),wn=1e4;var kn,_n,En,Cn,Sn,Nn;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(kn||(kn={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(_n||(_n={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(En||(En={})),function(e){e.websocket="websocket"}(Cn||(Cn={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(Sn||(Sn={}));class Tn{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"===typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const r=t.getUint8(1),o=t.getUint8(2);let a=this.HEADER_LENGTH+2;const i=n.decode(e.slice(a,a+r));a+=r;const s=n.decode(e.slice(a,a+o));a+=o;return{ref:null,topic:i,event:s,payload:JSON.parse(n.decode(e.slice(a,e.byteLength)))}}}class In{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(Nn||(Nn={}));const Rn=function(e,t){var n;const r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return Object.keys(t).reduce((n,o)=>(n[o]=An(o,e,t,r),n),{})},An=(e,t,n,r)=>{const o=t.find(t=>t.name===e),a=null===o||void 0===o?void 0:o.type,i=n[e];return a&&!r.includes(a)?Dn(a,i):Pn(i)},Dn=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return Fn(t,n)}switch(e){case Nn.bool:return jn(t);case Nn.float4:case Nn.float8:case Nn.int2:case Nn.int4:case Nn.int8:case Nn.numeric:case Nn.oid:return On(t);case Nn.json:case Nn.jsonb:return Mn(t);case Nn.timestamp:return Ln(t);case Nn.abstime:case Nn.date:case Nn.daterange:case Nn.int4range:case Nn.int8range:case Nn.money:case Nn.reltime:case Nn.text:case Nn.time:case Nn.timestamptz:case Nn.timetz:case Nn.tsrange:case Nn.tstzrange:default:return Pn(t)}},Pn=e=>e,jn=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},On=e=>{if("string"===typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Mn=e=>{if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},Fn=(e,t)=>{if("string"!==typeof e)return e;const n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){let r;const o=e.slice(1,n);try{r=JSON.parse("["+o+"]")}catch(Tt){r=o?o.split(","):[]}return r.map(e=>Dn(t,e))}return e},Ln=e=>"string"===typeof e?e.replace(" ","T"):e,Bn=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Un{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wn;this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive(e){let{status:t,response:n}=e;this.recHooks.filter(e=>e.status===t).forEach(e=>e.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var zn,Wn,Vn,Hn;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(zn||(zn={}));class qn{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null===t||void 0===t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qn.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=qn.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],r()}),this.channel._on(n.diff,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=qn.syncDiff(this.state,e,t,n),r())}),this.onJoin((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const o=this.cloneDeep(e),a=this.transformState(t),i={},s={};return this.map(o,(e,t)=>{a[e]||(s[e]=t)}),this.map(a,(e,t)=>{const n=o[e];if(n){const r=t.map(e=>e.presence_ref),o=n.map(e=>e.presence_ref),a=t.filter(e=>o.indexOf(e.presence_ref)<0),u=n.filter(e=>r.indexOf(e.presence_ref)<0);a.length>0&&(i[e]=a),u.length>0&&(s[e]=u)}else i[e]=t}),this.syncDiff(o,{joins:i,leaves:s},n,r)}static syncDiff(e,t,n,r){const{joins:o,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(o,(t,r)=>{var o;const a=null!==(o=e[t])&&void 0!==o?o:[];if(e[t]=this.cloneDeep(r),a.length>0){const n=e[t].map(e=>e.presence_ref),r=a.filter(e=>n.indexOf(e.presence_ref)<0);e[t].unshift(...r)}n(t,a,r)}),this.map(a,(t,n)=>{let o=e[t];if(!o)return;const a=n.map(e=>e.presence_ref);o=o.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=o,r(t,o,n),0===o.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return t[n]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Wn||(Wn={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Vn||(Vn={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Hn||(Hn={}));class Gn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n=arguments.length>2?arguments[2]:void 0;this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=_n.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Un(this,En.join,this.params,this.timeout),this.rejoinTimer=new In(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=_n.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=_n.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=_n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=_n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),e),this.state=_n.errored,this.rejoinTimer.scheduleTimeout())}),this._on(En.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new qn(this),this.broadcastEndpointURL=Bn(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;var n,r,o;if(this.socket.isConnected()||this.socket.connect(),this.state==_n.closed){const{config:{broadcast:a,presence:i,private:s}}=this.params,u=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(e=>e.filter))&&void 0!==r?r:[],l=!!this.bindings[Vn.PRESENCE]&&this.bindings[Vn.PRESENCE].length>0||!0===(null===(o=this.params.config.presence)||void 0===o?void 0:o.enabled),c={},d={broadcast:a,presence:Object.assign(Object.assign({},i),{enabled:l}),postgres_changes:u,private:s};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null===e||void 0===e?void 0:e(Hn.CHANNEL_ERROR,t)),this._onClose(()=>null===e||void 0===e?void 0:e(Hn.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async t=>{let{postgres_changes:n}=t;var r;if(this.socket.setAuth(),void 0!==n){const t=this.bindings.postgres_changes,o=null!==(r=null===t||void 0===t?void 0:t.length)&&void 0!==r?r:0,a=[];for(let r=0;r<o;r++){const o=t[r],{filter:{event:i,schema:s,table:u,filter:l}}=o,c=n&&n[r];if(!c||c.event!==i||c.schema!==s||c.table!==u||c.filter!==l)return this.unsubscribe(),this.state=_n.errored,void(null===e||void 0===e||e(Hn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},o),{id:c.id}))}return this.bindings.postgres_changes=a,void(e&&e(Hn.SUBSCRIBED))}null===e||void 0===e||e(Hn.SUBSCRIBED)}).receive("error",t=>{this.state=_n.errored,null===e||void 0===e||e(Hn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null===e||void 0===e||e(Hn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===_n.joined&&e===Vn.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(n=>{var r,o,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(o=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===o?void 0:o.broadcast)||void 0===a?void 0:a.ack)||n("ok"),i.receive("ok",()=>n("ok")),i.receive("error",()=>n("error")),i.receive("timeout",()=>n("timed out"))});{const{event:a,payload:i}=e,s={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,s,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(o){return"AbortError"===o.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=_n.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(En.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new Un(this,En.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null===n||void 0===n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=_n.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,o=setTimeout(()=>r.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(o),a}_push(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let r=new Un(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(e.event),e.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,o;const a=e.toLocaleLowerCase(),{close:i,error:s,leave:u,join:l}=En;if(n&&[i,s,u,l].indexOf(a)>=0&&n!==this._joinRef())return;let c=this._onMessage(a,t,n);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===a}).map(e=>e.callback(c,n)):null===(o=this.bindings[a])||void 0===o||o.filter(e=>{var n,r,o,i,s,u;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,i=null===(n=e.filter)||void 0===n?void 0:n.event;return a&&(null===(r=t.ids)||void 0===r?void 0:r.includes(a))&&("*"===i||(null===i||void 0===i?void 0:i.toLocaleLowerCase())===(null===(o=t.data)||void 0===o?void 0:o.type.toLocaleLowerCase()))}{const n=null===(s=null===(i=null===e||void 0===e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===s?void 0:s.toLocaleLowerCase();return"*"===n||n===(null===(u=null===t||void 0===t?void 0:t.event)||void 0===u?void 0:u.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"===typeof c&&"ids"in c){const e=c.data,{schema:t,table:n,commit_timestamp:r,type:o,errors:a}=e,i={schema:t,table:n,commit_timestamp:r,eventType:o,new:{},old:{},errors:a};c=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(c,n)})}_isClosed(){return this.state===_n.closed}_isJoined(){return this.state===_n.joined}_isJoining(){return this.state===_n.joining}_isLeaving(){return this.state===_n.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,n){const r=e.toLocaleLowerCase(),o={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(o):this.bindings[r]=[o],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&Gn.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(En.close,{},e)}_onError(e){this._on(En.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=_n.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Rn(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Rn(e.columns,e.old_record)),t}}const Kn=()=>{},Xn=25e3,Yn=10,$n=100,Jn=[1e3,2e3,5e3,1e4];class Qn{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=wn,this.transport=null,this.heartbeatIntervalMs=Xn,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Kn,this.ref=0,this.reconnectTimer=null,this.logger=Kn,this.conn=null,this.sendBuffer=[],this.serializer=new Tn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Promise.resolve().then(n.bind(n,621)).then(e=>{let{default:n}=e;return n(...t)}).catch(e=>{throw new Error("Failed to load @supabase/node-fetch: ".concat(e.message,". ")+"This is required for HTTP requests in Node.js environments without native fetch.")})}:fetch),function(){return t(...arguments)}},!(null===(r=null===t||void 0===t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint="".concat(e,"/").concat(Cn.websocket),this.httpEndpoint=Bn(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null===t||void 0===t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bn.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error("".concat(t,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(t))}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case kn.connecting:return Sn.Connecting;case kn.open:return Sn.Open;case kn.closing:return Sn.Closing;default:return Sn.Closed}}isConnected(){return this.connectionState()===Sn.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};const n="realtime:".concat(e),r=this.getChannels().find(e=>e.topic===n);if(r)return r;{const n=new Gn("realtime:".concat(e),t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:r,ref:o}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push","".concat(t," ").concat(n," (").concat(o,")"),r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(We){this.log("error","error in heartbeat callback",We)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},$n)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(We){this.log("error","error in heartbeat callback",We)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(We){this.log("error","error in heartbeat callback",We)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(We){this.log("error","error in heartbeat callback",We)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:n,payload:r,ref:o}=e,a=o?"(".concat(o,")"):"",i=r.status||"";this.log("receive","".concat(i," ").concat(t," ").concat(n," ").concat(a).trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(n,r,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(En.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const n={access_token:e,version:xn};e&&t.updateJoinPayload(n),t.joinedOnce&&t._isJoined()&&t._push(En.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this.setAuth().catch(t=>{this.log("error","error setting auth in ".concat(e),t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(We){this.log("error","error in ".concat(e," callback"),We)}})}catch(We){this.log("error","error triggering ".concat(e," callbacks"),We)}}_setupReconnectionTimer(){this.reconnectTimer=new In(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Yn)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,o,a,i,s,u,l;if(this.transport=null!==(t=null===e||void 0===e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null===e||void 0===e?void 0:e.timeout)&&void 0!==n?n:wn,this.heartbeatIntervalMs=null!==(r=null===e||void 0===e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Xn,this.worker=null!==(o=null===e||void 0===e?void 0:e.worker)&&void 0!==o&&o,this.accessToken=null!==(a=null===e||void 0===e?void 0:e.accessToken)&&void 0!==a?a:null,this.heartbeatCallback=null!==(i=null===e||void 0===e?void 0:e.heartbeatCallback)&&void 0!==i?i:Kn,(null===e||void 0===e?void 0:e.params)&&(this.params=e.params),(null===e||void 0===e?void 0:e.logger)&&(this.logger=e.logger),((null===e||void 0===e?void 0:e.logLevel)||(null===e||void 0===e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(s=null===e||void 0===e?void 0:e.reconnectAfterMs)&&void 0!==s?s:e=>Jn[e-1]||1e4,this.encode=null!==(u=null===e||void 0===e?void 0:e.encode)&&void 0!==u?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null===e||void 0===e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!==typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null===e||void 0===e?void 0:e.workerUrl}}}class Zn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function er(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}class tr extends Zn{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class nr extends Zn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var rr=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};const or=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Promise.resolve().then(n.bind(n,621)).then(e=>{let{default:n}=e;return n(...t)})}:fetch),function(){return t(...arguments)}},ar=e=>{if(Array.isArray(e))return e.map(e=>ar(e));if("function"===typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(e=>{let[n,r]=e;const o=n.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[o]=ar(r)}),t};var ir=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};const sr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ur=(e,t,r)=>ir(void 0,void 0,void 0,function*(){const o=yield rr(void 0,void 0,void 0,function*(){return"undefined"===typeof Response?(yield Promise.resolve().then(n.bind(n,621))).Response:Response});e instanceof o&&!(null===r||void 0===r?void 0:r.noResolveJson)?e.json().then(n=>{const r=e.status||500,o=(null===n||void 0===n?void 0:n.statusCode)||r+"";t(new tr(sr(n),r,o))}).catch(e=>{t(new nr(sr(e),e))}):t(new nr(sr(e),e))}),lr=(e,t,n,r)=>{const o={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(r)?(o.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),o.body=JSON.stringify(r)):o.body=r,(null===t||void 0===t?void 0:t.duplex)&&(o.duplex=t.duplex),Object.assign(Object.assign({},o),n)):o};function cr(e,t,n,r,o,a){return ir(this,void 0,void 0,function*(){return new Promise((i,s)=>{e(n,lr(t,r,o,a)).then(e=>{if(!e.ok)throw e;return(null===r||void 0===r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>ur(e,s,r))})})}function dr(e,t,n,r){return ir(this,void 0,void 0,function*(){return cr(e,"GET",t,n,r)})}function hr(e,t,n,r,o){return ir(this,void 0,void 0,function*(){return cr(e,"POST",t,r,o,n)})}function fr(e,t,n,r,o){return ir(this,void 0,void 0,function*(){return cr(e,"PUT",t,r,o,n)})}function pr(e,t,n,r,o){return ir(this,void 0,void 0,function*(){return cr(e,"DELETE",t,r,o,n)})}var mr=n(325).hp,vr=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};const gr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},yr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class br{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=or(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,r){return vr(this,void 0,void 0,function*(){try{let o;const a=Object.assign(Object.assign({},yr),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const s=a.metadata;"undefined"!==typeof Blob&&n instanceof Blob?(o=new FormData,o.append("cacheControl",a.cacheControl),s&&o.append("metadata",this.encodeMetadata(s)),o.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(o=n,o.append("cacheControl",a.cacheControl),s&&o.append("metadata",this.encodeMetadata(s))):(o=n,i["cache-control"]="max-age=".concat(a.cacheControl),i["content-type"]=a.contentType,s&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(s)))),(null===r||void 0===r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const u=this._removeEmptyFolders(t),l=this._getFinalPath(u),c=yield("PUT"==e?fr:hr)(this.fetch,"".concat(this.url,"/object/").concat(l),o,Object.assign({headers:i},(null===a||void 0===a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{data:{path:u,id:c.Id,fullPath:c.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(er(o))return{data:null,error:o};throw o}})}upload(e,t,n){return vr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,r){return vr(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),a=this._getFinalPath(o),i=new URL(this.url+"/object/upload/sign/".concat(a));i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:yr.upsert},r),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!==typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!==typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,a["cache-control"]="max-age=".concat(t.cacheControl),a["content-type"]=t.contentType);return{data:{path:o,fullPath:(yield fr(this.fetch,i.toString(),e,{headers:a})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(er(s))return{data:null,error:s};throw s}})}createSignedUploadUrl(e,t){return vr(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const r=Object.assign({},this.headers);(null===t||void 0===t?void 0:t.upsert)&&(r["x-upsert"]="true");const o=yield hr(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(n),{},{headers:r}),a=new URL(this.url+o.url),i=a.searchParams.get("token");if(!i)throw new Zn("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:i},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n))return{data:null,error:n};throw n}})}update(e,t,n){return vr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return vr(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(er(r))return{data:null,error:r};throw r}})}copy(e,t,n){return vr(this,void 0,void 0,function*(){try{return{data:{path:(yield hr(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null===n||void 0===n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(er(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,n){return vr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),o=yield hr(this.fetch,"".concat(this.url,"/object/sign/").concat(r),Object.assign({expiresIn:t},(null===n||void 0===n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const a=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return o={signedUrl:encodeURI("".concat(this.url).concat(o.signedURL).concat(a))},{data:o,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(er(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,n){return vr(this,void 0,void 0,function*(){try{const r=yield hr(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),o=(null===n||void 0===n?void 0:n.download)?"&download=".concat(!0===n.download?"":n.download):"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(this.url).concat(e.signedURL).concat(o)):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(er(r))return{data:null,error:r};throw r}})}download(e,t){return vr(this,void 0,void 0,function*(){const n="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),o=r?"?".concat(r):"";try{const t=this._getFinalPath(e),r=yield dr(this.fetch,"".concat(this.url,"/").concat(n,"/").concat(t).concat(o),{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(er(a))return{data:null,error:a};throw a}})}info(e){return vr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield dr(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:ar(e),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n))return{data:null,error:n};throw n}})}exists(e){return vr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,n,r){return ir(this,void 0,void 0,function*(){return cr(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n)&&n instanceof nr){const e=n.originalError;if([400,404].includes(null===e||void 0===e?void 0:e.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],o=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==o&&r.push(o);const a="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==i&&r.push(i);let s=r.join("&");return""!==s&&(s="?".concat(s)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(a,"/public/").concat(n).concat(s))}}}remove(e){return vr(this,void 0,void 0,function*(){try{return{data:yield pr(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(er(t))return{data:null,error:t};throw t}})}list(e,t,n){return vr(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},gr),t),{prefix:e||""});return{data:yield hr(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(er(r))return{data:null,error:r};throw r}})}listV2(e,t){return vr(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield hr(this.fetch,"".concat(this.url,"/object/list-v2/").concat(this.bucketId),n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!==typeof mr?mr.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const xr={"X-Client-Info":"storage-js/".concat("2.12.0")};var wr=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};class kr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;this.shouldThrowOnError=!1;const o=new URL(e);if(null===r||void 0===r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase."))}this.url=o.href,this.headers=Object.assign(Object.assign({},xr),t),this.fetch=or(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return wr(this,void 0,void 0,function*(){try{return{data:yield dr(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(er(e))return{data:null,error:e};throw e}})}getBucket(e){return wr(this,void 0,void 0,function*(){try{return{data:yield dr(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(er(t))return{data:null,error:t};throw t}})}createBucket(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return wr(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return wr(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(er(n))return{data:null,error:n};throw n}})}emptyBucket(e){return wr(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(er(t))return{data:null,error:t};throw t}})}deleteBucket(e){return wr(this,void 0,void 0,function*(){try{return{data:yield pr(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(er(t))return{data:null,error:t};throw t}})}}class _r extends kr{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}from(e){return new br(this.url,this.headers,e,this.fetch)}}let Er="";Er="undefined"!==typeof Deno?"deno":"undefined"!==typeof document?"web":"undefined"!==typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Cr={headers:{"X-Client-Info":"supabase-js-".concat(Er,"/").concat("2.57.2")}},Sr={schema:"public"},Nr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tr={};var Ir=n(621),Rr=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};const Ar=e=>{let t;return t=e||("undefined"===typeof fetch?Ir.default:fetch),function(){return t(...arguments)}},Dr=(e,t,n)=>{const r=Ar(n),o="undefined"===typeof Headers?Ir.Headers:Headers;return(n,a)=>Rr(void 0,void 0,void 0,function*(){var i;const s=null!==(i=yield t())&&void 0!==i?i:e;let u=new o(null===a||void 0===a?void 0:a.headers);return u.has("apikey")||u.set("apikey",e),u.has("Authorization")||u.set("Authorization","Bearer ".concat(s)),r(n,Object.assign(Object.assign({},a),{headers:u}))})};var Pr=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};const jr="2.71.1",Or=3e4,Mr=9e4,Fr={"X-Client-Info":"gotrue-js/".concat(jr)},Lr="X-Supabase-Api-Version",Br={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ur=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class zr extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Wr(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}class Vr extends zr{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class Hr extends zr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class qr extends zr{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class Gr extends qr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Kr extends qr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Xr extends qr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Yr extends qr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $r extends qr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Jr extends qr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Qr(e){return Wr(e)&&"AuthRetryableFetchError"===e.name}class Zr extends qr{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class eo extends qr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const to="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),no=" \t\n\r=".split(""),ro=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<no.length;t+=1)e[no[t].charCodeAt(0)]=-2;for(let t=0;t<to.length;t+=1)e[to[t].charCodeAt(0)]=t;return e})();function oo(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(to[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(to[e]),t.queuedBits-=6}}function ao(e,t,n){const r=ro[e];if(!(r>-1)){if(-2===r)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function io(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},a=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(0===(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)};for(let i=0;i<e.length;i+=1)ao(e.charCodeAt(i),o,a);return t.join("")}function so(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function uo(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}so(r,t)}}function lo(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let o=0;o<e.length;o+=1)ao(e.charCodeAt(o),n,r);return new Uint8Array(t)}function co(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>oo(e,n,r)),oo(null,n,r),t.join("")}const ho=()=>"undefined"!==typeof window&&"undefined"!==typeof document,fo={tested:!1,writable:!1},po=()=>{if(!ho())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(We){return!1}if(fo.tested)return fo.writable;const e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),fo.tested=!0,fo.writable=!0}catch(We){fo.tested=!0,fo.writable=!1}return fo.writable};const mo=e=>{let t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Promise.resolve().then(n.bind(n,621)).then(e=>{let{default:n}=e;return n(...t)})}:fetch),function(){return t(...arguments)}},vo=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},go=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(Ih){return n}},yo=async(e,t)=>{await e.removeItem(t)};class bo{constructor(){this.promise=new bo.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function xo(e){const t=e.split(".");if(3!==t.length)throw new eo("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Ur.test(t[n]))throw new eo("JWT not in base64url format");return{header:JSON.parse(io(t[0])),payload:JSON.parse(io(t[1])),signature:lo(t[2]),raw:{header:t[0],payload:t[1]}}}function wo(e){return("0"+e.toString(16)).substr(-2)}async function ko(e){if(!("undefined"!==typeof crypto&&"undefined"!==typeof crypto.subtle&&"undefined"!==typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function _o(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(){const e=new Uint32Array(56);if("undefined"===typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,wo).join("")}();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await vo(e,"".concat(t,"-code-verifier"),o);const a=await ko(r);return[a,r===a?"plain":"s256"]}bo.promiseConstructor=Promise;const Eo=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Co=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function So(e){if(!Co.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function No(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:(e,t)=>{throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function To(e){return JSON.parse(JSON.stringify(e))}var Io=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};const Ro=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ao=[502,503,504];async function Do(e){var t,n;if(!("object"===typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json))throw new Jr(Ro(e),0);if(Ao.includes(e.status))throw new Jr(Ro(e),e.status);let r,o;try{r=await e.json()}catch(We){throw new Hr(Ro(We),We)}const a=function(e){const t=e.headers.get(Lr);if(!t)return null;if(!t.match(Eo))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(We){return null}}(e);if(a&&a.getTime()>=Br.timestamp&&"object"===typeof r&&r&&"string"===typeof r.code?o=r.code:"object"===typeof r&&r&&"string"===typeof r.error_code&&(o=r.error_code),o){if("weak_password"===o)throw new Zr(Ro(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===o)throw new Gr}else if("object"===typeof r&&r&&"object"===typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0))throw new Zr(Ro(r),e.status,r.weak_password.reasons);throw new Vr(Ro(r),e.status||500,o)}async function Po(e,t,n,r){var o;const a=Object.assign({},null===r||void 0===r?void 0:r.headers);a[Lr]||(a[Lr]=Br.name),(null===r||void 0===r?void 0:r.jwt)&&(a.Authorization="Bearer ".concat(r.jwt));const i=null!==(o=null===r||void 0===r?void 0:r.query)&&void 0!==o?o:{};(null===r||void 0===r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const s=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",u=await async function(e,t,n,r,o,a){const i=((e,t,n,r)=>{const o={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))})(t,r,o,a);let s;try{s=await e(n,Object.assign({},i))}catch(We){throw console.error(We),new Jr(Ro(We),0)}s.ok||await Do(s);if(null===r||void 0===r?void 0:r.noResolveJson)return s;try{return await s.json()}catch(We){await Do(We)}}(e,t,n+s,{headers:a,noResolveJson:null===r||void 0===r?void 0:r.noResolveJson},{},null===r||void 0===r?void 0:r.body);return(null===r||void 0===r?void 0:r.xform)?null===r||void 0===r?void 0:r.xform(u):{data:Object.assign({},u),error:null}}function jo(e){var t;let n=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Oo(e){const t=jo(e);return!t.error&&e.weak_password&&"object"===typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"===typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"===typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Mo(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Fo(e){return{data:e,error:null}}function Lo(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:o,verification_type:a}=e,i=Io(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:r,redirect_to:o,verification_type:a},user:Object.assign({},i)},error:null}}function Bo(e){return e}const Uo=["global","local","others"];var zo=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};class Wo{constructor(e){let{url:t="",headers:n={},fetch:r}=e;this.url=t,this.headers=n,this.fetch=mo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uo[0];if(Uo.indexOf(t)<0)throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Uo.join(", ")));try{return await Po(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Wr(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await Po(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Mo})}catch(n){if(Wr(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=zo(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=null===n||void 0===n?void 0:n.newEmail,delete r.newEmail),await Po(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:r,headers:this.headers,xform:Lo,redirectTo:null===t||void 0===t?void 0:t.redirectTo})}catch(t){if(Wr(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Po(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:Mo})}catch(t){if(Wr(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,o,a,i,s;try{const u={nextPage:null,lastPage:0,total:0},l=await Po(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(r=null===e||void 0===e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==o?o:""},xform:Bo});if(l.error)throw l.error;const c=await l.json(),d=null!==(a=l.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(s=null===(i=l.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==s?s:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);u["".concat(n,"Page")]=t}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},c),u),error:null}}catch(u){if(Wr(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){So(e);try{return await Po(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:Mo})}catch(t){if(Wr(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){So(e);try{return await Po(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:Mo})}catch(n){if(Wr(n))return{data:{user:null},error:n};throw n}}async deleteUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];So(e);try{return await Po(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:Mo})}catch(n){if(Wr(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){So(e.userId);try{const{data:t,error:n}=await Po(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(Wr(t))return{data:null,error:t};throw t}}async _deleteFactor(e){So(e.userId),So(e.id);try{return{data:await Po(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Wr(t))return{data:null,error:t};throw t}}}function Vo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const Ho=!!(globalThis&&po()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class qo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Go extends qo{}async function Ko(e,t,n){Ho&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Ho&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Ho&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Go('Acquiring an exclusive Navigator LockManager lock "'.concat(e,'" immediately failed'));if(Ho)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(We){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",We)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}Ho&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{Ho&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(We){"undefined"!==typeof self&&(self.globalThis=self)}}();const Xo={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Fr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Yo(e,t,n){return await n()}const $o={};class Jo{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jo.nextInstanceID,Jo.nextInstanceID+=1,this.instanceID>0&&ho()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Xo),e);if(this.logDebugMessages=!!r.debug,"function"===typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Wo({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=mo(r.fetch),this.lock=r.lock||Yo,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ho()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Ko:this.lock=Yo,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:po()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vo(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Vo(this.memoryStorage)),ho()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(We){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",We)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=$o[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){$o[this.storageKey]=Object.assign(Object.assign({},$o[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=$o[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){$o[this.storageKey]=Object.assign(Object.assign({},$o[this.storageKey]),{cachedAt:e})}_debug(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger("GoTrueClient@".concat(this.instanceID," (").concat(jr,") ").concat((new Date).toISOString()),...t)}return this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((e,n)=>{t[n]=e})}catch(We){}return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),ho()&&this.detectSessionInUrl&&"none"!==n){const{data:r,error:o}=await this._getSessionFromURL(t,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),function(e){return Wr(e)&&"AuthImplicitGrantRedirectError"===e.name}(o)){const t=null===(e=o.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:o}}return await this._removeSession(),{error:o}}const{session:a,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",i),await this._saveSession(a),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Wr(t)?{error:t}:{error:new Hr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const o=await Po(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(n=null===(t=null===e||void 0===e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:jo}),{data:a,error:i}=o;if(i||!a)return{data:{user:null,session:null},error:i};const s=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",s)),{data:{user:u,session:s},error:null}}catch(o){if(Wr(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,n,r;try{let o;if("email"in e){const{email:n,password:r,options:a}=e;let i=null,s=null;"pkce"===this.flowType&&([i,s]=await _o(this.storage,this.storageKey)),o=await Po(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===a||void 0===a?void 0:a.emailRedirectTo,body:{email:n,password:r,data:null!==(t=null===a||void 0===a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:s},xform:jo})}else{if(!("phone"in e))throw new Xr("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;o=await Po(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:t,password:a,data:null!==(n=null===i||void 0===i?void 0:i.data)&&void 0!==n?n:{},channel:null!==(r=null===i||void 0===i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null===i||void 0===i?void 0:i.captchaToken}},xform:jo})}}const{data:a,error:i}=o;if(i||!a)return{data:{user:null,session:null},error:i};const s=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",s)),{data:{user:u,session:s},error:null}}catch(o){if(Wr(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:r,options:o}=e;t=await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:Oo})}else{if(!("phone"in e))throw new Xr("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:o}=e;t=await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},xform:Oo})}}const{data:n,error:r}=t;return r?{data:{user:null,session:null},error:r}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Kr}}catch(t){if(Wr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,r,o;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(o=e.options)||void 0===o?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error('@supabase/auth-js: Unsupported chain "'.concat(t,'"'))}async signInWithSolana(e){var t,n,r,o,a,i,s,u,l,c,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:d,wallet:h,statement:m,options:v}=e;let g;if(ho())if("object"===typeof h)g=h;else{const e=window;if(!("solana"in e)||"object"!==typeof e.solana||!("signIn"in e.solana&&"function"===typeof e.solana.signIn||"signMessage"in e.solana&&"function"===typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");g=e.solana}else{if("object"!==typeof h||!(null===v||void 0===v?void 0:v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=h}const y=new URL(null!==(t=null===v||void 0===v?void 0:v.url)&&void 0!==t?t:window.location.href);if("signIn"in g&&g.signIn){const e=await g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null===v||void 0===v?void 0:v.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),m?{statement:m}:null));let t;if(Array.isArray(e)&&e[0]&&"object"===typeof e[0])t=e[0];else{if(!(e&&"object"===typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"===typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"===typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in g)||"function"!==typeof g.signMessage||!("publicKey"in g)||"object"!==typeof g||!g.publicKey||!("toBase58"in g.publicKey)||"function"!==typeof g.publicKey.toBase58)throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=["".concat(y.host," wants you to sign in with your Solana account:"),g.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1","URI: ".concat(y.href),"Issued At: ".concat(null!==(r=null===(n=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==r?r:(new Date).toISOString()),...(null===(o=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===o?void 0:o.notBefore)?["Not Before: ".concat(v.signInWithSolana.notBefore)]:[],...(null===(a=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===a?void 0:a.expirationTime)?["Expiration Time: ".concat(v.signInWithSolana.expirationTime)]:[],...(null===(i=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===i?void 0:i.chainId)?["Chain ID: ".concat(v.signInWithSolana.chainId)]:[],...(null===(s=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===s?void 0:s.nonce)?["Nonce: ".concat(v.signInWithSolana.nonce)]:[],...(null===(u=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===u?void 0:u.requestId)?["Request ID: ".concat(v.signInWithSolana.requestId)]:[],...(null===(c=null===(l=null===v||void 0===v?void 0:v.signInWithSolana)||void 0===l?void 0:l.resources)||void 0===c?void 0:c.length)?["Resources",...v.signInWithSolana.resources.map(e=>"- ".concat(e))]:[]].join("\n");const e=await g.signMessage((new TextEncoder).encode(f),"utf8");if(!e||!(e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:n}=await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:co(p)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:jo});if(n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:n}):{data:{user:null,session:null},error:new Kr}}catch(m){if(Wr(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const t=await go(this.storage,"".concat(this.storageKey,"-code-verifier")),[n,r]=(null!==t&&void 0!==t?t:"").split("/");try{const{data:t,error:o}=await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:jo});if(await yo(this.storage,"".concat(this.storageKey,"-code-verifier")),o)throw o;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!==r&&void 0!==r?r:null}),error:o}):{data:{user:null,session:null,redirectType:null},error:new Kr}}catch(o){if(Wr(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:o,nonce:a}=e,i=await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:n,id_token:r,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:null===t||void 0===t?void 0:t.captchaToken}},xform:jo}),{data:s,error:u}=i;return u?{data:{user:null,session:null},error:u}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:s,error:u}):{data:{user:null,session:null},error:new Kr}}catch(t){if(Wr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,r,o,a;try{if("email"in e){const{email:r,options:o}=e;let a=null,i=null;"pkce"===this.flowType&&([a,i]=await _o(this.storage,this.storageKey));const{error:s}=await Po(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:r,data:null!==(t=null===o||void 0===o?void 0:o.data)&&void 0!==t?t:{},create_user:null===(n=null===o||void 0===o?void 0:o.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null===o||void 0===o?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:s}}if("phone"in e){const{phone:t,options:n}=e,{data:i,error:s}=await Po(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:t,data:null!==(r=null===n||void 0===n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(o=null===n||void 0===n?void 0:n.shouldCreateUser)||void 0===o||o,gotrue_meta_security:{captcha_token:null===n||void 0===n?void 0:n.captchaToken},channel:null!==(a=null===n||void 0===n?void 0:n.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null===i||void 0===i?void 0:i.message_id},error:s}}throw new Xr("You must provide either an email or phone number.")}catch(i){if(Wr(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,n;try{let r,o;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,o=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:a,error:i}=await Po(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:r,xform:jo});if(i)throw i;if(!a)throw new Error("An error occurred on token verification.");const s=a.session,u=a.user;return(null===s||void 0===s?void 0:s.access_token)&&(await this._saveSession(s),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",s)),{data:{user:u,session:s},error:null}}catch(r){if(Wr(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,n,r;try{let o=null,a=null;return"pkce"===this.flowType&&([o,a]=await _o(this.storage,this.storageKey)),await Po(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null===e||void 0===e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Fo})}catch(o){if(Wr(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Gr;const{error:r}=await Po(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Wr(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:n,type:r,options:o}=e,{error:a}=await Po(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}},redirectTo:null===o||void 0===o?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:n,type:r,options:o}=e,{data:a,error:i}=await Po(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null===o||void 0===o?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:null===a||void 0===a?void 0:a.message_id},error:i}}throw new Xr("You must provide either an email or phone number and a type")}catch(t){if(Wr(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(We){}})()),n}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(We){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await go(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<Mr;if(this._debug("#__loadSession()","session has".concat(n?"":" not"," expired"),"expires_at",e.expires_at),!n){if(this.userStorage){const t=await go(this.userStorage,this.storageKey+"-user");(null===t||void 0===t?void 0:t.user)?e.user=t.user:e.user=No()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,n,r)=>(t||"user"!==n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,n,r))})}return{data:{session:e},error:null}}const{session:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Po(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:Mo}):await this._useSession(async e=>{var t,n,r;const{data:o,error:a}=e;if(a)throw a;return(null===(t=o.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Po(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:null!==(r=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:Mo}):{data:{user:null},error:new Gr}})}catch(t){if(Wr(t))return function(e){return Wr(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await yo(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:t};throw t}}async updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this._useSession(async n=>{const{data:r,error:o}=n;if(o)throw o;if(!r.session)throw new Gr;const a=r.session;let i=null,s=null;"pkce"===this.flowType&&null!=e.email&&([i,s]=await _o(this.storage,this.storageKey));const{data:u,error:l}=await Po(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:s}),jwt:a.access_token,xform:Mo});if(l)throw l;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(n){if(Wr(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Gr;const t=Date.now()/1e3;let n=t,r=!0,o=null;const{payload:a}=xo(e.access_token);if(a.exp&&(n=a.exp,r=n<=t),r){const{session:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!t)return{data:{user:null,session:null},error:null};o=t}else{const{data:r,error:a}=await this._getUser(e.access_token);if(a)throw a;o={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(Wr(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:o}=t;if(o)throw o;e=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null===e||void 0===e?void 0:e.refresh_token))throw new Gr;const{session:r,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Wr(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ho())throw new Yr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Yr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new $r("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Yr("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $r("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:o,refresh_token:a,expires_in:i,expires_at:s,token_type:u}=e;if(!o||!i||!a||!u)throw new Yr("No session defined in URL");const l=Math.round(Date.now()/1e3),c=parseInt(i);let d=l+c;s&&(d=parseInt(s));const h=d-l;1e3*h<=Or&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(h,"s, should have been closer to ").concat(c,"s"));const f=d-c;l-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,l):l-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,l);const{data:p,error:m}=await this._getUser(o);if(m)throw m;const v={provider_token:n,provider_refresh_token:r,access_token:o,expires_in:c,expires_at:d,refresh_token:a,token_type:u,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(n){if(Wr(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await go(this.storage,"".concat(this.storageKey,"-code-verifier"));return!(!e.code||!t)}async signOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut(){let{scope:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scope:"global"};return await this._useSession(async t=>{var n;const{data:r,error:o}=t;if(o)return{error:o};const a=null===(n=r.session)||void 0===n?void 0:n.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Wr(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await yo(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:r},error:o}=t;if(o)throw o;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(o){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null;"pkce"===this.flowType&&([n,r]=await _o(this.storage,this.storageKey,!0));try{return await Po(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(Wr(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Wr(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:r}=await this._useSession(async t=>{var n,r,o,a,i;const{data:s,error:u}=t;if(u)throw u;const l=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:!0});return await Po(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(i=null===(a=s.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return ho()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null===n||void 0===n?void 0:n.url),{data:{provider:e.provider,url:null===n||void 0===n?void 0:n.url},error:null}}catch(n){if(Wr(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:o,error:a}=t;if(a)throw a;return await Po(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:null!==(r=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Wr(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const n=Date.now();return await function(e,t){const n=new Promise((n,r)=>{(async()=>{for(let o=0;o<1/0;o++)try{const r=await e(o);if(!t(o,null,r))return void n(r)}catch(We){if(!t(o,We))return void r(We)}})()});return n}(async n=>(n>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await Po(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:jo})),(e,t)=>{const r=200*Math.pow(2,e);return t&&Qr(t)&&Date.now()+r-n<Or})}catch(n){if(this._debug(t,"error",n),Wr(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ho()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await go(this.storage,this.storageKey);if(o&&this.userStorage){let t=await go(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:o.user},await vo(this.userStorage,this.storageKey+"-user",t)),o.user=null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:No()}else if(o&&!o.user&&!o.user){const e=await go(this.storage,this.storageKey+"-user");e&&(null===e||void 0===e?void 0:e.user)?(o.user=e.user,await yo(this.storage,this.storageKey+"-user"),await vo(this.storage,this.storageKey,o)):o.user=No()}if(this._debug(n,"session from storage",o),!this._isValidSession(o))return this._debug(n,"session is not valid"),void(null!==o&&await this._removeSession());const a=1e3*(null!==(t=o.expires_at)&&void 0!==t?t:1/0)-Date.now()<Mr;if(this._debug(n,"session has".concat(a?"":" not"," expired with margin of ").concat(Mr,"s")),a){if(this.autoRefreshToken&&o.refresh_token){const{error:e}=await this._callRefreshToken(o.refresh_token);e&&(console.error(e),Qr(e)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(o.user&&!0===o.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(o.access_token);!t&&(null===e||void 0===e?void 0:e.user)?(o.user=e.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){return this._debug(n,"error",o),void console.error(o)}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Gr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(r,"begin");try{this.refreshingDeferred=new bo;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new Gr;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(o){if(this._debug(r,"error",o),Wr(o)){const e={session:null,error:o};return Qr(o)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r="#_notifyAllSubscribers(".concat(e,")");this._debug(r,"begin",t,"broadcast = ".concat(n));try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(e,t)}catch(We){r.push(We)}});if(await Promise.all(o),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&t.user&&await vo(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=To(e);await vo(this.storage,this.storageKey,r)}else{const e=To(t);await vo(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await yo(this.storage,this.storageKey),await yo(this.storage,this.storageKey+"-code-verifier"),await yo(this.storage,this.storageKey+"-user"),this.userStorage&&await yo(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ho()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(We){console.error("removing visibilitychange callback failed",We)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Or);this.autoRefreshTicker=e,e&&"object"===typeof e&&"function"===typeof e.unref?e.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-e)/Or);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(r," ticks, a tick lasts ").concat(Or,"ms, refresh threshold is ").concat(3," ticks")),r<=3&&await this._callRefreshToken(n.refresh_token)})}catch(We){console.error("Auto refresh tick failed with error. This is likely a transient error.",We)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(We){if(!(We.isAcquireTimeout||We instanceof qo))throw We;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ho()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=["provider=".concat(encodeURIComponent(t))];if((null===n||void 0===n?void 0:n.redirectTo)&&r.push("redirect_to=".concat(encodeURIComponent(n.redirectTo))),(null===n||void 0===n?void 0:n.scopes)&&r.push("scopes=".concat(encodeURIComponent(n.scopes))),"pkce"===this.flowType){const[e,t]=await _o(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(e)),code_challenge_method:"".concat(encodeURIComponent(t))});r.push(n.toString())}if(null===n||void 0===n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);r.push(e.toString())}return(null===n||void 0===n?void 0:n.skipBrowserRedirect)&&r.push("skip_http_redirect=".concat(n.skipBrowserRedirect)),"".concat(e,"?").concat(r.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:o}=t;return o?{data:null,error:o}:await Po(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(Wr(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:o,error:a}=t;if(a)return{data:null,error:a};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:s,error:u}=await Po(this.fetch,"POST","".concat(this.url,"/factors"),{body:i,headers:this.headers,jwt:null===(n=null===o||void 0===o?void 0:o.session)||void 0===n?void 0:n.access_token});return u?{data:null,error:u}:("totp"===e.factorType&&(null===(r=null===s||void 0===s?void 0:s.totp)||void 0===r?void 0:r.qr_code)&&(s.totp.qr_code="data:image/svg+xml;utf-8,".concat(s.totp.qr_code)),{data:s,error:null})})}catch(t){if(Wr(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:i}=await Po(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:i})})}catch(t){if(Wr(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:o}=t;return o?{data:null,error:o}:await Po(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:{channel:e.channel},headers:this.headers,jwt:null===(n=null===r||void 0===r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(Wr(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(null===e||void 0===e?void 0:e.factors)||[],r=n.filter(e=>"totp"===e.factor_type&&"verified"===e.status),o=n.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:n,totp:r,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:r},error:o}=e;if(o)return{data:null,error:o};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=xo(r.access_token);let i=null;a.aal&&(i=a.aal);let s=i;(null!==(n=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==n?n:[]).length>0&&(s="aal2");return{data:{currentLevel:i,nextLevel:s,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e){let t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keys:[]}).keys.find(t=>t.kid===e);if(t)return t;const n=Date.now();if(t=this.jwks.keys.find(t=>t.kid===e),t&&this.jwks_cached_at+6e5>n)return t;const{data:r,error:o}=await Po(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(o)throw o;return r.keys&&0!==r.keys.length?(this.jwks=r,this.jwks_cached_at=n,t=r.keys.find(t=>t.kid===e),t||null):null}async getClaims(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};n=e.session.access_token}const{header:r,payload:o,signature:a,raw:{header:i,payload:s}}=xo(n);(null===t||void 0===t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(o.exp);const u=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null===t||void 0===t?void 0:t.keys)?{keys:t.keys}:null===t||void 0===t?void 0:t.jwks):null;if(!u){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:o,header:r,signature:a},error:null}}const l=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),c=await crypto.subtle.importKey("jwk",u,l,!0,["verify"]);if(!await crypto.subtle.verify(l,c,a,function(e){const t=[];return uo(e,e=>t.push(e)),new Uint8Array(t)}("".concat(i,".").concat(s))))throw new eo("Invalid JWT signature");return{data:{claims:o,header:r,signature:a},error:null}}catch(n){if(Wr(n))return{data:null,error:n};throw n}}}Jo.nextInstanceID=0;const Qo=Jo;class Zo extends Qo{constructor(e){super(e)}}var ea=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})};class ta{constructor(e,t,n){var r,o,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=(s=e).endsWith("/")?s:s+"/";var s;const u=new URL(i);this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const l="sb-".concat(u.hostname.split(".")[0],"-auth-token"),c=function(e,t){var n,r;const{db:o,auth:a,realtime:i,global:s}=e,{db:u,auth:l,realtime:c,global:d}=t,h={db:Object.assign(Object.assign({},u),o),auth:Object.assign(Object.assign({},l),a),realtime:Object.assign(Object.assign({},c),i),storage:{},global:Object.assign(Object.assign(Object.assign({},d),s),{headers:Object.assign(Object.assign({},null!==(n=null===d||void 0===d?void 0:d.headers)&&void 0!==n?n:{}),null!==(r=null===s||void 0===s?void 0:s.headers)&&void 0!==r?r:{})}),accessToken:()=>Pr(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!==n&&void 0!==n?n:{},{db:Sr,realtime:Tr,auth:Object.assign(Object.assign({},Nr),{storageKey:l}),global:Cr});this.storageKey=null!==(r=c.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(o=c.global.headers)&&void 0!==o?o:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(a=c.auth)&&void 0!==a?a:{},this.headers,c.global.fetch),this.fetch=Dr(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new hn(new URL("rest/v1",u).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new _r(this.storageUrl.href,this.headers,this.fetch,null===n||void 0===n?void 0:n.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new cn(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.rest.rpc(e,t,n)}channel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ea(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(t=null===(e=n.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient(e,t,n){let{autoRefreshToken:r,persistSession:o,detectSessionInUrl:a,storage:i,userStorage:s,storageKey:u,flowType:l,lock:c,debug:d}=e;const h={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Zo({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),t),storageKey:u,autoRefreshToken:r,persistSession:o,detectSessionInUrl:a,storage:i,userStorage:s,flowType:l,lock:c,debug:d,fetch:n,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Qn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null===t||void 0===t?void 0:t.access_token)})}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=n}}var na=n(224);(function(){if("undefined"!==typeof window)return!1;if("undefined"===typeof na)return!1;const e=na.version;if(void 0===e||null===e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("\u26a0\ufe0f  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ra=((e,t,n)=>new ta(e,t,n))("https://eiqcqnrqbdabmjvjbgcs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpcWNxbnJxYmRhYm1qdmpiZ2NzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTQ1ODgsImV4cCI6MjA3MjkzMDU4OH0.Zv5EkVBNBHlLe9o8EaXOIjQgEH4PzKeHjkWMtUXZkNk");var oa=n(414);const aa=(0,t.createContext)(void 0),ia=()=>{const e=(0,t.useContext)(aa);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},sa=e=>{let{children:n}=e;const[r,o]=(0,t.useState)(null),[a,i]=(0,t.useState)(null),[s,u]=(0,t.useState)(null),[l,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{try{var e;const{data:{session:t}}=await ra.auth.getSession();u(t),o(null!==(e=null===t||void 0===t?void 0:t.user)&&void 0!==e?e:null),null!==t&&void 0!==t&&t.user&&d(t.user.id).catch(e=>{console.error("Background profile fetch failed:",e)}),c(!1)}catch(t){console.error("Error getting initial session:",t),c(!1)}})();const{data:{subscription:e}}=ra.auth.onAuthStateChange(async(e,t)=>{var n;u(t),o(null!==(n=null===t||void 0===t?void 0:t.user)&&void 0!==n?n:null),null!==t&&void 0!==t&&t.user?d(t.user.id).catch(e=>{console.error("Background profile fetch failed:",e)}):i(null),c(!1)});return()=>e.unsubscribe()},[]);const d=async e=>{try{const{data:t,error:n}=await ra.from("profiles").select("*").eq("id",e).single();if(n)return console.error("Error fetching profile:",n),void i(null);i(t)}catch(t){console.error("Error fetching profile:",t),i(null)}},h={user:r,profile:a,session:s,loading:l,signIn:async(e,t)=>{try{c(!0);const{error:n}=await ra.auth.signInWithPassword({email:e,password:t});if(n)throw n;nn.success("Welcome back!")}catch(n){throw nn.error(n.message||"Failed to sign in"),n}finally{c(!1)}},signUp:async(e,t,n)=>{try{c(!0);const{error:r}=await ra.auth.signUp({email:e,password:t,options:{data:n}});if(r)throw r;nn.success("Account created successfully! Please check your email to verify your account.")}catch(r){throw nn.error(r.message||"Failed to create account"),r}finally{c(!1)}},signOut:async()=>{try{c(!0);const{data:{session:e}}=await ra.auth.getSession();if(e){const{error:e}=await ra.auth.signOut();if(e)throw e}else u(null),o(null),i(null);nn.success("Signed out successfully")}catch(t){var e;if(!(null!==(e=t.message)&&void 0!==e&&e.includes("Auth session missing")||"AuthSessionMissingError"===t.name))throw nn.error(t.message||"Failed to sign out"),t;u(null),o(null),i(null),nn.success("Signed out successfully")}finally{c(!1)}},updateProfile:async e=>{if(!r)throw new Error("No user logged in");const{error:t}=await ra.from("profiles").update(ze(ze({},e),{},{updated_at:(new Date).toISOString()})).eq("id",r.id);if(t)throw nn.error(t.message||"Failed to update profile"),t;await d(r.id),nn.success("Profile updated successfully")}};return(0,oa.jsx)(aa.Provider,{value:h,children:n})};function ua(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var la={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ca=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],da=(e,n)=>{const r=(0,t.forwardRef)((r,o)=>{let{color:a="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:u,className:l="",children:c}=r,d=ua(r,ca);return(0,t.createElement)("svg",ze(ze({ref:o},la),{},{width:i,height:i,stroke:a,strokeWidth:u?24*Number(s)/Number(i):s,className:["lucide","lucide-".concat((h=e,h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),l].join(" ")},d),[...n.map(e=>{let[n,r]=e;return(0,t.createElement)(n,r)}),...Array.isArray(c)?c:[c]]);var h});return r.displayName="".concat(e),r},ha=da("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),fa=da("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),pa=da("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ma=da("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),va=da("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ga=da("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),ya=da("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]),ba=da("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),xa=()=>{const{signOut:e,profile:n}=ia(),r=$(),[o,a]=(0,t.useState)(!1),i=[{name:"Dashboard",href:"/dashboard",icon:ha},{name:"Attendance",href:"/attendance",icon:fa},{name:"Profile",href:"/profile",icon:pa},{name:"Reports",href:"/reports",icon:ma}];return(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsx)("button",{onClick:()=>a(!o),className:"lg:hidden fixed top-4 left-4 z-50 p-2 bg-white rounded-xl shadow-lg border border-gray-200 hover:bg-gray-50 transition-all duration-200",children:o?(0,oa.jsx)(va,{className:"w-6 h-6 text-gray-600"}):(0,oa.jsx)(ga,{className:"w-6 h-6 text-gray-600"})}),o&&(0,oa.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:()=>a(!1)}),(0,oa.jsxs)("div",{className:"\n        fixed lg:static inset-y-0 left-0 z-40 w-72 lg:w-64\n        bg-white/95 backdrop-blur-xl shadow-2xl lg:shadow-xl border-r border-gray-200/50 \n        flex flex-col transform transition-transform duration-300 ease-in-out\n        ".concat(o?"translate-x-0":"-translate-x-full lg:translate-x-0","\n      "),children:[(0,oa.jsx)("div",{className:"p-6 lg:p-6 pt-16 lg:pt-6 border-b border-gray-200/30 bg-gradient-to-r from-gray-50/50 to-white/50",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,oa.jsx)("div",{className:"relative w-14 h-14 bg-gradient-to-br from-emerald-600 via-teal-600 to-cyan-600 rounded-3xl flex items-center justify-center shadow-xl",children:(0,oa.jsx)(ya,{className:"w-8 h-8 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700 bg-clip-text text-transparent",children:"AttendX"}),(0,oa.jsx)("p",{className:"text-sm text-gray-500 font-semibold flex items-center space-x-1",children:(0,oa.jsx)("span",{children:"Biometric Tracking"})})]})]})}),(0,oa.jsx)("nav",{className:"flex-1 p-6 space-y-2",children:i.map(e=>{const t=r.pathname===e.href;return(0,oa.jsxs)(De,{to:e.href,onClick:()=>a(!1),className:"\n                  group relative flex items-center space-x-4 px-4 py-4 rounded-2xl text-sm font-semibold transition-all duration-300 overflow-hidden\n                  ".concat(t?"bg-gradient-to-r from-blue-50/80 to-indigo-50/80 text-blue-700 shadow-lg border border-blue-200/50 backdrop-blur-sm":"text-gray-600 hover:bg-gradient-to-r hover:from-gray-50/80 hover:to-slate-50/80 hover:text-gray-900 hover:shadow-md hover:backdrop-blur-sm","\n                "),children:[t&&(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/15 to-indigo-500/15 rounded-2xl animate-pulse"}),(0,oa.jsx)("div",{className:"\n                  relative w-11 h-11 rounded-xl flex items-center justify-center transition-all duration-300 shadow-md\n                  ".concat(t?"bg-gradient-to-br from-blue-500 to-indigo-600 shadow-lg scale-110":"bg-gray-100/80 group-hover:bg-gradient-to-br group-hover:from-gray-200 group-hover:to-gray-300 group-hover:scale-105","\n                "),children:(0,oa.jsx)(e.icon,{className:"w-5 h-5 transition-colors duration-300 ".concat(t?"text-white":"text-gray-500 group-hover:text-gray-700")})}),(0,oa.jsx)("span",{className:"relative font-semibold",children:e.name})]},e.name)})}),(0,oa.jsx)("div",{className:"p-6 border-t border-gray-200/30 bg-gradient-to-r from-gray-50/80 to-slate-50/80 backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-gray-200 to-gray-300 rounded-3xl flex items-center justify-center shadow-xl",children:null!==n&&void 0!==n&&n.avatar_url?(0,oa.jsx)("img",{src:n.avatar_url,alt:n.full_name,className:"w-14 h-14 rounded-3xl object-cover"}):(0,oa.jsx)(pa,{className:"w-7 h-7 text-gray-600"})}),(0,oa.jsx)("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-gradient-to-r from-emerald-400 to-emerald-500 rounded-full border-2 border-white shadow-lg animate-pulse"})]}),(0,oa.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-900 truncate",children:(null===n||void 0===n?void 0:n.full_name)||"User"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold flex items-center space-x-1 leading-tight",children:(0,oa.jsx)("span",{className:"break-words",children:(null===n||void 0===n?void 0:n.position)||"Employee"})})]}),(0,oa.jsx)("button",{onClick:async()=>{try{await e()}catch(n){var t;null!==(t=n.message)&&void 0!==t&&t.includes("Auth session missing")||"AuthSessionMissingError"===n.name||console.error("Error signing out:",n)}},className:"group relative p-2.5 text-gray-500 hover:text-red-600 bg-white/80 hover:bg-red-50/80 rounded-xl border border-gray-200/50 hover:border-red-200 transition-all duration-300 shadow-md hover:shadow-lg backdrop-blur-sm hover:scale-105",title:"Sign Out",children:(0,oa.jsx)(ba,{className:"w-5 h-5"})})]})})]})]})},wa=()=>(0,oa.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,oa.jsxs)("div",{className:"flex h-screen",children:[(0,oa.jsx)(xa,{}),(0,oa.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,oa.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:(0,oa.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,oa.jsx)(me,{})})})})]})}),ka=da("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),_a=da("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ea=da("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ca=da("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Sa=e=>{let{size:t="md",className:n=""}=e;return(0,oa.jsx)("div",{className:"loading-spinner ".concat({sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"}[t]," ").concat(n)})},Na=()=>{const[e,n]=(0,t.useState)(""),[r,o]=(0,t.useState)(""),[a,i]=(0,t.useState)(!1),[s,u]=(0,t.useState)(!1),{signIn:l}=ia();return(0,oa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-primary-100 py-12 px-4 sm:px-6 lg:px-8",children:(0,oa.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,oa.jsxs)("div",{className:"text-center",children:[(0,oa.jsx)("div",{className:"mx-auto w-16 h-16 bg-primary-600 rounded-xl flex items-center justify-center mb-4",children:(0,oa.jsx)(fa,{className:"w-8 h-8 text-white"})}),(0,oa.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Welcome back"}),(0,oa.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Sign in to your AttendTrack account"})]}),(0,oa.jsx)("div",{className:"card",children:(0,oa.jsx)("div",{className:"card-body",children:(0,oa.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{t.preventDefault(),u(!0);try{await l(e,r)}catch(n){console.error("Login error:",n)}finally{u(!1)}},children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"email",className:"label",children:"Email address"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(ka,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"input pl-10",placeholder:"Enter your email",value:e,onChange:e=>n(e.target.value)})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"password",className:"label",children:"Password"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"password",name:"password",type:a?"text":"password",autoComplete:"current-password",required:!0,className:"input pl-10 pr-10",placeholder:"Enter your password",value:r,onChange:e=>o(e.target.value)}),(0,oa.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>i(!a),children:a?(0,oa.jsx)(Ea,{className:"w-5 h-5"}):(0,oa.jsx)(Ca,{className:"w-5 h-5"})})]})]}),(0,oa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,oa.jsxs)("div",{className:"flex items-center",children:[(0,oa.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,oa.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),(0,oa.jsx)("div",{className:"text-sm",children:(0,oa.jsx)("button",{type:"button",className:"font-medium text-primary-600 hover:text-primary-500",children:"Forgot your password?"})})]}),(0,oa.jsx)("div",{children:(0,oa.jsx)("button",{type:"submit",disabled:s,className:"btn-primary btn-lg w-full",children:s?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Signing in..."]}):"Sign in"})})]})})}),(0,oa.jsx)("div",{className:"text-center",children:(0,oa.jsxs)("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",(0,oa.jsx)(Ae,{to:"/register",className:"font-medium text-primary-600 hover:text-primary-500",children:"Sign up here"})]})})]})})},Ta=da("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),Ia=da("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Ra=["confirmPassword"],Aa=()=>{const[e,n]=(0,t.useState)({email:"",password:"",confirmPassword:"",full_name:"",employee_id:"",department:"",position:""}),[r,o]=(0,t.useState)(!1),[a,i]=(0,t.useState)(!1),[s,u]=(0,t.useState)(!1),{signUp:l}=ia(),c=t=>{n(ze(ze({},e),{},{[t.target.name]:t.target.value}))};return(0,oa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-primary-100 py-12 px-4 sm:px-6 lg:px-8",children:(0,oa.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,oa.jsxs)("div",{className:"text-center",children:[(0,oa.jsx)("div",{className:"mx-auto w-16 h-16 bg-primary-600 rounded-xl flex items-center justify-center mb-4",children:(0,oa.jsx)(fa,{className:"w-8 h-8 text-white"})}),(0,oa.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Create account"}),(0,oa.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Join AttendTrack and start tracking your attendance"})]}),(0,oa.jsx)("div",{className:"card",children:(0,oa.jsx)("div",{className:"card-body",children:(0,oa.jsxs)("form",{className:"space-y-6",onSubmit:async t=>{if(t.preventDefault(),e.password===e.confirmPassword){u(!0);try{const{confirmPassword:t}=e,n=ua(e,Ra);await l(e.email,e.password,n)}catch(n){console.error("Registration error:",n)}finally{u(!1)}}},children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"full_name",className:"label",children:"Full Name"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"full_name",name:"full_name",type:"text",required:!0,className:"input pl-10",placeholder:"Enter your full name",value:e.full_name,onChange:c})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"email",className:"label",children:"Email address"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(ka,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"input pl-10",placeholder:"Enter your email",value:e.email,onChange:c})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"employee_id",className:"label",children:"Employee ID"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ta,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"employee_id",name:"employee_id",type:"text",className:"input pl-10",placeholder:"Enter your employee ID",value:e.employee_id,onChange:c})]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"department",className:"label",children:"Department"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ia,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"department",name:"department",type:"text",className:"input pl-10",placeholder:"Department",value:e.department,onChange:c})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"position",className:"label",children:"Position"}),(0,oa.jsx)("input",{id:"position",name:"position",type:"text",className:"input",placeholder:"Position",value:e.position,onChange:c})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"password",className:"label",children:"Password"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"password",name:"password",type:r?"text":"password",autoComplete:"new-password",required:!0,className:"input pl-10 pr-10",placeholder:"Create a password",value:e.password,onChange:c}),(0,oa.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>o(!r),children:r?(0,oa.jsx)(Ea,{className:"w-5 h-5"}):(0,oa.jsx)(Ca,{className:"w-5 h-5"})})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"confirmPassword",className:"label",children:"Confirm Password"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:a?"text":"password",autoComplete:"new-password",required:!0,className:"input pl-10 pr-10 ".concat(e.confirmPassword&&e.password!==e.confirmPassword?"input-error":""),placeholder:"Confirm your password",value:e.confirmPassword,onChange:c}),(0,oa.jsx)("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>i(!a),children:a?(0,oa.jsx)(Ea,{className:"w-5 h-5"}):(0,oa.jsx)(Ca,{className:"w-5 h-5"})})]}),e.confirmPassword&&e.password!==e.confirmPassword&&(0,oa.jsx)("p",{className:"mt-1 text-sm text-danger-600",children:"Passwords do not match"})]}),(0,oa.jsxs)("div",{className:"flex items-center",children:[(0,oa.jsx)("input",{id:"terms",name:"terms",type:"checkbox",required:!0,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,oa.jsxs)("label",{htmlFor:"terms",className:"ml-2 block text-sm text-gray-900",children:["I agree to the"," ",(0,oa.jsx)("button",{type:"button",className:"text-primary-600 hover:text-primary-500",children:"Terms and Conditions"})]})]}),(0,oa.jsx)("div",{children:(0,oa.jsx)("button",{type:"submit",disabled:s||e.password!==e.confirmPassword,className:"btn-primary btn-lg w-full",children:s?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Creating account..."]}):"Create account"})})]})})}),(0,oa.jsx)("div",{className:"text-center",children:(0,oa.jsxs)("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",(0,oa.jsx)(Ae,{to:"/login",className:"font-medium text-primary-600 hover:text-primary-500",children:"Sign in here"})]})})]})})},Da=da("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Pa=da("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),ja=da("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Oa=da("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Ma=da("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),Fa=da("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),La=da("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Ba=da("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ua=da("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),za=da("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Wa=da("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function Va(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Ha(e){Va(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===Fe(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function qa(e){if(Va(1,arguments),!function(e){return Va(1,arguments),e instanceof Date||"object"===Fe(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!==typeof e)return!1;var t=Ha(e);return!isNaN(Number(t))}function Ga(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ka(e,t){return Va(2,arguments),function(e,t){Va(2,arguments);var n=Ha(e).getTime(),r=Ga(t);return new Date(n+r)}(e,-Ga(t))}function Xa(e){Va(1,arguments);var t=Ha(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function Ya(e){Va(1,arguments);var t=Ha(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var o=Xa(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var i=Xa(a);return t.getTime()>=o.getTime()?n+1:t.getTime()>=i.getTime()?n:n-1}function $a(e){Va(1,arguments);var t=Ha(e),n=Xa(t).getTime()-function(e){Va(1,arguments);var t=Ya(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),Xa(n)}(t).getTime();return Math.round(n/6048e5)+1}var Ja={};function Qa(){return Ja}function Za(e,t){var n,r,o,a,i,s,u,l;Va(1,arguments);var c=Qa(),d=Ga(null!==(n=null!==(r=null!==(o=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(i=t.locale)||void 0===i||null===(s=i.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==o?o:c.weekStartsOn)&&void 0!==r?r:null===(u=c.locale)||void 0===u||null===(l=u.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==n?n:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var h=Ha(e),f=h.getUTCDay(),p=(f<d?7:0)+f-d;return h.setUTCDate(h.getUTCDate()-p),h.setUTCHours(0,0,0,0),h}function ei(e,t){var n,r,o,a,i,s,u,l;Va(1,arguments);var c=Ha(e),d=c.getUTCFullYear(),h=Qa(),f=Ga(null!==(n=null!==(r=null!==(o=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(i=t.locale)||void 0===i||null===(s=i.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==o?o:h.firstWeekContainsDate)&&void 0!==r?r:null===(u=h.locale)||void 0===u||null===(l=u.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var p=new Date(0);p.setUTCFullYear(d+1,0,f),p.setUTCHours(0,0,0,0);var m=Za(p,t),v=new Date(0);v.setUTCFullYear(d,0,f),v.setUTCHours(0,0,0,0);var g=Za(v,t);return c.getTime()>=m.getTime()?d+1:c.getTime()>=g.getTime()?d:d-1}function ti(e,t){Va(1,arguments);var n=Ha(e),r=Za(n,t).getTime()-function(e,t){var n,r,o,a,i,s,u,l;Va(1,arguments);var c=Qa(),d=Ga(null!==(n=null!==(r=null!==(o=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(i=t.locale)||void 0===i||null===(s=i.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==o?o:c.firstWeekContainsDate)&&void 0!==r?r:null===(u=c.locale)||void 0===u||null===(l=u.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==n?n:1),h=ei(e,t),f=new Date(0);return f.setUTCFullYear(h,0,d),f.setUTCHours(0,0,0,0),Za(f,t)}(n,t).getTime();return Math.round(r/6048e5)+1}function ni(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}const ri={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return ni("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):ni(n+1,2)},d:function(e,t){return ni(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return ni(e.getUTCHours()%12||12,t.length)},H:function(e,t){return ni(e.getUTCHours(),t.length)},m:function(e,t){return ni(e.getUTCMinutes(),t.length)},s:function(e,t){return ni(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return ni(Math.floor(r*Math.pow(10,n-3)),t.length)}};var oi="midnight",ai="noon",ii="morning",si="afternoon",ui="evening",li="night",ci={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),o=r>0?r:1-r;return n.ordinalNumber(o,{unit:"year"})}return ri.y(e,t)},Y:function(e,t,n,r){var o=ei(e,r),a=o>0?o:1-o;return"YY"===t?ni(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):ni(a,t.length)},R:function(e,t){return ni(Ya(e),t.length)},u:function(e,t){return ni(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return ni(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return ni(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return ri.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return ni(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var o=ti(e,r);return"wo"===t?n.ordinalNumber(o,{unit:"week"}):ni(o,t.length)},I:function(e,t,n){var r=$a(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):ni(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):ri.d(e,t)},D:function(e,t,n){var r=function(e){Va(1,arguments);var t=Ha(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):ni(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var o=e.getUTCDay(),a=(o-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return ni(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(o,{width:"short",context:"formatting"});default:return n.day(o,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var o=e.getUTCDay(),a=(o-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return ni(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(o,{width:"narrow",context:"standalone"});case"cccccc":return n.day(o,{width:"short",context:"standalone"});default:return n.day(o,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),o=0===r?7:r;switch(t){case"i":return String(o);case"ii":return ni(o,t.length);case"io":return n.ordinalNumber(o,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,o=e.getUTCHours();switch(r=12===o?ai:0===o?oi:o/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,o=e.getUTCHours();switch(r=o>=17?ui:o>=12?si:o>=4?ii:li,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return ri.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ri.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):ni(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):ni(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ri.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ri.s(e,t)},S:function(e,t){return ri.S(e,t)},X:function(e,t,n,r){var o=(r._originalDate||e).getTimezoneOffset();if(0===o)return"Z";switch(t){case"X":return hi(o);case"XXXX":case"XX":return fi(o);default:return fi(o,":")}},x:function(e,t,n,r){var o=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return hi(o);case"xxxx":case"xx":return fi(o);default:return fi(o,":")}},O:function(e,t,n,r){var o=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+di(o,":");default:return"GMT"+fi(o,":")}},z:function(e,t,n,r){var o=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+di(o,":");default:return"GMT"+fi(o,":")}},t:function(e,t,n,r){var o=r._originalDate||e;return ni(Math.floor(o.getTime()/1e3),t.length)},T:function(e,t,n,r){return ni((r._originalDate||e).getTime(),t.length)}};function di(e,t){var n=e>0?"-":"+",r=Math.abs(e),o=Math.floor(r/60),a=r%60;if(0===a)return n+String(o);var i=t||"";return n+String(o)+i+ni(a,2)}function hi(e,t){return e%60===0?(e>0?"-":"+")+ni(Math.abs(e)/60,2):fi(e,t)}function fi(e,t){var n=t||"",r=e>0?"-":"+",o=Math.abs(e);return r+ni(Math.floor(o/60),2)+n+ni(o%60,2)}const pi=ci;var mi=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},vi=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},gi={p:vi,P:function(e,t){var n,r=e.match(/(P+)(p+)?/)||[],o=r[1],a=r[2];if(!a)return mi(e,t);switch(o){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",mi(o,t)).replace("{{time}}",vi(a,t))}};const yi=gi;var bi=["D","DD"],xi=["YY","YYYY"];function wi(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var ki={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const _i=function(e,t,n){var r,o=ki[e];return r="string"===typeof o?o:1===t?o.one:o.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function Ei(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var Ci={date:Ei({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Ei({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Ei({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var Si={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Ni(e){return function(t,n){var r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):o;r=e.formattingValues[a]||e.formattingValues[o]}else{var i=e.defaultWidth,s=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[s]||e.values[i]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function Ti(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,o=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(o);if(!a)return null;var i,s=a[0],u=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(u)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(u,function(e){return e.test(s)}):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(u,function(e){return e.test(s)});return i=e.valueCallback?e.valueCallback(l):l,{value:i=n.valueCallback?n.valueCallback(i):i,rest:t.slice(s.length)}}}var Ii;const Ri={code:"en-US",formatDistance:_i,formatLong:Ci,formatRelative:function(e,t,n,r){return Si[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:Ni({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Ni({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:Ni({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Ni({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Ni({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Ii={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(Ii.matchPattern);if(!n)return null;var r=n[0],o=e.match(Ii.parsePattern);if(!o)return null;var a=Ii.valueCallback?Ii.valueCallback(o[0]):o[0];return{value:a=t.valueCallback?t.valueCallback(a):a,rest:e.slice(r.length)}}),era:Ti({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:Ti({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:Ti({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:Ti({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:Ti({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};var Ai=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Di=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Pi=/^'([^]*?)'?$/,ji=/''/g,Oi=/[a-zA-Z]/;function Mi(e,t,n){var r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x;Va(2,arguments);var w=String(t),k=Qa(),_=null!==(r=null!==(o=null===n||void 0===n?void 0:n.locale)&&void 0!==o?o:k.locale)&&void 0!==r?r:Ri,E=Ga(null!==(a=null!==(i=null!==(s=null!==(u=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==u?u:null===n||void 0===n||null===(l=n.locale)||void 0===l||null===(c=l.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==s?s:k.firstWeekContainsDate)&&void 0!==i?i:null===(d=k.locale)||void 0===d||null===(h=d.options)||void 0===h?void 0:h.firstWeekContainsDate)&&void 0!==a?a:1);if(!(E>=1&&E<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var C=Ga(null!==(f=null!==(p=null!==(m=null!==(v=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==v?v:null===n||void 0===n||null===(g=n.locale)||void 0===g||null===(y=g.options)||void 0===y?void 0:y.weekStartsOn)&&void 0!==m?m:k.weekStartsOn)&&void 0!==p?p:null===(b=k.locale)||void 0===b||null===(x=b.options)||void 0===x?void 0:x.weekStartsOn)&&void 0!==f?f:0);if(!(C>=0&&C<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!_.localize)throw new RangeError("locale must contain localize property");if(!_.formatLong)throw new RangeError("locale must contain formatLong property");var S=Ha(e);if(!qa(S))throw new RangeError("Invalid time value");var N=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(S),T=Ka(S,N),I={firstWeekContainsDate:E,weekStartsOn:C,locale:_,_originalDate:S};return w.match(Di).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,yi[t])(e,_.formatLong):e}).join("").match(Ai).map(function(r){if("''"===r)return"'";var o=r[0];if("'"===o)return function(e){var t=e.match(Pi);if(!t)return e;return t[1].replace(ji,"'")}(r);var a,i=pi[o];if(i)return null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||(a=r,-1===xi.indexOf(a))||wi(r,t,String(e)),null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!function(e){return-1!==bi.indexOf(e)}(r)||wi(r,t,String(e)),i(T,r,_.localize,I);if(o.match(Oi))throw new RangeError("Format string contains an unescaped latin alphabet character `"+o+"`");return r}).join("")}const Fi=()=>{var e;const{user:n,profile:r}=ia(),o=Q(),[a,i]=(0,t.useState)([]),[s,u]=(0,t.useState)([]),[l,c]=(0,t.useState)(!1),[d,h]=(0,t.useState)({todayHours:0,weekHours:0,monthHours:0,attendanceRate:0}),[f,p]=(0,t.useState)(!0),[m,v]=(0,t.useState)(new Date),[g,y]=(0,t.useState)("00:00:00"),[b,x]=(0,t.useState)(null),[w,k]=(0,t.useState)(null),_=e=>{const t=new Date(e),n=(new Date).getTime()-t.getTime(),r=Math.floor(n/36e5),o=Math.floor(n%36e5/6e4),a=Math.floor(n%6e4/1e3);return r>0?"".concat(r,"h ").concat(o,"m ").concat(a,"s"):o>0?"".concat(o,"m ").concat(a,"s"):"".concat(a,"s")},E=e=>{const t=new Date(e),n=(new Date).getTime()-t.getTime(),r=Math.floor(n/36e5),o=Math.floor(n%36e5/6e4),a=Math.floor(n%6e4/1e3);return"".concat(r.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"))},C=(0,t.useCallback)(()=>a.find(e=>!e.check_out_time),[a]),S=(0,t.useCallback)(()=>{if(!navigator.geolocation)return void k("Geolocation is not supported by this browser.");navigator.geolocation.getCurrentPosition(e=>{x(e),k(null)},e=>{let t="Unable to get your location.";switch(e.code){case e.PERMISSION_DENIED:t="Location access denied. Please enable location permissions.";break;case e.POSITION_UNAVAILABLE:t="Location information unavailable.";break;case e.TIMEOUT:t="Location request timed out.";break;default:t="An unknown error occurred while getting location."}k(t)},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})},[]);(0,t.useEffect)(()=>{const e=setInterval(()=>{v(new Date)},1e3);return()=>clearInterval(e)},[]),(0,t.useEffect)(()=>{const e=C();if(e&&e.check_in_time){const t=setInterval(()=>{y(E(e.check_in_time))},1e3);return y(E(e.check_in_time)),()=>clearInterval(t)}y("00:00:00")},[C]);const N=(0,t.useCallback)(async()=>{if(n)try{const e=(new Date).toISOString().split("T")[0],{data:t,error:r}=await ra.from("attendance_records").select("\n          *,\n          session_types (\n            id,\n            name,\n            start_time,\n            end_time,\n            description,\n            is_active\n          )\n        ").eq("user_id",n.id).gte("created_at","".concat(e,"T00:00:00.000Z")).lte("created_at","".concat(e,"T23:59:59.999Z")).order("created_at",{ascending:!1});if(r)return void console.error("Error fetching attendance:",r);i(t||[])}catch(e){console.error("Error fetching today attendance:",e)}},[n]),T=(0,t.useCallback)(async()=>{const{data:e,error:t}=await ra.from("session_types").select("*").eq("is_active",!0).order("start_time");t?console.error("Error fetching session types:",t):u(e||[])},[]),I=(0,t.useCallback)(async()=>{if(!n)return;const e=(new Date).toISOString().split("T")[0],{data:t}=await ra.from("attendance_records").select("total_hours").eq("user_id",n.id).gte("check_in_time","".concat(e,"T00:00:00")).lt("check_in_time","".concat(e,"T23:59:59")),r=(null===t||void 0===t?void 0:t.reduce((e,t)=>e+(t.total_hours||0),0))||0,o=new Date;o.setDate(o.getDate()-o.getDay());const{data:a}=await ra.from("attendance_records").select("total_hours").eq("user_id",n.id).gte("check_in_time",o.toISOString()),i=(null===a||void 0===a?void 0:a.reduce((e,t)=>e+(t.total_hours||0),0))||0,s=new Date;s.setDate(1);const{data:u}=await ra.from("attendance_records").select("total_hours").eq("user_id",n.id).gte("check_in_time",s.toISOString()),l=(null===u||void 0===u?void 0:u.reduce((e,t)=>e+(t.total_hours||0),0))||0;h({todayHours:r,weekHours:i,monthHours:l,attendanceRate:95})},[n]),R=(0,t.useCallback)(async()=>{try{p(!0),await Promise.all([N(),T(),I()])}catch(e){console.error("Error fetching dashboard data:",e)}finally{p(!1)}},[N,T,I]);(0,t.useEffect)(()=>{n&&(R(),S())},[n,R,S]);return f?(0,oa.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,oa.jsx)(Sa,{size:"lg"})}):(0,oa.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 p-4 sm:p-6 lg:p-8",children:[(0,oa.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[(0,oa.jsxs)("div",{className:"relative overflow-hidden bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 p-6 sm:p-8 mb-6 sm:mb-8",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-50/50 via-white/30 to-indigo-50/50"}),(0,oa.jsxs)("div",{className:"relative text-center space-y-2 sm:space-y-4",children:[(0,oa.jsxs)("h1",{className:"text-2xl sm:text-4xl font-bold bg-gradient-to-r from-gray-900 via-blue-800 to-indigo-700 bg-clip-text text-transparent",children:["Welcome back, ",(null===r||void 0===r||null===(e=r.full_name)||void 0===e?void 0:e.split(" ")[0])||"User","! \u2728"]}),(0,oa.jsxs)("p",{className:"text-sm sm:text-lg text-gray-600 font-semibold flex items-center justify-center space-x-2",children:[(0,oa.jsx)("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),(0,oa.jsxs)("span",{children:[Mi(m,"EEEE, MMMM do, yyyy")," \u2022 ",Mi(m,"h:mm a")]}),(0,oa.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"})]}),(e=>{const t=C();return t?(0,oa.jsx)("div",{className:"mt-4 p-4 bg-gradient-to-r from-emerald-50/80 to-green-50/80 border border-emerald-200/50 rounded-2xl backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-3 h-3 bg-emerald-500 rounded-full animate-pulse"}),(0,oa.jsx)("span",{className:"text-emerald-800 font-bold text-sm",children:"Currently Active:"}),(0,oa.jsx)("span",{className:"text-emerald-900 font-bold text-lg",children:(null===(e=t.session_types)||void 0===e?void 0:e.name)||"Unknown Session"})]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)(fa,{className:"w-4 h-4 text-emerald-600"}),(0,oa.jsx)("span",{className:"text-emerald-800 font-bold text-sm",children:"Elapsed:"}),(0,oa.jsx)("span",{className:"text-emerald-900 font-mono font-bold text-xl bg-white/50 px-3 py-1 rounded-xl",children:g})]})]})}):null})()]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-blue-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/70 to-cyan-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(fa,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-blue-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Da,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Today"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-blue-800 bg-clip-text text-transparent",children:[Math.floor(d.todayHours),"h ",Math.round(d.todayHours%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Hours worked"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-indigo-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50/70 to-purple-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(Pa,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-indigo-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(ja,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"This Week"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-indigo-800 bg-clip-text text-transparent",children:[Math.floor(d.weekHours),"h ",Math.round(d.weekHours%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Weekly progress"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-emerald-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50/70 to-teal-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(ja,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-emerald-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Oa,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"This Month"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-emerald-800 bg-clip-text text-transparent",children:[Math.floor(d.monthHours),"h ",Math.round(d.monthHours%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Monthly total"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-amber-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50/70 to-orange-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-amber-500 to-orange-500 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(Ma,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-amber-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Fa,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Attendance Rate"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-amber-800 bg-clip-text text-transparent",children:[d.attendanceRate,"%"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Performance metric"})]})]})]})]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsx)("div",{className:"bg-gradient-to-r from-slate-800 via-gray-800 to-slate-900 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl sm:rounded-3xl flex items-center justify-center backdrop-blur-sm shadow-lg",children:(0,oa.jsx)(Pa,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Today's Sessions"}),(0,oa.jsx)("span",{className:"text-emerald-400",children:"\u2728"})]}),(0,oa.jsx)("p",{className:"text-slate-300 text-xs sm:text-sm font-medium",children:"Track your daily progress"})]})]})}),(0,oa.jsx)("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:s.map(e=>{const t=(e=>{const t=a.find(t=>t.session_type_id===e.id);return t?t.check_out_time?"completed":"active":"not-started"})(e),n=a.filter(t=>t.session_type_id===e.id),r=n.reduce((e,t)=>e+(t.total_hours||0),0),o=n[n.length-1];return(0,oa.jsx)("div",{className:"group relative overflow-hidden bg-gradient-to-r from-gray-50/80 to-gray-100/80 hover:from-blue-50/80 hover:to-indigo-50/80 rounded-2xl sm:rounded-3xl p-4 sm:p-5 transition-all duration-500 hover:shadow-xl border border-gray-200/50 hover:border-blue-300/50 backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[(0,oa.jsxs)("div",{className:"relative w-12 h-12 sm:w-14 sm:h-14 rounded-2xl sm:rounded-3xl flex items-center justify-center shadow-xl transition-all duration-500 group-hover:scale-110 ".concat("completed"===t?"bg-gradient-to-br from-emerald-500 to-emerald-600":"active"===t?"bg-gradient-to-br from-blue-500 to-indigo-600":"bg-gradient-to-br from-gray-400 to-gray-500"),children:["completed"===t?(0,oa.jsx)(La,{className:"w-6 h-6 text-white"}):"active"===t?(0,oa.jsx)(fa,{className:"w-6 h-6 text-white"}):(0,oa.jsx)(Ba,{className:"w-6 h-6 text-white"}),"active"===t&&(0,oa.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse"})]}),(0,oa.jsxs)("div",{className:"space-y-1",children:[(0,oa.jsx)("p",{className:"font-bold text-gray-900 text-base sm:text-lg group-hover:text-blue-900 transition-colors",children:e.name}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)(fa,{className:"w-3 h-3 sm:w-4 sm:h-4 text-gray-400"}),(0,oa.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:[e.start_time," - ",e.end_time]})]})]})]}),(0,oa.jsx)("div",{className:"text-right space-y-1",children:n.length>0?(0,oa.jsxs)("div",{children:[(0,oa.jsx)("p",{className:"text-lg font-bold text-gray-900",children:r>0?"".concat(Math.floor(r),"h ").concat(Math.round(r%1*60),"m"):"In Progress"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-medium",children:"Started: ".concat(null!==o&&void 0!==o&&o.check_in_time?Mi(new Date(o.check_in_time),"h:mm a"):"")})]}):(0,oa.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ".concat("completed"===t?"bg-emerald-100 text-emerald-800":"active"===t?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"),children:[(0,oa.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat("completed"===t?"bg-emerald-500":"active"===t?"bg-blue-500 animate-pulse":"bg-gray-400")}),"completed"===t?"Completed":"active"===t?"Active":"Not Started"]})})]})},e.id)})})]}),(0,oa.jsxs)("div",{className:"bg-white rounded-2xl sm:rounded-3xl shadow-xl border border-gray-200 overflow-hidden",children:[(0,oa.jsx)("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-white/20 rounded-xl sm:rounded-2xl flex items-center justify-center backdrop-blur-sm",children:(0,oa.jsx)(Oa,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Quick Actions"}),(0,oa.jsx)("p",{className:"text-slate-300 text-xs sm:text-sm",children:"Manage your attendance"})]})]})}),(0,oa.jsx)("div",{className:"p-4 sm:p-6 space-y-3 sm:space-y-4",children:(0,oa.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[(0,oa.jsxs)("button",{onClick:()=>{o("/attendance")},className:"group relative overflow-hidden bg-gradient-to-br from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-xl sm:rounded-2xl p-3 sm:p-4 transition-all duration-300 hover:shadow-xl hover:scale-105 transform",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-white/20 rounded-xl sm:rounded-2xl flex items-center justify-center",children:(0,oa.jsx)(fa,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),(0,oa.jsxs)("div",{className:"text-left",children:[(0,oa.jsx)("p",{className:"font-bold text-base sm:text-lg",children:"Clock In"}),(0,oa.jsx)("p",{className:"text-emerald-100 text-xs sm:text-sm",children:"Start your session"})]})]}),(0,oa.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),(0,oa.jsxs)("button",{onClick:()=>{S(),b?nn.success("Location: ".concat(b.coords.latitude.toFixed(6),", ").concat(b.coords.longitude.toFixed(6))):w?nn.error(w):nn.loading("Getting your location...")},className:"group relative overflow-hidden bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-2xl p-4 transition-all duration-300 hover:shadow-xl hover:scale-105 transform",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 bg-white/20 rounded-2xl flex items-center justify-center",children:(0,oa.jsx)(Ua,{className:"w-5 h-5"})}),(0,oa.jsxs)("div",{className:"text-left",children:[(0,oa.jsx)("p",{className:"font-bold text-lg",children:"Check Location"}),(0,oa.jsx)("p",{className:"text-blue-100 text-sm",children:"Verify your position"})]})]}),(0,oa.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[(0,oa.jsxs)("button",{onClick:()=>{nn("Schedule feature coming soon!",{icon:"\u2139\ufe0f"})},className:"group relative overflow-hidden bg-gradient-to-br from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white rounded-xl sm:rounded-2xl p-2 sm:p-3 transition-all duration-300 hover:shadow-lg hover:scale-105 transform",children:[(0,oa.jsxs)("div",{className:"flex flex-col items-center space-y-1 sm:space-y-2",children:[(0,oa.jsx)(Pa,{className:"w-5 h-5 sm:w-6 sm:h-6"}),(0,oa.jsxs)("div",{className:"text-center",children:[(0,oa.jsx)("p",{className:"font-semibold text-xs sm:text-sm",children:"Schedule"}),(0,oa.jsx)("p",{className:"text-gray-100 text-xs hidden sm:block",children:"View calendar"})]})]}),(0,oa.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),(0,oa.jsxs)("button",{onClick:()=>{nn("Team status feature coming soon!",{icon:"\u2139\ufe0f"})},className:"group relative overflow-hidden bg-gradient-to-br from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white rounded-2xl p-3 transition-all duration-300 hover:shadow-lg hover:scale-105 transform",children:[(0,oa.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,oa.jsx)(Fa,{className:"w-6 h-6"}),(0,oa.jsxs)("div",{className:"text-center",children:[(0,oa.jsx)("p",{className:"font-semibold text-sm",children:"Team"}),(0,oa.jsx)("p",{className:"text-gray-100 text-xs",children:"Check status"})]})]}),(0,oa.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]})]})})]})]})]}),(0,oa.jsx)("div",{className:"mt-8 sm:mt-12"}),(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsx)("div",{className:"bg-gradient-to-r from-slate-800 via-gray-800 to-slate-900 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl sm:rounded-3xl flex items-center justify-center backdrop-blur-sm shadow-lg",children:(0,oa.jsx)(Da,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Recent Activity"}),(0,oa.jsx)("span",{className:"text-blue-400",children:"\u26a1"})]}),(0,oa.jsx)("p",{className:"text-slate-300 text-xs sm:text-sm font-medium",children:"Your latest check-ins"})]})]}),(0,oa.jsxs)("button",{onClick:()=>c(!l),className:"flex items-center space-x-2 px-4 py-2.5 bg-white/20 hover:bg-white/30 rounded-2xl transition-all duration-300 text-white text-sm font-semibold backdrop-blur-sm shadow-lg hover:scale-105",children:[(0,oa.jsx)("span",{children:l?"Show Less":"Show All"}),l?(0,oa.jsx)(za,{className:"w-4 h-4"}):(0,oa.jsx)(Wa,{className:"w-4 h-4"})]})]})}),(0,oa.jsx)("div",{className:"p-4 sm:p-6",children:a.length>0?(0,oa.jsx)("div",{className:"space-y-4",children:(l?a:a.slice(0,3)).map((e,t)=>{var n;return(0,oa.jsx)("div",{className:"group relative overflow-hidden bg-gradient-to-r from-gray-50 to-gray-100 hover:from-blue-50 hover:to-indigo-50 rounded-xl sm:rounded-2xl p-3 sm:p-4 transition-all duration-300 hover:shadow-lg border border-gray-200 hover:border-blue-200",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl flex items-center justify-center shadow-lg transition-all duration-300 ".concat(e.check_out_time?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-blue-500 to-indigo-600"),children:e.check_out_time?(0,oa.jsx)(La,{className:"w-6 h-6 text-white"}):(0,oa.jsx)(fa,{className:"w-6 h-6 text-white"})}),!e.check_out_time&&(0,oa.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse"})]}),(0,oa.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,oa.jsx)("p",{className:"text-base sm:text-lg font-bold text-gray-900 group-hover:text-blue-900 transition-colors",children:(null===(n=e.session_types)||void 0===n?void 0:n.name)||"Unknown Session"}),(0,oa.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ".concat(e.check_out_time?"bg-emerald-100 text-emerald-800":"bg-blue-100 text-blue-800"),children:[(0,oa.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(e.check_out_time?"bg-emerald-500":"bg-blue-500 animate-pulse")}),e.check_out_time?"Completed":"In Progress"]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-4 text-xs sm:text-sm",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,oa.jsx)("span",{className:"text-gray-600 font-medium",children:"Check In:"}),(0,oa.jsx)("span",{className:"text-gray-900 font-semibold",children:e.check_in_time?Mi(new Date(e.check_in_time),"h:mm a"):"N/A"})]}),e.check_out_time?(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,oa.jsx)("span",{className:"text-gray-600 font-medium",children:"Check Out:"}),(0,oa.jsx)("span",{className:"text-gray-900 font-semibold",children:Mi(new Date(e.check_out_time),"h:mm a")})]}):(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),(0,oa.jsx)("span",{className:"text-gray-600 font-medium",children:"Elapsed:"}),(0,oa.jsx)("span",{className:"font-bold text-orange-600",children:e.check_in_time?_(e.check_in_time):"0s"})]}),e.total_hours&&(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),(0,oa.jsx)("span",{className:"text-gray-600 font-medium",children:"Duration:"}),(0,oa.jsxs)("span",{className:"text-gray-900 font-semibold",children:[Math.floor(e.total_hours),"h ",Math.round(e.total_hours%1*60),"m"]})]})]})]})]})},e.id)})}):(0,oa.jsxs)("div",{className:"text-center py-12",children:[(0,oa.jsx)("div",{className:"flex items-center justify-center h-32 sm:h-64",children:(0,oa.jsx)(fa,{className:"w-8 h-8 sm:w-10 sm:h-10 text-gray-400"})}),(0,oa.jsx)("p",{className:"text-gray-500 text-base sm:text-lg font-medium",children:"No attendance records for today"}),(0,oa.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mt-1",children:"Start your first session to see activity here"})]})})]})]})},Li=da("Clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),Bi=da("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ui=da("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),zi=da("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Wi=da("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var Vi=n(766),Hi=n.n(Vi),qi=n(224),Gi=n(325).hp,Ki=function(e,t){return(Ki=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Xi(e,t){function n(){this.constructor=e}Ki(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Yi(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})}function $i(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var Ji=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function Qi(){return Zi}var Zi=null,es=new Map,ts=new Map;function ns(e,t){var n=is(e,t);return es.get(n)}function rs(e){for(var t=es.entries(),n=[];;){var r=t.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===e&&n.push(s)}return n}function os(e){var t=e.kernelName,n=e.backendName,r=is(t,n);if(es.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");es.set(r,e)}function as(e){var t=e.kernelName;ts.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),ts.set(t,e)}function is(e,t){return t+"_"+e}function ss(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function us(e,t,n){return Math.max(e,Math.min(t,n))}function ls(e){return e%2==0?e:e+1}function cs(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ds(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function hs(e,t,n){void 0===n&&(n=""),ds(vs(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function fs(e){ds(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function ps(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Rs(e)&&!n)for(var r=0;r<e.length;++r)ps(e[r],t,n);else t.push(e);return t}function ms(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function vs(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function gs(e){return e%1==0}function ys(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function bs(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function xs(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ws(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var a=0,i=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()})}function ks(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function _s(e,t){var n=t.length;return ds((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),ds(e.every(function(e){return gs(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function Es(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:_s(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=a){if(a[i]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Cs(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Ss(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Ns(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Ts(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Is(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function Rs(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function As(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Ds(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function Ps(e){return"string"==typeof e||e instanceof String}function js(e){return"boolean"==typeof e}function Os(e){return"number"==typeof e}function Ms(e){return Array.isArray(e)?Ms(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Os(e)?"float32":Ps(e)?"string":js(e)?"bool":"float32"}function Fs(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ls(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Bs(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Us(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ps(e)),n&&Ns(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function zs(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[t+i];else{a=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(i=0;i<a;i++)o[i]=e(t+i*u,s,r)}return o}(0,e,t)}function Ws(e,t){for(var n=Vs(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Vs(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Hs(){return Qi().platform.now()}function qs(e){e.forEach(function(t){ds(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function Gs(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Qi().platform.encode(e,t)}function Ks(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",Qi().platform.decode(e,t)}function Xs(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function Ys(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:ss,clamp:us,nearestLargerEven:ls,sum:cs,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:ds,assertShapesMatch:hs,assertNonNull:fs,flatten:ps,sizeFromShape:ms,isScalarShape:function(e){return 0===e.length},arraysEqual:vs,isInt:gs,tanh:ys,sizeToSquarishShape:bs,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return ss(t),t},rightPad:xs,repeatedTry:ws,inferFromImplicitShape:ks,parseAxisParam:_s,squeezeShape:Es,getTypedArrayFromDType:Cs,getArrayFromDType:Ss,checkConversionForErrors:Ns,isValidDtype:Ts,hasEncodingLoss:Is,isTypedArray:Rs,bytesPerElement:As,bytesFromStringArray:Ds,isString:Ps,isBoolean:js,isNumber:Os,inferDtype:Ms,isFunction:Fs,nearestDivisor:Ls,computeStrides:Bs,toTypedArray:Us,toNestedArray:zs,makeOnesTypedArray:Ws,makeZerosTypedArray:Vs,now:Hs,assertNonNegativeIntegerDimensions:qs,fetch:function(e,t){return Qi().platform.fetch(e,t)},encodeString:Gs,decodeString:Ks,locToIndex:Xs,indexToLoc:Ys});var $s=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Js)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,a=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then(function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,a.kernelMs,t,i)})})}),r},e}(),Js=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,a){var i="number"==typeof r?xs(r+"ms",9):r.error,s=xs(e,25),u=t.rank,l=t.size,c=xs(t.shape.toString(),14),d="";for(var h in o){var f=o[h].shape||t.shape,p=f.length;d+=h+": "+p+"D "+(p>0?f:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+d+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function Qs(e,t,n){return xs(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Ps(e)?"'"+e+"'":"bool"===n?Zs(e):parseFloat(e.toFixed(7)).toString(),t)}function Zs(e){return 0===e?"false":"true"}function eu(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var tu=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=ms(e),null!=n){var o=n.length;ds(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ss(t,this.size),this.strides=Bs(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),ds(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return nu().makeTensor(this.values,this.shape,this.dtype)},e}(),nu=null,ru=null,ou=null,au=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ms(e),this.strides=Bs(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),ds(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),ru.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ru.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return ru.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,zs(this.shape,e)]}})})},e.prototype.arraySync=function(){return zs(this.shape,this.dataSync())},e.prototype.data=function(){return Yi(this,void 0,void 0,function(){var e,t;return $i(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=nu().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return Ks(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=nu().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return Ks(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,nu().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(nu().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ru.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ru.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ru.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ru.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ru.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ru.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ru.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=Bs(t),a=function(e,t,n,r){var o=ms(t),a=r[r.length-1],i=new Array(a).fill(0),s=t.length,u="complex64"===n?eu(e):e;if(s>1)for(var l=0;l<o/a;l++)for(var c=l*a,d=0;d<a;d++)i[d]=Math.max(i[d],Qs(u[c+d],0,n).length);return i}(e,t,n,o),i=t.length,s=function e(t,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],l=n.length;if(0===l)return"complex64"===r?[Qs(eu(t)[0],0,r)]:"bool"===r?[Zs(t[0])]:[t[0].toString()];if(1===l){if(u>20){var c=3*s,d=Array.from(t.slice(0,c)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(d=eu(d),h=eu(h)),["["+d.map(function(e,t){return Qs(e,a[t],r)}).join(", ")+", ..., "+h.map(function(e,t){return Qs(e,a[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?eu(t):Array.from(t)).map(function(e,t){return Qs(e,a[t],r)}).join(", ")+"]"]}var f=n.slice(1),p=o.slice(1),m=o[0]*s,v=[];if(u>20){for(var g=0;g<3;g++){var y=(b=g*m)+m;v.push.apply(v,e(t.slice(b,y),f,r,p,a,!1))}for(v.push("..."),g=u-3;g<u;g++)y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),f,r,p,a,g===u-1))}else for(g=0;g<u;g++){var b;y=(b=g*m)+m,v.push.apply(v,e(t.slice(b,y),f,r,p,a,g===u-1))}var x=2===l?",":"";for(v[0]="["+v[0]+x,g=1;g<v.length-1;g++)v[g]=" "+v[g]+x;var w=",\n";for(g=2;g<l;g++)w+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(i?"":w),v}(e,t,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ru.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ru.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ru.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ru.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ru.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ru.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ru.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ru.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ru.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ru.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ru.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ru.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),ou("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ru.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ru.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ru.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ru.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ru.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ru.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ru.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ru.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ru.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ru.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ru.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ru.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ru.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ru.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ru.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),ru.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ru.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ru.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ru.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ru.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ru.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ru.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ru.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ru.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ru.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ru.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ru.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ru.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ru.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ru.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ru.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ru.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ru.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ru.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ru.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ru.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ru.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ru.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ru.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ru.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ru.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ru.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ru.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ru.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ru.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ru.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ru.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ru.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ru.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ru.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ru.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ru.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ru.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ru.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ru.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ru.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ru.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ru.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ru.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ru.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ru.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ru.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ru.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ru.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ru.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ru.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ru.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ru.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ru.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ru.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ru.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ru.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ru.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ru.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ru.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ru.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ru.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ru.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ru.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ru.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ru.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ru.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ru.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ru.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ru.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ru.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ru.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ru.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ru.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ru.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ru.conv1d(this,e,t,n,r,o,a)},e.prototype.conv2d=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ru.conv2d(this,e,t,n,r,o,a)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),ru.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ru.depthwiseConv2d(this,e,t,n,r,o,a)},e.prototype.separableConv2d=function(e,t,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),ru.separableConv2d(this,e,t,n,r,o,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ru.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ru.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ru.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),ru.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),nu().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ru.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ru.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ru.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ru.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),ru.stridedSlice(this,e,t,n,r,o,a,i,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ru.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ru.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ru.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ru.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ru.spectral.irfft(this)},e}();Object.defineProperty(au,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var iu,su,uu,lu,cu,du=function(e){function t(t,n,r,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=r,a}return Xi(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!vs(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");nu().disposeTensor(this),this.dataId=e.dataId,nu().incRef(this,null)},t.prototype.dispose=function(){nu().disposeVariable(this),this.isDisposedInternal=!0},t}(au);Object.defineProperty(du,Symbol.hasInstance,{value:function(e){return e instanceof au&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(iu||(iu={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(su||(su={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(uu||(uu={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(lu||(lu={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(cu||(cu={}));var hu={float32:lu,int32:su,bool:uu,complex64:cu};function fu(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return hu[e][t]}function pu(e){return fu(e,"int32")}function mu(e,t){if(e.dtype===t.dtype)return[e,t];var n=fu(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function vu(e,t){ds(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function gu(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof au)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,a=t;for(var i in a){var s=a[i];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:mu,assertTypesMatch:vu,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:gu});var yu,bu=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),xu=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bu}return e.prototype.ready=function(){return Yi(this,void 0,void 0,function(){var e,t,n;return $i(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return Yi(this,void 0,void 0,function(){var t,n,r;return $i(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new $s(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;rs(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;rs(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[]),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(e){o+="complex64"===e.dtype?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,a,i){var s,u=this;void 0===a&&(a=[]),void 0===i&&(i=[]);var l=[],c=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,h=function(e){c&&(l=e.map(function(e){return u.keep(u.clone(e))}))},f=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=ns(r,this.backendName);return d=null!=v?function(){var e=u.backend.numDataIds();m=v.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}),l=s.filter(function(e,t){return i[t]});return h((a||[]).slice().concat(l)),s}:function(){var t=u.backend.numDataIds();m=u.tidy(function(){return e(u.backend,h)});var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return d()}):d()}),c&&this.addTapeNode(r,t,s,n,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&Ps(e[0])&&(o=e.map(function(e){return Gs(e)}));var a=r.write(o,t,n),i=new au(t,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=Ds(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new au(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new du(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*As(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof du||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return Yi(this,void 0,void 0,function(){var t,n;return $i(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o){var a=this,i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},s=function(e){return ts.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(i.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],o=Vs(r.size,r.dtype);return a.makeTensor(o,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],o)}),this.state.activeTape.push(i)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=gu(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==i.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),ds(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});ds(a instanceof au,function(){return"The result y returned by f() must be a tensor."});var i=function(e,t,n){for(var r={},o={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var i=(p=e[a]).inputs;for(var s in i){for(var u=i[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),l=!0,o[p.id]=!0;break}if(l)break}}var d={};d[n.id]=!0;var h={};for(a=e.length-1;a>=0;a--)for(i=(p=e[a]).inputs,c=0;c<p.outputs.length;c++)if(d[p.outputs[c].id]){for(var s in i)d[i[s].id]=!0,h[p.id]=!0;break}var f=[];for(a=0;a<e.length;a++){var p;if(o[(p=e[a]).id]&&h[p.id]){var m={};for(var s in p.inputs){var v=p.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},p);g.inputs=m,g.outputs=p.outputs,f.push(g)}}return f}(this.state.activeTape,t,a);if(!r&&0===i.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[a.id]=null==n?(r=Ws(ms(e=a.shape),"float32"),wu.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],a=[];if(o.outputs.forEach(function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(t){if(!(t in i))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(i)+".");var r=n(function(){return i[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[t];if(!vs(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,i,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),o.state.activeTape=null),{value:a,grads:u}})},e.prototype.customGrad=function(e){var t=this;return ds(Fs(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];ds(r.every(function(e){return e instanceof au}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return r.forEach(function(e,t){a[t]=e}),t.runKernelFunc(function(t,o){return ds((n=e.apply(void 0,r.concat([o]))).value instanceof au,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ds(Fs(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(e,t){var o=n.gradFunc(e,t),a=Array.isArray(o)?o:[o];ds(a.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ds(a.every(function(e){return e instanceof au}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var i={};return a.forEach(function(e,t){i[t]=function(){return e}}),i})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return Yi(this,void 0,void 0,function(){var t,n;return $i(this,function(r){switch(r.label){case 0:return t=Hs(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Hs()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bu,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),wu=function(){var e=function(){if(null==yu){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof qi)e=qi;else{if("undefined"==typeof self)throw new Error("Could not find a global object");qi=self}yu=e}return yu}();if(null==e._tfengine){var t=new Ji(e);e._tfengine=new xu(t)}return function(e){Zi=e}(e._tfengine.ENV),nu=function(){return e._tfengine},e._tfengine}();function ku(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var _u=Qi();_u.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),_u.registerFlag("IS_BROWSER",function(){return ku()}),_u.registerFlag("IS_NODE",function(){return"undefined"!=typeof qi&&void 0!==qi.versions&&void 0!==qi.versions.node}),_u.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),_u.registerFlag("PROD",function(){return!1}),_u.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return _u.getBool("DEBUG")}),_u.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),_u.registerFlag("IS_TEST",function(){return!1});var Eu,Cu,Su,Nu={},Tu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Iu(e,t){Nu[e]=t}function Ru(e){e in Nu||(Nu[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Nu[e]},!1),1===e?t.getContext("webgl",Tu)||t.getContext("experimental-webgl",Tu):t.getContext("webgl2",Tu)}(e));var t=Nu[e];return t.isContextLost()?(delete Nu[e],Ru(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Nu[e])}function Au(e,t){return[t,e]}function Du(e){var t=ms(e);return bs(Math.ceil(t/4))}function Pu(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function ju(e,t){var n,r,o,a,i,s,u,l,c,d=e;return 2===Qi().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,o=d.RGBA16F,a=d.RGBA32F,i=d.RED,s=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,a=d.RGBA,i=e.RGBA,s=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function Ou(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Fu(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Eu||(Eu={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Cu||(Cu={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Su||(Su={}));function Mu(e){return!!(Qi().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Fu(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Lu(e,t,n){return sl(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Bu(e,t,n){var r=sl(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Ou(e,t,function(){return e.shaderSource(r,n)}),Ou(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Uu(e,t,n){var r=sl(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Ou(e,t,function(){return e.shaderSource(r,n)}),Ou(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Vu.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,i=o.map(function(e,t){return xs((t+1).toString(),a)+e}),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var l=i.slice(0,r-1),c=i.slice(r-1,r),d=i.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+xs(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var zu,Wu,Vu=/ERROR: [0-9]+:([0-9]+):/g;function Hu(e,t){return sl(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function qu(e,t,n){if(Ou(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Gu(e,t,n){if(Ou(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Ku(e,t,n){var r=sl(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Ou(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Ou(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Xu(e,t,n){var r=sl(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return Ou(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),Ou(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function Yu(e,t){return sl(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function $u(e,t){var n=Qi().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Ju(e,t){return sl(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Qu(e,t,n,r,o,a,i,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Ou(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),Ou(e,t,function(){return e.vertexAttribPointer(u,a,e.FLOAT,!1,i,s)}),Ou(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function Zu(e,t,n,r){ul(e,r),Ou(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function el(e,t,n,r){return sl(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function tl(e,t,n){return e.getUniformLocation(t,n)}function nl(e,t,n,r,o,a){Ou(e,t,function(){return Zu(e,t,r,a)}),Ou(e,t,function(){return e.uniform1i(o,a)})}function rl(e,t,n,r){Ou(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),Ou(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function ol(e,t,n){Ou(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),Ou(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function al(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+il(e,t))}function il(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function sl(e,t,n,r){var o=Ou(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function ul(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function ll(e,t){return void 0===t&&(t=2),ms(e.slice(0,e.length-t))}function cl(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function dl(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[ll(e)].concat(cl(e))),t}function hl(e,t){var n;void 0===t&&(t=!1);var r=Qi().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?ls(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=Es(e);e=o.newShape}var a=ms(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var i=ll(e),s=2,u=2;return e.length&&(s=(n=cl(e))[0],u=n[1]),bs(a=i*(s/2)*(u/2)).map(function(e){return 2*e})}return bs(a)}function fl(e){return e%2==0}function pl(e,t){if(vs(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(fl(n)&&fl(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&fl(e[0])&&fl(t[0])}function ml(e){if(null==zu){var t=Ru(e);zu=t.getParameter(t.MAX_TEXTURE_SIZE)}return zu}function vl(e){if(null==Wu){var t=Ru(e);Wu=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Wu)}function gl(e){if(0===e)return 0;var t=Ru(e);return yl(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:yl(t,"EXT_disjoint_timer_query")?1:0}function yl(e,t){return null!=e.getExtension(t)}function bl(e){try{if(null!=Ru(e))return!0}catch(e){return!1}return!1}function xl(e){if(0===e)return!1;var t=Ru(e);if(1===e){if(!yl(t,"OES_texture_float"))return!1}else if(!yl(t,"EXT_color_buffer_float"))return!1;return kl(t)}function wl(e){if(0===e)return!1;var t=Ru(e);if(1!==e){if(yl(t,"EXT_color_buffer_float"))return kl(t);if(yl(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=ju(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}(t,n)}return!1}return!!yl(t,"OES_texture_float")&&!!yl(t,"WEBGL_color_buffer_float")&&kl(t)}function kl(e){var t=ju(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function _l(e){return 2===e&&null!=Ru(e).fenceSync}var El=Object.freeze({callAndCheck:Ou,canBeRepresented:Mu,getWebGLErrorMessage:Fu,getExtensionOrThrow:Lu,createVertexShader:Bu,createFragmentShader:Uu,createProgram:Hu,linkProgram:qu,validateProgram:Gu,createStaticVertexBuffer:Ku,createStaticIndexBuffer:Xu,getNumChannels:function(){return 2===Qi().getNumber("WEBGL_VERSION")?1:4},createTexture:Yu,validateTextureSize:$u,createFramebuffer:Ju,bindVertexBufferToProgramAttribute:Qu,bindTextureUnit:Zu,unbindTextureUnit:function(e,t,n){ul(e,n),Ou(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:el,getProgramUniformLocation:tl,bindTextureToProgramUniformSampler:nl,bindCanvasToFramebuffer:function(e,t){Ou(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Ou(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),Ou(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:rl,unbindColorTextureFromFramebuffer:ol,validateFramebuffer:al,getFramebufferErrorMessage:il,getBatchDim:ll,getRowsCols:cl,getShapeAs3D:dl,getTextureShapeFromLogicalShape:hl,isReshapeFree:pl,getWebGLMaxTextureSize:ml,resetMaxTextureSize:function(){zu=null},resetMaxTexturesInShader:function(){Wu=null},getMaxTexturesInShader:vl,getWebGLDisjointQueryTimerVersion:gl,hasExtension:yl,isWebGLVersionEnabled:bl,isCapableOfRenderingToFloatTexture:xl,isDownloadFloatTextureEnabled:wl,isWebGLFenceEnabled:_l}),Cl=Qi();function Sl(e){Qi().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Nl(e,t){return wu.tidy(e,t)}function Tl(e){gu(e).forEach(function(e){return e.dispose()})}function Il(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Qi().getBool("IS_TEST")||console.warn.apply(console,e)}function Rl(e,t){var n=e;if(Rs(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Rs(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Qi().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Rs(t)){ds(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),ds(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),a=0;a<t.length;++a)e(t[a],o,r.concat(a))}else ds(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function Al(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Dl(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof au)return Al(r,e.dtype,t,n),e;var o=Ms(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Al(r,o,t,n),null==e||!Rs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var i=Rl(e,o);Rs(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?Us(e,o,Qi().getBool("DEBUG")):ps(e,[],!0);return wu.makeTensor(s,i,o)}function Pl(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return Dl(e,t+"["+r+"]",n)},r)}function jl(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Ol(e,t,n){for(var r=e.length+t.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[a++]):o.push(t[i++]);return o}function Ml(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function Fl(e,t){return Ol(e,t.map(function(e){return 1}),t)}function Ll(e,t,n){ds(jl(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function Bl(e,t){if(jl(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function Ul(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function zl(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Wl(e,t){var n=e[0].length;e.forEach(function(e,t){ds(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),ds(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var a=0;a<n;a++)ds(a===t||e[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Vl(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Hl(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wu.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),wu.endScope(o),o}catch(e){throw wu.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Cl.registerFlag("HAS_WEBGL",function(){return Cl.getNumber("WEBGL_VERSION")>0}),Cl.registerFlag("WEBGL_VERSION",function(){return bl(2)?2:bl(1)?1:0}),Cl.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Cl.get("WEBGL_VERSION")}),Cl.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Cl.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Cl.registerFlag("WEBGL_PACK",function(){return Cl.getBool("HAS_WEBGL")}),Cl.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_CLIP",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Cl.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_PACK_REDUCE",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_CONV_IM2COL",function(){return Cl.getBool("WEBGL_PACK")}),Cl.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ml(Cl.getNumber("WEBGL_VERSION"))}),Cl.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return vl(Cl.getNumber("WEBGL_VERSION"))}),Cl.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Cl.getNumber("WEBGL_VERSION");return 0===e?0:gl(e)}),Cl.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Cl.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Cl.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return xl(Cl.getNumber("WEBGL_VERSION"))}),Cl.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Cl.getBool("WEBGL_FORCE_F16_TEXTURES")&&Cl.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Cl.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return wl(Cl.getNumber("WEBGL_VERSION"))}),Cl.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return _l(Cl.getNumber("WEBGL_VERSION"))}),Cl.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Cl.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),ou=Sl;var ql=Hl({complex_:function(e,t){var n=Dl(e,"real","complex"),r=Dl(t,"imag","complex");return hs(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),wu.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),Gl=Hl({real_:function(e){var t=Dl(e,"input","real");return wu.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),Kl=Hl({imag_:function(e){var t=Dl(e,"input","imag");return wu.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Xl(e,t,n){return Yl(e,t,Rl(e,n),n)}function Yl(e,t,n,r){if(null==r&&(r=Ms(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Rs(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){qs(t);var o=ms(t),a=ms(n);ds(o===a,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+a});for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==ms(t.slice(i));ds(n[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Rs(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Us(e,r,Qi().getBool("DEBUG")):ps(e,[],!0),wu.makeTensor(e,t,r)}function $l(e,t){if((Rs(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Rs(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Yl(e,[],[],t)}function Jl(e,t){fs(e);var n=Rl(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Yl(e,null,n,t)}function Ql(e,t,n){if(fs(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Rl(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Yl(e,t,r,n)}function Zl(e,t,n){if(fs(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Rl(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Yl(e,t,r,n)}function ec(e,t,n){if(fs(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Rl(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Yl(e,t,r,n)}function tc(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=tc(e,"float32"),r=nc(e,"float32");return ql(n,r)}var o=Ws(ms(e),t);return wu.makeTensor(o,e,t)}function nc(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=nc(e,"float32"),r=nc(e,"float32");return ql(n,r)}var o=Vs(ms(e),t);return wu.makeTensor(o,e,t)}function rc(e,t,n){return wu.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function oc(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return nc([0],r);var o=Vs(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return Jl(o,r)}var ac=Hl({onesLike_:function(e){var t=Dl(e,"x","onesLike");if("complex64"===t.dtype){var n=ac(Gl(t)),r=ic(Kl(t));return ql(n,r)}return wu.runKernelFunc(function(e){return e.onesLike(t)},{$x:t},function(e,t){return{$x:function(){return ic(e)}}})}}),ic=Hl({zerosLike_:function(e){var t=Dl(e,"x","zerosLike");return wu.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,t){return{$x:function(){return ic(e)}}})}}),sc=Hl({concat_:function(e,t){void 0===t&&(t=0),ds(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=Pl(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=_s(t,n[0].shape)[0];var r=Vl(n.map(function(e){return e.shape}),t);if(0===ms(r))return Xl([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});Wl(o,t);var a=n,i={axis:t};return wu.runKernelFunc(function(e){return e.concat(n,t)},a,function(e){var n=o.map(function(e){return e[t]});return hc(e,n,t).map(function(e){return function(){return e}})},"Concat",i)}}),uc=Hl({concat1d_:function(e){return sc(e,0)}}),lc=Hl({concat2d_:function(e,t){return sc(e,t)}}),cc=Hl({concat3d_:function(e,t){return sc(e,t)}}),dc=Hl({concat4d_:function(e,t){return sc(e,t)}}),hc=Hl({split_:function(e,t,n){void 0===n&&(n=0);var r,o=Dl(e,"x","split");return n=_s(n,o.shape)[0],"number"==typeof t?(ds(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(ds(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),wu.runKernelFunc(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return sc(e,n)}}})}});function fc(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var pc=fc(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),a=t&&t.state,i=o.next;return i.int32=function(){return 4294967296*o.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),mc=fc(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),vc=fc(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),gc=fc(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.x&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),yc=fc(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,a=-32;a<u;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&(a.X&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),bc=fc(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),a=t&&t.state,i=function(){return(o.next()>>>0)/4294967296};return i.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=o.next,i.quick=i,a&&("object"==typeof a&&r(a,o),i.state=function(){return r(o,{})}),i}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),xc=fc(function(e){!function(t,r){var o,a=this,i=256,s="random",u=r.pow(i,6),l=r.pow(2,52),c=2*l,d=255;function h(e,n,d){var h=[],g=m(function e(t,n){var r,o=[],a=typeof t;if(n&&"object"==a)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(i):(e=new Uint8Array(i),(a.crypto||a.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,v(t)]}}():e,3),h),y=new f(h),b=function(){for(var e=y.g(6),t=u,n=0;e<l;)e=(e+n)*i,t*=i,n=y.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(v(y.S),t),(n.pass||d||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,g,"global"in n?n.global:this==r,n.state)}function f(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<i;)s[o]=o++;for(o=0;o<i;o++)s[o]=s[a=d&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=d&o+1],n=n*i+s[d&(s[o]=s[a=d&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(i)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",o=0;o<r.length;)t[d&o]=d&(n^=19*t[d&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=h,m(r.random(),t),e.exports){e.exports=h;try{o=n(82)}catch(e){}}}([],Math)});xc.alea=pc,xc.xor128=mc,xc.xorwow=vc,xc.xorshift7=gc,xc.xor4096=yc,xc.tychei=bc;var wc=xc.alea,kc=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=wc(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),_c=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=wc(o.toString()),this.randn=new kc(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Ec=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=wc(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Cc(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",qs(e),new tu(e,t,n)}var Sc=Hl({batchToSpaceND_:function(e,t,n){var r=Dl(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return ds(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),ds(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),ds(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),wu.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Nc=Hl({broadcastTo_:function(e,t){var n=Dl(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var a=Array.from(t),i=t.length-1;i>=0;i--)if(n.shape[i]===t[i])a[i]=1;else if(1!==n.shape[i])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=a.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});return 0===s.length?n.clone():wu.runKernelFunc(function(e){return e.tile(n,a)},{input:n},function(e){return{input:function(){return e.sum(s,!0)}}})}}),Tc=Hl({cast_:function(e,t){var n=Dl(e,"x","cast");if(!Ts(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return wu.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),Ic=Hl({clone_:function(e){var t=Dl(e,"x","clone",null);return wu.runKernelFunc(function(){return wu.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),Rc=Hl({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Dl(e,"x","cumsum"),a=Bl([t|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=zl(1,o.rank)[0],u=wu.runKernelFunc(function(e){return e.cumsum(i,s,n,r)},{permutedX:i},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=a&&(u=u.transpose(a)),u}}),Ac=Hl({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Dl(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return ds(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),ds(a*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),ds(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),wu.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),Dc=Hl({expandDims_:function(e,t){void 0===t&&(t=0);var n=Dl(e,"x","expandDims",null);ds(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(ds(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),qc(n,r)}}),Pc=Hl({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Cc([e,t],r),a=e<=t?e:t,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Yc(Dc(s,0),[n[0],1,1]);if(2===n.length)return Yc(Dc(Dc(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Yc(Dc(Dc(Dc(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),jc=Hl({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=Dl(e,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=wu.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===i?u.as1D():u}}),Oc=Hl({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=Dl(e,"indices","oneHot","int32"),a=o.shape.concat([t]);return o=o.flatten(),wu.runKernelFunc(function(e){return e.oneHot(o,t,n,r)},{$indices:o},function(e){return{$indices:function(){return nc(o.shape,"float32")}}}).reshape(a)}}),Mc=Hl({pad_:function(e,t,n){void 0===n&&(n=0);var r=Dl(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return wu.runKernelFunc(function(e){return e.pad(r,t,n)},{x:r},function(e){var n=t.map(function(e){return e[0]});return{x:function(){return e.slice(n,r.shape)}}},"PadV2",o)}}),Fc=Hl({pad1d_:function(e,t,n){return void 0===n&&(n=0),ds(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),Mc(e,[t],n)}}),Lc=Hl({pad2d_:function(e,t,n){return void 0===n&&(n=0),ds(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Mc(e,t,n)}}),Bc=Hl({pad3d_:function(e,t,n){return void 0===n&&(n=0),ds(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Mc(e,t,n)}}),Uc=Hl({pad4d_:function(e,t,n){return void 0===n&&(n=0),ds(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Mc(e,t,n)}}),zc=Hl({rand_:function(e,t,n){var r=ms(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=t();return wu.makeTensor(o,e,n)}}),Wc=Hl({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new kc(t,n,r,!1,o),i=Cc(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Vc=Hl({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new _c(t,n,r,o),i=Cc(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Hc=Hl({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=Cc(e,r),i=new Ec(t,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),qc=Hl({reshape_:function(e,t){var n=Dl(e,"x","reshape",null);t=ks(t,n.size),ds(n.size===ms(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return wu.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),Gc=Hl({spaceToBatchND_:function(e,t,n){var r=Dl(e,"x","spaceToBatchND");return ds(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),ds(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),ds(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),wu.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),Kc=Hl({squeeze_:function(e,t){var n=Dl(e,"x","squeeze");return qc(n,Es(n.shape,t).newShape)}}),Xc=Hl({stack_:function(e,t){void 0===t&&(t=0);var n=Pl(e,"tensors","stack");if(ds(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;ds(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){hs(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){ds(a===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=n.map(function(e){return e.expandDims(t)});return sc(i,t)}}),Yc=Hl({tile_:function(e,t){var n=Dl(e,"x","tile",null);ds(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return wu.runKernelFunc(function(e,r){var o=e.tile(n,t);return r([n]),o},{x:n},function(e,n){var r=n[0];return{x:function(){var n=ic(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var a=0;a<t[1];++a)n=n.add(e.slice([o*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(var i=0;i<t[2];++i)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(a=0;a<t[1];++a)for(i=0;i<t[2];++i)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",o,r)}}),$c=Hl({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new kc(t,n,r,!0,o),i=Cc(e,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Jc=Hl({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Dl(e,"x","unstack");ds(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return wu.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return Xc(e,t)}}},"Unpack",r)}});function Qc(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var a=t.length,i=0;i<a;++i)o=o.concat([e[i+1]/t[i],t[i]]);o=o.concat(e.slice(a+1))}return o}function Zc(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function ed(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function td(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function nd(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function rd(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=e.shape,s=n.slice();s.pop();var u=1;for(a=r;a<e.rank;++a)u*=i[a],s.push(i[a]);var l=Bs(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,l]}Object.freeze({prepareAndValidate:rd});function od(e){return e<=30?e:Ls(e,Math.floor(Math.sqrt(e)))}function ad(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != "+(o+e.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==t.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==e[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+e[i+o]+")")}function id(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}ad(n,t,e)}function sd(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ms(t.shape)/u,sliceSize:i,strides:Bs(n.slice(0,o)).concat([1]),outputSize:ms(n)}}Object.freeze({validateUpdateShape:ad,validateInput:id,calculateShapes:sd});function ud(e,t,n){ds(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),ds(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){ds(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}function ld(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function cd(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function dd(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),us(0,a,s-1)}function hd(e,t,n,r,o){var a=t[o],i=n[o]||1;(e&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?us(0,a,s):us(-1,a,s-1)}function fd(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function pd(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:ud,maskToAxes:ld,computeOutShape:cd,startForAxis:dd,stopForAxis:hd,isSliceContinous:fd,computeFlatOffset:pd});function md(e){return wu.customGrad(e)}var vd=Hl({softmax_:function(e,t){void 0===t&&(t=-1);var n=Dl(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return wu.runKernelFunc(function(e,r){var o=e.softmax(n,t);return r([o]),o},{logits:n},function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),gd=Hl({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Dl(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return md(function(e,n){var r=e.max(t,!0),o=e.sub(r),a=o.toFloat().sub(o.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),yd=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),bd=function(){function e(){}return e.prototype.time=function(e){return xd("time")},e.prototype.read=function(e){return xd("read")},e.prototype.readSync=function(e){return xd("readSync")},e.prototype.numDataIds=function(){return xd("numDataIds")},e.prototype.disposeData=function(e){return xd("disposeData")},e.prototype.write=function(e,t,n){return xd("write")},e.prototype.move=function(e,t,n,r){return xd("move")},e.prototype.memory=function(){return xd("memory")},e.prototype.floatPrecision=function(){return xd("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return xd("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,xd("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return xd("slice")},e.prototype.stridedSlice=function(e,t,n,r){return xd("stridedSlice")},e.prototype.unstack=function(e,t){return xd("unstack")},e.prototype.reverse=function(e,t){return xd("reverse")},e.prototype.concat=function(e,t){return xd("concat")},e.prototype.neg=function(e){return xd("neg")},e.prototype.add=function(e,t){return xd("add")},e.prototype.addN=function(e){return xd("addN")},e.prototype.subtract=function(e,t){return xd("subtract")},e.prototype.multiply=function(e,t){return xd("multiply")},e.prototype.realDivide=function(e,t){return xd("realDivide")},e.prototype.floorDiv=function(e,t){return xd("floorDiv")},e.prototype.sum=function(e,t){return xd("sum")},e.prototype.prod=function(e,t){return xd("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return xd("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return xd("argMin")},e.prototype.argMax=function(e,t){return xd("argMax")},e.prototype.equal=function(e,t){return xd("equal")},e.prototype.notEqual=function(e,t){return xd("notEqual")},e.prototype.less=function(e,t){return xd("less")},e.prototype.lessEqual=function(e,t){return xd("lessEqual")},e.prototype.greater=function(e,t){return xd("greater")},e.prototype.greaterEqual=function(e,t){return xd("greaterEqual")},e.prototype.logicalNot=function(e){return xd("logicalNot")},e.prototype.logicalAnd=function(e,t){return xd("logicalAnd")},e.prototype.logicalOr=function(e,t){return xd("logicalOr")},e.prototype.where=function(e){return xd("where")},e.prototype.select=function(e,t,n){return xd("select")},e.prototype.topk=function(e,t,n){return xd("topk")},e.prototype.min=function(e,t){return xd("min")},e.prototype.minimum=function(e,t){return xd("minimum")},e.prototype.mod=function(e,t){return xd("mod")},e.prototype.max=function(e,t){return xd("max")},e.prototype.maximum=function(e,t){return xd("maximum")},e.prototype.all=function(e,t){return xd("all")},e.prototype.any=function(e,t){return xd("any")},e.prototype.squaredDifference=function(e,t){return xd("squaredDifference")},e.prototype.ceil=function(e){return xd("ceil")},e.prototype.floor=function(e){return xd("floor")},e.prototype.round=function(e){return xd("round")},e.prototype.sign=function(e){return xd("sign")},e.prototype.isNaN=function(e){return xd("isNaN")},e.prototype.isInf=function(e){return xd("isInf")},e.prototype.isFinite=function(e){return xd("isFinite")},e.prototype.pow=function(e,t){return xd("pow")},e.prototype.exp=function(e){return xd("exp")},e.prototype.expm1=function(e){return xd("expm1")},e.prototype.softmax=function(e,t){return xd("softmax")},e.prototype.log=function(e){return xd("log")},e.prototype.log1p=function(e){return xd("log1p")},e.prototype.sqrt=function(e){return xd("sqrt")},e.prototype.rsqrt=function(e){return xd("rsqrt")},e.prototype.square=function(e){return xd("square")},e.prototype.reciprocal=function(e){return xd("reciprocal")},e.prototype.relu=function(e){return xd("relu")},e.prototype.relu6=function(e){return xd("relu6")},e.prototype.prelu=function(e,t){return xd("prelu")},e.prototype.elu=function(e){return xd("elu")},e.prototype.eluDer=function(e,t){return xd("eluDer")},e.prototype.selu=function(e){return xd("selu")},e.prototype.int=function(e){return xd("int")},e.prototype.clip=function(e,t,n){return xd("clip")},e.prototype.abs=function(e){return xd("abs")},e.prototype.complexAbs=function(e){return xd("complexAbs")},e.prototype.sigmoid=function(e){return xd("sigmoid")},e.prototype.softplus=function(e){return xd("softplus")},e.prototype.sin=function(e){return xd("sin")},e.prototype.cos=function(e){return xd("cos")},e.prototype.tan=function(e){return xd("tan")},e.prototype.asin=function(e){return xd("asin")},e.prototype.acos=function(e){return xd("acos")},e.prototype.atan=function(e){return xd("atan")},e.prototype.atan2=function(e,t){return xd("atan2")},e.prototype.sinh=function(e){return xd("sinh")},e.prototype.cosh=function(e){return xd("cosh")},e.prototype.tanh=function(e){return xd("tanh")},e.prototype.asinh=function(e){return xd("asinh")},e.prototype.acosh=function(e){return xd("acosh")},e.prototype.atanh=function(e){return xd("atanh")},e.prototype.erf=function(e){return xd("erf")},e.prototype.step=function(e,t){return xd("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xd("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return xd("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return xd("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return xd("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xd("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return xd("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return xd("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return xd("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return xd("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return xd("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return xd("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return xd("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return xd("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return xd("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return xd("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return xd("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return xd("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return xd("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return xd("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return xd("reshape")},e.prototype.cast=function(e,t){return xd("cast")},e.prototype.tile=function(e,t){return xd("tile")},e.prototype.pad=function(e,t,n){return xd("pad")},e.prototype.transpose=function(e,t){return xd("transpose")},e.prototype.gather=function(e,t,n){return xd("gather")},e.prototype.gatherND=function(e,t){return xd("gatherND")},e.prototype.scatterND=function(e,t,n){return xd("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return xd("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return xd("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return xd("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return xd("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return xd("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return xd("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,a){return xd("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return xd("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,a,i){return xd("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return xd("multinomial")},e.prototype.oneHot=function(e,t,n,r){return xd("oneHot")},e.prototype.cumsum=function(e,t,n,r){return xd("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return xd("nonMaxSuppression")},e.prototype.fft=function(e){return xd("fft")},e.prototype.ifft=function(e){return xd("ifft")},e.prototype.complex=function(e,t){return xd("complex")},e.prototype.real=function(e){return xd("real")},e.prototype.imag=function(e){return xd("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,a){return xd("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return xd("depthToSpace")},e.prototype.split=function(e,t,n){return xd("split")},e.prototype.sparseToDense=function(e,t,n,r){return xd("sparseToDense")},e.prototype.diag=function(e){return xd("diag")},e.prototype.fill=function(e,t,n){return xd("fill")},e.prototype.onesLike=function(e){return xd("onesLike")},e.prototype.zerosLike=function(e){return xd("zerosLike")},e.prototype.linspace=function(e,t,n){return xd("linspace")},e.prototype.dispose=function(){return xd("dispose")},e}();function xd(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function wd(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=n-1-o,i=e[a]||1;(t[t.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function kd(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],a=t.length-r-1,i=t[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function _d(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var a=e[e.length-o-1];null==a&&(a=1);var i=t[t.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function Ed(e,t,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=Id(t),l=u[0],c=u[1];if("channelsLast"===i)s=[l,c,e[3],e[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[l,c,e[1],e[1]]}return Sd(e,s,n,r,o,a,!1,i)}function Cd(e,t,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,l=Rd(t),c=l[0],d=l[1],h=l[2];if("NDHWC"===i)u="channelsLast",s=[c,d,h,e[4],e[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,d,h,e[1],e[1]]}return Nd(e,s,n,r,o,!1,u,a)}function Sd(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3];if("channelsLast"===s)l=e[0],c=e[1],d=e[2],h=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],h=e[1],c=e[2],d=e[3]}var f,p=t[0],m=t[1],v=t[3],g=Id(n),y=g[0],b=g[1],x=Id(r),w=x[0],k=x[1],_=Ad(p,w),E=Ad(m,k),C=function(e,t,n,r,o,a,i,s){var u,l,c;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,o){null==r&&(r=Td(e,t,n));var a=e[1],i=Dd((e[0]-t+2*r)/n+1,o);ds(gs(i),function(){return"The output # of rows ("+i+") must be an integer. Change the stride and/or zero pad parameters"});var s=Dd((a-t+2*r)/n+1,o);return ds(gs(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[i,s]}([t,n],a,r,e,s);l=d[0],c=d[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/o);var h=Math.max(0,(l-1)*r+a-t),f=Math.max(0,(c-1)*o+i-n),p=Math.floor(h/2),m=h-p,v=Math.floor(f/2);u={top:p,bottom:m,left:v,right:f-v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-a+1)/r),c=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:l,outWidth:c}}(o,c,d,y,b,_,E,a),S=C.padInfo,N=C.outHeight,T=C.outWidth,I=i?v*h:v;return"channelsFirst"===s?f=[l,I,N,T]:"channelsLast"===s&&(f=[l,N,T,I]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:d,inChannels:h,outHeight:N,outWidth:T,outChannels:I,padInfo:S,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:_,effectiveFilterWidth:E,dilationHeight:w,dilationWidth:k,inShape:e,outShape:f,filterShape:t}}function Nd(e,t,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3],f=u[4];if("channelsLast"===i)l=e[0],c=e[1],d=e[2],h=e[3],f=e[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);l=e[0],f=e[1],c=e[2],d=e[3],h=e[4]}var p,m=t[0],v=t[1],g=t[2],y=t[4],b=Rd(n),x=b[0],w=b[1],k=b[2],_=Rd(r),E=_[0],C=_[1],S=_[2],N=Ad(m,E),T=Ad(v,C),I=Ad(g,S),R=function(e,t,n,r,o,a,i,s,u,l,c){var d,h,f,p;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,o,a){null==o&&(o=Td(e,t,r));var i=e[1],s=e[2],u=Dd((e[0]-t+2*o)/r+1,a);ds(gs(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var l=Dd((i-t+2*o)/r+1,a);ds(gs(l),function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"});var c=Dd((s-t+2*o)/r+1,a);return ds(gs(c),function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"}),[u,l,c,1]}([t,n,r,1],s,0,o,e,c);h=m[0],f=m[1],p=m[2]}else if("same"===e){var v=((h=Math.ceil(t/o))-1)*o+s-t,g=((f=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/i))-1)*i+l-r,b=Math.floor(v/2),x=v-b,w=Math.floor(g/2),k=g-w,_=Math.floor(y/2);d={top:w,bottom:k,left:_,right:y-_,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((t-s+1)/o),f=Math.ceil((n-u+1)/a),p=Math.ceil((r-l+1)/i)}return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}(o,c,d,h,x,w,k,N,T,I,s),A=R.padInfo,D=R.outDepth,P=R.outHeight,j=R.outWidth,O=a?y*f:y;return"channelsFirst"===i?p=[l,O,D,P,j]:"channelsLast"===i&&(p=[l,D,P,j,O]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:d,inWidth:h,inChannels:f,outDepth:D,outHeight:P,outWidth:j,outChannels:O,padInfo:A,strideDepth:x,strideHeight:w,strideWidth:k,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:N,effectiveFilterHeight:T,effectiveFilterWidth:I,dilationDepth:E,dilationHeight:C,dilationWidth:S,inShape:e,outShape:p,filterShape:t}}function Td(e,t,n,r){void 0===r&&(r=1);var o=Ad(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function Id(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Rd(e){return"number"==typeof e?[e,e,e]:e}function Ad(e,t){return t<=1?e:e+(e-1)*(t-1)}function Dd(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Pd(e){var t=Id(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function jd(e,t){return Pd(e)||Pd(t)}function Od(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Md(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=nc(e.shape),o=e.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!Is(e.dtype,t))return wu.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var i=n.real(e);return a=i.cast(t),i.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=$l(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Fd(e,t){return wu.makeTensorFromDataId(e.dataId,t,e.dtype)}function Ld(e,t,n){var r=(t-e)/(n-1),o=Vs(n,"float32");o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return Jl(o,"float32")}Object.freeze({castTensor:Md,reshapeTensor:Fd,linspaceImpl:Ld,upcastType:fu,axesAreInnerMostDims:jl,combineLocations:Ol,computeOutAndReduceShapes:Ml,expandShapeToKeepDim:Fl,assertAxesAreInnerMostDims:Ll,getAxesPermutation:Bl,getUndoAxesPermutation:Ul,getInnerMostAxes:zl,getBroadcastDims:wd,getReductionAxes:kd,assertAndGetBroadcastShape:_d,assertParamsConsistent:Wl,computeOutShape:Vl,computePool2DInfo:Ed,computePool3DInfo:Cd,computeConv2DInfo:Sd,computeConv3DInfo:Nd,computeDefaultPad:Td,tupleValuesAreOne:Pd,eitherStridesOrDilationsAreOne:jd,convertConv2DDataFormat:Od,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:od});function Bd(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Ud(e,t){return{real:e[2*t],imag:e[2*t+1]}}function zd(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Wd(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Vd(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,a=0,i=!1;r<o;){var s=n(t,e[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(e,t,n||Hd)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Hd(e,t){return e>t?1:e<t?-1:0}function qd(e,t,n,r,o){return Kd(e,t,n,r,o,0).selectedIndices}function Gd(e,t,n,r,o,a){var i=Kd(e,t,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function Kd(e,t,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort($d),l=a>0?-.5/a:0,c=[],d=[];c.length<n&&u.length>0;){var h=u.pop(),f=h.score,p=h.boxIndex,m=h.suppressBeginIndex;if(f<o)break;for(var v=!1,g=c.length-1;g>=m;--g){var y=Xd(e,p,c[g]);if(y>=r){v=!0;break}if(h.score=h.score*Yd(r,l,y),h.score<=o)break}h.suppressBeginIndex=c.length,v||(h.score===f?(c.push(p),d.push(h.score)):h.score>o&&Vd(u,h,$d))}var b=c.length;return s&&(c.fill(0,b),d.fill(0,b)),{selectedIndices:Jl(c,"int32"),selectedScores:Jl(d,"float32"),numValidOutputs:$l(b,"int32")}}function Xd(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),f=(s-a)*(u-i),p=(d-l)*(h-c);if(f<=0||p<=0)return 0;var m=Math.max(a,l),v=Math.max(i,c),g=Math.min(s,d),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+p-b)}function Yd(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function $d(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Jd(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var a=e.slice(r,o);return r[n]+=t,a})}function Qd(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Cc(n,e.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(e.rank),s=0;s<i.length;s++)i[s]=a[s]%e.shape[s];var u=e.locToIndex(i);o.values[r]=e.values[u]}return o.toTensor()}function Zd(e,t,n,r,o){for(var a=t[t.length-1],i=[e.length/a,a],s=i[0],u=i[1],l=Cs(n,s*r),c=Cs("int32",s*r),d=0;d<s;d++){for(var h=d*u,f=e.subarray(h,h+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(e,t){return t.value-e.value});var v=d*r,g=l.subarray(v,v+r),y=c.subarray(v,v+r);for(m=0;m<r;m++)g[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[Xl(l,b,n),Xl(c,b,"int32")]}function eh(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Cc(e,"int32"),a=Cc([n.length,e.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*e.length;a.values.set(i,s)}return a.toTensor()}var th=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},nh=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},rh=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,a=e.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function oh(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function ah(e,t){return 1===t?[e]:oh(e,t)}function ih(){var e,t,n,r,o,a,i,s,u,l;return 2===Qi().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",i="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function sh(e,t,n){void 0===n&&(n="index");var r=Bs(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function uh(e){var t=Bs(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var lh="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ch(e,t,n,r){var o=[];e.forEach(function(e){var t=ms(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var a,i,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?hh(e):dh(e);var o=e.shapeInfo.logicalShape,a=t.logicalShape;return o.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=wd(e.shapeInfo.logicalShape,t.logicalShape),l=bh(s),c=s-i,d=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+d[e+c]+" = 0;"}).join("\n");var h;h=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+d[t+c]}).join(", ");var f="return outputValue;",p=1===ms(e.shapeInfo.logicalShape),m=1===ms(t.logicalShape);if(1!==i||p||m){if(p&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=i-2,g=i-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?f="return vec4(outputValue.x);":u.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+h+");\n      "+f+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&vs(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var l,c=bh(u),d=wd(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,f=["x","y","z","w","u","v"];l=0===s?"":u<2&&d.length>=1?"coords = 0;":d.map(function(e){return"coords."+f[e+h]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+h]}).join(", "),"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+l+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),l=t.texShape,c=ih(),d=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(c),h=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+fh+"\n    "+ph+"\n    "+mh+"\n  "}(c);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(vs(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),a=o,i="",s="b, r, c",u=2;u<e.length-1;u++)i="\n      int b"+u+" = index / "+(a*=e[e.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,a,i}(t.logicalShape,l),i=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(c)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return vs(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=sh(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=sh(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=sh(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=sh(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,l),i=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(h+=vh),[h,d,i,s,a,u,n].join("\n")}function dh(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+gh(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+yh(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=gh(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&vs(t,o)){var a=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var i=Es(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n      "+dh(xh(e,l))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+wh(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+yh(e)+"\n      }\n    ";var c=o[0],d=o[1],h=gh(n);return 1===d?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===c?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+h+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+d+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+h+";\n    vec2 uv = uvFromFlat("+c+", "+d+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],i=Es(t),s=i.newShape,u=i.keptDims,l=s;if(l.length<t.length)return"\n        "+dh(xh(e,l))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+wh(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+yh(e)+"\n      }\n    ";var c=e.shapeInfo.texShape,d=c[0],h=c[1],f=e.shapeInfo.flatOffset;return h===o&&null==f?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+h+".0, "+d+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":h===a&&null==f?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+".0, "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+gh(n)+";\n        vec2 uv = uvFromFlat("+d+", "+h+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,s=Es(t),u=s.newShape,l=s.keptDims;if(u.length<t.length)return"\n      "+dh(xh(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+wh(["row","col","depth","depth2"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+o+", 1)));\n        "+yh(e)+"\n      }\n    ";var c=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],f=d[1];return f===i&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===o&&null==c?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+h+", "+f+", index + "+gh(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,i=t[2]*a,s=t[1]*i,u=Es(t),l=u.newShape,c=u.keptDims;if(l.length<t.length)return"\n      "+dh(xh(e,l))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+wh(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+o+")) +\n          depth3;\n        "+yh(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],p=h[1];return p===s&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+gh(n)+";\n      vec2 uv = uvFromFlat("+f+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Es(t),a=o.newShape,i=o.keptDims;if(a.length<t.length)return"\n      "+dh(xh(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+wh(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    ";var s=t[5],u=t[4]*s,l=t[3]*u,c=t[2]*l,d=t[1]*c;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+c+", "+l+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+yh(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],m=f[1];return m===d&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+l+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==h?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+c+" + depth * "+l+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+gh(n)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function hh(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+ih().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=ih();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],i=o[1],s=ih();if(null!=o&&vs(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+hh(xh(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+wh(["b","row","col"],[1,2])+");\n        }\n      ";var i=a[0],s=a[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+i+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+ih().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],l=Math.ceil(t[n-1]/2),c=l*Math.ceil(t[n-2]/2),d="int b, int row, int col",h="b * "+c+" + (row / 2) * "+l+" + (col / 2)",f=2;f<n-1;f++)d="int b"+f+", "+d,h="b"+f+" * "+(c*=t[n-f-1])+" + "+h;return"\n    vec4 "+o+"("+d+") {\n      int index = "+h+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+ih().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var fh="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ph="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",mh="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",vh="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function gh(e){return"offset"+e}function yh(e){var t=e.name,n=ms(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function bh(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function xh(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function wh(e,t){return t.map(function(t){return e[t]}).join(", ")}var kh=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ds(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=bh(l),d=ah("coords",l);if(1===a){var h=bh(s=l+1);i="\n        "+h+" sourceLocR = "+h+"("+d.join()+", 0);\n        ++"+d[l-1]+";\n        "+h+" sourceLocG = "+h+"("+d.join()+", 0);\n        ++"+d[l-2]+";\n        "+h+" sourceLocA = "+h+"("+d.join()+", 0);\n        --"+d[l-1]+";\n        "+h+" sourceLocB = "+h+"("+d.join()+", 0);\n        --"+d[l-2]+";"}else s=l,i="\n        "+c+" sourceLocR = coords;\n        ++"+d[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+d[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+d[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+d[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(e){return"int "+e}),v=ah("sourceLocR",s-1).concat("inIdx.r"),g=ah("sourceLocG",s-1).concat("inIdx.g"),y=ah("sourceLocB",s-1).concat("inIdx.b"),b=ah("sourceLocA",s-1).concat("inIdx.a"),x="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",k="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",_=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+_+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+d[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+d[l-2]+" < "+(u[l-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+k+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+k+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},_h=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+d+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Eh=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=c-1-e.padInfo.front,p=d-1-e.padInfo.top,m=h-1-e.padInfo.left,v=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float avgMultiplier = float("+v+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+l+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ch=function(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],_d(e,t),_d(e,n);var i="0.0";null!=r&&(_d(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(_d(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Sh=function(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],_d(e,t),_d(e,n);var i="vec4(0.0)";null!=r&&(_d(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(_d(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Nh=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=_d(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Th="return a + b;",Ih="return a - b;",Rh="return a * b;",Ah="return (a < 0.) ? b * a : a;",Dh=function(e,t,n){this.variableNames=["A","B"],this.outputShape=_d(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ph="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",jh=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_d(t,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===ms(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+bh(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=ah("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},Oh=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Mh=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Fh=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Lh=function(e){this.outputShape=[],this.outputShape=Vl(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=t.length,i=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Bh=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Vl(e,t);var n=this.outputShape,r=n.length,o=bh(r),a=ah("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=i[t],c=i.slice(-2),d=i.join(),h="if ("+l+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+c.join()+"));\n        }";for(u=1;u<s.length;u++){var f=s[u-1];h+="\n        if ("+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Uh(i,l,f)+"),\n            vec2("+Uh(c,l,f)+"));\n        }"}var p=s.length,m=s[s.length-1];h+="\n        return getChannel(\n          getT"+p+"("+Uh(i,l,m)+"),\n          vec2("+Uh(c,l,m)+"));",this.userCode="\n      float getValue("+i.map(function(e){return"int "+e})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function Uh(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var zh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,i=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=a?1:2,l=a?2:3,c=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+c+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+l+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Vh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Hh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+l+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Gh=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Kh=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,a=e.padInfo.left,i=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),f=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,v=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+x+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Xh=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Yh=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=e.outChannels/e.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},$h=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,a=e.inWidth,i=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=f,m="int xR; int xC; int xCOffset;",v=0;v<h;v++)for(var g=0;g<f;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<h;v++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+v*c+";\n          xC = xCCorner + "+(g=2*y)*d+";\n        ",1===l){if(g<f&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+v+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<f)){var b=s%2==0?ls(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<f&&(m+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<f&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<f&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<f&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<h;v++)for(g=0;g<f;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var x="",w="";n&&(x=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+x+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+k+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Jh=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],i=e[1],s=e[2],u=e[3],l=t[0],c=n[0],d=n[1];this.outputShape=[l,c,d,u];var h="bilinear"===r?1:0,f=[i-1+".0",s-1+".0"],p=f[0],m=f[1],v=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=v[0],y=v[1],b=v[2],x=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=x[0],k=x[1],_=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+k+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+_+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Qh=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+bh(r)+" coords = getOutputCoords();\n        int end = "+Zh(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Zh(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Zh(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var ef=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Eu.DENSE;var t=Du(e),n=ih();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+sh(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},tf=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Eu.DENSE;var t=Du(e),n=ih();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+sh(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},nf=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),rf=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},of=function(e){this.variableNames=["A"],this.outTexUsage=Cu.DOWNLOAD;var t=ih();this.outputShape=e,this.userCode="\n      "+lh+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},af=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Cu.DOWNLOAD;var t=ih();this.outputShape=e,this.userCode="\n      "+lh+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},sf=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=ih(),o=t[0],a=t[1];this.outputShape=e;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+uh(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},uf=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=ih(),o=t[0],a=t[1];this.outputShape=e;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+e[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+uh(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},lf=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},cf=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),df=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=bh(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<e.length;a++)a===t?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},hf=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=bh(t.length),o=bh(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function ff(e,t){var n=ih();return Bu(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function pf(e,t){return Ku(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function mf(e,t){return Xu(e,t,new Uint16Array([0,1,2,2,1,3]))}function vf(e,t,n,r,o,a,i){$u(n,r);var s=Yu(e,t),u=e.TEXTURE_2D;return Ou(e,t,function(){return e.bindTexture(u,s)}),Ou(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),Ou(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),Ou(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),Ou(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),Ou(e,t,function(){return e.texImage2D(u,0,o,n,r,0,a,i,null)}),Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function gf(e,t,n,r,o){var a=Au(n,r);return vf(e,t,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function yf(e,t,n,r,o){var a=Au(n,r);return vf(e,t,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function bf(e,t,n,r,o){var a=Au(n,r);return vf(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function xf(e,t,n,r,o){var a=Pu(n,r);return vf(e,t,a[0],a[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function wf(e,t,n,r,o){var a=Pu(n,r);return vf(e,t,a[0],a[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function kf(e,t,n,r){return Ou(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Qu(e,t,n,"clipSpacePos",r,3,20,0)&&Qu(e,t,n,"uv",r,2,20,12)}function _f(e,t,n,r,o,a,i){var s,u,l;Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=i.internalFormatPackedFloat),s.set(a),Ou(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Ef(e,t,n,r){Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Ou(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):Ou(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),Ou(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Cf(e,t,n,r,o){var a=e.createBuffer();Ou(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)});var i=16*n*r;return Ou(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)}),Ou(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),Ou(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),a}function Sf(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Nf(e,t,n,r,o){var a=Au(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return Ou(e,t,function(){return e.readPixels(0,0,i,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Tf(e,t,n,r,o,a,i,s){var u=e,l=new Float32Array(function(e,t){var n=Pu(e,t);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function If(e,t,n,r){var o=new Float32Array(n*r*4);return Ou(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var Rf=Object.freeze({createVertexShader:ff,createVertexBuffer:pf,createIndexBuffer:mf,createFloat32MatrixTexture:gf,createFloat16MatrixTexture:yf,createUnsignedBytesMatrixTexture:bf,createPackedMatrixTexture:xf,createFloat16PackedMatrixTexture:wf,bindVertexProgramAttributeStreams:kf,uploadDenseMatrixToTexture:_f,uploadPixelDataToTexture:Ef,createBufferFromOutputTexture:Cf,downloadFloat32MatrixFromBuffer:Sf,downloadByteEncodedFloatMatrixFromOutputTexture:Nf,downloadPackedMatrixFromBuffer:Tf,downloadMatrixFromPackedOutputTexture:If}),Af=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Qi().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Iu(t,e)):this.gl=Ru(t);var n="WEBGL_color_buffer_float";if(1===Qi().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Lu(this.gl,this.debug,"OES_texture_float"),yl(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Lu(this.gl,this.debug,"OES_texture_half_float");else if(Qi().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),yl(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Lu(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Qi().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",yl(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!yl(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=pf(this.gl,this.debug),this.indexBuffer=mf(this.gl,this.debug),this.framebuffer=Ju(this.gl,this.debug),this.textureConfig=ju(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Qi().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Ou(t,this.debug,function(){return t.finish()}),Ou(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Ou(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Ou(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Ou(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Ou(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),gf(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),yf(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),bf(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Ef(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),_f(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),wf(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),xf(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(ol(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Ou(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Nf(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,a){return Tf(this.gl,e,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Sf(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Cf(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(Qi().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(a,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=a}else Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return If(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=Uu(t,this.debug,e),r=ff(t,this.debug),o=Hu(t,this.debug);return Ou(t,this.debug,function(){return t.attachShader(o,r)}),Ou(t,this.debug,function(){return t.attachShader(o,n)}),qu(t,this.debug,o),this.debug&&Gu(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=kf(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Ou(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Gu(this.gl,this.debug,this.program),Ou(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?el(this.gl,this.debug,e,t):tl(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Ou(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),nl(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Pu(t,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,o,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Gu(this.gl,this.debug,this.program),al(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Ou(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Ou(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Lu(this.gl,this.debug,2===Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return Yi(this,void 0,void 0,function(){var t=this;return $i(this,function(n){switch(n.label){case 0:return[4,ws(function(){return t.disposed||t.isQueryAvailable(e,Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ws(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),rl(this.gl,this.debug,e,this.framebuffer),this.debug&&al(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(rl(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&al(this.gl)):ol(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;rl(r,this.debug,e,this.framebuffer),this.debug&&al(r),this.outputTexture=e,Ou(r,this.debug,function(){return r.viewport(0,0,t,n)}),Ou(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),Ou(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Df(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],a=o.shape;if(!vs(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!o.isUniform){var i=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!vs(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}})}var Pf=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,h=s.left,f=s.top,p=o*r,m=ih(),v="channelsLast"===d,g=v?0:1,y=v?1:2,b="",x=0;x<=1;x++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+x+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+f+";\n            d0 = offsetY + "+c+" * (pos / "+p+");\n\n            if(d0 < "+t[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+h+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*x+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},jf=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Of=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},Mf=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Ff=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,s=a-1-e.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Lf=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,d=u-1-e.padInfo.top,h=l-1-e.padInfo.left,f=s*u*l-1;this.userCode="\n      const ivec3 pads = ivec3("+c+", "+d+", "+h+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+f+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Bf=function(e,t,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";a&&(f=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+h[0]+");\n          result += ("+d[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Uf=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),zf=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Wf=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=ah("rc",t),r=bh(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),i=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<e;i++)a=t[t.length-1-i]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},Vf=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=bh(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Hf=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=bh(r),a=t.map(function(e){return e[0]}).join(","),i=t.map(function(t,n){return t[0]+e[n]}).join(","),s=ah("rc",r),u=ah("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=1===r?2:4;p<m;p++)f+="\n        "+d[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";f+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+f+"\n        setOutput(result);\n      }\n    "},qf=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,a=e.strideWidth,i=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var h="avg"===t,f="0.0";if(h||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+c+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+c+", "+d+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+i+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Gf=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var v="avg"===t,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+a+", "+i+");\n        const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),x=r%4,w="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===x)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},Kf=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===t?i="1.0":"min"===t?(i="1.0 / 1e-20",s="min"):"max"===t&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(i="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(i="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},Xf=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+sh(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+uh(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Yf=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},$f=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Jf=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Qf=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],a=r[2],i=e.shape,s=i[1],u=i[2],l=[n&&s>1?o-1:o,n&&u>1?a-1:a],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,v=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Zf=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],a=e[1],i=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?a-1:a,r&&n>1?i-1:i],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},ep=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=bh(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},tp=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=ah("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=bh(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},np=function(e,t,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=bh(o.length),u=bh(a.length),l="";1===n?l="i":2===n&&(l="i, j");var c="getIndices("+l+")",d="";1===r?d="i":2===r&&(d="i, coords[1]");var h="getUpdates("+d+")",f=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+f+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+h+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},rp=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";o%n>0&&(c="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},op=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+a[u]),u<e&&i.push(""+a[u]);r=i.join(),o=s.join()}var l=bh(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},ap=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=bh(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return ip.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+ip[t]+" = start["+t+"] + coords."+ip[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),ip=["x","y","z","w","u","v"],sp=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=bh(this.rank),n=ah("coords",this.rank),r=ah("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),up=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=bh(n.length),a=bh(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},lp=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=cp(t,n),a=dp(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===Su.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Su.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Su.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Su.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Su.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=dp(t,cp(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(e);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function cp(e,t){if(e===Cu.UPLOAD)return Su.PACKED_2X2_FLOAT32;if(e===Cu.RENDER||null==e)return function(e){return Qi().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Su.PACKED_2X2_FLOAT32:Su.UNPACKED_FLOAT32:e?Su.PACKED_2X2_FLOAT16:Su.UNPACKED_FLOAT16}(t);if(e===Cu.DOWNLOAD||e===Cu.PIXELS)return Su.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function dp(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var hp=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=bh(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},fp=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=bh(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},pp=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=bh(this.rank),a=oh("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},mp=1.7580993408473768,vp=1.0507009873554805,gp=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},yp="if (isnan(x)) return x;",bp="return abs(x);",xp=yp+"\n  return (x < 0.0) ? 0.0 : x;\n",wp=yp+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",kp="return (x >= 0.0) ? x : (exp(x) - 1.0);",_p="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+mp+";\n  float scale = "+vp+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Ep="return -x;",Cp="return ceil(x);",Sp="return floor(x);",Np="return exp(x);",Tp="return exp(x) - 1.0;",Ip=yp+"\n  return sin(x);\n",Rp=yp+"\n  return cos(x);\n",Ap=yp+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",Dp=yp+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",Pp=yp+"\n  return atan(x);\n",jp=yp+"return log(x + sqrt(x * x + 1.0));",Op=yp+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Mp=yp+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",Fp="return x;",Lp="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Bp="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Up="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",zp=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Wp=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=ah("rc",t),r=bh(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),i=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},Vp={};function Hp(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?Lp:xp;if("elu"===e)return t?Up:kp;if("relu6"===e)return t?Bp:wp;if("prelu"===e)return t?Ph:Ah;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var qp=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Qi().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=Ru(Qi().getNumber("WEBGL_VERSION"));r.binaryCache=((n=Qi().getNumber("WEBGL_VERSION"))in Vp||(Vp[n]={}),Vp[n]),r.gpgpu=new Af(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new lp(r.gpgpu),r.numMBBeforeWarning=null==Qi().global.screen?1024:Qi().global.screen.height*Qi().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new yd(r,wu),r}return Xi(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(Qi().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Cu.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(Qi().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Cu.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,a=t.slice,i=t.shape,s=t.isPacked;if(null!=a){var u;u=s?new zp(i,Fp):new gp(i,Fp);var l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),c=this.readSync(l.dataId);return this.disposeData(l.dataId),c}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,h,f=null!=this.activeTimers;return f&&(d=Hs()),h="complex64"===r?Bd(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=Hs()-d),this.convertAndCacheOnCPU(e,h)},t.prototype.read=function(e){return Yi(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x,w,k;return $i(this,function(_){switch(_.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,o=n.shape,a=n.slice,i=n.dtype,s=n.complexTensors,u=n.isPacked,null!=a)return void 0,l=u?new zp(o,Fp):new gp(o,Fp),c=this.runWebGLProgram(l,[{dataId:e,shape:o,dtype:i}],i),d=this.read(c.dataId),this.disposeData(c.dataId),[2,d];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!Qi().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Qi().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==i&&Qi().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(e),p=this.texData.get(f.dataId),h=(k=this.gpgpu).createBufferFromTexture.apply(k,[p.texture].concat(Du(o)))),this.pendingRead.set(e,[]),"complex64"===i?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:_.sent(),_.label=2;case 2:return"complex64"!==i?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return v=_.sent(),g=v[0],y=v[1],m=Bd(g,y),[3,5];case 4:null==h?m=this.getValuesFromTexture(e):(b=ms(o),m=this.gpgpu.downloadFloat32MatrixFromBuffer(h,b)),_.label=5;case 5:return null!=f&&this.disposeData(f.dataId),x=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach(function(e){return e(x)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,x]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Mu(n)){if(Qi().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.isPacked,i=ms(r);if(Qi().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Du(r))).subarray(0,i);return this.disposeData(s.dataId),l}var c=Qi().getBool("WEBGL_PACK")&&!0===a,d=c?dl(r):r,h=c?new af(d):new of(d),f=this.runWebGLProgram(h,[{shape:d,dtype:o,dataId:e}],"float32"),p=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeData(f.dataId),m},t.prototype.time=function(e){return Yi(this,void 0,void 0,function(){var t,n,r,o,a,i,s;return $i(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=ps(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),a=ps(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),i.kernelMs=cs(s),i.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:a[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:i.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Hs(),endMs:null}},t.prototype.endTimer=function(e){return Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Hs(),e)},t.prototype.getQueryTime=function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){return Qi().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,a=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return Qi().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=wu.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:wu.keep(e.clone()),imag:wu.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===ms(n))return Xl([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=fd(e.shape,t,n);if(r||!o){var a=Qi().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sp(n):new ap(n),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,i)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var i=pd(t,e.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=cd(t,n,r);if(o.some(function(e){return 0===e}))return Xl([],o);var a=new up(t,r,o);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=Qi().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tp(e.shape,t):new ep(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return Gl(e)}),r=e.map(function(e){return Kl(e)});return ql(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>Qi().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),a=this.concat(e.slice(0,o),t),i=this.concat(e.slice(o),t);return this.concat([a,i],t)}if(Qi().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new Bh(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=Vl(e.map(function(e){return e.shape}),t),l=e.map(function(e){return e.as2D(-1,ms(e.shape.slice(t)))}),c=new Lh(l.map(function(e){return e.shape}));return this.compileAndRun(c,l).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ep,e.dtype);var t=new gp(e.shape,Ep);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],i=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===a)&&i>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===a?e:e.as3D(s,i,1),l=1===a?2:1,c=1===a?t.as3D(s,1,i):t;return this.multiply(u,c).sum(l,!0)}var d=fu(e.dtype,t.dtype),h=new Bf(e.shape,[s,o,a],n,r);return this.compileAndRun(h,[e,t],d)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],l=o?n.shape[1]:n.shape[2],c=t.shape[0],d=fu(t.dtype,n.dtype),h=null!=a,f=null!=s,p=i?Hp(i,!0):null,m=new Bf(t.shape,[c,u,l],r,o,h,p,f),v=[t,n];return a&&v.push(a),s&&v.push(s),this.compileAndRun(m,v,d)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new Nh("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new Nh("return areal * bimag + aimag * breal;",e.shape,t.shape),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,i),u=this.compileAndRun(a,i),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Rh,e.dtype);var c=new Dh(Rh,e.shape,t.shape);return this.compileAndRun(c,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){var i=[e,t,n],s=null;null!=a&&(s=a.shape,i.push(a));var u=null;if(null!=o&&(u=o.shape,i.push(o)),Qi().getBool("WEBGL_PACK_NORMALIZATION")){var l=new Sh(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,i)}var c=new Ch(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,i)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var a=Qi().getBool("WEBGL_PACK_NORMALIZATION")?new Mf(e.shape,t,n,r,o):new jf(e.shape,t,n,r,o);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){var s=new Of(t.shape,r,o,a,i);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return Ks(e)});return Qd(Cc(e.shape,e.dtype,n),t)}var r=new hp(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=Qi().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hf(e.shape,t,n):new Vf(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=Qi().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pp(e.shape,t):new fp(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new df(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){ds(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=Qc(e.shape,t,r),a=Zc(o.length,t.length),i=ed(e.shape,t,r),s=td(n,t.length),u=nd(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){ds(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Qc(i.shape,t,r,!1),u=Zc(s.length,t.length,!1),l=ed(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],a=od(o),i=new Kf({windowSize:a,inSize:o,batchSize:r},t),s=this.compileAndRun(i,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=od(o),i=new rh({windowSize:a,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=od(r[r.length-1]),a=new kh(r,o,t,null==n),i=null==n?[e]:[e,n],s=this.compileAndRun(a,i,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){Ll("sum",t,e.rank);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o),i=pu(e.dtype);return this.reduce(a,"sum",i).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o),i=pu(e.dtype);return this.reduce(a,"prod",i).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=Bl([r],e.rank),a=e;null!=o&&(a=e.transpose(o),r=zl(1,e.rank)[0]);var i=function(e,t,n){for(var r=[],o=e.length,a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=ms([a.shape[r]]),u=a.as2D(-1,s),l=pu(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(i);return null!=o&&(c=c.transpose(Ul(o))),c},t.prototype.segOpCompute=function(e,t,n,r,o){var a=e.shape[0],i=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Ls(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ls(e,n+1);return n}(i,o),u=new rp({windowSize:s,inSize:i,batchSize:a,numSegments:o},t),l=this.compileAndRun(u,[e,n],r);return l.shape[1]===o?l:(n=oc(0,o).tile([i/s]),this.segOpCompute(l,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(Ll("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!Qi().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Ml(e.shape,r),a=o[0],i=ms(o[1]),s=e.as2D(-1,i);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new Qh(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Dh("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Dh("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Dh("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Dh("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Dh("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Dh("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new gp(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Dh("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Dh("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new op(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],fu(t.dtype,n.dtype))},t.prototype.where=function(e){Il("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return eh(e.shape,t)},t.prototype.topk=function(e,t,n){return Zd(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Ll("min",t,e.rank);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Dh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Dh("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Ll("max",t,e.rank);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Dh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){Ll("all",t,e.rank);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){Ll("any",t,e.rank);var n=Ml(e.shape,t),r=n[0],o=ms(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Dh("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Dh("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Th);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=fu(e.dtype,t.dtype);if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Th,n);var r=new Dh(Th,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new zp(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var a=new jh(n,e.shape,t.shape,o);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(e,a),u=r.makeComplexComponentTensorInfo(t,i),l=new Dh(n,e.shape,t.shape);return r.compileAndRun(l,[s,u],fu(a.dtype,i.dtype))}),s=i[0],u=i[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>Qi().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return fu(e,t)}),a=e.map(function(e){return e.shape}),i=Qi().getBool("WEBGL_PACK")?new nh(e[0].shape,a):new th(e[0].shape,a);return this.compileAndRun(i,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Ih);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=fu(e.dtype,t.dtype);if(Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ih,e.dtype);var r=new Dh(Ih,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Dh("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=fu(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Cp,e.dtype);var t=new gp(e.shape,Cp);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Sp,e.dtype);var t=new gp(e.shape,Sp);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new gp(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new gp(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new gp(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new gp(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new gp(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Np,e.dtype);var t=new gp(e.shape,Np);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Tp,e.dtype);var t=new gp(e.shape,Tp);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=_s([t],e.shape),r=this.max(e,n),o=Fl(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new gp(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new gp(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new gp(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new gp(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new gp(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=Qi().getBool("WEBGL_PACK")?new zp(e.shape,Lp):new gp(e.shape,xp),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=Qi().getBool("WEBGL_PACK")?new zp(e.shape,Bp):new gp(e.shape,wp),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh(Ph,e.shape,t.shape):new Dh(Ah,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Up,e.dtype);var t=new gp(e.shape,kp);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Dh("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new gp(e.shape,_p);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new gp(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=Qi().getBool("WEBGL_PACK_CLIP")?new Mh(e.shape):new Oh(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(Qi().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bp,e.dtype);var t=new gp(e.shape,bp);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Fh(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new gp(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new gp(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new gp(e.shape,Ip);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new gp(e.shape,Rp);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new gp(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new gp(e.shape,Ap);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new gp(e.shape,Dp);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new gp(e.shape,Pp);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Dh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new gp(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new gp(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new gp(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new gp(e.shape,jp);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new gp(e.shape,Op);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new gp(e.shape,Mp);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new gp(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new gp(e.shape,function(e){return void 0===e&&(e=0),yp+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,a){var i=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,l=i[0]*i[1]*i[2],c=n.outChannels,d="channelsLast"===n.dataFormat,h=(1===l||1===c)&&u>1e3,f=i[2]%2!=0&&!!s.isPacked;if(h||!Qi().getBool("WEBGL_LAZILY_UNPACK")||!Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var p=d?i[0]*i[1]*i[2]:i[0]*i[2]*i[3],m=this.reshape(e,[1,p,n.inChannels]),v=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:v,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var g=d?i[0]*i[1]*(i[2]+1):i[0]*i[2]*(i[3]+1),y={dataId:e.dataId,shape:[1,g,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,ds(pl(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var x=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),k=this.texData.get(w.dataId);return ds(k.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=b,k.shape=n.outShape,wu.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,l=n.outWidth,c=n.outHeight,d="channelsLast"===n.dataFormat,h=i*s*u,f=c*l,p=[h,f],m=e.squeeze([0]),v=t.reshape([1,h,-1]),g=new Pf(p,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,p[0],p[1]]),b=null!=r,x=null!=a,w=o?Hp(o,!0):null,k=new Bf(y.shape,[1,f,n.outChannels],!0,!1,b,w,x),_=[y,v];r&&_.push(r),x&&_.push(a);var E=this.compileAndRun(k,_);return d?E.reshape([1,c,l,n.outChannels]):E.reshape([1,n.outChannels,c,l])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,a,i);if(Qi().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,a,i);var s=null!=o,u=null!=i,l=a?Hp(a,!1):null,c=new Kh(r,s,l,u),d=[t,n];return o&&d.push(o),i&&d.push(i),this.compileAndRun(c,d)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Qi().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Kh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new Wh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new zh(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=Qi().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=i?Hp(i,u):null,c=[n,r],d=null!=a,h=null!=s;return d&&c.push(a),h&&c.push(s),u?(t=new $h(o,d,l,h),this.compileAndRun(t,c)):(t=new Yh(o,d,l,h),this.compileAndRun(t,c))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return Qi().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new $h(n),this.compileAndRun(r,[e,t])):(r=new Yh(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new Gh(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new qh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new Xh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new Hh(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new Vh(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new qf(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new qf(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new qf(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Ff(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new _h(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Md(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new Gf(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new Eh(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new Gf(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new Gf(r,"max",!0),a=this.compileAndRun(o,[t]),i=new Lf(r),s=this.compileAndRun(i,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!pl(e.shape,t)&&(null===n.texture||!pl(n.shape,t))){var r=this.packedReshape(e,t);return wu.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Fd(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=Qi().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Jf(e.shape,t,n,r):new $f(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new Yf(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Zf(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new Qf(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:vd(e),a=o.shape[0],i=o.shape[1],s=new Uf(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new zf(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new rf(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return Il("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),qd(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,a){var i=new Jh(e.shape,t.shape,r,o,a);return this.compileAndRun(i,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){ds(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],i="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=a*t,l=i/(t*t),c=new nf("NHWC"===n?[r,s,u,l]:[r,l,s,u],t,n);return this.compileAndRun(c,[e])},t.prototype.split=function(e,t,n){return Jd(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=sd(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/i,i],c=e.reshape([a,o]),d=t.reshape([a,i]);if(0===u)return Fd(Xl([]),n);var h=$l(0),f=new np(a,o,c.rank,d.rank,s,l);return this.compileAndRun(f,[d,c,h]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=sd(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,l=new np(i,a,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new lf("return real * expR - imag * expI;",e.shape,t),o=new lf("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(e.shape[0],e.shape[1]);return i.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=rd(e,t),a=o[0],i=o[1],s=o[2],u=o[3],l=t.reshape([i,r]),c=e.reshape([e.size/s,s]),d=new hf(r,u,[i,s]);return this.compileAndRun(d,[c,l]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Ms(t))){var r=Ss(n,ms(e));return r.fill(t),wu.makeTensor(r,e,n,this)}var o=new cf(e,t),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Ld(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return wu.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Wp(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new Wf(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[ll(e.shape)].concat(cl(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[ll(t)].concat(cl(t)),a=new Xf(o,n),i=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,a=n.dtype,i=dl(o);return t=r?new tf(i):new ef(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(t,[{shape:i,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var a=this;void 0===o&&(o=!1);var i=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(i.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Eu.DENSE){var u=Du(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===ms(i.shape))return s.values=Cs(i.dtype,0),i;var l=[],c=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&ms(t.shape)<=Qi().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!pl(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),l.push(t),n=a.texData.get(t.dataId),r.shape=o}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(i.dataId);var d,h={shape:i.shape,texData:s,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,c,h),p=this.getAndSaveBinary(f,function(){return function(e,t,n,r){var o=t.userCode,a=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),i=a.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=ch(a,s,o,t.packedInputs),l=e.createProgram(u),c=null,d=e.getUniformLocation(l,"NAN",!1);1===Qi().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(l,"INFINITY",!1));for(var h={},f=0;f<t.variableNames.length;f++){var p=t.variableNames[f];h[p]=e.getUniformLocation(l,p,!1),h["offset"+p]=e.getUniformLocation(l,"offset"+p,!1)}return{program:t,source:u,webGLProgram:l,uniformLocations:h,inShapeInfos:i,outShapeInfo:s,infLoc:c,nanLoc:d}}(a.gpgpu,e,c,h)}),m=null!=this.activeTimers;if(m&&(d=this.startTimer()),function(e,t,n,r,o){Df(t.inShapeInfos,n),Df([t.outShapeInfo],[r]);var a=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,i[0],i[1]):e.setOutputMatrixTexture(a,i[0],i[1]),e.setProgram(t.webGLProgram),1===Qi().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],a=t.uniformLocations[o],i=t.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(ms(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,c,h,r),l.forEach(function(e){return a.disposeData(e.dataId)}),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!Qi().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var v=this.unpackTensor(i);return this.disposeData(i.dataId),v}return i},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,o);return wu.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(Qi().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Nl(function(){if(!Qi().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Qi().getBool("DEBUG");Qi().set("DEBUG",!1);var n=e.abs($l(1e-8)).dataSync()[0];if(Qi().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var l,c=null!=this.activeTimers;c&&(l=Hs());var d=n.texShape;if(null==d&&(d=hl(r,u),n.texShape=d),null!=a){var h=dl(r),f=void 0,p=d[1],m=d[0],v=a instanceof Uint8Array;u?(p=(t=Pu(d[0],d[1]))[0],m=t[1],f=new uf(h,[m,p],v)):f=new sf(h,[m,p],v);var g=this.makeTensorInfo([m,p],o);this.texData.get(g.dataId).usage=v?Cu.PIXELS:Cu.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),p,m,a);var y=this.runWebGLProgram(f,[g],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,c&&(this.uploadWaitMs+=Hs()-l)}else{var x=this.acquireTexture(d,s,o,u);n.texture=x}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*As(t)},t}(bd);ku()&&wu.registerBackend("webgl",function(){return new qp},2);var Gp=Hl({square_:function(e){var t=Dl(e,"x","square"),n=[t];return wu.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),Kp="SquaredDifference",Xp=Hl({squaredDifference_:function(e,t){var n,r=Dl(e,"a","squaredDifference"),o=Dl(t,"b","squaredDifference");n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return wu.runKernelFunc(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},a,function(e,t){var n=t[0],r=t[1],o=$l(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}},Kp,{},i,[])}}),Yp=Hl({abs_:function(e){var t=Dl(e,"x","abs");return"complex64"===t.dtype?wu.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):wu.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),$p=Hl({acos_:function(e){var t=Dl(e,"x","acos");return wu.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict($l(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Jp=Hl({acosh_:function(e){var t=Dl(e,"x","acosh");return wu.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Qp=Hl({asin_:function(e){var t=Dl(e,"x","asin");return wu.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict($l(1).sub(n.toFloat().square()).sqrt())}}})}}),Zp=Hl({asinh_:function(e){var t=Dl(e,"x","asinh");return wu.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict($l(1).add(n.toFloat().square()).sqrt())}}})}}),em=Hl({atan_:function(e){var t=Dl(e,"x","atan");return wu.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),tm=Hl({atanh_:function(e){var t=Dl(e,"x","atanh");return wu.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div($l(1).sub(n.toFloat().square()))}}})}}),nm=Hl({ceil_:function(e){var t=Dl(e,"x","ceil");return wu.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),rm=Hl({clipByValue_:function(e,t,n){var r=Dl(e,"x","clipByValue");ds(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],a={min:t,max:n};return wu.runKernelFunc(function(e,o){var a=e.clip(r,t,n);return o([r]),a},{x:r},function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),ic(e))}}},"ClipByValue",a,o)}}),om=Hl({cos_:function(e){var t=Dl(e,"x","cos"),n=[t];return wu.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),am=Hl({cosh_:function(e){var t=Dl(e,"x","cosh");return wu.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),im=Hl({erf_:function(e){var t=Dl(e,"x","erf");return ds("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),wu.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),sm=Hl({exp_:function(e){var t=Dl(e,"x","exp");return wu.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),um=Hl({expm1_:function(e){var t=Dl(e,"x","expm1");return wu.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),lm=Hl({floor_:function(e){var t=Dl(e,"x","floor");return wu.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),cm=Hl({log_:function(e){var t=Dl(e,"x","log"),n=[t];return wu.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),dm=Hl({log1p_:function(e){var t=Dl(e,"x","log1p");return wu.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),hm=Hl({logSigmoid_:function(e){var t=Dl(e,"x","logSigmoid");return wu.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),fm=Hl({neg_:function(e){var t=Dl(e,"x","neg"),n=[t];return wu.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),pm=Hl({reciprocal_:function(e){var t=Dl(e,"x","reciprocal");return wu.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),mm=Hl({round_:function(e){var t=Dl(e,"x","round");return wu.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),vm=Hl({rsqrt_:function(e){var t=Dl(e,"x","rsqrt"),n=[t];return wu.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),gm=Hl({sigmoid_:function(e){var t=Dl(e,"x","sigmoid");return wu.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul($l(1).sub(n)))}}},"Sigmoid")}}),ym=Hl({sign_:function(e){var t=Dl(e,"x","sign");return wu.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),bm=Hl({isNaN_:function(e){var t=Dl(e,"x","isNaN");return wu.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),xm=Hl({isInf_:function(e){var t=Dl(e,"x","isInf");return wu.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),wm=Hl({isFinite_:function(e){var t=Dl(e,"x","isFinite");return wu.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return ic(e)}}})}}),km=Hl({sin_:function(e){var t=Dl(e,"x","sin"),n=[t];return wu.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),_m=Hl({sinh_:function(e){var t=Dl(e,"x","sinh");return wu.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Em=Hl({softplus_:function(e){var t=Dl(e,"x","softplus");return wu.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Cm=Hl({sqrt_:function(e){var t=Dl(e,"x","sqrt");return wu.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),Sm=Hl({step_:function(e,t){void 0===t&&(t=0);var n=Dl(e,"x","step");return wu.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return ic(e)}}})}}),Nm=Hl({tan_:function(e){var t=Dl(e,"x","tan");return wu.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),Tm=Hl({tanh_:function(e){var t=Dl(e,"x","tanh");return wu.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return $l(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Im(e,t,n,r,o,a){var i,s,u=Dl(e,"x","batchNorm"),l=Dl(t,"mean","batchNorm"),c=Dl(n,"variance","batchNorm");return null!=o&&(i=Dl(o,"scale","batchNorm")),null!=r&&(s=Dl(r,"offset","batchNorm")),ds(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ds(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),ds(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=i&&ds(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),null!=s&&ds(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function Rm(e,t,n,r,o,a){var i,s,u=Dl(e,"x","batchNorm"),l=Dl(t,"mean","batchNorm"),c=Dl(n,"variance","batchNorm");return null!=o&&(i=Dl(o,"scale","batchNorm")),null!=r&&(s=Dl(r,"offset","batchNorm")),ds(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ds(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),ds(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=i&&ds(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),null!=s&&ds(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function Am(e,t,n,r,o,a){var i,s,u=Dl(e,"x","batchNorm"),l=Dl(t,"mean","batchNorm"),c=Dl(n,"variance","batchNorm");return null!=o&&(i=Dl(o,"scale","batchNorm")),null!=r&&(s=Dl(r,"offset","batchNorm")),ds(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),ds(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),ds(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=i&&ds(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),null!=s&&ds(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Dm(u,l,c,s,i,a)}function Dm(e,t,n,r,o,a){null==a&&(a=.001);var i,s,u,l=Dl(e,"x","batchNorm"),c=Dl(t,"mean","batchNorm"),d=Dl(n,"variance","batchNorm");null!=o&&(i=Dl(o,"scale","batchNorm")),null!=r&&(s=Dl(r,"offset","batchNorm")),ds(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ds(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ds(null==i||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var h=[l,c,d,i];return wu.runKernelFunc(function(e,t){var n=e.batchNormalization(u,Pm(c),Pm(d),a,Pm(i),Pm(s));return t([l,c,d,i]),n},{x:l,mean:c,variance:d,scale:i,offset:s},function(e,t){var n=t,r=n[0],o=n[1],i=n[2],s=n[3],l=null==s?$l(1):s,c=kd(o.shape,u.shape),d=[];if(1===o.rank){for(var h=0;h<u.shape.length-1;++h)d.push(u.shape[h]);d.push(1)}var f=r.sub(o),p=e.mul(l),m=vm(i.add($l(a))),v=m.mul(m).mul(m).mul($l(-.5));return{x:function(){return 1===o.rank?e.mul(Yc(m.as4D(1,1,1,o.shape[0]),d)).mul(l).reshape(r.shape):e.mul(m).mul(l).reshape(r.shape)},mean:function(){var e=m.mul($l(-1)).mul(p);return 1===o.rank&&(e=e.sum(c)),e.reshape(o.shape)},variance:function(){var e=v.mul(f).mul(p);return 1===o.rank&&(e=e.sum(c)),e.reshape(o.shape)},scale:function(){var t=f.mul(m),n=e.mul(t);return 1===o.rank&&(n=n.sum(c)),n.reshape(o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=t.sum(c)),t.reshape(o.shape)}}},"BatchNormalization",{varianceEpsilon:a},h).reshape(l.shape)}function Pm(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function jm(){Sl("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Om=Hl({batchNormalization2d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),jm(),Im(e,t,n,a,o,r)}}),Mm=Hl({batchNormalization3d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),jm(),Rm(e,t,n,a,o,r)}}),Fm=Hl({batchNormalization4d_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),jm(),Am(e,t,n,a,o,r)}}),Lm=Hl({batchNormalization_:function(e,t,n,r,o,a){return void 0===r&&(r=.001),jm(),Dm(e,t,n,a,o,r)}}),Bm=Hl({batchNorm_:Dm}),Um=Hl({batchNorm2d_:Im}),zm=Hl({batchNorm3d_:Rm}),Wm=Hl({batchNorm4d_:Am}),Vm=Hl({logicalAnd_:function(e,t){var n=Dl(e,"a","logicalAnd","bool"),r=Dl(t,"b","logicalAnd","bool");return _d(n.shape,r.shape),wu.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),Hm=Hl({logicalNot_:function(e){var t=Dl(e,"x","logicalNot","bool");return wu.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),qm=Hl({logicalOr_:function(e,t){var n=Dl(e,"a","logicalOr","bool"),r=Dl(t,"b","logicalOr","bool");return _d(n.shape,r.shape),wu.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),Gm=Hl({logicalXor_:function(e,t){var n=Dl(e,"a","logicalXor","bool"),r=Dl(t,"b","logicalXor","bool");return _d(n.shape,r.shape),qm(e,t).logicalAnd(Vm(e,t).logicalNot())}}),Km=Hl({where_:function(e,t,n){var r=Dl(t,"a","where"),o=Dl(n,"b","where"),a=Dl(e,"condition","where","bool");return hs(r.shape,o.shape,"Error in where: "),1===a.rank?ds(a.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):hs(a.shape,o.shape,"Error in where: "),wu.runKernelFunc(function(e,t){var n=e.select(a,r,o);return t([a]),n},{$condition:a,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return ic(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),Xm=function(e){return Yi(this,void 0,void 0,function(){var t,n,r;return $i(this,function(o){switch(o.label){case 0:return[4,(t=Dl(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=eh(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Ym=Hl({add_:function(e,t){var n,r=Dl(e,"a","add"),o=Dl(t,"b","add");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e){return e.add(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=kd(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=kd(o.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}},"Add")}}),$m=Hl({addN_:function(e){ds(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ds(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return Dl(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!vs(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return wu.runKernelFunc(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n},"AddN")}}),Jm=Hl({addStrict_:function(e,t){var n=Dl(e,"a","addStrict"),r=Dl(t,"b","addStrict");return hs(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Qm=Hl({atan2_:function(e,t){var n,r=Dl(e,"a","atan2"),o=Dl(t,"b","atan2");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Ym(n.square(),r.square()),o=e.mul(r.div(t)),i=kd(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var t=Ym(n.square(),r.square()),o=fm(e.mul(n.div(t))),i=kd(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}})}}),Zm=Hl({div_:function(e,t){var n,r=Dl(e,"a","div"),o=Dl(t,"b","div");if(n=mu(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return nv(r,o);var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=kd(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=kd(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}},"Div")}}),ev=Hl({divNoNan_:function(e,t){var n,r=Dl(e,"a","div"),o=Dl(t,"b","div");r=(n=mu(r,o))[0],o=n[1];var a=Zm(r,o),i=ic(a),s=o.equal(i);return Km(s,i,a)}}),tv=Hl({divStrict_:function(e,t){var n=Dl(e,"a","div"),r=Dl(t,"b","div");return hs(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),nv=Hl({floorDiv_:function(e,t){var n,r=Dl(e,"a","floorDiv"),o=Dl(t,"b","floorDiv");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=kd(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=kd(r.shape,a);o.length>0&&(t=t.sum(o).reshape(r.shape));var i=r.square();return t.div(i.toFloat()).neg()}}},"FloorDiv")}}),rv=Hl({maximum_:function(e,t){var n,r=Dl(e,"a","maximum"),o=Dl(t,"b","maximum");return n=mu(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),_d(r.shape,o.shape),wu.runKernelFunc(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),ov=Hl({maximumStrict_:function(e,t){var n=Dl(e,"a","maximumStrict"),r=Dl(t,"b","maximumStrict");return hs(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),av=Hl({minimum_:function(e,t){var n,r=Dl(e,"a","minimum"),o=Dl(t,"b","minimum");return n=mu(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),_d(r.shape,o.shape),wu.runKernelFunc(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),iv=Hl({minimumStrict_:function(e,t){var n=Dl(e,"a","minimumStrict"),r=Dl(t,"b","minimumStrict");return hs(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),sv=Hl({mod_:function(e,t){var n,r=Dl(e,"a","mod"),o=Dl(t,"b","mod");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=kd(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=kd(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),uv=Hl({modStrict_:function(e,t){var n=Dl(e,"a","modStrict"),r=Dl(t,"b","modStrict");return hs(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),lv=Hl({mul_:function(e,t){var n,r=Dl(e,"a","mul"),o=Dl(t,"b","mul");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=kd(n.shape,a);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=kd(r.shape,a);return o.length>0?t.sum(o).reshape(r.shape):t}}},"Mul")}}),cv=Hl({mulStrict_:function(e,t){var n=Dl(e,"a","mul"),r=Dl(t,"b","mul");return hs(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),dv=Hl({pow_:function(e,t){var n,r=Dl(e,"base","pow"),o=Dl(t,"exp","pow");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape),i=[r,o];return wu.runKernelFunc(function(e,t){var n=e.pow(r,o);return t([r,o,n]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub($l(1))))),i=kd(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var t=n.greater(0),i=n.log().where(t,ic(n)),s=e.mul(o.mul(i)),u=kd(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},i,[!0])}}),hv=Hl({powStrict_:function(e,t){return hs(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),fv=Hl({squaredDifferenceStrict_:function(e,t){var n=Dl(e,"a","squaredDifferenceStrict"),r=Dl(t,"b","squaredDifferenceStrict");return hs(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),pv=Hl({sub_:function(e,t){var n,r=Dl(e,"a","sub"),o=Dl(t,"b","sub");n=mu(r,o),r=n[0],o=n[1];var a=_d(r.shape,o.shape);return wu.runKernelFunc(function(e){return e.subtract(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=kd(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=kd(o.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}},"Sub")}}),mv=Hl({subStrict_:function(e,t){var n=Dl(e,"a","subStrict"),r=Dl(t,"b","subStrict");return hs(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),vv=Hl({equal_:function(e,t){var n,r=Dl(e,"a","equal"),o=Dl(t,"b","equal");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),gv=Hl({equalStrict_:function(e,t){var n=Dl(e,"a","equalStrict"),r=Dl(t,"b","equalStrict");return hs(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),yv=Hl({greater_:function(e,t){var n,r=Dl(e,"a","greater"),o=Dl(t,"b","greater");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e){return e.greater(r,o)},{a:r,b:o},null,"Greater")}}),bv=Hl({greaterEqual_:function(e,t){var n,r=Dl(e,"a","greaterEqual"),o=Dl(t,"b","greaterEqual");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return ic(n)},b:function(){return ic(r)}}},"GreaterEqual")}}),xv=Hl({greaterEqualStrict_:function(e,t){var n=Dl(e,"a","greaterEqualStrict"),r=Dl(t,"b","greaterEqualStrict");return hs(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),wv=Hl({greaterStrict_:function(e,t){var n=Dl(e,"a","greaterStrict"),r=Dl(t,"b","greaterStrict");return hs(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),kv=Hl({less_:function(e,t){var n,r=Dl(e,"a","less"),o=Dl(t,"b","less");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e){return e.less(r,o)},{a:r,b:o},null,"Less")}}),_v=Hl({lessEqual_:function(e,t){var n,r=Dl(e,"a","lessEqual"),o=Dl(t,"b","lessEqual");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n},{a:r,b:o},null,"LessEqual")}}),Ev=Hl({lessEqualStrict_:function(e,t){var n=Dl(e,"a","lessEqualStrict"),r=Dl(t,"b","lessEqualStrict");return hs(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Cv=Hl({lessStrict_:function(e,t){var n=Dl(e,"a","lessStrict"),r=Dl(t,"b","lessStrict");return hs(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Sv=Hl({notEqual_:function(e,t){var n,r=Dl(e,"a","notEqual"),o=Dl(t,"b","notEqual");return n=mu(r,o),r=n[0],o=n[1],_d(r.shape,o.shape),wu.runKernelFunc(function(e){return e.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),Nv=Hl({notEqualStrict_:function(e,t){var n=Dl(e,"a","notEqualStrict"),r=Dl(t,"b","notEqualStrict");return hs(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function Tv(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Iv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Rv=Hl({gather_:function(e,t,n){void 0===n&&(n=0);var r=Dl(e,"x","gather"),o=Dl(t,"indices","gather","int32");n=_s(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),i*=e.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return wu.runKernelFunc(function(e,t){var a=e.gather(r,o.flatten(),n);return t([o]),a},{x:r,indices:o},function(e,t){var o=t[0];return{x:function(){var t=r.shape,a=o.size,i=t.slice(0,n),s=i.length,u=t.slice(n,t.length).slice(1),l=u.length,c=Tv(0,s),d=Tv(s+1,s+1+l),h=Iv([i,[a],u]),f=e.reshape(h),p=o.reshape([a]),m=Iv([[s],c,d]),v=f.transpose(m),g=Av(v,p,r.shape[n]),y=Ul(m);return g.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(a.outputShape)}}),Av=Hl({unsortedSegmentSum_:function(e,t,n){var r=Dl(e,"x","unsortedSegmentSum"),o=Dl(t,"segmentIds","unsortedSegmentSum","int32");return ds(gs(n),function(){return"numSegments must be of dtype int"}),wu.runKernelFunc(function(e,t){var a=e.unsortedSegmentSum(r,o,n);return t([o]),a},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=rv(t,ic(t)),r=Rv(e,n),o=bv(t,$l(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Dc(o,i+1);o=Vm(o,tc(r.shape,"bool"));var s=ic(r);return Km(o,r,s)}(e,n)}}})}});function Dv(e,t,n,r,o,a,i){void 0===a&&(a="NHWC"),ds(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),ds(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),ds(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),ds(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c="NHWC"===a?s[3]:s[1],d="NHWC"===a?u.shape[3]:u.shape[1];ds(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),ds(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),null!=i&&ds(gs(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var h=Od(a),f=Sd(s,n.shape,r,1,o,i,!1,h),p=wu.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,f);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return Mv(e,n,r,o,a,1,i)},filter:function(){return Lv(e,s,n.shape,r,o,a,i)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Pv(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function jv(e,t,n,r,o){ds(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var a=e,i=t,s=!1;4===t.rank&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var u=a[4],l=i.shape[4];ds(5===a.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."}),ds(5===i.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),ds(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),ds(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),ds(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Nd(a,n.shape,r,1,o),d=wu.runKernelFunc(function(e){return e.conv3dDerInput(i,n,c)},{dy5D:i});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var Ov=Hl({conv1d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=Dl(e,"x","conv1d"),u=Dl(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),ds(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),ds(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=i&&ds(gs(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),ds(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),ds(jd(n,a),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"}),ds("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=Mv(h,d,[1,n],r,"NHWC",[1,a],i);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),Mv=Hl({conv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Dl(e,"x","conv2d"),u=Dl(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ds(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),ds(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=i&&ds(gs(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d="NHWC"===o?l.shape[3]:l.shape[1];ds(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),ds(jd(n,a),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"});var h=Od(o),f=Sd(l.shape,u.shape,n,a,r,i,!1,h),p=[u,l],m=wu.runKernelFunc(function(e,t){var n=e.conv2d(l,u,f);return t([u,l]),n},{x:l,filter:u},function(e,t){var i=t,s=i[0],u=i[1];return ds(Pd(a),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}),{x:function(){return Bv(u.shape,e,s,n,r,o)},filter:function(){return Lv(u,e,s.shape,n,r,o)}}},"Conv2D",f,p);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Fv=Hl({conv3d_:function(e,t,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=Dl(e,"x","conv3d"),s=Dl(t,"filter","conv3d"),u=i,l=!1;4===i.rank&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),ds(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),ds(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),ds(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),ds(function(e,t){return Pv(e)||Pv(t)}(n,a),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),ds("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=Nd(u.shape,s.shape,n,a,r),d=wu.runKernelFunc(function(e,t){var n=e.conv3d(u,s,c);return t([u,s]),n},{x:u,$filter:s},function(e,t){ds(Pv(a),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"});var o=t[0],i=t[1];return{x:function(){return jv(o.shape,e,i,n,r)},$filter:function(){return function(e,t,n,r,o){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var i=t;4===i.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),ds(5===a.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."}),ds(5===i.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."}),ds(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),ds(a.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."}),ds(i.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Nd(a.shape,n,r,1,o);return wu.runKernelFunc(function(e){return e.conv3dDerFilter(a,i,s)},{x5D:a,dy5D:i})}(o,e,i.shape,n,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Lv=Hl({conv2dDerFilter_:function(e,t,n,r,o,a,i){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),ds(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),ds(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),ds(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l="NHWC"===a?s.shape[3]:s.shape[1],c="NHWC"===a?u.shape[3]:u.shape[1];ds(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),ds(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),null!=i&&ds(gs(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var d=Od(a),h=Sd(s.shape,n,r,1,o,i,!1,d);return wu.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,h)},{x4D:s,dy4D:u})}}),Bv=Hl({conv2dDerInput_:Dv}),Uv=Hl({depthwiseConv2d_:function(e,t,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=Dl(e,"x","depthwiseConv2d"),u=Dl(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ds(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),ds(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),ds(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==a&&(a=[1,1]),ds(jd(n,a),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&ds(gs(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var d=Sd(l.shape,u.shape,n,a,r,i,!0),h=[l,u],f=wu.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(l,u,d);return t([l,u]),n},{x:l,filter:u},function(e,t){ds(Pd(a),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"});var n=t[0],r=t[1];return{x:function(){return zv(n.shape,e,r,d)},filter:function(){return Wv(n,e,r.shape,d)}}},"DepthwiseConv2dNative",d,h);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),zv=Hl({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,a=!1;3===t.rank&&(a=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=wu.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),Wv=Hl({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),wu.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,a,r)},{x4D:o,dy4D:a})}}),Vv=Hl({separableConv2d_:function(e,t,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=Dl(e,"x","separableConv2d"),u=Dl(t,"depthwiseFilter","separableConv2d"),l=Dl(n,"pointwiseFilter","separableConv2d"),c=s,d=!1;if(3===s.rank&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ds(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),ds(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),ds(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),ds(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),ds(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];ds(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var p=Uv(c,u,r,o,i,a),m=Mv(p,l,1,"valid",i);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Hv=Hl({conv2dTranspose_:function(e,t,n,r,o,a){return Dv(n,Dl(e,"x","conv2dTranspose"),Dl(t,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),qv=Hl({conv3dTranspose_:function(e,t,n,r,o){return jv(n,Dl(e,"x","conv3dTranspose"),Dl(t,"filter","conv3dTranspose"),r,o)}}),Gv=Hl({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=Dl(e,"a","matMul"),i=Dl(t,"b","matMul");o=mu(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=n?a.shape[a.rank-1]:a.shape[a.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],d=a.shape.slice(0,-2),h=i.shape.slice(0,-2),f=ms(d),p=ms(h);ds(a.rank>=2&&i.rank>=2&&a.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."}),ds(vs(d,h),function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."}),ds(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=a.shape.slice(0,-2).concat([l,c]),v=n?a.as3D(f,s,l):a.as3D(f,l,s),g=r?i.as3D(p,c,u):i.as3D(p,u,c),y={transposeA:n,transposeB:r};return wu.runKernelFunc(function(e,t){var o=e.batchMatMul(v,g,n,r);return t([v,g]),o},{a:v,b:g},function(e,t){var o=t,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return e.matMul(i,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return i.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(i,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),Kv=Hl({dot_:function(e,t){var n=Dl(e,"t1","dot"),r=Dl(t,"t2","dot");ds(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return ds(o===a,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Xv=Hl({outerProduct_:function(e,t){var n=Dl(e,"v1","outerProduct"),r=Dl(t,"v2","outerProduct");return ds(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Yv=Hl({reverse_:function(e,t){var n=Dl(e,"x","reverse");if(0===n.rank)return n.clone();var r=_s(t,n.shape);return wu.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),$v=Hl({reverse1d_:function(e){var t=Dl(e,"x","reverse");return ds(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Yv(t,0)}}),Jv=Hl({reverse2d_:function(e,t){var n=Dl(e,"x","reverse");return ds(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Yv(n,t)}}),Qv=Hl({reverse3d_:function(e,t){var n=Dl(e,"x","reverse");return ds(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Yv(n,t)}}),Zv=Hl({reverse4d_:function(e,t){var n=Dl(e,"x","reverse");return ds(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Yv(n,t)}});function eg(e,t,n,r,o,a){var i=Dl(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),ds(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),ds(jd(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=a&&ds(gs(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ed(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&vs(l.inShape,l.outShape))return i.clone();var c=[s],d=wu.runKernelFunc(function(e,t){var n=e.maxPool(s,l);return t([s,n]),n},{x:s},function(e,a){var i=a[0],s=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Dl(e,"dy","maxPoolBackprop"),l=Dl(t,"input","maxPoolBackprop"),c=Dl(n,"output","maxPoolBackprop");ds(l.rank===u.rank,function(){return"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"}),null==a&&(a=[1,1]),ds(jd(o,a),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),ds(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),ds(4===l.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."});var d=Ed(l.shape,r,o,a,i,s);return wu.runKernelFunc(function(e){return e.maxPoolBackprop(u,l,c,d)},{$dy:u,$input:l})}(e,i,s,t,n,r,o)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function tg(e,t,n,r,o,a){var i=Dl(e,"x","avgPool","float32");null==r&&(r=[1,1]),ds(jd(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ds(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=a&&ds(gs(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var l=Ed(s.shape,t,n,r,o,a);if(1===l.filterWidth&&1===l.filterHeight&&vs(l.inShape,l.outShape))return i.clone();var c=wu.runKernelFunc(function(e){return e.avgPool(s,l)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,a){var i=Dl(e,"dy","avgPoolBackprop"),s=Dl(t,"input","avgPoolBackprop");ds(s.rank===i.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"}),null==o&&(o=[1,1]),ds(jd(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,l=i,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ds(4===l.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."}),ds(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var d=Ed(u.shape,n,r,o,a),h=wu.runKernelFunc(function(e){return e.avgPoolBackprop(l,u,d)},{dy4D:l,input4D:u});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}(e,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var ng=Hl({maxPool_:function(e,t,n,r,o){return eg(e,t,n,1,r,o)}}),rg=Hl({avgPool_:function(e,t,n,r,o){return tg(e,t,n,1,r,o)}}),og=Hl({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=Dl(e,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ds(jd(a,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"});var l,c=Ed(s.shape,t,a,o,r),d=[c.dilationHeight,c.dilationWidth];l="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var h=1===d[0]&&1===d[1],f=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),a=e.concat(r,o),i=t.map(function(e,t){return(e-a[t]%e)%e}),s=o.map(function(e,t){return e+i[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,i[t]]})]}([c.inHeight,c.inWidth],d,l),p=f[0],m=f[1],v=h?r:"valid",g=h?s:Gc(s,d,p),y=("avg"===n?function(){return tg(g,t,a,1,v)}:function(){return eg(g,t,a,1,v)})(),b=h?y:Sc(y,d,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),ag=Hl({maxPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Dl(e,"x","maxPool3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),ds(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),ds("NDHWC"===a,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),ds(jd(n,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&ds(gs(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Cd(u.shape,t,n,i,r,o,a),d=wu.runKernelFunc(function(e,t){var n=e.maxPool3d(u,c);return t([u,n]),n},{x:u},function(e,a){var s=a[0],u=a[1];return{x:function(){return function(e,t,n,r,o,a,i,s){var u=Dl(e,"dy","maxPool3dBackprop"),l=Dl(t,"input","maxPool3dBackprop"),c=Dl(n,"output","maxPool3dBackprop"),d=u,h=l,f=c,p=!1;4===l.rank&&(p=!0,d=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),ds(5===d.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+d.rank+"."}),ds(5===h.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."}),ds(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),null==a&&(a=[1,1,1]),ds(jd(o,a),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"}),null!=s&&ds(gs(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var m=Cd(h.shape,r,o,a,i,s),v=wu.runKernelFunc(function(e){return e.maxPool3dBackprop(d,h,f,m)},{dy5D:d,input5D:h});return p?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(e,s,u,t,n,i,r,o)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),ig=Hl({avgPool3d_:function(e,t,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=Dl(e,"x","avgPool3d","float32"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),ds(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),ds("NDHWC"===a,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a}),ds(jd(n,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=o&&ds(gs(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Cd(u.shape,t,n,i,r,o,a),d=wu.runKernelFunc(function(e){return e.avgPool3d(u,c)},{x:u},function(e){return{x:function(){return function(e,t,n,r,o,a,i){var s=Dl(e,"dy","avgPool3dBackprop"),u=Dl(t,"input","avgPool3dBackprop"),l=s,c=u,d=!1;4===u.rank&&(d=!0,l=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),c=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),ds(5===l.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."}),ds(5===c.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."}),null==o&&(o=[1,1,1]),ds(jd(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=i&&ds(gs(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var h=Cd(c.shape,n,r,o,a,i),f=wu.runKernelFunc(function(e){return e.avgPool3dBackprop(l,c,h)},{dy5D:l,input5D:c});return d?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(e,u,t,n,i,r,o)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),sg=Hl({slice_:function(e,t,n){var r,o,a=Dl(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach(function(e){ds(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(ds(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),a.shape[t]-r[t])}),ud(a,r,o);var i=a.shape,s={begin:r,size:o};return wu.runKernelFunc(function(e){return e.slice(a,r,o)},{x:a},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return e.pad(t)}}},"Slice",s)}}),ug=Hl({slice1d_:function(e,t,n){var r=Dl(e,"x","slice1d");return ds(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),sg(r,[t],[n])}}),lg=Hl({slice2d_:function(e,t,n){var r=Dl(e,"x","slice2d");return ds(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),sg(r,t,n)}}),cg=Hl({slice3d_:function(e,t,n){var r=Dl(e,"x","slice3d");return ds(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),sg(r,t,n)}}),dg=Hl({slice4d_:function(e,t,n){var r=Dl(e,"x","slice4d");return ds(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),sg(r,t,n)}});function hg(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(Fl(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Fl(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var fg=Hl({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","all","bool"),o=_s(t,r.shape),a=o,i=Bl(a,r.rank);null!=i&&(r=r.transpose(i),a=zl(a.length,r.rank));var s=wu.runKernelFunc(function(e){return e.all(r,a)},{$x:r});if(n){var u=Fl(s.shape,o);return s.reshape(u)}return s}}),pg=Hl({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","any","bool"),o=_s(t,r.shape),a=o,i=Bl(a,r.rank);null!=i&&(r=r.transpose(i),a=zl(a.length,r.rank));var s=wu.runKernelFunc(function(e){return e.any(r,a)},{$x:r});if(n){var u=Fl(s.shape,o);return s.reshape(u)}return s}}),mg=Hl({argMax_:function(e,t){void 0===t&&(t=0);var n=Dl(e,"x","argMax");null==t&&(t=0);var r=_s(t,n.shape),o=Bl(r,n.rank);null!=o&&(n=n.transpose(o),r=zl(r.length,n.rank));var a={axis:r[0]},i=[n];return wu.runKernelFunc(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{x:n},function(e,t){var n=t[0];return{x:function(){return ic(n)}}},"ArgMax",a,i)}}),vg=Hl({argMin_:function(e,t){void 0===t&&(t=0);var n=Dl(e,"x","argMin");null==t&&(t=0);var r=_s(t,n.shape),o=Bl(r,n.rank);return null!=o&&(n=n.transpose(o),r=zl(r.length,n.rank)),wu.runKernelFunc(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return ic(n)}}})}}),gg=Hl({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","logSumExp"),o=_s(t,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=Fl(s.shape,o);return s.reshape(u)}return s}}),yg=Hl({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","max"),o=r,a=_s(t,r.shape),i=a,s=Bl(i,r.rank);null!=s&&(r=r.transpose(s),i=zl(i.length,r.rank));var u=[r],l=wu.runKernelFunc(function(e,t){var n=e.max(r,i);return t([o,n]),n},{x:r},function(e,t){return hg(e,t[1],t[0],a,s)},"Max",{axes:i},u,[!0]);if(n){var c=Fl(l.shape,a);l=l.reshape(c)}return l}}),bg=Hl({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","mean"),o=_s(t,r.shape),a=ms(Ml(r.shape,o)[1]);return md(function(e){var r=$l(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(tc(e.shape,"float32")).div(a)}}})(r)}}),xg=Hl({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","min"),o=r,a=_s(t,r.shape),i=a,s=Bl(i,r.rank);null!=s&&(r=r.transpose(s),i=zl(i.length,r.rank));var u=[r],l=wu.runKernelFunc(function(e,t){var n=e.min(r,i);return t([o,n]),n},{x:r},function(e,t){return hg(e,t[1],t[0],a,s)},"Min",{axes:i},u,[!0]);if(n){var c=Fl(l.shape,a);l=l.reshape(c)}return l}}),wg=Hl({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=_s(t,(e=Dl(e,"x","moments")).shape),o=e.mean(r,n),a=o.shape;n||(a=Fl(o.shape,r));var i=e.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),kg=Hl({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=_s(t,r.shape);return md(function(e){var t=Bl(o,e.rank),r=o,a=e;null!=t&&(a=e.transpose(t),r=zl(r.length,e.rank));var i=function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(tc(e.shape,"float32"))},s={axes:r},u=wu.runKernelFunc(function(e){return e.sum(a,r)},{x:a},function(e){return{x:function(){return i(e)}}},"Sum",s);if(n){var l=Fl(u.shape,o);u=u.reshape(l)}return{value:u,gradFunc:i}})(r)}}),_g=Hl({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Dl(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=_s(t,r.shape),a=Bl(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=zl(i.length,r.rank));var u=wu.runKernelFunc(function(e){return e.prod(s,i)},{permutedX:s});if(n){var l=Fl(u.shape,o);u=u.reshape(l)}return u}}),Eg=Hl({elu_:function(e){var t=Dl(e,"x","elu");return wu.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return wu.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),Cg=Hl({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Dl(e,"x","leakyRelu");return rv($l(t).mul(n),n)}}),Sg=Hl({prelu_:function(e,t){var n=Dl(e,"x","prelu"),r=Dl(t,"alpha","prelu");return wu.runKernelFunc(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return Km(o,e,e.mul(r))},alpha:function(){var t=Km(o,ic(e),e.mul(n)),a=kd(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}},"Prelu")}}),Ng=Hl({relu_:function(e){var t=Dl(e,"x","relu");return"bool"===t.dtype?t.toInt():wu.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),Tg=Hl({relu6_:function(e){var t=Dl(e,"x","relu6");return"bool"===t.dtype?t.toInt():wu.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),Ig=Hl({selu_:function(e){var t=Dl(e,"x","selu");return wu.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater($l(0)),r=$l(mp),o=$l(vp),a=e.mul(o),i=e.mul(r).mul(n.toFloat().exp());return Km(t,a,i)}}})}}),Rg=Hl({transpose_:function(e,t){var n=Dl(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),ds(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){ds(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return wu.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},function(e){var n=Ul(t);return{x:function(){return e.transpose(n)}}},"Transpose",r)}}),Ag=Hl({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=Dl(e,"x","localResponseNormalization");ds(4===a.rank||3===a.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."}),ds(gs(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=wu.runKernelFunc(function(e,a){var s=e.localResponseNormalization4D(i,t,n,r,o);return a([i,s]),s},{x4D:i},function(e,a){var i=a[0],s=a[1];return{x4D:function(){return wu.runKernelFunc(function(a){return a.LRNGrad(e,i,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Dg=Hl({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow($l(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Dl(e,"x","norm"),t,n),a=o.shape;if(r){var i=_s(n,e.shape);a=Fl(o.shape,i)}return o.reshape(a)}}),Pg=Hl({basicLSTMCell_:function(e,t,n,r,o,a){var i=Dl(e,"forgetBias","basicLSTMCell"),s=Dl(t,"lstmKernel","basicLSTMCell"),u=Dl(n,"lstmBias","basicLSTMCell"),l=Dl(r,"data","basicLSTMCell"),c=Dl(o,"c","basicLSTMCell"),d=Dl(a,"h","basicLSTMCell"),h=l.concat(d,1).matMul(s).add(u),f=h.shape[0],p=h.shape[1]/4,m=[f,p],v=h.slice([0,0],m),g=h.slice([0,p],m),y=h.slice([0,2*p],m),b=h.slice([0,3*p],m),x=v.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(i.add(y).sigmoid())),w=x.tanh().mulStrict(b.sigmoid());return[x,w]}}),jg=Hl({multiRNNCell_:function(e,t,n,r){for(var o=Dl(t,"data","multiRNNCell"),a=Pl(n,"c","multiRNNCell"),i=Pl(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,a[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var d=[],h=[];for(l=0;l<u.length;l+=2)d.push(u[l]),h.push(u[l+1]);return[d,h]}}),Og=Hl({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var a=Dl(e,"v","movingAverage"),i=Dl(t,"x","movingAverage"),s=Dl(n,"decay","movingAverage");vu(a,i),ds(vs(a.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=$l(1),l=u.sub(s),c=i.sub(a).mul(l);if(o){ds(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=Dl(r,"step","movingAverage");c=c.div(u.sub(dv(s,d)))}return a.add(c)}}),Mg=Hl({stridedSlice_:function(e,t,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var l=Dl(e,"x","stridedSlice"),c=ld(s),d=l.shape.slice();c.forEach(function(e){t[e]=0,n[e]=1,d.splice(e,0,1)}),l=l.reshape(d);for(var h=0;h<l.rank;h++)t[h]=dd(o,t,r,l.shape,h),n[h]=hd(a,n,r,l.shape,h),r[h]=r[h]||1;var f=ld(u);f.forEach(function(e){n[e]=t[e]+1,r[e]=1});var p=cd(t,n,r),m=p.filter(function(e,t){return-1===f.indexOf(t)});return r.every(function(e){return 1===e})?sg(l,t,p).reshape(m):wu.runKernelFunc(function(e){return e.stridedSlice(l,t,n,r)},{$x:l}).reshape(m)}}),Fg=Hl({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Dl(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var a=wu.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:a[0],indices:a[1]}}}),Lg=Hl({scatterND_:function(e,t,n){var r=Dl(e,"indices","scatterND","int32"),o=Dl(t,"updates","scatterND");return id(o,r,n),wu.runKernelFunc(function(e){return e.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Bg=Hl({fft_:function(e){ds("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return wu.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),Ug=Hl({ifft_:function(e){ds("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return wu.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),zg=Hl({rfft_:function(e,t){ds("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var a=e.shape.map(function(e){return 0}),i=e.shape.map(function(e){return e});i[e.shape.length-1]=t,n=e.slice(a,i),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(nc(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=ql(n,u).as2D(o,r),c=Bg(l),d=Math.floor(r/2)+1,h=Gl(c),f=Kl(c),p=h.split([d,r-d],h.shape.length-1),m=f.split([d,r-d],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,ql(p[0],m[0]).reshape(v)}}),Wg=Hl({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=Ug(r);return Gl(o)}var a=[n,2*(t-1)],i=Gl(e).as2D(n,t),s=Kl(e).as2D(n,t),u=i.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul($l(-1)),c=i.concat(u,1),d=s.concat(l,1);return r=ql(c,d).as2D(a[0],a[1]),o=Ug(r),Gl(o)}}),Vg=Object.freeze({fft:Bg,ifft:Ug,rfft:zg,irfft:Wg}),Hg=Hl({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=Dl(e,"sparseIndices","sparseToDense","int32"),a=Dl(t,"sparseValues","sparseToDense"),i=Dl(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=t.size;if(0!==t.rank&&(1!==t.rank||i!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),wu.runKernelFunc(function(e){return e.sparseToDense(o,a,n,i)},{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),qg=Hl({gatherND_:function(e,t){var n=Dl(t,"indices","gatherND","int32"),r=Dl(e,"x","gatherND");return wu.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),Gg=Hl({diag_:function(e){var t=Dl(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return wu.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),Kg=Hl({dropout_:function(e,t,n,r){var o=Dl(e,"x","dropout");if(ds("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),ds(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof au?o.clone():o;var a=function(e,t){if(null==t)return e.shape.slice();if(vs(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),i=1-t,s=Hc(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function Xg(e,t,n){for(var r=1-e%2,o=new Float32Array(e),a=0;a<e;++a){var i=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(i)}return Jl(o,"float32")}var Yg,$g=Hl({hannWindow_:function(e){return Xg(e,.5,.5)}}),Jg=Hl({hammingWindow_:function(e){return Xg(e,.54,.46)}}),Qg=Hl({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+t<=e.size;)i.push(sg(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,u=sc([sg(e,a,t-s),rc([s],o)]);i.push(u),a+=n}return 0===i.length?Ql([],[0,t]):sc(i).as2D(i.length,t)}}),Zg=Hl({stft_:function(e,t,n,r,o){var a;void 0===o&&(o=$g),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=Qg(e,t,n),s=lv(i,o(t)),u=[],l=0;l<i.shape[0];l++)u.push(zg(s.slice([l,0],[1,t]),r));return sc(u)}}),ey=Object.freeze({hannWindow:$g,hammingWindow:Jg,frame:Qg,stft:Zg});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Yg||(Yg={}));var ty=Hl({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Yg.SUM_BY_NONZERO_WEIGHTS);var o=Dl(e,"labels","absoluteDifference"),a=Dl(t,"predictions","absoluteDifference"),i=null;null!=n&&(i=Dl(n,"weights","absoluteDifference")),hs(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return ny(s,i,r)}}),ny=Hl({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Yg.SUM_BY_NONZERO_WEIGHTS);var r=Dl(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=Dl(t,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===Yg.NONE)return a;if(n===Yg.SUM)return a.sum();if(n===Yg.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div($l(i)):s}if(n===Yg.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div($l(r.size));var u=o.mul(tc(r.shape)).notEqual($l(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),ry=Hl({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=Yg.SUM_BY_NONZERO_WEIGHTS);var a=Dl(e,"labels","cosineDistance"),i=Dl(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Dl(r,"weights","cosineDistance")),hs(a.shape,i.shape,"Error in cosineDistance: ");var u=$l(1).sub(a.mul(i).sum(n,!0));return ny(u,s,o)}}),oy=Hl({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Yg.SUM_BY_NONZERO_WEIGHTS);var o=Dl(e,"labels","hingeLoss"),a=Dl(t,"predictions","hingeLoss"),i=null;null!=n&&(i=Dl(n,"weights","hingeLoss")),hs(o.shape,a.shape,"Error in hingeLoss: ");var s=$l(1);o=$l(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return ny(u,i,r)}}),ay=Hl({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Yg.SUM_BY_NONZERO_WEIGHTS);var a=Dl(e,"labels","huberLoss"),i=Dl(t,"predictions","huberLoss"),s=null;null!=n&&(s=Dl(n,"weights","huberLoss")),hs(a.shape,i.shape,"Error in huberLoss: ");var u=$l(r),l=i.sub(a).abs(),c=av(l,u),d=l.sub(c),h=$l(.5).mul(c.square()).add(u.mul(d));return ny(h,s,o)}}),iy=Hl({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Yg.SUM_BY_NONZERO_WEIGHTS);var a=Dl(e,"labels","logLoss"),i=Dl(t,"predictions","logLoss"),s=null;null!=n&&(s=Dl(n,"weights","logLoss")),hs(a.shape,i.shape,"Error in logLoss: ");var u=$l(1),l=$l(r),c=a.mul(i.add(l).log()).neg().sub(u.sub(a).mul(u.sub(i).add(l).log()));return ny(c,s,o)}}),sy=Hl({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Yg.SUM_BY_NONZERO_WEIGHTS);var o=Dl(e,"labels","meanSquaredError"),a=Dl(t,"predictions","meanSquaredError"),i=null;null!=n&&(i=Dl(n,"weights","meanSquaredError")),hs(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return ny(s,i,r)}}),uy=Hl({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Yg.SUM_BY_NONZERO_WEIGHTS);var a=Dl(e,"multiClassLabels","sigmoidCrossEntropy"),i=Dl(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Dl(n,"weights","sigmoidCrossEntropy")),hs(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=$l(r),l=$l(1),c=$l(.5);a=a.mul(l.sub(u)).add(c.mul(u))}var d=function(e,t){var n=Dl(e,"labels","sigmoidCrossEntropyWithLogits"),r=Dl(t,"logits","sigmoidCrossEntropyWithLogits");hs(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return ny(d,s,o)}}),ly=Hl({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Yg.SUM_BY_NONZERO_WEIGHTS);var a=Dl(e,"onehotLabels","softmaxCrossEntropy"),i=Dl(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Dl(n,"weights","softmaxCrossEntropy")),hs(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=$l(r),l=$l(1),c=$l(a.shape[1]);a=a.mul(l.sub(u)).add(u.div(c))}var d=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return md(function(e,t,r){var o=t.logSumExp([n],!0),a=t.toFloat().sub(o);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],a=Fl(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(o.exp())),e.reshape(a).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(a,i);return ny(d,s,o)}}),cy=Object.freeze({get Reduction(){return Yg},absoluteDifference:ty,computeWeightedLoss:ny,cosineDistance:ry,hingeLoss:oy,huberLoss:ay,logLoss:iy,meanSquaredError:sy,sigmoidCrossEntropy:uy,softmaxCrossEntropy:ly});function dy(e,t){return void 0===t&&(t=!1),wu.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=Pc(n),a=e.clone(),i=Ql([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,l=function(e){var t,u=a,l=s,c=o;t=wu.tidy(function(){var t=a.slice([e,e],[n-e,1]),u=t.norm(),l=a.slice([e,e],[1,1]),c=Ql([[-1]]).where(l.greater(0),Ql([[1]])),d=l.sub(c.mul(u)),h=t.div(d);s=1===h.shape[0]?i.clone():i.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=c.matMul(d).div(u).neg(),p=a.slice([e,0],[n-e,r]),m=f.mul(s);if(0===e)a=p.sub(m.matMul(s.transpose().matMul(p)));else{var v=p.sub(m.matMul(s.transpose().matMul(p)));a=a.slice([0,0],[e,r]).concat(v,0)}var g=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=g.sub(g.matMul(s).matMul(m.transpose()));else{var y=g.sub(g.matMul(s).matMul(m.transpose()));o=o.slice([0,0],[n,e]).concat(y,1)}return[s,a,o]}),s=t[0],a=t[1],o=t[2],Tl([u,l,c])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]})}var hy=Hl({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=Dl(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),n<0&&(n=s);var u=oc(0,i,1,"int32").reshape([-1,1]),l=oc(0,s,1,"int32"),c=pv(u,l),d=Vm(c.lessEqual($l(+t,"int32")),c.greaterEqual($l(-n,"int32"))),h=nc([i,s],r.dtype);return Xc(Jc(r.reshape([-1,i,s])).map(function(e){return Km(d,e,h)})).reshape(o)}}),fy=Hl({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,ds(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){ds(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=hc(e,e.shape[0],0).map(function(e){return Kc(e,[0])});ds(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var a=[],i=e,s=function(e){a.push(wu.tidy(function(){var t=i[e];if(e>0)for(var n=0;n<e;++n){var r=kg(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(Dg(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Xc(a,0):a}}),py=Hl({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return dy(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=Jc(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return r.forEach(function(e){var n=dy(e,t),r=n[0],i=n[1];o.push(r),a.push(i)}),[Xc(o,0).reshape(e.shape),Xc(a,0).reshape(e.shape)]}}),my=Object.freeze({bandPart:hy,gramSchmidt:fy,qr:py});function vy(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=e.shape[0];return n=Math.min(n,i),ds(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),ds(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),ds(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),ds(1===t.rank,function(){return"scores must be a 1D tensor"}),ds(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),ds(0<=a&&a<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var gy=Hl({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Dl(e,"images","resizeBilinear");ds(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),ds(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=wu.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,i,s,n)},{x:o},function(e,t){return{x:function(){return wu.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),yy=Hl({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Dl(e,"images","resizeNearestNeighbor");ds(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),ds(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),ds("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=wu.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,i,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return wu.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),by=Hl({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=Dl(e,"boxes","nonMaxSuppression"),i=Dl(t,"scores","nonMaxSuppression"),s=vy(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return wu.runKernelFunc(function(e){return e.nonMaxSuppression(a,i,n,r,o)},{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),xy=Hl({nonMaxSuppressionWithScore_:function(e,t,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=Dl(e,"boxes","nonMaxSuppression"),s=Dl(t,"scores","nonMaxSuppression"),u=vy(i,s,n,r,o,a),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},c=wu.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),wy=Hl({cropAndResize_:function(e,t,n,r,o,a){var i=Dl(e,"image","cropAndResize"),s=Dl(t,"boxes","cropAndResize","float32"),u=Dl(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var l=s.shape[0];return ds(4===i.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),ds(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),ds(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),ds(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),ds(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),ds("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),wu.runKernelFunc(function(e,t){return e.cropAndResize(i,s,u,r,o,a)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),ky=Object.freeze({resizeBilinear:gy,resizeNearestNeighbor:yy,nonMaxSuppression:by,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),Yi(this,void 0,void 0,function(){var a,i,s,u,l,c,d;return $i(this,function(h){switch(h.label){case 0:return a=Dl(e,"boxes","nonMaxSuppressionAsync"),i=Dl(t,"scores","nonMaxSuppressionAsync"),s=vy(a,i,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([a.data(),i.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],d=qd(l,c,n,r,o),a!==e&&a.dispose(),i!==t&&i.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:xy,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,a){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),Yi(this,void 0,void 0,function(){var i,s,u,l,c,d,h;return $i(this,function(f){switch(f.label){case 0:return i=Dl(e,"boxes","nonMaxSuppressionAsync"),s=Dl(t,"scores","nonMaxSuppressionAsync"),u=vy(i,s,n,r,o,a),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,a=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=f.sent(),c=l[0],d=l[1],h=Gd(c,d,n,r,o,a),i!==e&&i.dispose(),s!==t&&s.dispose(),[2,h]}})})},cropAndResize:wy}),_y=function(e,t){return!(e>0)||"linear"===t},Ey=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Cy=function(e,t){var n=t,r=kd(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Sy=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Ng(e);if("elu"===t)return Eg(e);if("relu6"===t)return Tg(e);if("prelu"===t)return Sg(e,n);throw new Error("Unknown fused activation "+t+".")},Ny=Hl({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,a=void 0!==o&&o,i=e.transposeB,s=void 0!==i&&i,u=e.bias,l=e.activation,c=void 0===l?"linear":l,d=e.preluActivationWeights;if(!1===_y(wu.state.gradientDepth,c)){var h=Gv(n,r,a,s);return null!=u&&(h=Ym(h,u)),Sy(h,c,d)}var f=Dl(n,"a","fused matMul"),p=Dl(r,"b","fused matMul");t=mu(f,p),f=t[0],p=t[1];var m=a?f.shape[f.rank-2]:f.shape[f.rank-1],v=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=a?f.shape[f.rank-1]:f.shape[f.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=f.shape.slice(0,-2),x=p.shape.slice(0,-2),w=ms(b),k=ms(x);ds(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),ds(vs(b,x),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+x+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),ds(m===v,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."});var _,E,C=f.shape.slice(0,-2).concat([g,y]),S=a?f.as3D(w,m,g):f.as3D(w,g,m),N=s?p.as3D(k,y,v):p.as3D(k,v,y);null!=u&&_d(C,(_=mu(_=Dl(u,"bias","fused matMul"),f)[0]).shape),null!=d&&(E=Dl(d,"prelu weights","fused matMul"));var T={a:S,b:N};null!=u&&(T.bias=_),null!=d&&(T.preluActivationWeights=E);var I=[S,N];return wu.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:S,b:N,transposeA:a,transposeB:s,bias:_,activation:c,preluActivationWeights:E});return t([S,N,n]),n},T,function(e,t){var n=t[0],r=t[1],o=t[2],i=Ey(e,o,c),l={};return null!=u&&(l={bias:function(){return Cy(_,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},l):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},l):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},l):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},l)},"_FusedMatMul",{transposeA:a,transposeB:s,activation:c},I,[!0]).reshape(C)}}),Ty=Hl({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,h=void 0===d?"linear":d,f=e.preluActivationWeights;if(h=h||"linear",!1===_y(wu.state.gradientDepth,h)){var p=Mv(t,n,r,o,i,u,l);return null!=c&&(p=Ym(p,c)),Sy(p,h,f)}var m=Dl(t,"x","conv2d"),v=Dl(n,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),ds(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),ds(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=l&&ds(gs(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),ds(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),ds(jd(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),ds("NHWC"===i,function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var b,x,w=Sd(g.shape,v.shape,r,u,o,l);null!=c&&(b=mu(b=Dl(c,"bias","fused conv2d"),m)[0],_d(w.outShape,b.shape)),null!=f&&(x=Dl(f,"prelu weights","fused conv2d"));var k={x:g,filter:v};null!=c&&(k.bias=b),null!=f&&(k.preluActivationWeights=x);var _=[v,g],E=wu.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:g,filter:v,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return t([v,g,n]),n},k,function(e,t){var n=t,a=n[0],i=n[1],s=n[2],l=Ey(e,s,h);ds(Pd(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var d={};return null!=c&&(d={bias:function(){return Cy(b,l)}}),Object.assign({x:function(){return Bv(i.shape,l,a,r,o)},filter:function(){return Lv(i,l,a.shape,r,o)}},d)},"FusedConv2D",{convInfo:w,activation:h},_,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Iy=Hl({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,a=e.dataFormat,i=void 0===a?"NHWC":a,s=e.dilations,u=void 0===s?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,h=void 0===d?"linear":d,f=e.preluActivationWeights;if(!1===_y(wu.state.gradientDepth,h)){var p=Uv(t,n,r,o,i,u,l);return null!=c&&(p=Ym(p,c)),Sy(p,h,f)}var m=Dl(t,"x","depthwiseConv2d"),v=Dl(n,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),ds(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),ds(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),ds(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),ds(jd(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=l&&ds(gs(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var b,x,w=Sd(g.shape,v.shape,r,u,o,l,!0);null!=c&&(b=mu(b=Dl(c,"bias","fused conv2d"),m)[0],_d(w.outShape,b.shape)),null!=f&&(x=Dl(f,"prelu weights","fused depthwiseConv2d"));var k={x:g,filter:v};null!=c&&(k.bias=b),null!=f&&(k.preluActivationWeights=x);var _=[v,g],E=wu.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:v,convInfo:w,bias:b,activation:h,preluActivationWeights:x});return t([v,g,n]),n},k,function(e,t){ds(Pd(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],o=t[2],a=Ey(e,o,h),i={};return null!=c&&(i={bias:function(){return Cy(b,a)}}),Object.assign({x:function(){return zv(r.shape,a,n,w)},filter:function(){return Wv(r,a,n.shape,w)}},i)},"FusedDepthwiseConv2D",{convInfo:w,activation:h},_,[!0]);return y?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),Ry=Object.freeze({matMul:Ny,conv2d:Ty,depthwiseConv2d:Iy}),Ay=Object.freeze({image:ky,linalg:my,losses:cy,spectral:Vg,fused:Ry,signal:ey,square:Gp,squaredDifference:Xp,conv1d:Ov,conv2d:Mv,conv3d:Fv,depthwiseConv2d:Uv,separableConv2d:Vv,conv2dTranspose:Hv,conv3dTranspose:qv,op:Hl,batchNormalization2d:Om,batchNormalization3d:Mm,batchNormalization4d:Fm,batchNormalization:Lm,batchNorm:Bm,batchNorm2d:Um,batchNorm3d:zm,batchNorm4d:Wm,booleanMaskAsync:function(e,t,n){return Yi(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,h,f,p,m;return $i(this,function(v){switch(v.label){case 0:for(r=Dl(e,"tensor","boolMask"),o=Dl(t,"mask","boolMask","bool"),a=null==n?0:n,i=o.rank,s=r.shape,ds(i>0,function(){return"mask cannot be scalar"}),hs(s.slice(a,a+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=a;l<a+i;l++)u*=s[l];return c=s.slice(0,a).concat([u],s.slice(a+i)),d=r.reshape(c),h=o.reshape([-1]),[4,Xm(h)];case 1:return f=v.sent(),p=f.squeeze([1]),m=Rv(d,p,a),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,m]}})})},complex:ql,real:Gl,imag:Kl,concat:sc,concat1d:uc,concat2d:lc,concat3d:cc,concat4d:dc,split:hc,matMul:Gv,dot:Kv,outerProduct:Xv,reverse:Yv,reverse1d:$v,reverse2d:Jv,reverse3d:Qv,reverse4d:Zv,maxPool:ng,avgPool:rg,pool:og,maxPool3d:ag,avgPool3d:ig,slice:sg,slice1d:ug,slice2d:lg,slice3d:cg,slice4d:dg,abs:Yp,acos:$p,acosh:Jp,asin:Qp,asinh:Zp,atan:em,atanh:tm,ceil:nm,clipByValue:rm,cos:om,cosh:am,erf:im,exp:sm,expm1:um,floor:lm,log:cm,log1p:dm,logSigmoid:hm,neg:fm,reciprocal:pm,round:mm,rsqrt:vm,sigmoid:gm,sign:ym,isNaN:bm,isInf:xm,isFinite:wm,sin:km,sinh:_m,softplus:Em,sqrt:Cm,step:Sm,tan:Nm,tanh:Tm,all:fg,any:pg,argMax:mg,argMin:vg,logSumExp:gg,max:yg,mean:bg,min:xg,moments:wg,sum:kg,prod:_g,equal:vv,equalStrict:gv,greater:yv,greaterEqual:bv,greaterEqualStrict:xv,greaterStrict:wv,less:kv,lessEqual:_v,lessEqualStrict:Ev,lessStrict:Cv,notEqual:Sv,notEqualStrict:Nv,add:Ym,addN:$m,addStrict:Jm,atan2:Qm,div:Zm,divNoNan:ev,divStrict:tv,floorDiv:nv,maximum:rv,maximumStrict:ov,minimum:av,minimumStrict:iv,mod:sv,modStrict:uv,mul:lv,mulStrict:cv,pow:dv,powStrict:hv,squaredDifferenceStrict:fv,sub:pv,subStrict:mv,elu:Eg,leakyRelu:Cg,prelu:Sg,relu:Ng,relu6:Tg,selu:Ig,logicalAnd:Vm,logicalNot:Hm,logicalOr:qm,logicalXor:Gm,where:Km,whereAsync:Xm,buffer:Cc,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Sc,broadcastTo:Nc,cast:Tc,clone:Ic,cumsum:Rc,depthToSpace:Ac,expandDims:Dc,eye:Pc,multinomial:jc,oneHot:Oc,pad:Mc,pad1d:Fc,pad2d:Lc,pad3d:Bc,pad4d:Uc,rand:zc,randomNormal:Wc,randomGamma:Vc,randomUniform:Hc,reshape:qc,spaceToBatchND:Gc,squeeze:Kc,stack:Xc,tile:Yc,truncatedNormal:$c,unstack:Jc,setdiff1dAsync:function(e,t){return Yi(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d;return $i(this,function(h){switch(h.label){case 0:return n=Dl(e,"x","setdiff1d"),r=Dl(t,"y","setdiff1d"),ds(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),ds(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),ds(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(a=h.sent(),i=new Set(a),s=0,c=0;c<o.length;c++)i.has(o[c])||s++;for(u=new tu([s],n.dtype),l=new tu([s],"int32"),c=0,d=0;c<o.length;c++)i.has(o[c])||(u.values[d]=o[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:rc,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return wu.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:tc,range:oc,scalar:$l,tensor:Xl,tensor1d:Jl,tensor2d:Ql,tensor3d:Zl,tensor4d:ec,tensor5d:function(e,t,n){if(fs(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Rl(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Yl(e,t,r,n)},tensor6d:function(e,t,n){if(fs(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Rl(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Yl(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),wu.makeVariable(e,t,n,r)},zeros:nc,onesLike:ac,zerosLike:ic,transpose:Rg,softmax:vd,logSoftmax:gd,localResponseNormalization:Ag,norm:Dg,gather:Rv,unsortedSegmentSum:Av,basicLSTMCell:Pg,multiRNNCell:jg,movingAverage:Og,stridedSlice:Mg,topk:Fg,scatterND:Lg,fft:Bg,ifft:Ug,rfft:zg,irfft:Wg,sparseToDense:Hg,gatherND:qg,diag:Gg,dropout:Kg,hannWindow:$g,hammingWindow:Jg,frame:Qg,stft:Zg,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),Yi(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,h,f,p,m,v;return $i(this,function(g){switch(g.label){case 0:return r=Dl(e,"predictions","inTopK"),o=Dl(t,"targets","inTopK"),ds(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),ds(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),hs(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],ds(n>0&&n<=a,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n}),[4,r.data()];case 1:return i=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[i.length/a,a],c=u[1],d=Cs("bool",l=u[0]),h=0;h<l;h++){for(f=h*c,p=i.subarray(f,f+c),m=[],v=0;v<p.length;v++)m.push({value:p[v],index:v});for(m.sort(function(e,t){return t.value-e.value}),d[h]=0,v=0;v<n;v++)if(m[v].index===s[h]){d[h]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,Xl(d,o.shape,"bool")]}})})}});function Dy(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&ds("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function Py(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var jy=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new yd(t,wu),t}return Xi(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,Qi().get("IS_NODE")&&Il("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Bd(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return Ks(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Cc(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return wu.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){return t=Hs(),e(),[2,{kernelMs:Hs()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:wu.keep(e.clone()),imag:wu.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(Dy(e,"slice"),fd(e.shape,t,n)){var r=pd(t,e.strides),o=ms(n);return Xl(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var a=Cc(n,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s).map(function(e,n){return e+t[n]});a.values[s]=i.get.apply(i,u)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){Dy(e,"stridedSlice");var o=cd(t,n,r);if(o.some(function(e){return 0===e}))return Xl([],o);for(var a=Cc(o,e.dtype),i=this.bufferSync(e),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[c]*r[c]+t[c];a.set.apply(a,[i.get.apply(i,l)].concat(u))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Cc([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(r[o++]=e.shape[a]);var i=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[t]=a,u[a]=this.slice(e,i,s).reshape(r);return u},t.prototype.reverse=function(e,t){Dy(e,"reverse");for(var n=Cc(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var a=n.indexToLoc(o),i=a.slice();t.forEach(function(t){return i[t]=e.shape[t]-1-i[t]}),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return Gl(e)}),o=e.map(function(e){return Kl(e)});return ql(this.concat(r,t),this.concat(o,t))}var a=e.map(function(e){var n=ms(e.shape.slice(t));return e.as2D(-1,n)}),i=Vl(a.map(function(e){return e.shape}),1),s=Cc(i,e[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var l=0;a.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var a=o*i[1]+l,u=0;u<e.shape[1];++u)s[a+u]=t[r++];l+=e.shape[1]})}var c=Vl(e.map(function(e){return e.shape}),t);return Xl(s,c,e[0].dtype)},t.prototype.neg=function(e){return Dy(e,"neg"),this.multiply($l(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,fu(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;Dy(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=Cc(e[0].shape,e[0].dtype),o=r.values,a=0;a<e.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=_s([t],e.shape),r=this.max(e,n),o=Fl(r.shape,n),a=this.subtract(e,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return this.realDivide(i,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,fu(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return Dy([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){Dy([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=c[0],h=c[1],f=c[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],v=p[1],g=p[2],y=a*i,b=Cc([s,a,i],e.dtype),x=b.values,w=this.blockSize,k=0;k<s;k++)for(var _=0;_<a;_+=w)for(var E=0;E<i;E+=w)for(var C=0;C<o;C+=w)for(var S=Math.min(_+w,a),N=Math.min(E+w,i),T=Math.min(C+w,o),I=_;I<S;I++)for(var R=E;R<N;R++){for(var A=0,D=C;D<T;D++)A+=u[k*d+I*h+D*f]*l[D*m+R*v+k*g];x[k*y+(I*i+R)]+=A}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,a=e.bias,i=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return a&&(u=this.add(u,a)),i&&(u=Py(this,u,i,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,fu(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.realDivide=function(e,t){return Dy([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},t.prototype.floorDiv=function(e,t){return Dy([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){Dy(e,"sum"),Ll("sum",t,e.rank);for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,fu(e.dtype,"int32")),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=0,h=0;h<i;++h)d+=u[c+h];s[l]=d}return a},t.prototype.prod=function(e,t){Dy(e,"sum");for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,fu(e.dtype,"int32")),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=1,h=0;h<i;++h)d*=u[c+h];s[l]=d}return a},t.prototype.unsortedSegmentSum=function(e,t,n){Dy(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var i=$l(a,"int32"),s=vv(i,t).asType("float32").mul(e).sum(0);r.push(s)}return Xc(r)},t.prototype.argMin=function(e,t){Dy(e,"argMin");var n=[t];Ll("argMin",n,e.rank);for(var r=Ml(e.shape,n),o=r[0],a=r[1],i=nc(o,"int32"),s=ms(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var d=c*s,h=l[d],f=0,p=0;p<s;++p){var m=l[d+p];m<h&&(h=m,f=p)}u[c]=f}return i},t.prototype.argMax=function(e,t){Dy(e,"argMax");var n=[t];Ll("argMax",n,e.rank);for(var r=Ml(e.shape,n),o=r[0],a=r[1],i=nc(o,"int32"),s=ms(a),u=this.readSync(i.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var d=c*s,h=l[d],f=0,p=0;p<s;++p){var m=l[d+p];m>h&&(h=m,f=p)}u[c]=f}return i},t.prototype.cumsum=function(e,t,n,r){if(Dy(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=fu(e.dtype,"int32"),a=nc(e.shape,o),i=this.readSync(a.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var d=0;d<u;d++){var h=l(c,d);if(0===d)i[h]=n?0:s[h];else{var f=l(c,d-1);i[h]=n?s[f]+i[f]:s[h]+i[f]}}return a},t.prototype.equal=function(e,t){return Dy([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return Dy([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return Dy([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return Dy([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return Dy([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return Dy([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){Dy(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return Dy([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return Dy([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){Dy([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),i=nc(t.shape,fu(t.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,l=0===e.rank||e.rank>1||1===t.rank?1:ms(t.shape.slice(1)),c=0;c<r.length;c++)for(var d=0;d<l;d++)1===r[c]?s[u++]=o[c]:s[u++]=a[c];return i},t.prototype.where=function(e){Dy([e],"where");var t=this.readSync(e.dataId);return eh(e.shape,t)},t.prototype.topk=function(e,t,n){return Dy(e,"topk"),Zd(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){Dy(e,"min"),Ll("min",t,e.rank);for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,e.dtype),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=u[c],h=0;h<i;++h){var f=u[c+h];f<d&&(d=f)}s[l]=d}return a},t.prototype.minimum=function(e,t){return Dy([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return Dy([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){Dy(e,"max"),Ll("max",t,e.rank);for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,e.dtype),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=u[c],h=0;h<i;++h){var f=u[c+h];f>d&&(d=f)}s[l]=d}return a},t.prototype.maximum=function(e,t){return Dy([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){Dy(e,"all"),Ll("all",t,e.rank);for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,e.dtype),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=u[c],h=0;h<i;++h){var f=u[c+h];d=d&&f}s[l]=d}return a},t.prototype.any=function(e,t){Dy(e,"any"),Ll("any",t,e.rank);for(var n=Ml(e.shape,t),r=n[0],o=n[1],a=nc(r,e.dtype),i=ms(o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=0;l<s.length;++l){for(var c=l*i,d=u[c],h=0;h<i;++h){var f=u[c+h];d=d||f}s[l]=d}return a},t.prototype.squaredDifference=function(e,t){return Dy([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){Dy(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){Dy(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){Dy(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){Dy(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){Dy(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){Dy(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){Dy(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){Dy(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){Dy(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){Dy(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){Dy(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){Dy(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){Dy(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){Dy(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Dy(e,"relu");for(var t=nc(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){Dy(e,"relu");for(var t=nc(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return Dy([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){Dy(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){Dy([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){Dy(e,"selu");for(var t=mp,n=vp,r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>=0?n*i:t*(Math.exp(i)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){Dy(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<t?t:i}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],a=n[2*r+1];t[r]=Math.hypot(o,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){Dy(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){Dy(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){Dy(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a,i=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);a=s?u:i?r[o]:Math.log(1+u),n[o]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){Dy(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){Dy(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){Dy(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){Dy(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){Dy(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){Dy(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return Dy([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){Dy(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){Dy(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){Dy(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=ys(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){Dy(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){Dy(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){Dy(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){Dy(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);t[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),Dy(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),a&&(s=Py(this,s,a,i)),s},t.prototype.conv2d=function(e,t,n){Dy([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l="channelsLast"===n.dataFormat,c=Cc(n.outShape,e.dtype),d=e.strides[0],h=l?e.strides[1]:e.strides[2],f=l?e.strides[2]:1,p=l?1:e.strides[1],m=c.strides[0],v=l?c.strides[1]:c.strides[2],g=l?c.strides[2]:1,y=l?1:c.strides[1],b=this.readSync(e.dataId),x=this.readSync(t.dataId),w=c.values,k=0;k<n.batchSize;++k)for(var _=k*d,E=k*m,C=0;C<n.outHeight;++C)for(var S=E+C*v,N=C*n.strideHeight-u,T=0;T<r;T++){var I=N+T*a;if(!(I<0||I>=n.inHeight))for(var R=T*t.strides[0],A=_+I*h,D=0;D<n.outWidth;++D)for(var P=S+D*g,j=D*n.strideWidth-s,O=0;O<o;O++){var M=j+O*i;if(!(M<0||M>=n.inWidth))for(var F=A+M*f,L=R+O*t.strides[1],B=0;B<n.inChannels;++B){for(var U=b[F+B*p],z=0;z<n.outChannels;++z)w[P+z*y]+=U*x[L+z];L+=n.outChannels}}}return c.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,l=n.padInfo.front,c=n.padInfo.left,d=n.padInfo.top,h=Cc(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),m=h.values,v=0;v<n.batchSize;++v)for(var g=v*e.strides[0],y=v*h.strides[0],b=0;b<n.outDepth;++b)for(var x=y+b*h.strides[1],w=b*n.strideDepth-l,k=0;k<r;k++){var _=w+k*i;if(!(_<0||_>=n.inDepth))for(var E=k*t.strides[0],C=g+_*e.strides[1],S=0;S<n.outHeight;++S)for(var N=x+S*h.strides[2],T=S*n.strideHeight-d,I=0;I<o;I++){var R=T+I*s;if(!(R<0||R>=n.inHeight))for(var A=E+I*t.strides[1],D=C+R*e.strides[2],P=0;P<n.outWidth;++P)for(var j=N+P*n.outChannels,O=P*n.strideWidth-c,M=0;M<a;M++){var F=O+M*u;if(!(F<0||F>=n.inWidth))for(var L=A+M*t.strides[2],B=D+F*n.inChannels,U=L,z=0;z<n.inChannels;++z){for(var W=f[B+z],V=0;V<n.outChannels;++V)m[j+V]+=W*p[U+V];U+=n.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){Dy([e,t],"conv2dDerInput");for(var r=Cc(n.inShape,"float32"),o=r.values,a=this.readSync(e.dataId),i=this.readSync(t.dataId),s=t.strides,u=s[0],l=s[1],c=s[2],d=n.batchSize,h=n.filterHeight,f=n.filterWidth,p=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,x=n.strideHeight,w=n.strideWidth,k=n.dataFormat,_=h-1-n.padInfo.top,E=f-1-n.padInfo.left,C="channelsLast"===k,S=r.strides[0],N=C?r.strides[1]:r.strides[2],T=C?r.strides[2]:1,I=C?1:r.strides[1],R=e.strides[0],A=C?e.strides[1]:e.strides[2],D=C?e.strides[2]:1,P=C?1:e.strides[1],j=0;j<d;++j)for(var O=0;O<p;++O)for(var M=0;M<m;++M)for(var F=M-_,L=Math.max(0,Math.ceil(F/x)),B=Math.min(y,(h+F)/x),U=0;U<v;++U){for(var z=U-E,W=Math.max(0,Math.ceil(z/w)),V=Math.min(b,(f+z)/w),H=0,q=L;q<B;++q)for(var G=q*x-F,K=W;K<V;++K)for(var X=R*j+A*q+D*K,Y=u*(h-1-G)+l*(f-1-(K*w-z))+c*O,$=0;$<g;++$)H+=a[X+P*$]*i[Y+$];o[S*j+N*M+T*U+I*O]=H}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Cc(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=a[3],c=this.readSync(e.dataId),d=e.strides,h=d[0],f=d[1],p=d[2],m=d[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],k=n.batchSize,_=n.filterDepth,E=n.filterHeight,C=n.filterWidth,S=n.inChannels,N=n.inDepth,T=n.inHeight,I=n.inWidth,R=n.outChannels,A=n.outDepth,D=n.outHeight,P=n.outWidth,j=n.strideDepth,O=n.strideHeight,M=n.strideWidth,F=_-1-n.padInfo.front,L=E-1-n.padInfo.top,B=C-1-n.padInfo.left,U=0;U<k;++U)for(var z=0;z<S;++z)for(var W=0;W<N;++W)for(var V=W-F,H=Math.max(0,Math.ceil(V/j)),q=Math.min(A,(_+V)/j),G=0;G<T;++G)for(var K=G-L,X=Math.max(0,Math.ceil(K/O)),Y=Math.min(D,(E+K)/O),$=0;$<I;++$){for(var J=$-B,Q=Math.max(0,Math.ceil(J/M)),Z=Math.min(P,(C+J)/M),ee=0,te=H;te<q;++te)for(var ne=te*j-V,re=X;re<Y;++re)for(var oe=re*O-K,ae=Q;ae<Z;++ae)for(var ie=h*U+f*te+p*re+m*ae,se=y*(_-1-ne)+b*(E-1-oe)+x*(C-1-(ae*M-J))+w*z,ue=0;ue<R;++ue)ee+=c[ie+ue]*v[se+ue];o[i*U+s*W+u*G+l*$+z]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){Dy([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=Cc(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,d=this.bufferSync(e),h=this.bufferSync(t),f=0;f<a;++f)for(var p=Math.max(0,Math.ceil((c-f)/r)),m=Math.min(n.outHeight,(n.inHeight+c-f)/r),v=0;v<i;++v)for(var g=Math.max(0,Math.ceil((l-v)/o)),y=Math.min(n.outWidth,(n.inWidth+l-v)/o),b=0;b<n.inChannels;++b)for(var x=0;x<n.outChannels;++x){for(var w=0,k=0;k<n.batchSize;++k)for(var _=p;_<m;++_)for(var E=f+_*r-c,C=g;C<y;++C){var S=v+C*o-l;w+=s?d.get(k,E,S,b)*h.get(k,_,C,x):d.get(k,b,E,S)*h.get(k,x,_,C)}u.set(w,f,v,b,x)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=Cc(n.filterShape,"float32"),c=l.values,d=l.strides,h=d[0],f=d[1],p=d[2],m=d[3],v=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],x=g[2],w=g[3],k=this.readSync(e.dataId),_=e.strides,E=_[0],C=_[1],S=_[2],N=_[3],T=n.padInfo.front,I=n.padInfo.left,R=n.padInfo.top,A=0;A<i;++A)for(var D=Math.max(0,Math.ceil((T-A)/r)),P=Math.min(n.outDepth,(n.inDepth+T-A)/r),j=A*h,O=0;O<s;++O)for(var M=Math.max(0,Math.ceil((R-O)/o)),F=Math.min(n.outHeight,(n.inHeight+R-O)/o),L=O*f+j,B=0;B<u;++B)for(var U=Math.max(0,Math.ceil((I-B)/a)),z=Math.min(n.outWidth,(n.inWidth+I-B)/a),W=B*p+L,V=0;V<n.inChannels;++V)for(var H=V*m+W,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var X=K*E,Y=K*y,$=D;$<P;++$)for(var J=(A+$*r-T)*C+X,Q=$*b+Y,Z=M;Z<F;++Z)for(var ee=(O+Z*o-R)*S+J,te=Z*x+Q,ne=U;ne<z;++ne){var re=ne*w+te;G+=k[(B+ne*a-I)*N+ee+V]*v[re+q]}c[H+q]=G}return l.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,a=e.activation,i=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),a&&(s=Py(this,s,a,i)),s},t.prototype.depthwiseConv2D=function(e,t,n){Dy([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=Cc(n.outShape,e.dtype),d=this.readSync(e.dataId),h=this.readSync(t.dataId),f=c.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],v=p*c.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*c.strides[1],b=g*n.strideHeight-s,x=0;x<r;++x){var w=b+x*a;if(!(w<0||w>=n.inHeight))for(var k=x*t.strides[0],_=m+w*e.strides[1],E=0;E<n.outWidth;++E)for(var C=y+E*c.strides[2],S=E*n.strideWidth-u,N=0;N<o;++N){var T=S+N*i;if(!(T<0||T>=n.inWidth))for(var I=k+N*t.strides[1],R=_+T*n.inChannels,A=C,D=I,P=0;P<n.inChannels;++P){for(var j=d[R+P],O=0;O<l;++O)f[A+O]+=j*h[D+O];A+=l,D+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){Dy([e,t],"depthwiseConv2DDerInput");for(var r=Cc(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],l=this.readSync(e.dataId),c=e.strides,d=c[0],h=c[1],f=c[2],p=this.readSync(t.dataId),m=t.strides,v=m[0],g=m[1],y=m[2],b=n.batchSize,x=n.filterHeight,w=n.filterWidth,k=n.inChannels,_=n.inHeight,E=n.inWidth,C=n.outChannels,S=n.outHeight,N=n.outWidth,T=n.strideHeight,I=n.strideWidth,R=x-1-n.padInfo.top,A=w-1-n.padInfo.left,D=C/k,P=0;P<b;++P)for(var j=0;j<k;++j)for(var O=0;O<_;++O)for(var M=O-R,F=Math.max(0,Math.ceil(M/T)),L=Math.min(S,(x+M)/T),B=0;B<E;++B){for(var U=B-A,z=Math.max(0,Math.ceil(U/I)),W=Math.min(N,(w+U)/I),V=0,H=F;H<L;++H)for(var q=H*T-M,G=z;G<W;++G)for(var K=d*P+h*H+f*G,X=v*(x-1-q)+g*(w-1-(G*I-U))+y*j,Y=0;Y<D;++Y)V+=l[K+(j*D+Y)]*p[X+Y];o[i*P+s*O+u*B+j]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){Dy([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=Cc(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,d=this.bufferSync(e),h=this.bufferSync(t),f=0;f<a;++f)for(var p=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),v=0;v<i;++v)for(var g=Math.max(0,Math.ceil((u-v)/o)),y=Math.min(n.outWidth,(n.inWidth+u-v)/o),b=0;b<n.outChannels;++b){for(var x=Math.trunc(b/c),w=b%c,k=0,_=0;_<n.batchSize;++_)for(var E=p;E<m;++E)for(var C=f+E*r-l,S=g;S<y;++S){var N=v+S*o-u;k+=d.get(_,C,N,x)*h.get(_,E,S,b)}s.set(k,f,v,x,w)}return s.toTensor()},t.prototype.tile=function(e,t){return Dy(e,"tile"),Qd(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){Dy(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),a=this.bufferSync(e),i=Cc(r,e.dtype);0!==n&&i.values.fill(n);for(var s=0;s<e.size;s++){var u=a.indexToLoc(s),l=u.map(function(e,t){return e+o[t]});i.set.apply(i,[a.get.apply(a,u)].concat(l))}return i.toTensor()},t.prototype.transpose=function(e,t){Dy(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=this.readSync(e.dataId),a=Cc(n,e.dtype),i=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=i.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=a.locToIndex(u);a.values[c]=o[r]}return a.toTensor()},t.prototype.gather=function(e,t,n){Dy([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var a=Cc(r,e.dtype),i=this.bufferSync(e),s=0;s<a.size;++s){var u=a.indexToLoc(s),l=u.slice();l[n]=o[u[n]];var c=i.locToIndex(l);a.values[s]=i.values[c]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){Dy([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=Qc(e.shape,t,r),a=Zc(o.length,t.length),i=ed(e.shape,t,r),s=td(n,t.length),u=nd(i,n,t.length);return e.reshape(o).transpose(a).reshape(i).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){Dy([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var i=e.pad(o),s=Qc(i.shape,t,r,!1),u=Zc(s.length,t.length,!1),l=ed(i.shape,t,r,!1);return i.reshape(s).transpose(u).reshape(l)},t.prototype.pool=function(e,t,n){Dy(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,d="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(e.dataId),f=Cc(t.outShape,e.dtype),p=f.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],v=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,x=y*e.strides[0],w=0;w<t.inChannels;++w)for(var k=0;k<t.outHeight;++k)for(var _=k*r-l,E=Math.max(0,_),C=Math.min(t.inHeight,s+_),S=b+k*v,N=0;N<t.outWidth;++N){for(var T=N*o-c,I=Math.max(0,T),R=Math.min(t.inWidth,u+T),A=d,D=0,P=0,j=E;j<C;j+=a){for(var O=x+j*e.strides[1],M=I;M<R;M+=i){var F=h[O+M*e.strides[2]+w];"max"===n&&F>A?A=F:"avg"===n&&(D+=F,P++)}if(isNaN(A))break}p[S+N*g+w]="avg"===n?D/P:A}return f.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=Cc(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=t.padInfo.top,c=t.padInfo.left,d=this.bufferSync(e),h=0;h<t.batchSize;++h)for(var f=0;f<t.inChannels;++f)for(var p=0;p<t.outHeight;++p){for(var m=p*r-l,v=m;v<0;)v+=a;for(var g=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*o-c,x=b;x<0;)x+=i;for(var w=Math.min(t.inWidth,u+b),k=Number.NEGATIVE_INFINITY,_=-1,E=v;E<g;E+=a)for(var C=E-m,S=x;S<w;S+=i){var N=S-b,T=d.get(h,E,S,f);T>k&&(k=T,_=C*u+N)}n.set(_,h,p,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){Dy([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),a=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=c-1-r.padInfo.left,h=l-1-r.padInfo.top,f=Cc(t.shape,"float32"),p=this.bufferSync(o),m=this.bufferSync(e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var x=y-h,w=b-d,k=0,_=0;_<l;_+=s){var E=(x+_)/a;if(!(E<0||E>=r.outHeight||Math.floor(E)!==E))for(var C=0;C<c;C+=u){var S=(w+C)/i;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var N=l*c-1-p.get(v,E,S,g)===_*c+C?1:0;0!==N&&(k+=m.get(v,E,S,g)*N)}}}f.set(k,v,y,b,g)}return f.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){Dy([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,d=c-1-n.padInfo.left,h=l-1-n.padInfo.top,f=Cc(t.shape,"float32"),p=1/(a*i),m=this.bufferSync(e),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var x=y-h,w=b-d,k=0,_=0;_<l;_+=s){var E=(x+_)/r;if(!(E<0||E>=n.outHeight||Math.floor(E)!==E))for(var C=0;C<c;C+=u){var S=(w+C)/o;S<0||S>=n.outWidth||Math.floor(S)!==S||(k+=m.get(v,E,S,g))}}f.set(k*p,v,y,b,g)}return f.toTensor()},t.prototype.pool3d=function(e,t,n){Dy(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=Cc(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],k=t.outShape[4],_=0;_<t.batchSize;++_)for(var E=_*b,C=_*e.strides[0],S=0;S<t.inChannels;++S)for(var N=0;N<t.outDepth;++N){for(var T=N*r-h,I=T;I<0;)I+=i;for(var R=Math.min(t.inDepth,l+T),A=E+N*x,D=0;D<t.outHeight;++D){for(var P=D*o-f,j=P;j<0;)j+=s;for(var O=Math.min(t.inHeight,c+P),M=A+D*w,F=0;F<t.outWidth;++F){for(var L=F*a-p,B=L;B<0;)B+=u;for(var U=Math.min(t.inWidth,d+L),z=M+F*k,W=m,V=0,H=0,q=I;q<R;q+=i){for(var G=C+q*e.strides[1],K=j;K<O;K+=s){for(var X=G+K*e.strides[2],Y=B;Y<U;Y+=u){var $=v[X+Y*e.strides[3]+S];if("max"===n&&$>W?W=$:"avg"===n&&(V+=$,H++),isNaN(W))break}if(isNaN(W))break}if(isNaN(W))break}y[z+S]="avg"===n?V/H:W}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return Dy(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){Dy([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,l=n.dilationDepth,c=n.dilationHeight,d=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=h-1-n.padInfo.front,v=p-1-n.padInfo.left,g=f-1-n.padInfo.top,y=Cc(t.shape,"float32"),b=1/(i*s*u),x=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var k=0;k<n.inChannels;++k)for(var _=0;_<n.inDepth;++_)for(var E=0;E<n.inHeight;++E)for(var C=0;C<n.inWidth;++C){for(var S=_-m,N=E-g,T=C-v,I=0,R=0;R<h;R+=l){var A=(S+R)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<f;D+=c){var P=(N+D)/o;if(!(P<0||P>=n.outHeight||Math.floor(P)!==P))for(var j=0;j<p;j+=d){var O=(T+j)/a;O<0||O>=n.outWidth||Math.floor(O)!==O||(I+=x.get(w,A,P,O,k))}}}y.set(I*b,w,_,E,C,k)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return Dy(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Cc(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,d=t.effectiveFilterWidth,h=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-h,x=b;x<0;)x+=i;for(var w=Math.min(t.inDepth,l+b),k=0;k<t.outHeight;++k){for(var _=k*o-f,E=_;E<0;)E+=s;for(var C=Math.min(t.inHeight,c+_),S=0;S<t.outWidth;++S){for(var N=S*a-p,T=N;T<0;)T+=u;for(var I=Math.min(t.inWidth,d+N),R=Number.NEGATIVE_INFINITY,A=-1,D=x;D<w;D+=i)for(var P=D-b,j=E;j<C;j+=s)for(var O=j-_,M=T;M<I;M+=u){var F=M-N,L=m.get(v,D,j,M,g);L>=R&&(R=L,A=P*c*d+O*c+F)}n.set(A,v,y,k,S,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){Dy([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=d-1-r.padInfo.front,m=f-1-r.padInfo.left,v=h-1-r.padInfo.top,g=Cc(t.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var k=0;k<r.inDepth;++k)for(var _=0;_<r.inHeight;++_)for(var E=0;E<r.inWidth;++E){for(var C=k-p,S=_-v,N=E-m,T=0,I=0;I<d;I+=u){var R=(C+I)/a;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var A=0;A<h;A+=l){var D=(S+A)/i;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var P=0;P<f;P+=c){var j=(N+P)/s;if(!(j<0||j>=r.outWidth||Math.floor(j)!==j)){var O=d*h*f-1-y.get(x,R,D,j,w)===I*h*f+A*f+P?1:0;0!==O&&(T+=b.get(x,R,D,j,w)*O)}}}}g.set(T,x,k,_,E,w)}return g.toTensor()},t.prototype.cast=function(e,t){return Md(e,t,this)},t.prototype.reshape=function(e,t){return Fd(e,t)},t.prototype.avgPool=function(e,t){return Dy(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){Dy(e,"resizeBilinear");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(ms([a,t,n,u])),d=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=0,p=d[0]/h[0],m=d[1]/h[1],v=0;v<a;v++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),x=y-b,w=Math.min(i-1,Math.ceil(y)),k=v*e.strides[0]+b*e.strides[1],_=v*e.strides[0]+w*e.strides[1],E=0;E<n;E++)for(var C=m*E,S=Math.floor(C),N=C-S,T=Math.min(s-1,Math.ceil(C)),I=k+S*e.strides[2],R=_+S*e.strides[2],A=k+T*e.strides[2],D=_+T*e.strides[2],P=0;P<u;P++){var j=l[I+P],O=l[R+P],M=j+(l[A+P]-j)*N,F=M+(O+(l[D+P]-O)*N-M)*x;c[f++]=F}return Xl(c,[a,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){Dy([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],d=new Float32Array(o*a*i*s),h=[n&&l>1?a-1:a,n&&c>1?i-1:i],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],p=h[0]/f[0],m=h[1]/f[1],v=this.readSync(e.dataId),g=0,y=0;y<o;y++)for(var b=y*t.strides[0],x=0;x<l;x++)for(var w=x*p,k=Math.floor(w),_=Math.min(Math.ceil(w),a-1),E=b+k*t.strides[1],C=b+_*t.strides[1],S=w-k,N=1-S,T=0;T<c;T++)for(var I=T*m,R=Math.floor(I),A=Math.min(Math.ceil(I),i-1),D=I-R,P=1-D,j=E+R*t.strides[2],O=E+A*t.strides[2],M=C+R*t.strides[2],F=C+A*t.strides[2],L=N*P,B=N*D,U=S*P,z=S*D,W=0;W<s;W++){var V=v[g++];d[j+W]+=V*L,d[O+W]+=V*B,d[M+W]+=V*U,d[F+W]+=V*z}return ec(d,[o,i,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){Dy(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],i=o[1],s=o[2],u=o[3],l=this.readSync(e.dataId),c=new Float32Array(a*t*n*u),d=[r&&t>1?i-1:i,r&&n>1?s-1:s],h=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=d[0]/h[0],p=d[1]/h[1],m=0,v=0;v<a;v++)for(var g=v*e.strides[0],y=0;y<t;y++)for(var b=f*y,x=g+Math.min(i-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var k=p*w,_=x+Math.min(s-1,r?Math.round(k):Math.floor(k))*e.strides[2],E=0;E<u;E++){var C=l[_+E];c[m++]=C}return Xl(c,[a,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){Dy([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],d=new Float32Array(o*a*i*s),h=this.readSync(e.dataId),f=[n&&l>1?a-1:a,n&&c>1?i-1:i],p=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=f[0]/p[0],v=f[1]/p[1],g=1/m,y=1/v,b=2*Math.ceil(g)+2,x=2*Math.ceil(y)+2,w=0;w<o;w++)for(var k=w*t.strides[0],_=0;_<a;_++)for(var E=k+_*t.strides[1],C=Math.floor(_*g),S=Math.floor(C-b/2),N=0;N<i;N++)for(var T=E+N*t.strides[2],I=Math.floor(N*y),R=Math.floor(I-x/2),A=0;A<s;A++){for(var D=0,P=0;P<b;P++){var j=P+S;if(!(j<0||j>=l)){var O=k+j*e.strides[1],M=j*m;if(_===Math.min(a-1,n?Math.round(M):Math.floor(M)))for(var F=0;F<x;F++){var L=F+R;if(!(L<0||L>=c)){var B=O+L*e.strides[2],U=L*v;N===Math.min(i-1,n?Math.round(U):Math.floor(U))&&(D+=h[B+A])}}}}d[T+A]=D}return ec(d,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,a){Dy([e,t,n,o,a],"batchNorm");for(var i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=o?this.readSync(o.dataId):new Float32Array([1]),c=a?this.readSync(a.dataId):new Float32Array([0]),d=new Float32Array(i.length),h=c.length,f=l.length,p=u.length,m=s.length,v=0,g=0,y=0,b=0,x=0;x<i.length;++x)d[x]=c[v++]+(i[x]-s[g++])*l[y++]/Math.sqrt(u[b++]+r),v>=h&&(v=0),g>=m&&(g=0),y>=f&&(y=0),b>=p&&(b=0);return ec(d,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){Dy(e,"localResponseNormalization4D");var a=e.shape[3],i=a-1,s=this.readSync(e.dataId),u=e.size,l=new Float32Array(u);function c(e){for(var n=e%a,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,i),u=0;r<=o;r++){var l=s[r];u+=l*l}return u}for(var d=0;d<u;d++){var h=c(d),f=s[d]*Math.pow(n+r*h,-o);l[d]=f}return ec(l,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,a,i){Dy(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),l=this.readSync(t.dataId),c=this.readSync(n.dataId),d=new Float32Array(e.size),h=e.size,f=0;f<h;f++){for(var p=f%s,m=f-p+Math.max(0,p-r),v=f-p+Math.min(s,p+r+1),g=0,y=m;y<v;y++)g+=Math.pow(l[y],2);for(g=a*g+o,y=m;y<v;y++){var b=-2*a*i*l[y]*c[f]/g;f===y&&(b+=Math.pow(g,-i)),b*=u[f],d[y]+=b}}return ec(d,e.shape)},t.prototype.multinomial=function(e,t,n,r){Dy(e,"multinomial");for(var o=t?e:vd(e),a=o.shape[0],i=o.shape[1],s=nc([a,n],"int32"),u=this.readSync(s.dataId),l=this.readSync(o.dataId),c=0;c<a;++c){var d=c*i,h=new Float32Array(i-1);h[0]=l[d];for(var f=1;f<h.length;++f)h[f]=h[f-1]+l[d+f];for(var p=wc(r.toString()),m=c*n,v=0;v<n;++v){var g=p();u[m+v]=h.length;for(var y=0;y<h.length;y++)if(g<h[y]){u[m+v]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){Dy(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var a=this.readSync(e.dataId),i=0;i<e.size;++i)a[i]>=0&&a[i]<t&&(o[i*t+a[i]]=n);return Ql(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return Dy(e,"nonMaxSuppression"),qd(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Cc(e.shape,"float32"),a=Cc(e.shape,"float32"),i=Gl(e).as2D(n,r),s=Kl(e).as2D(n,r),u=0;u<n;u++)for(var l=i.slice([u,0],[1,r]),c=s.slice([u,0],[1,r]),d=ql(l,c),h=this.readSync(this.fftImpl(d,t).dataId),f=0;f<r;f++){var p=Ud(h,f);o.values[u*r+f]=p.real,a.values[u*r+f]=p.imag}return ql(o.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=ql(Gl(o).div($l(r)),Kl(o).div($l(r)))),o}var a=this.readSync(e.dataId),i=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return ql(i.real,i.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),i=ql(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=ql(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var l=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(t,n),c=ql(l.real,l.imag).mul(u),d=i.add(c),h=i.sub(c),f=Gl(d).concat(Gl(h)),p=Kl(d).concat(Kl(h));return ql(f,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,i=0,s=0;s<t;s++){var u=Wd(o*s,t,n),l=Ud(e,s);a+=l.real*u.real-l.imag*u.imag,i+=l.real*u.imag+l.imag*u.real}n&&(a/=t,i/=t),zd(r,a,i,o)}return r},t.prototype.depthToSpace=function(e,t,n){ds("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),ds(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],a=e.shape[2],i=e.shape[3],s=o*t,u=a*t,l=i/(t*t),c=this.readSync(e.dataId),d=new Float32Array(r*s*u*l),h=0,f=0;f<r;++f)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),v=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(v*t+g%t)*l,x=0;x<l;++x){var w=x+b+i*(y+a*(m+o*f));d[h++]=c[w]}return ec(d,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=_d(e.shape,t.shape),a=Cc(o,n),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=wd(e.shape,o),l=wd(t.shape,o),c=a.values;if(u.length+l.length===0)for(var d=0;d<c.length;++d)c[d]=r(i[d%i.length],s[d%s.length]);else{var h=this.bufferSync(e),f=this.bufferSync(t),p=function(n){var o=a.indexToLoc(n),d=o.slice(-e.rank);u.forEach(function(e){return d[e]=0});var p=h.locToIndex(d),m=o.slice(-t.rank);l.forEach(function(e){return m[e]=0});var v=f.locToIndex(m);c[n]=r(i[p],s[v])};for(d=0;d<c.length;++d)p(d)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=_d(e.shape,t.shape),o=Cc(r,"float32"),a=Cc(r,"float32"),i=this.readSync(e.dataId),s=this.readSync(t.dataId),u=wd(e.shape,r),l=wd(t.shape,r),c=o.values,d=a.values;if(u.length+l.length===0)for(var h=0;h<c.length;h++){var f=h%i.length,p=h%s.length,m=n(i[2*f],i[2*f+1],s[2*p],s[2*p+1]);c[h]=m.real,d[h]=m.imag}else{var v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),h=a.slice(-e.rank);u.forEach(function(e){return h[e]=0});var f=v.locToIndex(h),p=a.slice(-t.rank);l.forEach(function(e){return p[e]=0});var m=g.locToIndex(p),y=n(i[2*f],i[2*f+1],s[2*m],s[2*m+1]);c[r]=y.real,d[r]=y.imag};for(h=0;h<c.length;h++)y(h)}return this.complex(o.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return Jd(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,a){for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],d=t.shape[0],h=r[0],f=r[1],p=Cc([d,h,f,c],"float32"),m=this.readSync(t.dataId),v=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=p.strides,x=0;x<d;x++){var w=4*x,k=m[w],_=m[w+1],E=m[w+2],C=m[w+3],S=v[x];if(!(S>=s))for(var N=h>1?(E-k)*(u-1)/(h-1):0,T=f>1?(C-_)*(l-1)/(f-1):0,I=0;I<h;I++){var R=h>1?k*(u-1)+I*N:.5*(k+E)*(u-1);if(R<0||R>u-1)for(var A=0;A<f;A++)for(var D=0;D<c;D++){var P=D+A*b[2]+I*b[1]+x*b[0];p.values[P]=a}else if("bilinear"===o){var j=Math.floor(R),O=Math.ceil(R),M=R-j;for(A=0;A<f;A++)if((q=f>1?_*(l-1)+A*T:.5*(_+C)*(l-1))<0||q>l-1)for(D=0;D<c;D++)P=D+A*b[2]+I*b[1]+x*b[0],p.values[P]=a;else{var F=Math.floor(q),L=Math.ceil(q),B=q-F;for(D=0;D<c;D++){var U=g[P=D+F*y[2]+j*y[1]+S*y[0]],z=g[P=D+L*y[2]+j*y[1]+S*y[0]],W=g[P=D+F*y[2]+O*y[1]+S*y[0]],V=U+(z-U)*B,H=W+(g[P=D+L*y[2]+O*y[1]+S*y[0]]-W)*B;P=D+A*b[2]+I*b[1]+x*b[0],p.values[P]=V+(H-V)*M}}}else for(A=0;A<f;++A){var q;if((q=f>1?_*(l-1)+A*T:.5*(_+C)*(l-1))<0||q>l-1)for(D=0;D<c;D++)P=D+A*b[2]+I*b[1]+x*b[0],p.values[P]=a;else{var G=Math.round(q),K=Math.round(R);for(D=0;D<c;D++){var X=D+G*y[2]+K*y[1]+S*y[0],Y=D+A*b[2]+I*b[1]+x*b[0];p.values[Y]=g[X]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=sd(0,e,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,l=o.outputSize;return this.scatter(e,t,n,l,s,i,a,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=rd(e,t),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return Xl([],a,e.dtype);for(var l=new tu([i,s],e.dtype),c=this.readSync(t.dataId),d=this.readSync(e.dataId),h=0;h<i;h++){for(var f=[],p=0,m=0;m<r;m++){var v=c[h*r+m];p+=v*u[m],f.push(v)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+f+" does not index into "+e.shape);for(var g=0;g<s;g++)l.values[h*s+g]=d[p*s+g]}return l.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=sd(0,e,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,l=$l(0);return this.scatter(e,t,n,u,i,a,o,s,l,!0)},t.prototype.fill=function(e,t,n){var r=Ss(n=n||Ms(t),ms(e));return r.fill(t),wu.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Ss(e.dtype,ms(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Ld(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,a,i,s,u,l){var c=[r/o,o],d=this.readSync(e.dataId),h=this.readSync(t.dataId);if(0===r)return Xl([],n,t.dtype);var f=new tu(c,t.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],v=0,g=0;g<i;g++){var y=d[p*i+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<o;b++)l?f.values[v*o+b]+=h[p*o+b]:f.values[v*o+b]=0===t.rank?h[0]:h[p*o+b]}return f.toTensor().reshape(n)},t}(bd);wu.registerBackend("cpu",function(){return new jy},1);for(var Oy=0,My=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,h=n;Dy(a,"NonMaxSuppressionWithScore");var f=Gd(h.data.get(a.dataId).values,h.data.get(i.dataId).values,u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;Dy(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Kp,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n;Dy([o,a],Kp);var s=i.data.get(o.dataId).values,u=i.data.get(a.dataId).values,l=function(e,t,n,r,o,a){var i=_d(e,t),s=i.length,u=Bs(i),l=Cs(o,ms(i)),c=e.length,d=t.length,h=Bs(e),f=Bs(t),p=wd(e,i),m=wd(t,i);if(p.length+m.length===0)for(var v=0;v<l.length;++v)l[v]=a(n[v%n.length],r[v%r.length]);else{var g=function(e){var t=Ys(e,s,u),o=t.slice(-c);p.forEach(function(e){return o[e]=0});var i=Xs(o,c,h),v=t.slice(-d);m.forEach(function(e){return v[e]=0});var g=Xs(v,d,f);l[e]=a(n[i],r[g])};for(v=0;v<l.length;++v)g(v)}return[l,i]}(o.shape,a.shape,s,u,o.dtype,function(e,t){var n=e-t;return n*n}),c=l[0],d=l[1];return{dataId:i.write(c,d,o.dtype),shape:d,dtype:o.dtype}}}];Oy<My.length;Oy++)os(My[Oy]);for(var Fy,Ly=function(e){this.variableNames=["A"];var t=ih(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},By=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=ih(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Uy=0,zy=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,a=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],d=[c,l],h=[c,l,a];(s||i)&&(null==Fy&&(Fy=document.createElement("canvas").getContext("2d")),Fy.canvas.width=l,Fy.canvas.height=c,Fy.drawImage(o,0,0,l,c),o=Fy.canvas);var f=n.makeTensorInfo(d,"int32");n.texData.get(f.dataId).usage=Cu.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),o);var p=Qi().getBool("WEBGL_PACK")?new By(h):new Ly(h),m=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;Il("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,h=n,f=Gd(h.readSync(a.dataId),h.readSync(i.dataId),u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,a=new gp(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Kp,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,a=r.b,i=n,s=Qi().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jh("return (a - b) * (a - b);",o.shape,a.shape):new Dh("return (a - b) * (a - b);",o.shape,a.shape);return i.compileAndRun(s,[o,a])}}];Uy<zy.length;Uy++)os(zy[Uy]);for(var Wy=0,Vy=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Kp,gradFunc:function(e,t){var n=t[0],r=t[1],o=$l(2);return{a:function(){return lv(e,lv(o,pv(n,r)))},b:function(){return lv(e,lv(o,pv(r,n)))}}}}];Wy<Vy.length;Wy++)as(Vy[Wy]);var Hy=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();Qi().get("IS_BROWSER")&&Qi().setPlatform("browser",new Hy);var qy,Gy=function(){function e(){this.util=n(745),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=Qi().global.fetch?Qi().global.fetch(e,t):(null==qy&&(qy=n(318)),qy(e,t))},e.prototype.now=function(){var e=qi.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();Qi().get("IS_NODE")&&Qi().setPlatform("node",new Gy);var Ky={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Xy(e,t){for(var n={},r=0,o=function(t){var o=t.name,a=t.dtype,i=t.shape,s=ms(i),u=void 0;if("quantization"in t){var l=t.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+l.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=Ky[l.dtype],d=e.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===a)u=Float32Array.from(h,function(e){return e*l.scale+l.min});else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(h,function(e){return Math.round(e*l.scale+l.min)})}r+=s*c}else if("string"===a){var f=ms(t.shape);u=[];for(var p=0;p<f;p++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var v=new Uint8Array(e.slice(r,r+m));u.push(v),r+=m}}else{var g=Ky[a];if(d=e.slice(r,r+s*g),"float32"===a)u=new Float32Array(d);else if("int32"===a)u=new Int32Array(d);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(d)}r+=s*g}n[o]=Xl(u,i,a)},a=0,i=t;a<i.length;a++)o(i[a]);return n}function Yy(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var $y="undefined"!=typeof Gi&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Jy(e){return $y?Gi.byteLength(e):new Blob([e]).size}function Qy(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Zy(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function eb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Jy(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Jy(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var tb=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),nb="://",rb=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){ds(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(nb)&&(t=t.slice(0,t.indexOf(nb))),ds(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();ds(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function ob(e){if(-1===e.indexOf(nb))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+rb.getSchemes().join(","));return{scheme:e.split(nb)[0],path:e.split(nb)[1]}}function ab(e,t,n){return void 0===n&&(n=!1),Yi(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d;return $i(this,function(h){switch(h.label){case 0:return ds(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),ds((r=tb.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),ds(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],ds((a=tb.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),ds(a.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=a[0],s=ob(e).scheme,u=ob(e).path,l=s===ob(e).scheme,[4,o.load()];case 1:return c=h.sent(),n&&l?[4,rb.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,i.save(c)];case 4:return d=h.sent(),!n||l?[3,6]:[4,rb.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var ib="models_store",sb="model_info_store";function ub(){if(!Qi().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function lb(e){var t=e.result;t.createObjectStore(ib,{keyPath:"modelPath"}),t.createObjectStore(sb,{keyPath:"modelPath"})}var cb=function(){function e(e){if(this.indexedDB=ub(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return lb(o)},o.onsuccess=function(){var a=o.result;if(null==t){var i=a.transaction(ib,"readonly"),s=i.objectStore(ib).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,l=eb(t),c=a.transaction(sb,"readwrite"),d=c.objectStore(sb),h=d.put({modelPath:n.modelPath,modelArtifactsInfo:l});h.onsuccess=function(){var o=(u=a.transaction(ib,"readwrite")).objectStore(ib).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l});o.onsuccess=function(){return e({modelArtifactsInfo:l})},o.onerror=function(e){var t=(d=c.objectStore(sb)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(o.error)},t.onerror=function(e){return a.close(),r(o.error)}}},h.onerror=function(e){return a.close(),r(h.error)},c.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),db=function(e){return Qi().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cb.URL_SCHEME)?(t=e.slice(cb.URL_SCHEME.length),new cb(t)):null;var t};tb.registerSaveRouter(db),tb.registerLoadRouter(db);var hb=function(){function e(){this.indexedDB=ub()}return e.prototype.listModels=function(){return Yi(this,void 0,void 0,function(){var e=this;return $i(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return lb(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(sb,"readonly"),a=o.objectStore(sb).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return Yi(this,void 0,void 0,function(){var t=this;return $i(this,function(n){var r;return e=(r=e).startsWith(cb.URL_SCHEME)?r.slice(cb.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return lb(o)},o.onsuccess=function(){var t,a=o.result,i=a.transaction(sb,"readwrite"),s=i.objectStore(sb),u=s.get(e);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),i=function(){var o=(t=a.transaction(ib,"readwrite")).objectStore(ib).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=i,o.onerror=function(e){return i(),a.close(),r(u.error)}},u.onerror=function(e){return a.close(),r(u.error)},i.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(Qi().getBool("IS_BROWSER"))try{rb.registerManager(cb.URL_SCHEME,new hb)}catch(Ve){}var fb="/",pb="tensorflowjs_models",mb="info",vb="model_topology",gb="weight_specs",yb="weight_data",bb="model_metadata";function xb(e){return{info:[pb,e,mb].join(fb),topology:[pb,e,vb].join(fb),weightSpecs:[pb,e,gb].join(fb),weightData:[pb,e,yb].join(fb),modelMetadata:[pb,e,bb].join(fb)}}function wb(e){var t=e.split(fb);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(fb)}var kb=function(){function e(e){if(!Qi().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=xb(this.modelPath)}return e.prototype.save=function(e){return Yi(this,void 0,void 0,function(){var t,n,r;return $i(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=eb(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if($y)return Gi.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return Yi(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return $i(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(i=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if($y){var t=Gi.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(i),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),_b=function(e){return Qi().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(kb.URL_SCHEME)?(t=e.slice(kb.URL_SCHEME.length),new kb(t)):null;var t};tb.registerSaveRouter(_b),tb.registerLoadRouter(_b);var Eb=function(){function e(){ds(Qi().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ds("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return Yi(this,void 0,void 0,function(){var e,t,n,r,o,a;return $i(this,function(i){for(e={},t=pb+fb,n=fb+mb,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(a=wb(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return Yi(this,void 0,void 0,function(){var t,n;return $i(this,function(r){var o;if(e=(o=e).startsWith(kb.URL_SCHEME)?o.slice(kb.URL_SCHEME.length):o,t=xb(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(Qi().getBool("IS_BROWSER"))try{rb.registerManager(kb.URL_SCHEME,new Eb)}catch(Ve){}function Cb(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var Sb=function(){function e(t){if(!Qi().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return Yi(this,void 0,void 0,function(){var t,n,r,o,a,i;return $i(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,Cb(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,Cb(function(){return i.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:eb(e)}]}})})},e.URL_SCHEME="downloads://",e}(),Nb=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return Yi(this,void 0,void 0,function(){var e,t,n=this;return $i(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var l;try{l=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var c=[],d=[],h=[];u.forEach(function(e){e.paths.forEach(function(e){d.push(e),h.push(null)}),c.push.apply(c,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=d.indexOf(e);h[o]=n,-1===h.indexOf(null)&&r({modelTopology:s,weightSpecs:c,weightData:Qy(h),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(l[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return Zy(e.name)}),o={},a=0,i=e;a<i.length;a++)i[a].paths.forEach(function(e){var a=Zy(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[e]=t[r.indexOf(a)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function Tb(e,t,n,r){!function(e){ds(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){ds(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),ds(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),ds(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(a){return a.then(function(a){var i=n+ ++o/e.length*(r-n);return t(i),a}),a}))}function Ib(e,t){return Yi(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c;return $i(this,function(d){switch(d.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?Qi().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),o=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return i=d.sent(),[3,4];case 2:return[4,Tb(r,t.onProgress,o,a)];case 3:i=d.sent(),d.label=4;case 4:return s=i.map(function(e){return e.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return c=d.sent(),[3,8];case 6:return[4,Tb(s,t.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function Rb(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),Yi(t,void 0,void 0,function(){var t,a,i,s,u,l,c,d,h,f;return $i(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),a={},i=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,l=Ky[u]*ms(e.shape),c=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=o?o.forEach(function(t,n){t===e.name&&(c(),i[n]=!0)}):c(),s.push(e.name),r+=l})}),!i.every(function(e){return e}))throw u=o.filter(function(e,t){return!i[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return l=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),c=[],l.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;c.push(t)})}),[4,e(c)];case 1:return d=p.sent(),h={},f=0,l.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=d[f+o].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,l=0;l<t;l++){var c=new Uint8Array(d[f+l]);s.set(c,u),u+=c.byteLength}a[e].forEach(function(e){var t=Xy(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]}),f+=t}),[2,h]}})})}}tb.registerSaveRouter(function(e){return Qi().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Sb.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Sb(e)}(e.slice(Sb.URL_SCHEME.length)):null});var Ab=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(ds("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Qi().platform.fetch,ds(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&ds(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return Yi(this,void 0,void 0,function(){var t,n,r,o;return $i(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:eb(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return Yi(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,u,l,c,d;return $i(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,e.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,i=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:d=h.sent(),l=d[0],c=d[1],h.label=7;case 7:return[2,{modelTopology:r,weightSpecs:l,weightData:c,userDefinedMetadata:u,generatedBy:a,convertedBy:i,format:s}]}})})},e.prototype.loadWeights=function(e){return Yi(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c,d;return $i(this,function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],a=this.weightPathPrefix||r,i=[],s=0,u=e;s<u.length;s++)l=u[s],i.push.apply(i,l.weights);return c=[],e.forEach(function(e){e.paths.forEach(function(e){c.push(a+e+o)})}),[4,Ib(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[i,Qy(d)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Db(e){return null!=e.match(Ab.URL_SCHEME_REGEX)}var Pb=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return Db(e)}):Db(e))?jb(e,{onProgress:t}):null};function jb(e,t){return new Ab(e,t)}tb.registerSaveRouter(Pb),tb.registerLoadRouter(Pb);var Ob,Mb=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){return[2,this.modelArtifacts]})})},e}(),Fb=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){return[2,this.saveHandler(e)]})})},e}(),Lb=Object.freeze({browserFiles:function(e){return new Nb(e)},browserHTTPRequest:function(e,t){return jb(e,t)},concatenateArrayBuffers:Qy,decodeWeights:Xy,encodeWeights:function(e,t){return Yi(this,void 0,void 0,function(){var n,r,o,a,i,s=this;return $i(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),a=function(a){var i=o[a],u=Array.isArray(e)?e[a].tensor:e[i];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+i+"': "+u.dtype);var l={name:i,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var c=new Promise(function(e){return Yi(s,void 0,void 0,function(){var t,n,r,o,a,i,s;return $i(this,function(l){switch(l.label){case 0:return[4,u.bytes()];case 1:for(t=l.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),o=0,a=0;a<t.length;a++)i=t[a],s=new Uint8Array(new Uint32Array([i.length]).buffer),r.set(s,o),o+=4,r.set(i,o),o+=i.length;return e(r),[2]}})})});r.push(c)}else r.push(u.data());null!=t&&(l.group=t),n.push(l)},i=0;i<o.length;++i)a(i);return[4,Promise.all(r)];case 1:return[2,{data:Yy(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Mb(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Mb({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Mb({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return tb.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:eb,getSaveHandlers:function(e){return tb.getSaveHandlers(e)},http:jb,isHTTPScheme:Db,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),Yi(this,void 0,void 0,function(){return $i(this,function(o){return[2,Rb(function(e){return Ib(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return tb.registerLoadRouter(e)},registerSaveRouter:function(e){return tb.registerSaveRouter(e)},weightsLoaderFactory:Rb,withSaveHandler:function(e){return new Fb(e)},copyModel:function(e,t){return Yi(this,void 0,void 0,function(){return $i(this,function(n){return[2,ab(e,t,!1)]})})},listModels:function(){return Yi(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return $i(this,function(s){switch(s.label){case 0:e=rb.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,rb.getManager(o).listModels()]):[3,4];case 2:for(i in a=s.sent())t[o+nb+i]=a[i];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return Yi(this,void 0,void 0,function(){return $i(this,function(n){return[2,ab(e,t,!0)]})})},removeModel:function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){return t=ob(e),[2,rb.getManager(t.scheme).removeModel(t.path)]})})}}),Bb=Hl({confusionMatrix_:function(e,t,n){var r=Dl(e,"labels","confusionMatrix"),o=Dl(t,"predictions","confusionMatrix");ds(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),ds(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),ds(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),ds(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),ds(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var a=Oc(r.asType("int32"),n),i=Oc(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),Ub=(Object.freeze({confusionMatrix:Bb}),Hl({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);i=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=ns("FromPixels",wu.backendName))return wu.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],d=l[1];if(i?s=e.getContext("2d").getImageData(0,0,c,d).data:r||n?s=e.data:(a||o)&&(null==Ob&&(Ob=document.createElement("canvas").getContext("2d")),Ob.canvas.width=c,Ob.canvas.height=d,Ob.drawImage(e,0,0,c,d),s=Ob.getImageData(0,0,c,d).data),4===t)u=new Int32Array(s);else{var h=c*d;u=new Int32Array(h*t);for(var f=0;f<h;f++)for(var p=0;p<t;++p)u[f*t+p]=s[4*f+p]}return Zl(u,[d,c,t],"int32")}})),zb=Object.freeze({toPixels:function(e,t){return Yi(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x,w,k,_,E;return $i(this,function(C){switch(C.label){case 0:if(n=Dl(e,"img","toPixels"),e instanceof au||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],a=r[1],(i=2===n.rank?1:n.shape[2])>4||2===i)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,n.data()];case 1:return s=C.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=C.sent(),d=c[0],h=c[1],f=d[0],p=h[0],u.dispose(),l.dispose(),"float32"===n.dtype){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m="float32"===n.dtype?255:1,v=new Uint8ClampedArray(a*o*4),g=0;g<o*a;++g)y=void 0,b=void 0,x=void 0,w=void 0,1===i?(y=s[g]*m,b=s[g]*m,x=s[g]*m,w=255):3===i?(y=s[3*g]*m,b=s[3*g+1]*m,x=s[3*g+2]*m,w=255):4===i&&(y=s[4*g]*m,b=s[4*g+1]*m,x=s[4*g+2]*m,w=s[4*g+3]*m),v[0+(k=4*g)]=Math.round(y),v[k+1]=Math.round(b),v[k+2]=Math.round(x),v[k+3]=Math.round(w);return null!=t&&(t.width=a,t.height=o,_=t.getContext("2d"),E=new ImageData(v,a,o),_.putImageData(E,0,0)),n!==e&&n.dispose(),[2,v]}})})},fromPixels:Ub}),Wb=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),Vb=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Hb(e){ds(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),ds("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),ds(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Vb.register(e)}Object.freeze({Serializable:Wb,SerializationMap:Vb,registerClass:Hb});function qb(){return 32===wu.backend.floatPrecision()?.001:.1}function Gb(e,t,n){var r=!0;if((Rs(e)||Rs(t))&&(r=!1),Rs(e)&&Rs(t)&&(r=!0),r){var o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var i=Rl(e),s=Rl(t);if(!vs(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=Rs(e)?e:ps(e),l=Rs(t)?t:ps(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var d=u[c],h=l[c];if(!n(d,h))throw new Error("Arrays differ: actual["+c+"] = "+d+", expected["+c+"] = "+h+".\nActual:   "+u+".\nExpected: "+l+".")}}function Kb(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=qb()),Gb(e,t,function(e,t){return Kb(e,t,n)})},testEpsilon:qb,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Ps(e)||Ps(e[0])||Ps(t)||Ps(t[0])?Gb(e,n,function(e,t){return e==t}):Gb(e,t,function(e,t){return Kb(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=qb()),!Kb(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:Rf,webgl_util:El,forceHalfFloat:function(){Qi().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:qp,setWebGLContext:Iu,GPGPUContext:Af});var Xb=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Xi(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,a=r.grads;if(null!=n){var i=n.map(function(e){return{name:e.name,tensor:a[e.name]}});this.applyGradients(i)}else this.applyGradients(a);return Tl(a),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){ds(Fs(e),function(){return"The f passed in variableGrads(f) must be a function"}),ds(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof du}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],wu.registeredVariables)t.push(wu.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,a=t.length;ds((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."});var i=wu.gradients(e,t,null,!0),s=i.value,u=i.grads;ds(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ds(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(e,t){null!=u[t]&&(l[e.name]=u[t])}),null!=o&&o.forEach(function(e){return l[e.name]=null}),{value:s,grads:l}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Tl(this.iterations_)},t.prototype.saveIterations=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:$l(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(Wb);Object.defineProperty(Xb,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Yb=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=wu.backend.epsilon()),o}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=wu.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Nl(function(){return ic(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Nl(function(){return ic(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Nl(function(){var e=i.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(i.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));i.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Tl(this.accumulatedGrads.map(function(e){return e.variable})),Tl(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(Xb);Hb(Yb);var $b=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=wu.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Nl(function(){return rc(o.shape,t.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedGrads[r].variable;Nl(function(){var e=i.add(a.square());i.assign(e);var n=a.div(e.add(wu.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Tl(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(Xb);Hb($b);var Jb=function(e){function t(t,n,r,o){void 0===o&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Nl(function(){a.accBeta1=$l(n).variable(),a.accBeta2=$l(r).variable()}),null==o&&(a.epsilon=wu.backend.epsilon()),a}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Nl(function(){var r=pv(1,t.accBeta1),o=pv(1,t.accBeta2);n.forEach(function(n,a){var i=wu.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Nl(function(){return ic(i).variable(!1)})}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:Nl(function(){return ic(i).variable(!1)})});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedSecondMoment[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),d=l.mul(t.beta2).add(s.square().mul(1-t.beta2)),h=c.div(r),f=d.div(o);u.assign(c),l.assign(d);var p=h.div(f.sqrt().add(t.epsilon)).mul(-t.learningRate).add(i);i.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Tl(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Tl(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){var t,n=this;return $i(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Nl(function(){n.accBeta1.assign(dv(n.beta1,n.iterations_+1)),n.accBeta2.assign(dv(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(Xb);Hb(Jb);var Qb=function(e){function t(t,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Nl(function(){i.iteration=$l(0).variable(),i.accBeta1=$l(n).variable()}),null==o&&(i.epsilon=wu.backend.epsilon()),i}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Nl(function(){var r=pv(1,t.accBeta1),o=Zm(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,a){var i=wu.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:ic(i).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:ic(i).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[a].variable,l=t.accumulatedWeightedInfNorm[a].variable,c=u.mul(t.beta1).add(s.mul(1-t.beta1)),d=l.mul(t.beta2),h=s.abs(),f=d.maximum(h);u.assign(c),l.assign(f);var p=o.div(r).mul(c.div(f.add(t.epsilon))).add(i);i.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Tl(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Tl(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(Xb);Hb(Qb);var Zb=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=wu.registeredVariables[n];Nl(function(){var e=t.c.mul(o).add(a);a.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return wu.keep(e)}($l(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(Xb);Hb(Zb);var ex=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=$l(o.momentum),o}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=wu.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Nl(function(){return ic(o).variable(!1)})});var a=t.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[n];null!=i&&Nl(function(){var e,n=t.m.mul(a).add(i);e=t.useNesterov?t.c.mul(i.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),a.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Tl(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){return $i(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){return $i(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(Zb);Hb(ex);var tx=function(e){function t(t,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=e.call(this)||this;if(i.learningRate=t,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=wu.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return Xi(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=wu.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Nl(function(){return ic(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Nl(function(){return ic(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Nl(function(){return ic(o).variable(!1)})});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Nl(function(){var e=i.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(a.mul(1-t.decay)),l=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));i.assign(e),n.assign(u),s.assign(l);var c=o.sub(l);o.assign(c)}else{var d=i.mul(t.decay).add(a.square().mul(1-t.decay));l=s.mul(t.momentum).add(a.mul(t.learningRate).div(d.add(t.epsilon).sqrt())),i.assign(d),s.assign(l),c=o.sub(l),o.assign(c)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Tl(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Tl(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Tl(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return Yi(this,void 0,void 0,function(){var e;return $i(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return Yi(this,void 0,void 0,function(){var t;return $i(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(Xb);Hb(tx);var nx=function(){function e(){}return e.sgd=function(e){return new Zb(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new ex(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new tx(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Jb(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new Yb(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new Qb(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new $b(e,t)},e}();nx.sgd,nx.momentum,nx.adadelta,nx.adagrad,nx.rmsprop,nx.adamax,nx.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;function rx(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var o=n.x,a=n.y,i=t[r];e.moveTo(i.x,i.y),e.lineTo(o,a)}),n){var r=t[t.length-1],o=t[0];if(!r||!o)return;e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)}e.stroke()}au.prototype.squaredDifference=function(e){return Xp(this,e)},ru=Ay;var ox=function(e,t){return ox=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},ox(e,t)};function ax(e,t){function n(){this.constructor=e}ox(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ix=function(){return ix=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ix.apply(this,arguments)};function sx(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(We){a(We)}}function s(e){try{u(r.throw(e))}catch(We){a(We)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}u((r=r.apply(e,t||[])).next())})}function ux(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(We){a=[6,We],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function lx(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}var cx=function(){function e(e,t){if(!bx(e)||!bx(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function dx(e,t){return e instanceof au&&e.shape.length===t}function hx(e){return dx(e,3)}function fx(e){return dx(e,4)}function px(e){return e%2===0}function mx(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function vx(e){return e&&e.width&&e.height}function gx(e){return e.reduce(function(e,t){return e.add(t)},new wx(0,0)).div(new wx(e.length,e.length))}function yx(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function bx(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function xx(e){return bx(e)&&0<=e&&e<=1}var wx=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),kx=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(bx),a=[r.x,r.y,r.width,r.height].every(bx);if(!a&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(bx)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new wx(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new wx(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new wx(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new wx(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,a=t.height,i=Math.abs(o-a);return o<a&&(n-=i/2,o+=i),a<o&&(r-=i/2,a+=i),new e({x:n,y:r,width:o,height:a})},e.prototype.rescale=function(t){var n=vx(t)?t.width:t,r=vx(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,a=r.y,i=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(a,0),c=i-u,d=s-l;return new e({x:u,y:l,width:Math.min(c,t-u),height:Math.min(d,n-l)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,a=r,i=this.left,s=this.top,u=this.right,l=this.bottom;return u>t&&(o=-u+t+n,u=t),l>e&&(a=-l+e+r,l=e),i<1&&(a=2-i,i=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:o,y:s,ey:l,x:i,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),_x=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:o},a)||this}return ax(t,e),t}(kx),Ex=function(){function e(e,t,n,r,o){this._imageDims=new cx(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new kx(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new kx(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Cx=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return ax(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(Ex);function Sx(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Nx(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),a=[],i=function(){var t=o.pop();a.push(t);for(var i=o,s=[],u=0;u<i.length;u++){var l=i[u],c=e[t],d=e[l];s.push(Sx(c,d,r))}o=o.filter(function(e,t){return s[t]<=n})};o.length>0;)i();return a}function Tx(e,t){return Nl(function(){var n=t[0],r=t[1],o=t[2],a=rc(lx(e.shape.slice(0,3),[1]),n),i=rc(lx(e.shape.slice(0,3),[1]),r),s=rc(lx(e.shape.slice(0,3),[1]),o),u=sc([a,i,s],3);return pv(e,u)})}function Ix(e){return 1/(1+Math.exp(-e))}var Rx=function(e){function t(t,n,r,o,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:o},a)||this}return ax(t,e),t}(kx),Ax=function(){function e(e,t,n){void 0===n&&(n=new wx(0,0));var r=t.width,o=t.height;this._imgDims=new cx(r,o),this._shift=n,this._positions=e.map(function(e){return e.mul(new wx(r,o)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new wx(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new wx(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new wx(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof Cx?e.box.floor():new kx(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,a=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},a=(o(t)+o(n))/2,i=Math.floor(a/.45),s=gx(e),u=Math.floor(Math.max(0,s.x-.5*i)),l=Math.floor(Math.max(0,s.y-.43*i));return new Rx(u,l,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+l))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return t<e?t:e},1/0),a=t.reduce(function(e,t){return e<t?t:e},0),i=n.reduce(function(e,t){return e<t?t:e},0);return new _x(r,o,a,i)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),Dx=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],gx([e[3],e[4]])]},t}(Ax),Px=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(gx)},t}(Ax),jx=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+mx(this.distance)+")":"")},e}(),Ox=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return ax(t,e),t.assertIsValidLabeledBox=function(e,t){if(kx.assertIsValidBox(e,t),!bx(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(kx),Mx=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(e){return new Float32Array(e)});return new e(t.label,n)},e}();!function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=o,a}ax(t,e),t.assertIsValidPredictedBox=function(e,t){if(Ox.assertIsValidLabeledBox(e,t),!xx(e.score)||!xx(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(Ox);function Fx(e){return e.detection instanceof Cx}function Lx(e,t){var n={detection:t};return Object.assign({},e,n)}function Bx(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function Ux(e){var t="";if(!e)try{e=n(591)}catch(r){t=r.toString()}return{readFile:e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function zx(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=Ux();return ix({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function Wx(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}var Vx,Hx=n(224);function qx(){return"object"===typeof n.g&&"undefined"!==typeof Hx&&!!Hx.version}function Gx(e){Vx=e}function Kx(){Wx()&&Gx(Bx()),qx()&&Gx(zx())}var Xx,Yx={getEnv:function(){if(!Vx)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Vx},setEnv:Gx,initialize:Kx,createBrowserEnv:Bx,createFileSystem:Ux,createNodejsEnv:zx,monkeyPatch:function(e){if(Vx||Kx(),!Vx)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?Vx.Canvas:t,r=e.Image,o=void 0===r?Vx.Image:r;Vx.Canvas=n,Vx.Image=o,Vx.createCanvasElement=e.createCanvasElement||function(){return new n},Vx.createImageElement=e.createImageElement||function(){return new o},Vx.ImageData=e.ImageData||Vx.ImageData,Vx.Video=e.Video||Vx.Video,Vx.fetch=e.fetch||Vx.fetch,Vx.readFile=e.readFile||Vx.readFile},isBrowser:Wx,isNodejs:qx};function $x(e){return Yx.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function Jx(e){var t=Yx.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=$x(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}Kx(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Xx||(Xx={}));var Qx=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,a=e.fontStyle,i=e.padding;this.anchorPosition=t||Xx.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=i||4},Zx=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new Qx(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===Xx.BOTTOM_RIGHT||n===Xx.TOP_RIGHT,o=n===Xx.BOTTOM_LEFT||n===Xx.BOTTOM_RIGHT,a=this.measureWidth(e),i=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(t){var l=t.width,c=t.height;return{x:Math.max(Math.min(s,l-a),0),y:Math.max(Math.min(u,c-i),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=$x(e),n=Jx(t),r=this.options,o=r.backgroundColor,a=r.fontColor,i=r.fontSize,s=r.fontStyle,u=r.padding;n.font=i+"px "+s;var l=this.measureWidth(n),c=this.measureHeight();n.fillStyle=o;var d=this.getUpperLeft(n,t);n.fillRect(d.x,d.y,l,c),n.fillStyle=a,this.text.forEach(function(e,t){var r=u+d.x,o=u+d.y+(t+1)*i;n.fillText(e,r,o)})},e}(),ew=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:Xx.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Qx(Object.assign({},a,o))},tw=function(){function e(e,t){void 0===t&&(t={}),this.box=new kx(e),this.options=new ew(t)}return e.prototype.draw=function(e){var t=Jx(e),n=this.options,r=n.boxColor,o=n.lineWidth,a=this.box,i=a.x,s=a.y,u=a.width,l=a.height;t.strokeStyle=r,t.lineWidth=o,t.strokeRect(i,s,u,l);var c=this.options.label;c&&new Zx([c],{x:i-o/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function nw(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof Cx?t.score:Fx(t)?t.detection.score:void 0,r=t instanceof Cx?t.box:Fx(t)?t.detection.box:new kx(t),o=n?""+mx(n):void 0;new tw(r,{label:o}).draw(e)})}function rw(e){var t=Yx.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function ow(e){var t=Yx.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new cx(e.naturalWidth,e.naturalHeight):e instanceof r?new cx(e.videoWidth,e.videoHeight):new cx(e.width,e.height)}function aw(e){var t=e.width,n=e.height,r=(0,Yx.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function iw(e,t){var n=Yx.getEnv().ImageData;if(!(e instanceof n)&&!rw(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||ow(e),o=r.width,a=r.height,i=aw({width:o,height:a});return e instanceof n?Jx(i).putImageData(e,0,0):Jx(i).drawImage(e,0,0,o,a),i}function sw(e,t){return sx(this,void 0,void 0,function(){var n,r,o,a,i,s;return ux(this,function(u){switch(u.label){case 0:return n=t||Yx.getEnv().createCanvasElement(),r=e.shape.slice(fx(e)?1:0),o=r[0],a=r[1],i=r[2],s=Nl(function(){return e.as3D(o,a,i).toInt()}),[4,zb.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function uw(e){var t=Yx.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}var lw=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(hx(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(fx(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof Yx.getEnv().Canvas?e:iw(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return yx(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new cx(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Nl(function(){var r=yx(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof au){var a=fx(o)?o:o.expandDims();return a=function(e,t){return void 0===t&&(t=!1),Nl(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var a=Math.abs(r-o),i=Math.round(a*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,rc(n,0)},l=u(i),c=a-l.shape[s],d=[t&&c?u(c):null,e,l].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return sc(d,s)})}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=ky.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(o instanceof Yx.getEnv().Canvas)return zb.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=Yx.getEnv(),o=r.Image,a=r.Canvas;if(!(e instanceof o||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=ow(e),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=aw({width:t,height:t}),d=e instanceof a?e:iw(e),h=Math.abs(u-l)/2,f=n&&u<l?h:0,p=n&&l<u?h:0;return Jx(c).drawImage(d,f,p,u,l),c}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=Xc(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return o})},e}();function cw(e){return sx(this,void 0,void 0,function(){var t,n,r;return ux(this,function(o){switch(o.label){case 0:if(e instanceof lw)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map($x)).forEach(function(e,r){if(!uw(e)&&!hx(e)&&!fx(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(fx(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return uw(e)&&(t=e,new Promise(function(e,n){if(t instanceof Yx.getEnv().Canvas||rw(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)}));var t}))];case 1:return o.sent(),[2,new lw(r,Array.isArray(e))]}})})}function dw(e,t){return sx(this,void 0,void 0,function(){var n,r,o,a,i,s;return ux(this,function(u){switch(u.label){case 0:return n=Yx.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,cw(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=o.getInput(0))instanceof n?(i=a,[3,4]):[3,2];case 2:return[4,sw(a)];case 3:i=u.sent(),u.label=4;case 4:r=i,u.label=5;case 5:return s=Jx(r),[2,t.map(function(e){return e instanceof Cx?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,o=e.height,a=aw({width:r,height:o});return Jx(a).putImageData(s.getImageData(t,n,r,o),0,0),a})]}})})}function hw(e,t){return sx(this,void 0,void 0,function(){return ux(this,function(n){if(!hx(e)&&!fx(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(fx(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Nl(function(){var n=e.shape.slice(fx(e)?1:0),r=n[0],o=n[1],a=n[2],i=t.map(function(e){return e instanceof Cx?e.forSize(o,r).box:e}).map(function(e){return e.clipAtImageBorders(o,r)}).map(function(t){var n=t.x,i=t.y,s=t.width,u=t.height;return cg(e.as3D(r,o,a),[i,n,0],[u,s,a])});return i})]})})}function fw(e,t){return sx(this,void 0,void 0,function(){var n;return ux(this,function(r){switch(r.label){case 0:return[4,(0,Yx.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function pw(e){return sx(this,void 0,void 0,function(){return ux(this,function(t){switch(t.label){case 0:return[4,fw(e)];case 1:return[2,t.sent().json()]}})})}function mw(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter(function(e){return e}),a=e.endsWith(".json")?o[o.length-1]:n,i=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:i=e.startsWith("/")?"/"+i:i,manifestUri:"/"===i?"/"+a:i+"/"+a}}function vw(e,t){return sx(this,void 0,void 0,function(){var n,r,o,a;return ux(this,function(i){switch(i.label){case 0:return n=mw(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,pw(r)];case 1:return a=i.sent(),[2,Lb.loadWeights(a,o)]}})})}function gw(e,t,n){void 0===n&&(n=!1);var r=n?ow(t):t,o=r.width,a=r.height;return e.width=o,e.height=a,{width:o,height:a}}var yw=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof du})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof du)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,o=Xl(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return sx(this,void 0,void 0,function(){return ux(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,vw(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return sx(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,l,c;return ux(this,function(d){switch(d.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=Yx.getEnv().readFile,n=mw(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,a=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},i=Lb.weightsLoaderFactory(a),l=(u=JSON).parse,[4,t(r)];case 1:return s=l.apply(u,[d.sent().toString()]),[4,i(s,o)];case 2:return c=d.sent(),this.loadFromWeightMap(c),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof au))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function bw(e,t,n){return Nl(function(){var r=Vv(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Ym(r,t.bias)})}function xw(e,t,n){return void 0===n&&(n=!1),Nl(function(){var r=Ng(n?Ym(Mv(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):bw(e,t.conv0,[2,2])),o=bw(r,t.conv1,[1,1]),a=bw(Ng(Ym(r,o)),t.conv2,[1,1]);return Ng(Ym(r,Ym(o,a)))})}function ww(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Nl(function(){var o=Ng(n?Ym(Mv(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):bw(e,t.conv0,r?[2,2]:[1,1])),a=bw(o,t.conv1,[1,1]),i=bw(Ng(Ym(o,a)),t.conv2,[1,1]),s=bw(Ng(Ym(o,Ym(a,i))),t.conv3,[1,1]);return Ng(Ym(o,Ym(a,Ym(i,s))))})}function kw(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Nl(function(){var o=Ym(Mv(e,t.filters,[1,1],n),t.bias);return r?Ng(o):o})}function _w(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function Ew(e,t){return function(n,r,o,a){var i=ec(e(n*r*o*o),[o,o,n,r]),s=Jl(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}}function Cw(e,t){return function(n,r,o){var a=Ql(e(n*r),[n,r]),i=Jl(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:a,bias:i}}}var Sw=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function Nw(e,t){return function(n,r,o){var a=ec(e(9*n),[3,3,n,1]),i=ec(e(n*r),[1,1,n,r]),s=Jl(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Sw(a,i,s)}}function Tw(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new Sw(n,r,o)}}function Iw(e,t){return function(n,r,o){var a=e[n];if(!dx(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:o||n}),a}}function Rw(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function Aw(e,t){var n=Ew(e,t),r=Nw(e,t);function o(e,t,o,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var i=o(e,t,n,a);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,n+"/conv3")}}}}function Dw(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function Pw(e,t){var n=Iw(e,t),r=Dw(n),o=Tw(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var jw=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return ax(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Nl(function(){var n=ww(Tx(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div($l(255)),t.dense0,!0);return n=ww(n,t.dense1),n=ww(n,t.dense2),n=ww(n,t.dense3),n=rg(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=Pw(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return _w(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Rw(e),r=n.extractWeights,o=n.getRemainingWeights,a=Aw(r,t).extractDenseBlock4Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2"),l=a(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}(e)},t}(yw);function Ow(e,t){return Nl(function(){return Ym(Gv(e,t.weights),t.bias)})}function Mw(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Fw=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return ax(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Nl(function(){var r=e instanceof lw?t.faceFeatureExtractor.forwardInput(e):e;return Ow(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=Rw(e),a=o.extractWeights,i=o.getRemainingWeights,s=Cw(a,r)(t,n,"fc");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=Mw(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=Iw(e,n),o={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return _w(e,n),{params:o,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(a)},t}(yw),Lw=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Bw=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);Lw.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return Lw.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),Uw=function(e){function t(t){return void 0===t&&(t=new jw),e.call(this,"FaceExpressionNet",t)||this}return ax(t,e),t.prototype.forwardInput=function(e){var t=this;return Nl(function(){return vd(t.runNet(e))})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return sx(this,void 0,void 0,function(){var t,n,r,o,a=this;return ux(this,function(i){switch(i.label){case 0:return[4,cw(e)];case 1:return t=i.sent(),[4,this.forwardInput(t)];case 2:return n=i.sent(),[4,Promise.all(Jc(n).map(function(e){return sx(a,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=i.sent(),n.dispose(),o=r.map(function(e){return new Bw(e)}),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Fw);function zw(e,t){var n={expressions:t};return Object.assign({},e,n)}function Ww(e){return Fx(e)&&e.landmarks instanceof Ax&&e.unshiftedLandmarks instanceof Ax&&e.alignedRect instanceof Cx}function Vw(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),a=e.detection.imageDims,i={landmarks:r,unshiftedLandmarks:t,alignedRect:new Cx(e.detection.score,o.rescale(a.reverse()),a)};return Object.assign({},e,i)}var Hw=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,o=void 0===r||r,a=e.lineWidth,i=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},qw=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new Hw(t)}return e.prototype.draw=function(e){var t=Jx(e),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,i=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof Px&&(t.strokeStyle=i,t.lineWidth=a,rx(t,this.faceLandmarks.getJawOutline()),rx(t,this.faceLandmarks.getLeftEyeBrow()),rx(t,this.faceLandmarks.getRightEyeBrow()),rx(t,this.faceLandmarks.getNose()),rx(t,this.faceLandmarks.getLeftEye(),!0),rx(t,this.faceLandmarks.getRightEye(),!0),rx(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}},e}();function Gw(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof Ax?t:Ww(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new qw(n).draw(e)})}function Kw(e,t){var n=[],r=Rw(e),o=r.extractWeights,a=r.getRemainingWeights,i=function(e,t){var n=Ew(e,t),r=Nw(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,d={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},h={};yx(t,0,1).forEach(function(e){h["main_block_"+e]=c(128,"middle_flow/main_block_"+e)});var f={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:d,middle_flow:h,exit_flow:f}}}function Xw(e,t){var n=[],r=function(e,t){var n=Iw(e,t),r=Dw(n),o=Tw(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,a=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:i("entry_flow/reduction_block_0"),reduction_block_1:i("entry_flow/reduction_block_1")},l={};yx(t,0,1).forEach(function(e){l["main_block_"+e]=s("middle_flow/main_block_"+e)});var c={reduction_block:i("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return _w(e,n),{params:{entry_flow:u,middle_flow:l,exit_flow:c},paramMappings:n}}function Yw(e,t,n){return Ym(Mv(e,t.filters,n,"same"),t.bias)}function $w(e,t,n){void 0===n&&(n=!0);var r=n?Ng(e):e;return r=bw(r,t.separable_conv0,[1,1]),r=bw(Ng(r),t.separable_conv1,[1,1]),r=ng(r,[3,3],[2,2],"same"),r=Ym(r,Yw(e,t.expansion_conv,[2,2]))}var Jw,Qw=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return ax(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Nl(function(){var r=Tx(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div($l(256)),o=Ng(Yw(r,n.entry_flow.conv_in,[2,2]));return o=$w(o,n.entry_flow.reduction_block_0,!1),o=$w(o,n.entry_flow.reduction_block_1),yx(t._numMainBlocks,0,1).forEach(function(e){o=function(e,t){var n=bw(Ng(e),t.separable_conv0,[1,1]);return n=bw(Ng(n),t.separable_conv1,[1,1]),n=bw(Ng(n),t.separable_conv2,[1,1]),Ym(n,e)}(o,n.middle_flow["main_block_"+e])}),o=$w(o,n.exit_flow.reduction_block),o=Ng(bw(o,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Xw(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Kw(e,this._numMainBlocks)},t}(yw);!function(e){e.FEMALE="female",e.MALE="male"}(Jw||(Jw={}));var Zw=function(e){function t(t){void 0===t&&(t=new Qw(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return ax(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Nl(function(){var r=e instanceof lw?t.faceFeatureExtractor.forwardInput(e):e,o=rg(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:Ow(o,n.fc.age).as1D(),gender:Ow(o,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return Nl(function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:vd(o)}})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return sx(this,void 0,void 0,function(){var t,n,r,o,a,i,s=this;return ux(this,function(u){switch(u.label){case 0:return[4,cw(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=Jc(n.age),o=Jc(n.gender),a=r.map(function(e,t){return{ageTensor:e,genderTensor:o[t]}}),[4,Promise.all(a.map(function(e){var t=e.ageTensor,n=e.genderTensor;return sx(s,void 0,void 0,function(){var e,r,o,a,i;return ux(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(o=r>.5)?Jw.MALE:Jw.FEMALE,i=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:i}]}})})}))];case 3:return i=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=Rw(e),r=n.extractWeights,o=n.getRemainingWeights,a=Cw(r,t),i=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=Mw(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=Iw(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return _w(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(yw),ek=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return Nl(function(){var n=function(e,t){return Xc([rc([68],e),rc([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],o=n.width,a=n.height;return t(o,a)?Math.abs(o-a)/2:0},i=e.mul(rc([o,136],t)).sub(Xc(Array.from(Array(o),function(e,t){return n(function(e){return a(e,function(e,t){return e<t})}(t),function(e){return a(e,function(e,t){return t<e})}(t))}))).div(Xc(Array.from(Array(o),function(e,t){return n(r[t].width,r[t].height)})));return i})},t.prototype.forwardInput=function(e){var t=this;return Nl(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return sx(this,void 0,void 0,function(){var t,n,r,o=this;return ux(this,function(a){switch(a.label){case 0:return[4,cw(e)];case 1:return t=a.sent(),n=Nl(function(){return Jc(o.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return sx(o,void 0,void 0,function(){var r,o,a,i,s;return ux(this,function(u){switch(u.label){case 0:return a=(o=Array).from,[4,e.data()];case 1:return r=a.apply(o,[u.sent()]),i=r.filter(function(e,t){return px(t)}),s=r.filter(function(e,t){return!px(t)}),[2,new Px(Array(68).fill(0).map(function(e,t){return new wx(i[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Fw),tk=function(e){function t(t){return void 0===t&&(t=new jw),e.call(this,"FaceLandmark68Net",t)||this}return ax(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(ek);var nk=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return ax(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Nl(function(){var n=xw(Tx(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div($l(255)),t.dense0,!0);return n=xw(n,t.dense1),n=xw(n,t.dense2),n=rg(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=Pw(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return _w(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Rw(e),r=n.extractWeights,o=n.getRemainingWeights,a=Aw(r,t).extractDenseBlock3Params,i=a(3,32,"dense0",!0),s=a(32,64,"dense1"),u=a(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}(e)},t}(yw),rk=function(e){function t(t){return void 0===t&&(t=new nk),e.call(this,"FaceLandmark68TinyNet",t)||this}return ax(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(ek);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ax(t,e)}(tk);function ok(e,t,n,r,o){void 0===o&&(o="same");var a=t.conv,i=a.filters,s=a.bias,u=Mv(e,i,n,o);return u=function(e,t){return Ym(lv(e,t.weights),t.biases)}(u=Ym(u,s),t.scale),r?Ng(u):u}function ak(e,t){return ok(e,t,[1,1],!1)}function ik(e,t){return ok(e,t,[2,2],!0,"valid")}function sk(e,t){function n(n,r,o,a){var i=function(t,n,r){var o=e(t),a=o.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Nl(function(){return Rg(ec(o,[n,a,r,r]),[2,3,1,0])})}(n,r,o),s=Jl(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:i,bias:s}}function r(r,o,a,i){var s=n(r,o,a,i+"/conv"),u=function(n,r){var o=Jl(e(n)),a=Jl(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:a}}(o,i+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,o,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,o+"/conv1"),conv2:r(e,t,n,o+"/conv2")}}}}function uk(e,t){var n=Iw(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function lk(e){var t=[],n=uk(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,a=r("conv32_down"),i=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),d=o("conv64_2"),h=o("conv64_3"),f=o("conv128_down"),p=o("conv128_1"),m=o("conv128_2"),v=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!dx(x,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+x);var w={conv32_down:a,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:h,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return _w(e,t),{params:w,paramMappings:t}}function ck(e,t){var n=function(e,t){return ok(e,t,[1,1],!0)}(e,t.conv1);return n=ak(n,t.conv2),n=Ym(n,e),n=Ng(n)}function dk(e,t){var n=ik(e,t.conv1);n=ak(n,t.conv2);var r=rg(e,2,2,"valid"),o=nc(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var i=lx(n.shape);i[1]=1;var s=nc(i),u=lx((n=sc([n,s],1)).shape);u[2]=1;var l=nc(u);n=sc([n,l],2)}return r=a?sc([r,o],3):r,n=Ym(r,n),n=Ng(n)}var hk=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return ax(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Nl(function(){var n=ik(Tx(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div($l(256)),t.conv32_down);n=ck(n=ng(n,3,2,"valid"),t.conv32_1),n=ck(n,t.conv32_2),n=ck(n,t.conv32_3),n=ck(n=dk(n,t.conv64_down),t.conv64_1),n=ck(n,t.conv64_2),n=ck(n,t.conv64_3),n=ck(n=dk(n,t.conv128_down),t.conv128_1),n=ck(n,t.conv128_2),n=ck(n=dk(n,t.conv256_down),t.conv256_1);var r=(n=dk(n=ck(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Gv(r,t.fc)})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return sx(this,void 0,void 0,function(){var t,n,r,o=this;return ux(this,function(a){switch(a.label){case 0:return[4,cw(e)];case 1:return t=a.sent(),n=Nl(function(){return Jc(o.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=a.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return lk(e)},t.prototype.extractParams=function(e){return function(e){var t=Rw(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=sk(n,o),i=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),k=s(589824,256,3,"conv256_down_out"),_=Nl(function(){return Rg(Ql(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:h,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:w,conv256_down_out:k,fc:_},paramMappings:o}}(e)},t}(yw);function fk(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var pk=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,i=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=i,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function mk(e,t){function n(n,r,o,a,i){var s=ec(e(n*r*o*o),[o,o,n,r]),u=Jl(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(i?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var a=n(e,t,r,o,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function o(n,o,a){var i=function(n,r){var o=ec(e(9*n),[3,3,n,1]),a=Jl(e(n)),i=Jl(e(n)),s=Jl(e(n)),u=Jl(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:a,batch_norm_offset:i,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv");return{depthwise_conv:i,pointwise_conv:r(n,o,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function vk(e){var t=[],n=function(e,t){var n=Iw(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",i=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,i)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function i(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!hx(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var i={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:a}};return _w(e,t),{params:i,paramMappings:t}}function gk(e,t,n){return Nl(function(){var r=Mv(e,t.filters,n,"same");return r=Ym(r,t.batch_norm_offset),rm(r,0,6)})}function yk(e,t){return Nl(function(){var n=null,r=gk(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var o=t+1,a=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(o);r=function(e,t,n){return Nl(function(){var r=Uv(e,t.filters,n,"same");return r=Bm(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),rm(r,0,6)})}(r,e.depthwise_conv,a),r=gk(r,e.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function bk(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),h=(i-o)*(s-a),f=(c-u)*(d-l);if(h<=0||f<=0)return 0;var p=Math.max(o,u),m=Math.max(a,l),v=Math.min(i,c),g=Math.min(s,d),y=Math.max(v-p,0)*Math.max(g-m,0);return y/(h+f-y)}function xk(e,t){var n=function(e){var t=Jc(Rg(e,[1,0])),n=[pv(t[2],t[0]),pv(t[3],t[1])];return{sizes:n,centers:[Ym(t[0],Zm(n[0],$l(2))),Ym(t[1],Zm(n[1],$l(2)))]}}(e),r=n.sizes,o=n.centers,a=Jc(Rg(t,[1,0])),i=Zm(lv(sm(Zm(a[2],$l(5))),r[0]),$l(2)),s=Ym(lv(Zm(a[0],$l(10)),r[0]),o[0]),u=Zm(lv(sm(Zm(a[3],$l(5))),r[1]),$l(2)),l=Ym(lv(Zm(a[1],$l(10)),r[1]),o[1]);return Rg(Xc([pv(s,i),pv(l,u),Ym(s,i),Ym(l,u)]),[1,0])}function wk(e,t){return Nl(function(){var n=e.shape[0];return{boxPredictionEncoding:qc(kw(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:qc(kw(e,t.class_predictor),[n,-1,3])}})}var kk=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),_k=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return ax(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Nl(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=yk(pv(lv(n,$l(.007843137718737125)),$l(1)),t.mobilenetv1),o=function(e,t,n){return Nl(function(){var r=gk(e,n.conv_0,[1,1]),o=gk(r,n.conv_1,[2,2]),a=gk(o,n.conv_2,[1,1]),i=gk(a,n.conv_3,[2,2]),s=gk(i,n.conv_4,[1,1]),u=gk(s,n.conv_5,[2,2]),l=gk(u,n.conv_6,[1,1]),c=gk(l,n.conv_7,[2,2]),d=wk(t,n.box_predictor_0),h=wk(e,n.box_predictor_1),f=wk(o,n.box_predictor_2),p=wk(i,n.box_predictor_3),m=wk(u,n.box_predictor_4),v=wk(c,n.box_predictor_5);return{boxPredictions:sc([d.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:sc([d.classPrediction,h.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,v.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Nl(function(){var r=e.shape[0],o=xk(qc(Yc(n.extra_dim,[r,1,1]),[-1,4]),qc(e,[-1,4]));o=qc(o,[r,o.shape[0]/r,4]);var a=gm(sg(t,[0,0,1],[-1,-1,-1])),i=sg(a,[0,0,0],[-1,-1,1]);return i=qc(i,[r,i.shape[1]]),{boxes:Jc(o),scores:Jc(i)}})}(o.boxPredictions,o.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,cw(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),sx(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x,w;return ux(this,function(k){switch(k.label){case 0:return n=new kk(t),r=n.maxResults,o=n.minConfidence,[4,cw(e)];case 1:for(a=k.sent(),i=this.forwardInput(a),s=i.boxes,u=i.scores,l=s[0],c=u[0],d=1;d<s.length;d++)s[d].dispose(),u[d].dispose();return p=(f=Array).from,[4,c.data()];case 2:return h=p.apply(f,[k.sent()]),m=function(e,t,n,r,o){var a=e.shape[0],i=Math.min(n,a),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},l=[];return s.forEach(function(t){if(!(l.length>=i)){for(var n=t.score,r=l.length-1;r>=0;--r){var a=bk(e,t.boxIndex,l[r]);if(0!==a&&(t.score*=u(a),t.score<=o))break}n===t.score&&l.push(t.boxIndex)}}),l}(l,h,r,.5,o),v=a.getReshapedInputDimensions(0),g=a.inputSize,y=g/v.width,b=g/v.height,x=l.arraySync(),w=m.map(function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map(function(e){return e*b}),n=t[0],r=t[1],o=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map(function(e){return e*y}),i=o[0],s=o[1];return new Cx(h[e],new Rx(i,n,s-i,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),l.dispose(),c.dispose(),[2,w]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return vk(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=Rw(e),r=n.extractWeights,o=n.getRemainingWeights,a=mk(r,t),i=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=i(),l=s(),c={extra_dim:Zl(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:c},paramMappings:t}}(e)},t}(yw);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ax(t,e)}(_k);var Ek,Ck=[new wx(.738768,.874946),new wx(2.42204,2.65704),new wx(4.30971,7.04493),new wx(10.246,4.59428),new wx(12.6868,11.8741)],Sk=[new wx(1.603231,2.094468),new wx(6.041143,7.080126),new wx(2.882459,3.518061),new wx(4.266906,5.178857),new wx(9.041765,10.66308)],Nk=[117.001,114.697,97.404],Tk=function(e){return"number"===typeof e};function Ik(e){return Nl(function(){var t=lv(e,$l(.10000000149011612));return Ym(Ng(pv(e,t)),t)})}function Rk(e,t){return Nl(function(){var n=Mc(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Mv(n,t.conv.filters,[1,1],"valid"),n=pv(n,t.bn.sub),n=lv(n,t.bn.truediv),Ik(n=Ym(n,t.conv.bias))})}function Ak(e,t){return Nl(function(){var n=Mc(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Vv(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),Ik(n=Ym(n,t.bias))})}function Dk(e,t){var n=Ew(e,t);var r=Nw(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,a){var i=n(r,o,3,a+"/conv"),s=function(n,r){var o=Jl(e(n)),a=Jl(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:a}}(o,a+"/bn");return{conv:i,bn:s}},extractSeparableConvParams:r}}function Pk(e,t){var n=Iw(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:Tw(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(Ek||(Ek={}));var jk=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Ok=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Tk(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return Tk(e.x)&&Tk(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(Tk)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return ax(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=Rk(e,t.conv0);return n=Rk(n=ng(n,[2,2],[2,2],"same"),t.conv1),n=Rk(n=ng(n,[2,2],[2,2],"same"),t.conv2),n=Rk(n=ng(n,[2,2],[2,2],"same"),t.conv3),n=Rk(n=ng(n,[2,2],[2,2],"same"),t.conv4),n=Rk(n=ng(n,[2,2],[2,2],"same"),t.conv5),n=Rk(n=ng(n,[2,2],[1,1],"same"),t.conv6),kw(n=Rk(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?Ik(kw(e,t.conv0,"valid",!1)):Ak(e,t.conv0);return n=Ak(n=ng(n,[2,2],[2,2],"same"),t.conv1),n=Ak(n=ng(n,[2,2],[2,2],"same"),t.conv2),n=Ak(n=ng(n,[2,2],[2,2],"same"),t.conv3),n=Ak(n=ng(n,[2,2],[2,2],"same"),t.conv4),n=Ak(n=ng(n,[2,2],[2,2],"same"),t.conv5),n=ng(n,[2,2],[1,1],"same"),n=t.conv6?Ak(n,t.conv6):n,kw(n=t.conv7?Ak(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Nl(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?Tx(o,n.config.meanRgb):o).div($l(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},t.prototype.forward=function(e,t){return sx(this,void 0,void 0,function(){var n;return ux(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,cw(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),sx(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,h,f,p,m=this;return ux(this,function(v){switch(v.label){case 0:return n=new jk(t),r=n.inputSize,o=n.scoreThreshold,[4,cw(e)];case 1:return a=v.sent(),[4,this.forwardInput(a,r)];case 2:return i=v.sent(),s=Nl(function(){return Jc(i)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),o)];case 3:return l=v.sent(),i.dispose(),s.dispose(),c=l.map(function(e){return e.box}),d=l.map(function(e){return e.score}),h=l.map(function(e){return e.classScore}),f=l.map(function(e){return m.config.classes[e.label]}),p=Nx(c.map(function(e){return e.rescale(r)}),d,this.config.iouThreshold,!0),[2,p.map(function(e){return new Ex(d[e],h[e],f[e],c[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=Pk(e,r),a=o.extractConvParams,i=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:a("conv8")};return _w(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,a=Rw(e),i=a.extractWeights,s=a.getRemainingWeights,u=[],l=Dk(i,u),c=l.extractConvParams,d=l.extractConvWithBatchNormParams,h=l.extractSeparableConvParams;if(t.withSeparableConvs){var f=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8];o={conv0:t.isFirstLayerConv2d?c(f,p,3,"conv0"):h(f,p,"conv0"),conv1:h(p,m,"conv1"),conv2:h(m,v,"conv2"),conv3:h(v,g,"conv3"),conv4:h(g,y,"conv4"),conv5:h(y,b,"conv5"),conv6:x?h(b,x,"conv6"):void 0,conv7:w?h(x,w,"conv7"):void 0,conv8:c(w||x||b,5*n,1,"conv8")}}else f=r[0],p=r[1],m=r[2],v=r[3],g=r[4],y=r[5],b=r[6],x=r[7],w=r[8],o={conv0:d(f,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,v,"conv2"),conv3:d(v,g,"conv3"),conv4:d(g,y,"conv4"),conv5:d(y,b,"conv5"),conv6:d(b,x,"conv6"),conv7:d(x,w,"conv7"),conv8:c(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return sx(this,void 0,void 0,function(){var r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x,w,k,_,E,C,S,N,T,I,R,A,D=this;return ux(this,function(P){switch(P.label){case 0:return r=t.width,o=t.height,a=Math.max(r,o),i=a/r,s=a/o,u=e.shape[1],l=this.config.anchors.length,c=Nl(function(){var t=e.reshape([u,u,l,D.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,l,4]),t.slice([0,0,0,4],[u,u,l,1]),D.withClassScores?vd(t.slice([0,0,0,5],[u,u,l,D.config.classes.length]),3):$l(0)]}),d=c[0],h=c[1],f=c[2],p=[],[4,h.array()];case 1:return m=P.sent(),[4,d.array()];case 2:v=P.sent(),g=0,P.label=3;case 3:if(!(g<u))return[3,12];y=0,P.label=4;case 4:if(!(y<u))return[3,11];b=0,P.label=5;case 5:return b<l?(x=Ix(m[g][y][b][0]),!n||x>n?(w=(y+Ix(v[g][y][b][0]))/u*i,k=(g+Ix(v[g][y][b][1]))/u*s,_=Math.exp(v[g][y][b][2])*this.config.anchors[b].x/u*i,E=Math.exp(v[g][y][b][3])*this.config.anchors[b].y/u*s,C=w-_/2,S=k-E/2,N={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(f,N)]:[3,7]):[3,9]):[3,10];case 6:return A=P.sent(),[3,8];case 7:A={classScore:1,label:0},P.label=8;case 8:I=(T=A).classScore,R=T.label,p.push(ix({box:new _x(C,S,C+_,S+E),score:x,classScore:x*I,label:R},N)),P.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return d.dispose(),h.dispose(),f.dispose(),[2,p]}})})},t.prototype.extractPredictedClass=function(e,t){return sx(this,void 0,void 0,function(){var n,r,o,a;return ux(this,function(i){switch(i.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return a=i.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return a[n][r][o][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(yw),Mk=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:Sk,meanRgb:Nk}:{anchors:Ck,withClassScores:!0});return e.call(this,n)||this}return ax(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return sx(this,void 0,void 0,function(){return ux(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Cx(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ok);var Fk=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return ax(t,e),t}(jk),Lk=function(){function e(){}return e.prototype.then=function(e){return sx(this,void 0,void 0,function(){var t;return ux(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return sx(this,void 0,void 0,function(){return ux(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function Bk(e,t){var n={descriptor:t};return Object.assign({},e,n)}function Uk(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),sx(this,void 0,void 0,function(){var a,i,s,u,l;return ux(this,function(c){switch(c.label){case 0:return a=e.map(function(e){return Ww(e)?o(e):e.detection}),(s=r)?[3,5]:t instanceof au?[4,hw(t,a)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,dw(t,a)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return[4,n(i=s)];case 6:return l=c.sent(),i.forEach(function(e){return e instanceof au&&e.dispose()}),[2,l]}})})}function zk(e,t,n,r,o){return sx(this,void 0,void 0,function(){var a=this;return ux(this,function(i){return[2,Uk([e],t,function(e){return sx(a,void 0,void 0,function(){return ux(this,function(t){return[2,n(e[0])]})})},r,o)]})})}function Wk(e){var t=Rw(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],a=function(e,t){var n=Ew(e,t),r=Cw(e,t);function o(n,r){var o=Jl(e(n));return t.push({paramPath:r}),o}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return ix(ix({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),i=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return ix(ix({},e),{fc1:t,prelu4_alpha:n,fc2_1:i,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),i=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),l=r(256,2,"onet/fc2_1"),c=r(256,4,"onet/fc2_2"),d=r(256,10,"onet/fc2_3");return ix(ix({},e),{conv4:t,prelu4_alpha:i,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:d})}}}(n,o),i=a.extractPNetParams,s=a.extractRNetParams,u=a.extractONetParams,l=i(),c=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:o}}function Vk(e){var t=[],n=function(e,t){var n=Iw(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function i(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return ix(ix({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=i("rnet"),t=o("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return ix(ix({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=i("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=o("onet/fc1"),u=a("onet/prelu5_alpha"),l=o("onet/fc2_1"),c=o("onet/fc2_2"),d=o("onet/fc2_3");return ix(ix({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:l,fc2_2:c,fc2_3:d})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,a=n.extractONetParams,i=r(),s=o(),u=a();return _w(e,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function Hk(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var qk=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return ax(t,e),t}(kx);function Gk(e){return Nl(function(){return lv(pv(e,$l(127.5)),$l(.0078125))})}function Kk(e,t){return Nl(function(){return Ym(Ng(e),lv(t,fm(Ng(fm(e)))))})}function Xk(e,t,n){return void 0===n&&(n=!1),Nl(function(){var r=kw(e,t.conv1,"valid");return r=Kk(r,t.prelu1_alpha),r=Kk(r=kw(r=ng(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=Kk(r=kw(r=n?r:ng(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function Yk(e,t,n,r,o){o.stage1=[];var a=t.map(function(t){return Nl(function(){var n={scale:t},o=function(e,t){return Nl(function(){var n=Hk(t,e.shape.slice(1)),r=n.height,o=n.width,a=Gk(ky.resizeBilinear(e,[r,o]));return Rg(a,[0,2,1,3])})}(e,t),a=Date.now(),i=function(e,t){return Nl(function(){var n=Xk(e,t,!0),r=kw(n,t.conv4_1,"valid"),o=Dc(yg(r,3),3);return{prob:vd(pv(r,o),3),regions:kw(n,t.conv4_2,"valid")}})}(o,r),s=i.prob,u=i.regions;return n.pnet=Date.now()-a,{scoresTensor:Jc(Jc(s,3)[1])[0],regionsTensor:Jc(u)[0],scale:t,statsForScale:n}})}),i=a.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,i=e.statsForScale,s=function(e,t,n,r){for(var o=[],a=e.arraySync(),i=0;i<e.shape[0];i++)for(var s=0;s<e.shape[1];s++)a[i][s]>=r&&o.push(new wx(s,i));return o.map(function(e){var r=new _x(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=a[e.y][e.x],i=t.arraySync();return{cell:r,score:o,region:new qk(i[e.y][e.x][0],i[e.y][e.x][1],i[e.y][e.x][2],i[e.y][e.x][3])}})}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(i),[];var u=Date.now(),l=Nx(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return i.nms=Date.now()-u,i.numBoxes=l.length,o.stage1.push(i),l.map(function(e){return s[e]})}),s=i.reduce(function(e,t){return e.concat(t)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),d=Nx(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);o.stage1_nms=Date.now()-c,l=d.map(function(e){return s[e].score}),u=d.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new _x(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:l}}function $k(e,t,n){var r=n.width,o=n.height;return sx(this,void 0,void 0,function(){var n,a,i,s=this;return ux(this,function(u){switch(u.label){case 0:return n=Jx(e),[4,Promise.all(t.map(function(t){return sx(s,void 0,void 0,function(){var r,o,a,i,s,u,l,c;return ux(this,function(d){return r=t.padAtBorders(e.height,e.width),o=r.y,a=r.ey,i=r.x,s=r.ex,u=i-1,l=o-1,c=n.getImageData(u,l,s-u,a-l),[2,Yx.isNodejs()?iw(c):createImageBitmap(c)]})})}))];case 1:return a=u.sent(),i=[],a.forEach(function(e){var t=Jx(aw({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);i.push(a)}),[2,i.map(function(e){return Nl(function(){return Gk(Rg(ec(e,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function Jk(e,t,n,r,o){return sx(this,void 0,void 0,function(){var a,i,s,u,l,c,d,h,f,p,m,v,g,y;return ux(this,function(b){switch(b.label){case 0:return a=Date.now(),[4,$k(e,t,{width:24,height:24})];case 1:return i=b.sent(),o.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return Nl(function(){var n=Xk(e,t),r=Kk(Ow(qc(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=Ow(r,t.fc2_1),a=Dc(yg(o,1),1),i=vd(pv(o,a),1),s=Ow(r,t.fc2_2);return{scores:Jc(i,1)[1],regions:s}})}(e,r);return e.dispose(),t}),o.stage2_rnet=Date.now()-a,u=s.length>1?sc(s.map(function(e){return e.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[b.sent()]),u.dispose(),h=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=h.map(function(e){return t[e]}),p=h.map(function(e){return l[e]}),m=[],v=[],f.length>0&&(a=Date.now(),g=Nx(f,p,.7),o.stage2_nms=Date.now()-a,y=g.map(function(e){var t=s[h[e]].regions.arraySync();return new qk(t[0][0],t[0][1],t[0][2],t[0][3])}),v=g.map(function(e){return p[e]}),m=g.map(function(e,t){return f[e].calibrate(y[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:m,scores:v}]}})})}function Qk(e,t,n,r,o){return sx(this,void 0,void 0,function(){var a,i,s,u,l,c,d,h,f,p,m,v,g,y,b;return ux(this,function(x){switch(x.label){case 0:return a=Date.now(),[4,$k(e,t,{width:48,height:48})];case 1:return i=x.sent(),o.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=i.map(function(e){var t=function(e,t){return Nl(function(){var n=Xk(e,t);n=Kk(n=kw(n=ng(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=Kk(Ow(qc(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=Ow(r,t.fc2_1),a=Dc(yg(o,1),1),i=vd(pv(o,a),1),s=Ow(r,t.fc2_2),u=Ow(r,t.fc2_3);return{scores:Jc(i,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),o.stage3_onet=Date.now()-a,u=s.length>1?sc(s.map(function(e){return e.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[x.sent()]),u.dispose(),h=l.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=h.map(function(e){var t=s[e].regions.arraySync();return new qk(t[0][0],t[0][1],t[0][2],t[0][3])}),p=h.map(function(e,n){return t[e].calibrate(f[n])}),m=h.map(function(e){return l[e]}),v=[],g=[],y=[],p.length>0&&(a=Date.now(),b=Nx(p,m,.7,!1),o.stage3_nms=Date.now()-a,v=b.map(function(e){return p[e]}),g=b.map(function(e){return m[e]}),y=b.map(function(e,t){return Array(5).fill(0).map(function(n,r){var o=s[e].points.arraySync();return new wx(o[0][r]*(v[t].width+1)+v[t].left,o[0][r+5]*(v[t].height+1)+v[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:v,scores:g,points:y}]}})})}var Zk=function(e){function t(){return e.call(this,"Mtcnn")||this}return ax(t,e),t.prototype.load=function(t){return sx(this,void 0,void 0,function(){return ux(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},t.prototype.loadFromDisk=function(t){return sx(this,void 0,void 0,function(){return ux(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),sx(this,void 0,void 0,function(){var n,r,o,a,i,s,u,l,c,d,h,f,p,m,v,g,y,b,x,w,k;return ux(this,function(_){switch(_.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},a=Date.now(),i=Nl(function(){return e=Dc(zb.fromPixels(r)).toFloat(),Nl(function(){return Xc(Jc(e,3).reverse(),3)});var e}),s=function(e){return i.dispose(),o.total=Date.now()-a,e},u=i.shape.slice(1),l=u[0],c=u[1],d=new pk(t),h=d.minFaceSize,f=d.scaleFactor,p=d.maxNumScales,m=d.scoreThresholds,v=d.scaleSteps,g=(v||function(e,t,n){for(var r=n[0],o=n[1],a=12/e,i=[],s=Math.min(r,o)*a,u=0;s>=12;)i.push(a*Math.pow(t,u)),s*=t,u+=1;return i}(h,f,[l,c])).filter(function(e){var t=Hk(e,[l,c]);return Math.min(t.width,t.height)>12}).slice(0,p),o.scales=g,o.pyramid=g.map(function(e){return Hk(e,[l,c])}),y=Date.now(),[4,Yk(i,g,m[0],n.pnet,o)];case 1:return b=_.sent(),o.total_stage1=Date.now()-y,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,Jk(r,b.boxes,m[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return x=_.sent(),o.total_stage2=Date.now()-y,x.boxes.length?(o.stage3_numInputBoxes=x.boxes.length,y=Date.now(),[4,Qk(r,x.boxes,m[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return w=_.sent(),o.total_stage3=Date.now()-y,k=w.boxes.map(function(e,t){return Vw(Lx({},new Cx(w.scores[t],new Rx(e.left/c,e.top/l,e.width/c,e.height/l),{height:l,width:c})),new Dx(w.points[t].map(function(t){return t.sub(new wx(e.left,e.top)).div(new wx(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:k,stats:o})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),sx(this,void 0,void 0,function(){var n;return ux(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,cw(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),sx(this,void 0,void 0,function(){var n;return ux(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,cw(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Vk(e)},t.prototype.extractParams=function(e){return Wk(e)},t}(yw),e_=[new wx(1.603231,2.094468),new wx(6.041143,7.080126),new wx(2.882459,3.518061),new wx(4.266906,5.178857),new wx(9.041765,10.66308)],t_=[117.001,114.697,97.404],n_=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:e_,meanRgb:t_,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return ax(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return sx(this,void 0,void 0,function(){return ux(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Cx(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(Ok),r_={ssdMobilenetv1:new _k,tinyFaceDetector:new n_,tinyYolov2:new Mk,mtcnn:new Zk,faceLandmark68Net:new tk,faceLandmark68TinyNet:new rk,faceRecognitionNet:new hk,faceExpressionNet:new Uw,ageGenderNet:new Zw};function o_(e,t){var n={age:t};return Object.assign({},e,n)}var a_=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return ax(t,e),t}(Lk),i_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n=this;return ux(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Uk(e=r.sent(),this.input,function(e){return sx(n,void 0,void 0,function(){return ux(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return r_.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return zw(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new d_(this,this.input)},t}(a_),s_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t;return ux(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,zk(e,this.input,function(e){return r_.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,zw(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new h_(this,this.input)},t}(a_),u_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.withAgeAndGender=function(){return new f_(this,this.input)},t.prototype.withFaceDescriptors=function(){return new v_(this,this.input)},t}(i_),l_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.withAgeAndGender=function(){return new p_(this,this.input)},t.prototype.withFaceDescriptor=function(){return new g_(this,this.input)},t}(s_),c_=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return ax(t,e),t}(Lk),d_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n=this;return ux(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Uk(e=r.sent(),this.input,function(e){return sx(n,void 0,void 0,function(){return ux(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return r_.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],o=r.age;return o_(fk(e,r.gender,r.genderProbability),o)})]}})})},t.prototype.withFaceExpressions=function(){return new i_(this,this.input)},t}(c_),h_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n,r,o;return ux(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,zk(e,this.input,function(e){return r_.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,o_(fk(e,r,o),n)]}})})},t.prototype.withFaceExpressions=function(){return new s_(this,this.input)},t}(c_),f_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.withFaceExpressions=function(){return new u_(this,this.input)},t.prototype.withFaceDescriptors=function(){return new v_(this,this.input)},t}(d_),p_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.withFaceExpressions=function(){return new l_(this,this.input)},t.prototype.withFaceDescriptor=function(){return new g_(this,this.input)},t}(h_),m_=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return ax(t,e),t}(Lk),v_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e;return ux(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,Uk(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return r_.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return Bk(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new u_(this,this.input)},t.prototype.withAgeAndGender=function(){return new f_(this,this.input)},t}(m_),g_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t;return ux(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,zk(e,this.input,function(e){return r_.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,Bk(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new l_(this,this.input)},t.prototype.withAgeAndGender=function(){return new p_(this,this.input)},t}(m_),y_=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return ax(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?r_.faceLandmark68TinyNet:r_.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Lk),b_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n,r,o,a=this;return ux(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),t=e.map(function(e){return e.detection}),this.input instanceof au?[4,hw(this.input,t)]:[3,3];case 2:return r=i.sent(),[3,5];case 3:return[4,dw(this.input,t)];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return a.landmarkNet.detectLandmarks(e)}))];case 6:return o=i.sent(),n.forEach(function(e){return e instanceof au&&e.dispose()}),[2,e.map(function(e,t){return Vw(e,o[t])})]}})})},t.prototype.withFaceExpressions=function(){return new u_(this,this.input)},t.prototype.withAgeAndGender=function(){return new f_(this,this.input)},t.prototype.withFaceDescriptors=function(){return new v_(this,this.input)},t}(y_),x_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n,r,o;return ux(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof au?[4,hw(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,dw(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=a.sent(),n.forEach(function(e){return e instanceof au&&e.dispose()}),[2,Vw(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new l_(this,this.input)},t.prototype.withAgeAndGender=function(){return new p_(this,this.input)},t.prototype.withFaceDescriptor=function(){return new g_(this,this.input)},t}(y_),w_=function(e){function t(t,n){void 0===n&&(n=new kk);var r=e.call(this)||this;return r.input=t,r.options=n,r}return ax(t,e),t}(Lk),k_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t,n,r;return ux(this,function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof pk?[4,r_.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof Fk?function(e){return r_.tinyFaceDetector.locateFaces(e,n)}:n instanceof kk?function(e){return r_.ssdMobilenetv1.locateFaces(e,n)}:n instanceof jk?function(e){return r_.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return sx(e,void 0,void 0,function(){var e;return ux(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return Lx({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new b_(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new i_(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new d_(this.runAndExtendWithFaceDetections(),this.input)},t}(w_);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ax(t,e),t.prototype.run=function(){return sx(this,void 0,void 0,function(){var e,t;return ux(this,function(n){switch(n.label){case 0:return[4,new k_(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return sx(e,void 0,void 0,function(){var e;return ux(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?Lx({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new x_(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new s_(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new h_(this.runAndExtendWithFaceDetection(),this.input)}}(w_);function __(e,t){return void 0===t&&(t=new kk),new k_(e,t)}function E_(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof Mx)return e;if(e instanceof Float32Array)return new Mx(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new Mx(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return E_(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new jx(o,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new jx("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(e){return Mx.fromJSON(e)});return new e(n,t.distanceThreshold)}}();function C_(e,t){var n=new cx(t.width,t.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(e))return e.map(function(e){return C_(e,{width:r,height:o})});if(Ww(e)){var a=e.detection.forSize(r,o),i=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return Vw(Lx(e,a),i)}return Fx(e)?Lx(e,e.detection.forSize(r,o)):e instanceof Ax||e instanceof Cx?e.forSize(r,o):e}const S_=da("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),N_=da("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),T_=e=>{let{onSuccess:n,onCancel:r,mode:o="checkin"}=e;const{profile:a}=ia(),i=(0,t.useRef)(null),s=(0,t.useRef)(null),[u,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1),[h,f]=(0,t.useState)(!1),[p,m]=(0,t.useState)(null),[v,g]=(0,t.useState)("detecting"),[y,b]=(0,t.useState)(0);(0,t.useEffect)(()=>{x()},[]);const x=async()=>{try{const e="/models";if(!(await fetch("/models/tiny_face_detector_model-weights_manifest.json")).ok)throw new Error("Face recognition models not found. Please add the models to public/models directory.");await Promise.all([r_.tinyFaceDetector.loadFromUri(e),r_.faceLandmark68Net.loadFromUri(e),r_.faceRecognitionNet.loadFromUri(e),r_.faceExpressionNet.loadFromUri(e)]),l(!0)}catch(p){console.error("Error loading face-api models:",p),m("Face recognition models not available. This feature will be enabled once models are installed."),l(!1)}};return(0,oa.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,oa.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 p-6 sm:p-8 max-w-lg w-full mx-4",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center",children:"checkin"===o?(0,oa.jsx)(S_,{className:"w-5 h-5 text-white"}):(0,oa.jsx)(Wi,{className:"w-5 h-5 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"checkin"===o?"Face Verification":"Facial Recognition"}),(0,oa.jsx)("p",{className:"text-sm text-gray-600",children:"checkin"===o?"Verify your identity for check-in":"Capture your face for attendance"})]})]}),(0,oa.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:(0,oa.jsx)(va,{className:"w-5 h-5 text-gray-500"})})]}),u?(0,oa.jsxs)("div",{className:"space-y-6",children:[(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Hi(),{ref:i,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{width:640,height:480,facingMode:"user"},className:"w-full rounded-2xl shadow-lg",style:{transform:"scaleX(-1)"}}),(0,oa.jsx)("canvas",{ref:s,className:"absolute top-0 left-0 w-full h-full rounded-2xl"}),"detecting"===v&&c&&(0,oa.jsx)("div",{className:"absolute top-4 right-4 bg-blue-500 text-white p-3 rounded-2xl shadow-lg",children:(0,oa.jsx)(Wi,{className:"w-5 h-5 animate-pulse"})}),"verifying"===v&&(0,oa.jsx)("div",{className:"absolute top-4 right-4 bg-amber-500 text-white p-3 rounded-2xl shadow-lg",children:(0,oa.jsx)(S_,{className:"w-5 h-5 animate-spin"})}),"success"===v&&h&&(0,oa.jsx)("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white p-3 rounded-2xl shadow-lg",children:(0,oa.jsx)(N_,{className:"w-5 h-5"})}),"checkin"===o&&y>0&&(0,oa.jsxs)("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-3 py-2 rounded-xl text-sm font-medium",children:["Match: ",y.toFixed(1),"%"]})]}),p&&(0,oa.jsxs)("div",{className:"flex items-center p-4 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-2xl",children:[(0,oa.jsx)(Bi,{className:"w-5 h-5 text-red-600 mr-3 flex-shrink-0"}),(0,oa.jsx)("p",{className:"text-sm text-red-700 font-medium",children:p})]}),"checkin"===o&&"verifying"===v&&(0,oa.jsxs)("div",{className:"flex items-center p-4 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl",children:[(0,oa.jsx)(S_,{className:"w-5 h-5 text-amber-600 mr-3 animate-pulse"}),(0,oa.jsx)("p",{className:"text-sm text-amber-700 font-medium",children:"Verifying your identity..."})]}),"checkin"===o&&"success"===v&&(0,oa.jsxs)("div",{className:"flex items-center p-4 bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200 rounded-2xl",children:[(0,oa.jsx)(N_,{className:"w-5 h-5 text-emerald-600 mr-3"}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("p",{className:"text-sm text-emerald-700 font-medium",children:"Identity verified successfully!"}),(0,oa.jsxs)("p",{className:"text-xs text-emerald-600 mt-1",children:["Match confidence: ",y.toFixed(1),"%"]})]})]}),(0,oa.jsxs)("div",{className:"text-center space-y-4",children:[(0,oa.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"checkin"===o?"Position your face in the camera for identity verification":"Position your face in the camera and click detect when ready"}),(0,oa.jsxs)("div",{className:"flex space-x-3",children:[(0,oa.jsx)("button",{onClick:r,className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-2xl transition-all duration-300",children:"Cancel"}),(0,oa.jsx)("button",{onClick:async()=>{if(i.current&&s.current&&u){d(!0),m(null);try{const t=i.current.video;if(!t)return;const r=s.current,u={width:t.videoWidth,height:t.videoHeight};gw(r,u);const l=await __(t,new Fk).withFaceLandmarks().withFaceDescriptors();if(0===l.length)return m("No face detected. Please position your face in the camera."),void f(!1);if(l.length>1)return m("Multiple faces detected. Please ensure only one person is in the frame."),f(!1),void g("failed");const c=l[0].descriptor;if("checkin"===o&&null!==a&&void 0!==a&&a.face_encoding){g("verifying");try{const e=E_(c,new Float32Array(JSON.parse(a.face_encoding))),t=Math.max(0,100*(1-e));b(t);if(t<60)return m("Face verification failed. Confidence: ".concat(t.toFixed(1),"%. Please ensure you are the registered user.")),f(!1),void g("failed");g("success")}catch(e){return console.error("Face verification error:",e),m("Face verification failed. Please try again or contact support."),f(!1),void g("failed")}}else if("checkin"===o&&(null===a||void 0===a||!a.face_encoding))return m("No face profile found. Please set up your face profile in your account settings first."),f(!1),void g("failed");const d=JSON.stringify(Array.from(c));f(!0),m(null);const h=C_(l,u),p=r.getContext("2d");p&&(p.clearRect(0,0,r.width,r.height),nw(r,h),Gw(r,h)),setTimeout(()=>{n(d)},"checkin"===o?2e3:1e3)}catch(p){console.error("Face detection error:",p),m("Face detection failed. Please try again."),f(!1),g("failed")}finally{d(!1)}}},disabled:c||!u||"success"===v,className:"flex-1 px-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 text-white font-semibold rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl",children:c?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"verifying"===v?"Verifying...":"Detecting..."]}):"success"===v?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(N_,{className:"w-4 h-4 mr-2"}),"Verified"]}):(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Wi,{className:"w-4 h-4 mr-2"}),"checkin"===o?"Verify Identity":"Detect Face"]})})]})]})]}):(0,oa.jsxs)("div",{className:"text-center py-12",children:[(0,oa.jsx)(Sa,{size:"lg",className:"mx-auto mb-4"}),(0,oa.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading facial recognition models..."}),(0,oa.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a few moments"})]})]})})},I_=()=>{var e;const{user:n}=ia(),[r,o]=(0,t.useState)([]),[a,i]=(0,t.useState)([]),[s,u]=(0,t.useState)([]),[l,c]=(0,t.useState)(""),[d,h]=(0,t.useState)(null),[f,p]=(0,t.useState)(!0),[m,v]=(0,t.useState)(!1),[g,y]=(0,t.useState)(!1),[b]=(0,t.useState)("facial"),[x,w]=(0,t.useState)("00:00:00"),[k,_]=(0,t.useState)(null),[E,C]=(0,t.useState)(0),[S,N]=(0,t.useState)(!1),T=(0,t.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!navigator.geolocation)return void _("Geolocation is not supported by this browser.");navigator.geolocation.getCurrentPosition(e=>{h(e),_(null),C(0)},t=>{const n=e+1;let r="Unable to get your location.";switch(t.code){case t.PERMISSION_DENIED:r="Location access denied. Please enable location permissions.",_(r);break;case t.POSITION_UNAVAILABLE:if(r="Location information unavailable.",n<3)return C(n),void setTimeout(()=>T(n),2e3*n);_(r);break;case t.TIMEOUT:if(r="Location request timed out.",n<3)return C(n),void setTimeout(()=>T(n),1e3);_(r);break;default:if(r="An unknown error occurred while getting location.",n<3)return C(n),void setTimeout(()=>T(n),2e3);_(r)}n>=3&&nn.error("".concat(r," You can proceed without location verification."))},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})},[]),I=(0,t.useCallback)(async()=>{try{p(!0),await Promise.all([R(),A(),D()])}catch(e){console.error("Error fetching data:",e)}finally{p(!1)}},[]);(0,t.useEffect)(()=>{n&&(I(),T())},[n,I,T]);const R=async()=>{const{data:e,error:t}=await ra.from("session_types").select("*").eq("is_active",!0).order("start_time");t?console.error("Error fetching session types:",t):(o(e||[]),e&&e.length>0&&c(e[0].id))},A=async()=>{if(!n)return;const e=(new Date).toISOString().split("T")[0],{data:t,error:r}=await ra.from("attendance_records").select("\n        *,\n        session_types (\n          name,\n          start_time,\n          end_time,\n          description\n        )\n      ").eq("user_id",n.id).gte("check_in_time","".concat(e,"T00:00:00")).lt("check_in_time","".concat(e,"T23:59:59")).order("check_in_time",{ascending:!0});r?console.error("Error fetching today attendance:",r):i(t||[])},D=async()=>{const{data:e,error:t}=await ra.from("company_locations").select("*").eq("is_active",!0);t?console.error("Error fetching locations:",t):u(e||[])},P=()=>!(!d||0===s.length)&&s.some(e=>{const t=((e,t,n,r)=>{const o=e*Math.PI/180,a=n*Math.PI/180,i=(n-e)*Math.PI/180,s=(r-t)*Math.PI/180,u=Math.sin(i/2)*Math.sin(i/2)+Math.cos(o)*Math.cos(a)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3})(d.coords.latitude,d.coords.longitude,e.latitude,e.longitude);return t<=e.radius_meters}),j=(e,t)=>{const n=r.find(t=>t.id===e);if(!n)return"present";const o=60*t.getHours()+t.getMinutes(),[a,i]=n.start_time.split(":").map(Number),[s,u]=n.end_time.split(":").map(Number),l=60*a+i;return o<l-30||o>60*s+u||o>l+15?"late":"present"},O=(0,t.useCallback)(()=>a.find(e=>!e.check_out_time),[a]),M=e=>{const t=new Date(e),n=(new Date).getTime()-t.getTime(),r=Math.floor(n/36e5),o=Math.floor(n%36e5/6e4),a=Math.floor(n%6e4/1e3);return"".concat(r.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"))};if((0,t.useEffect)(()=>{const e=O();if(e&&e.check_in_time){const t=setInterval(()=>{w(M(e.check_in_time))},1e3);return w(M(e.check_in_time)),()=>clearInterval(t)}w("00:00:00")},[O]),f)return(0,oa.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,oa.jsx)(Sa,{size:"lg"})});const F=O(),L=P();return(0,oa.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50/30 p-4 sm:p-6 lg:p-8",children:[(0,oa.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[(0,oa.jsxs)("div",{className:"relative overflow-hidden bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 p-6 sm:p-8",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-50/50 via-white/30 to-gray-50/50"}),(0,oa.jsxs)("div",{className:"relative flex items-center justify-between",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700 bg-clip-text text-transparent flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Attendance"}),(0,oa.jsx)(Li,{className:"w-7 h-7 text-gray-500"})]}),(0,oa.jsxs)("p",{className:"text-gray-600 font-medium flex items-center space-x-2 mt-2",children:[(0,oa.jsx)("span",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse"}),(0,oa.jsx)("span",{children:"Manage your daily attendance and sessions"})]})]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-3 px-4 py-2.5 rounded-2xl backdrop-blur-sm border border-gray-200/50 shadow-lg",children:[(0,oa.jsx)(Ua,{className:"w-5 h-5 ".concat(L?"text-emerald-600":"text-red-600")}),(0,oa.jsx)("span",{className:"text-sm font-semibold ".concat(L?"text-emerald-600":"text-red-600"),children:L?"Within allowed area":"Outside allowed area"}),(0,oa.jsx)("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse ".concat(L?"bg-emerald-500":"bg-red-500")})]})]})]}),!d&&!S&&(0,oa.jsx)("div",{className:"bg-gradient-to-r from-amber-50/80 to-orange-50/80 backdrop-blur-xl rounded-3xl shadow-xl border border-amber-200/50 overflow-hidden",children:(0,oa.jsx)("div",{className:"p-6 sm:p-8",children:(0,oa.jsxs)("div",{className:"flex items-center",children:[(0,oa.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg mr-4",children:(0,oa.jsx)(Bi,{className:"w-6 h-6 text-white"})}),(0,oa.jsxs)("div",{className:"flex-1",children:[(0,oa.jsx)("p",{className:"font-bold text-amber-900 text-lg",children:k||"Location access required"}),(0,oa.jsx)("p",{className:"text-sm text-amber-700 font-medium mt-1",children:k?"Location services are having issues. You can proceed without location verification.":"Please enable location services to check in/out."})]}),(0,oa.jsxs)("div",{className:"flex space-x-3",children:[(0,oa.jsx)("button",{onClick:()=>{T(0)},className:"px-4 py-2.5 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 disabled:opacity-50",disabled:E>=3,children:E>0?"Retry (".concat(E,"/3)"):"Enable Location"}),k&&(0,oa.jsx)("button",{onClick:()=>N(!0),className:"px-4 py-2.5 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:"Continue Without Location"})]})]})})}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8",children:[(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsxs)("div",{className:"bg-gradient-to-r from-gray-800 via-gray-800 to-gray-900 p-6",children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Quick Actions"}),(0,oa.jsx)(Ui,{className:"w-6 h-6 text-gray-400"})]}),(0,oa.jsx)("p",{className:"text-gray-200 text-sm font-medium mt-1",children:"Check in and out of your sessions"})]}),(0,oa.jsx)("div",{className:"p-6 sm:p-8",children:F?(0,oa.jsxs)("div",{className:"space-y-4",children:[(0,oa.jsx)("div",{className:"p-6 bg-gradient-to-r from-emerald-50/80 to-green-50/80 border border-emerald-200/50 rounded-3xl backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,oa.jsxs)("div",{className:"flex-1",children:[(0,oa.jsxs)("p",{className:"font-bold text-emerald-900 text-lg flex items-center space-x-2",children:[(0,oa.jsx)(fa,{className:"w-5 h-5 text-emerald-600"}),(0,oa.jsx)("span",{children:"Currently Active"})]}),(0,oa.jsxs)("p",{className:"text-sm text-emerald-700 font-medium mt-1",children:[null===(e=F.session_types)||void 0===e?void 0:e.name," - Started at"," ",F.check_in_time?Mi(new Date(F.check_in_time),"h:mm a"):""]}),(0,oa.jsx)("div",{className:"mt-4 space-y-3",children:(0,oa.jsx)("div",{className:"p-4 bg-gradient-to-r from-emerald-100/80 to-green-100/80 rounded-2xl backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center justify-between",children:[(0,oa.jsx)("span",{className:"text-sm font-bold text-emerald-800",children:"Elapsed Time:"}),(0,oa.jsx)("span",{className:"text-xl font-mono font-bold text-emerald-900 bg-white/50 px-3 py-1 rounded-xl",children:x})]})})})]}),(0,oa.jsxs)("div",{className:"flex flex-col items-center space-y-2 ml-4",children:[(0,oa.jsx)("div",{className:"w-4 h-4 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full animate-pulse shadow-lg"}),(0,oa.jsx)("span",{className:"text-xs font-bold text-emerald-600 bg-emerald-100 px-2 py-1 rounded-full",children:"ACTIVE"})]})]})}),(0,oa.jsx)("button",{onClick:()=>(async e=>{if(d){v(!0);try{const t=new Date,n=a.find(t=>t.id===e);if(!n)throw new Error("Attendance record not found");const r=new Date(n.check_in_time),o=(t.getTime()-r.getTime())/6e4;if(o<1)return nn.error("Minimum session duration is 1 minute. Please wait before checking out."),void v(!1);const i=o/60,{error:s}=await ra.from("attendance_records").update({check_out_time:t.toISOString(),check_out_location:{latitude:d.coords.latitude,longitude:d.coords.longitude,address:"Current Location"},check_out_method:"facial",total_hours:Math.round(100*i)/100,updated_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;const u=M(n.check_in_time);nn.success("Checked out successfully! Total time: ".concat(u)),await A()}catch(t){console.error("Check-out error:",t),nn.error(t.message||"Failed to check out")}finally{v(!1)}}})(F.id),disabled:m||!d||!L,className:"w-full px-6 py-4 bg-gradient-to-r from-red-600 to-pink-600 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:m?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Checking out..."]}):(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(zi,{className:"w-6 h-6 mr-3"}),"Check Out"]})})]}):(0,oa.jsxs)("div",{className:"space-y-4 pt-6",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{className:"label",children:"Select Session"}),(0,oa.jsx)("select",{value:l,onChange:e=>c(e.target.value),className:"pl-4 pr-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-gray-500/20 focus:border-gray-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80",children:r.map(e=>(0,oa.jsxs)("option",{value:e.id,children:[e.name," (",e.start_time," - ",e.end_time,")"]},e.id))})]}),(0,oa.jsx)("div",{className:"p-4 bg-gradient-to-r from-gray-50/80 to-gray-100/80 border border-gray-200/50 rounded-2xl backdrop-blur-sm",children:(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,oa.jsx)(Wi,{className:"w-5 h-5 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("p",{className:"font-bold text-gray-900 text-sm",children:"Facial Recognition Check-in"}),(0,oa.jsx)("p",{className:"text-xs text-gray-700 font-medium",children:"Secure attendance tracking with face verification"})]})]})}),(0,oa.jsx)("button",{onClick:()=>y(!0),disabled:m||!d||!L||!l,className:"w-full px-6 py-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:m?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Checking in..."]}):(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Wi,{className:"w-6 h-6 mr-3"}),"Start Facial Recognition"]})})]})})]}),(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsxs)("div",{className:"bg-gradient-to-r from-gray-800 via-gray-800 to-gray-900 p-6",children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Today's Sessions"}),(0,oa.jsx)(Pa,{className:"w-6 h-6 text-gray-400"})]}),(0,oa.jsx)("p",{className:"text-gray-200 text-sm font-medium mt-1",children:"Track your daily session progress"})]}),(0,oa.jsx)("div",{className:"p-6 sm:p-8",children:(0,oa.jsx)("div",{className:"space-y-3",children:r.map(e=>{const t=(e=>{const t=a.find(t=>t.session_type_id===e);return t?t.check_out_time?"completed":"active":"not-started"})(e.id),n=a.filter(t=>t.session_type_id===e.id),r=n.reduce((e,t)=>e+(t.total_hours||0),0),o=n[n.length-1];return(0,oa.jsxs)("div",{className:"flex items-center justify-between p-5 bg-gradient-to-r from-white/60 to-gray-50/60 backdrop-blur-sm rounded-2xl border border-gray-200/50 shadow-md hover:shadow-lg transition-all duration-300",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,oa.jsx)("div",{className:"p-3 rounded-2xl shadow-lg ".concat("completed"===t?"bg-gradient-to-br from-emerald-500 to-green-500":"active"===t?"bg-gradient-to-br from-amber-500 to-orange-500":"bg-gradient-to-br from-gray-400 to-slate-500"),children:"completed"===t?(0,oa.jsx)(La,{className:"w-6 h-6 text-white"}):"active"===t?(0,oa.jsx)(fa,{className:"w-6 h-6 text-white animate-pulse"}):(0,oa.jsx)(Ba,{className:"w-6 h-6 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("p",{className:"font-bold text-gray-900 text-lg",children:e.name}),(0,oa.jsxs)("p",{className:"text-sm text-gray-600 font-medium",children:[e.start_time," - ",e.end_time]})]})]}),(0,oa.jsx)("div",{className:"text-right",children:n.length>0?(0,oa.jsxs)("div",{children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-900 bg-white/50 px-3 py-1 rounded-xl",children:r>0?"".concat(Math.floor(r),"h ").concat(Math.round(r%1*60),"m"):"In Progress"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-medium mt-1",children:null!==o&&void 0!==o&&o.check_in_time?Mi(new Date(o.check_in_time),"h:mm a"):""})]}):(0,oa.jsx)("span",{className:"px-3 py-1.5 bg-gradient-to-r from-gray-500 to-gray-600 text-white text-xs font-bold rounded-full shadow-lg",children:"Not Started"})})]},e.id)})})})]})]})]}),g&&(0,oa.jsx)(T_,{onSuccess:e=>{(async e=>{if(!n||!l||!d)return;if(a.find(e=>!e.check_out_time))nn.error("You must check out of your current session before starting a new one.");else if(P()){v(!0);try{const{error:t}=await ra.from("attendance_records").insert({user_id:n.id,session_type_id:l,check_in_time:(new Date).toISOString(),check_in_location:{latitude:d.coords.latitude,longitude:d.coords.longitude,address:"Current Location"},check_in_method:b,status:j(l,new Date)}).select().single();if(t)throw t;e&&"facial"===b&&await ra.from("profiles").update({face_encoding:e}).eq("id",n.id),nn.success("Checked in successfully!"),await A(),c(""),y(!1)}catch(t){console.error("Check-in error:",t),nn.error(t.message||"Failed to check in")}finally{v(!1)}}else nn.error("You are not within the allowed check-in radius.")})(e)},onCancel:()=>{y(!1)}})]})},R_=da("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),A_=da("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),D_=da("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),P_=da("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),j_=da("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),O_=e=>{let{onSuccess:n,onCancel:r,existingFaceEncoding:o,mode:a}=e;const i=(0,t.useRef)(null),s=(0,t.useRef)(null),[u,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1),[h,f]=(0,t.useState)(!1),[p,m]=(0,t.useState)(null),[v,g]=(0,t.useState)([]),[y,b]=(0,t.useState)(1),[x,w]=(0,t.useState)(0);(0,t.useEffect)(()=>{k()},[]);const k=async()=>{try{const e="/models";if(!(await fetch("/models/tiny_face_detector_model-weights_manifest.json")).ok)throw new Error("Face recognition models not found. Please add the models to public/models directory.");await Promise.all([r_.tinyFaceDetector.loadFromUri(e),r_.faceLandmark68Net.loadFromUri(e),r_.faceRecognitionNet.loadFromUri(e),r_.faceExpressionNet.loadFromUri(e)]),l(!0)}catch(p){console.error("Error loading face-api models:",p),m("Face recognition models not available. This feature will be enabled once models are installed."),l(!1)}};return(0,oa.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,oa.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-gray-200/50 p-6 sm:p-8 max-w-lg w-full mx-4",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,oa.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,oa.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center",children:(0,oa.jsx)(pa,{className:"w-5 h-5 text-white"})}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"setup"===a?"Face Setup":"Update Face Profile"}),(0,oa.jsxs)("p",{className:"text-sm text-gray-600",children:["Step ",y," of ",3,": ",(()=>{switch(y){case 1:return"Look straight at the camera";case 2:return"Turn your head slightly to the left";case 3:return"Turn your head slightly to the right";default:return"Position your face in the camera"}})()]})]})]}),(0,oa.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:(0,oa.jsx)(va,{className:"w-5 h-5 text-gray-500"})})]}),u?(0,oa.jsxs)("div",{className:"space-y-6",children:[(0,oa.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,oa.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(Math.min(v.length/3*100,100),"%")}})}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Hi(),{ref:i,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{width:640,height:480,facingMode:"user"},className:"w-full rounded-2xl shadow-lg",style:{transform:"scaleX(-1)"}}),(0,oa.jsx)("canvas",{ref:s,className:"absolute top-0 left-0 w-full h-full rounded-2xl"}),h&&(0,oa.jsx)("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white p-3 rounded-2xl shadow-lg",children:(0,oa.jsx)(La,{className:"w-5 h-5"})}),x>0&&(0,oa.jsxs)("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-3 py-2 rounded-xl text-sm font-medium",children:["Confidence: ",Math.round(100*x),"%"]})]}),p&&(0,oa.jsxs)("div",{className:"flex items-center p-4 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-2xl",children:[(0,oa.jsx)(Bi,{className:"w-5 h-5 text-red-600 mr-3 flex-shrink-0"}),(0,oa.jsx)("p",{className:"text-sm text-red-700 font-medium",children:p})]}),(0,oa.jsxs)("div",{className:"text-center space-y-4",children:[(0,oa.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"setup"===a?"We'll capture your face from multiple angles for better recognition accuracy":"Update your face profile with a new capture"}),(0,oa.jsxs)("div",{className:"flex space-x-3",children:[(0,oa.jsx)("button",{onClick:r,className:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-2xl transition-all duration-300",children:"Cancel"}),v.length>0&&(0,oa.jsxs)("button",{onClick:()=>{g([]),b(1),f(!1),m(null),w(0)},className:"px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-semibold rounded-2xl transition-all duration-300 flex items-center",children:[(0,oa.jsx)(j_,{className:"w-4 h-4 mr-2"}),"Reset"]}),(0,oa.jsx)("button",{onClick:async()=>{if(i.current&&s.current&&u&&!c&&!h){d(!0),m(null);try{const t=i.current.video;if(!t)return;const r=s.current,u={width:t.videoWidth,height:t.videoHeight};gw(r,u);const l=await __(t,new Fk).withFaceLandmarks().withFaceDescriptors();if(0===l.length)return m("No face detected. Please position your face in the camera."),void f(!1);if(l.length>1)return m("Multiple faces detected. Please ensure only one person is in the frame."),void f(!1);const c=l[0],d=c.descriptor,h=c.detection.score;if(w(h),h<.5)return m("Face detection confidence too low. Please ensure good lighting and clear view of your face."),void f(!1);if("update"===a&&o)try{const e=new Float32Array(JSON.parse(o));if(E_(d,e)>.6)return m("Face does not match your existing profile. Please use the same person's face."),void f(!1)}catch(e){console.warn("Could not verify against existing face encoding:",e)}const p=JSON.stringify(Array.from(d));f(!0),m(null);const v=C_(l,u),x=r.getContext("2d");x&&(x.clearRect(0,0,r.width,r.height),nw(r,v),Gw(r,v)),g(e=>[...e.filter((e,t)=>t<y),p]),y<3?setTimeout(()=>{b(e=>e+1),f(!1)},1500):setTimeout(()=>{n(p)},1e3)}catch(p){console.error("Face detection error:",p),m("Face detection failed. Please try again."),f(!1)}finally{d(!1)}}},disabled:c||!u,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 text-white font-semibold rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl",children:c?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Detecting..."]}):(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Wi,{className:"w-4 h-4 mr-2"}),"Capture Face"]})})]}),v.length>0&&(0,oa.jsx)("div",{className:"flex justify-center space-x-2 mt-4",children:Array.from({length:3},(e,t)=>(0,oa.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-300 ".concat(t<v.length?"bg-gradient-to-r from-emerald-500 to-green-500":t===v.length?"bg-gradient-to-r from-blue-500 to-indigo-500 animate-pulse":"bg-gray-300")},t))})]})]}):(0,oa.jsxs)("div",{className:"text-center py-12",children:[(0,oa.jsx)(Sa,{size:"lg",className:"mx-auto mb-4"}),(0,oa.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading facial recognition models..."}),(0,oa.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a few moments"})]})]})})},M_=()=>{const{profile:e,updateProfile:n,user:r,loading:o}=ia(),[a,i]=(0,t.useState)(!1),[s,u]=(0,t.useState)(!1),[l,c]=(0,t.useState)(!1),[d,h]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1),[m,v]=(0,t.useState)(!1),[g,y]=(0,t.useState)(!1),[b,x]=(0,t.useState)(!1),[w,k]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),C=(0,t.useRef)(null),[S,N]=(0,t.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[T,I]=(0,t.useState)(""),[R,A]=(0,t.useState)({full_name:(null===e||void 0===e?void 0:e.full_name)||"",employee_id:(null===e||void 0===e?void 0:e.employee_id)||"",department:(null===e||void 0===e?void 0:e.department)||"",position:(null===e||void 0===e?void 0:e.position)||"",phone:(null===e||void 0===e?void 0:e.phone)||"",address:(null===e||void 0===e?void 0:e.address)||""});if((0,t.useEffect)(()=>{console.log("Profile data changed:",e),e&&(console.log("Updating form data with profile:",e),A({full_name:e.full_name||"",employee_id:e.employee_id||"",department:e.department||"",position:e.position||"",phone:e.phone||"",address:e.address||""}))},[e]),o)return(0,oa.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:(0,oa.jsx)(Sa,{size:"lg"})});const D=e=>{A(ze(ze({},R),{},{[e.target.name]:e.target.value}))},P=e=>{N(ze(ze({},S),{},{[e.target.name]:e.target.value}))};return(0,oa.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 p-4 sm:p-6 lg:p-8",children:(0,oa.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[(0,oa.jsxs)("div",{className:"relative overflow-hidden bg-white/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-xl border border-gray-200/50 p-4 sm:p-6 lg:p-8",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-50/50 via-white/30 to-indigo-50/50"}),(0,oa.jsxs)("div",{className:"relative text-center sm:text-left",children:[(0,oa.jsxs)("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-gray-900 via-blue-800 to-indigo-700 bg-clip-text text-transparent flex items-center justify-center sm:justify-start space-x-2",children:[(0,oa.jsx)(pa,{className:"w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 text-blue-600"}),(0,oa.jsx)("span",{children:"Profile"})]}),(0,oa.jsxs)("p",{className:"text-gray-600 font-medium flex items-center justify-center sm:justify-start space-x-2 mt-2 text-sm sm:text-base",children:[(0,oa.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),(0,oa.jsx)("span",{className:"text-center sm:text-left",children:"Manage your personal information and settings"})]})]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8",children:[(0,oa.jsx)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:(0,oa.jsxs)("div",{className:"p-4 sm:p-6 lg:p-8 text-center",children:[(0,oa.jsxs)("div",{className:"relative inline-block mb-4 sm:mb-6",children:[(0,oa.jsx)("div",{className:"w-24 h-24 sm:w-28 sm:h-28 lg:w-32 lg:h-32 bg-gradient-to-br from-gray-200 to-gray-300 rounded-2xl sm:rounded-3xl flex items-center justify-center mx-auto shadow-xl",children:null!==e&&void 0!==e&&e.avatar_url?(0,oa.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-24 h-24 sm:w-28 sm:h-28 lg:w-32 lg:h-32 rounded-2xl sm:rounded-3xl object-cover"}):(0,oa.jsx)(pa,{className:"w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 text-gray-400"})}),(0,oa.jsx)("button",{onClick:()=>{var e;null===(e=C.current)||void 0===e||e.click()},disabled:l,className:"absolute -bottom-1 -right-1 sm:-bottom-2 sm:-right-2 p-2 sm:p-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl sm:rounded-2xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-xl hover:scale-110",children:l?(0,oa.jsx)("div",{className:"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,oa.jsx)(Wi,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),(0,oa.jsx)("input",{ref:C,type:"file",accept:"image/*",onChange:async e=>{var t;const o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(o&&r)if(o.type.startsWith("image/"))if(o.size>5242880)nn.error("File size must be less than 5MB");else{c(!0);try{const e=new FileReader,t=new Promise((t,n)=>{e.onload=()=>{const n=e.result;t(n)},e.onerror=n,e.readAsDataURL(o)}),a=await t,{error:i}=await ra.from("profiles").update({avatar_url:a}).eq("id",r.id);if(i)throw i;await n({}),nn.success("Profile picture updated successfully!")}catch(a){console.error("Avatar upload error:",a.message||a),nn.error(a.message||"Failed to upload profile picture")}finally{c(!1),C.current&&(C.current.value="")}}else nn.error("Please select an image file")},className:"hidden"})]}),(0,oa.jsx)("h3",{className:"text-lg sm:text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-2 px-2",children:(null===e||void 0===e?void 0:e.full_name)||"User Name"}),(0,oa.jsxs)("p",{className:"text-gray-600 font-semibold mb-2 flex items-center justify-center space-x-2 text-sm sm:text-base px-2",children:[(0,oa.jsx)("span",{className:"text-center",children:(null===e||void 0===e?void 0:e.position)||"Position"}),(0,oa.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full flex-shrink-0"})]}),(0,oa.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 font-medium px-2",children:(null===e||void 0===e?void 0:e.department)||"Department"}),(0,oa.jsx)("div",{className:"mt-4 sm:mt-6 pt-4 sm:pt-6 border-t border-gray-200/50 mx-4 sm:mx-0",children:(0,oa.jsxs)("div",{className:"space-y-2 sm:space-y-3 text-xs sm:text-sm text-gray-600",children:[(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between bg-gray-50/80 rounded-xl sm:rounded-2xl p-2 sm:p-3 space-y-1 sm:space-y-0",children:[(0,oa.jsx)("span",{className:"font-medium text-center sm:text-left",children:"Employee ID:"}),(0,oa.jsx)("span",{className:"font-bold text-gray-900 text-center sm:text-right break-all",children:(null===e||void 0===e?void 0:e.employee_id)||"N/A"})]}),(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between bg-gray-50/80 rounded-xl sm:rounded-2xl p-2 sm:p-3 space-y-1 sm:space-y-0",children:[(0,oa.jsx)("span",{className:"font-medium text-center sm:text-left",children:"Member since:"}),(0,oa.jsx)("span",{className:"font-bold text-gray-900 text-center sm:text-right",children:null!==e&&void 0!==e&&e.created_at?new Date(e.created_at).toLocaleDateString():"N/A"})]})]})})]})}),(0,oa.jsx)("div",{className:"lg:col-span-2",children:(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsx)("div",{className:"bg-gradient-to-r from-slate-800 via-gray-800 to-slate-900 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0",children:[(0,oa.jsxs)("div",{className:"text-center sm:text-left",children:[(0,oa.jsxs)("h3",{className:"text-base sm:text-lg lg:text-xl font-bold text-white flex items-center justify-center sm:justify-start space-x-2",children:[(0,oa.jsx)("span",{children:"Personal Information"}),(0,oa.jsx)("span",{className:"text-blue-400",children:"\ud83d\udcdd"})]}),(0,oa.jsx)("p",{className:"text-slate-300 text-xs sm:text-sm font-medium mt-1 text-center sm:text-left",children:"Update your profile details"})]}),!a&&(0,oa.jsx)("button",{onClick:()=>i(!0),className:"w-full sm:w-auto px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 backdrop-blur-sm border border-blue-500/20 text-sm sm:text-base",children:"Edit Profile"})]})}),(0,oa.jsx)("div",{className:"p-4 sm:p-6 lg:p-8",children:(0,oa.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),u(!0);try{await n(R),i(!1)}catch(t){console.error("Profile update error:",t)}finally{u(!1)}},className:"space-y-6",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"full_name",className:"label",children:"Full Name"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"full_name",name:"full_name",type:"text",disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.full_name,onChange:D})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"email",className:"label",children:"Email Address"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(ka,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"email",type:"email",disabled:!0,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl w-full text-sm bg-gray-50/50 backdrop-blur-sm shadow-sm",value:(null===e||void 0===e?void 0:e.email)||""})]}),(0,oa.jsxs)("p",{className:"text-xs text-gray-500 mt-2 flex items-center space-x-1",children:[(0,oa.jsx)("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),(0,oa.jsx)("span",{children:"Email cannot be changed"})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"employee_id",className:"label",children:"Employee ID"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ta,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"employee_id",name:"employee_id",type:"text",disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.employee_id,onChange:D})]})]}),(0,oa.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"department",className:"label",children:"Department"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ia,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"department",name:"department",type:"text",disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.department,onChange:D})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"position",className:"label",children:"Position"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ta,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"position",name:"position",type:"text",disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.position,onChange:D})]})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"phone",className:"label",children:"Phone Number"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(R_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("input",{id:"phone",name:"phone",type:"tel",disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.phone,onChange:D})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"address",className:"label",children:"Address"}),(0,oa.jsxs)("div",{className:"relative",children:[(0,oa.jsx)(Ua,{className:"absolute left-3 top-3 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),(0,oa.jsx)("textarea",{id:"address",name:"address",rows:3,disabled:!a,className:"pl-9 sm:pl-10 pr-3 sm:pr-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm resize-none ".concat(a?"bg-white/80":"bg-gray-50/50"),value:R.address,onChange:D})]})]}),a&&(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 pt-4",children:[(0,oa.jsx)("button",{type:"submit",disabled:s,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:s?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Saving..."]}):(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(A_,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),(0,oa.jsx)("button",{type:"button",onClick:()=>{A({full_name:(null===e||void 0===e?void 0:e.full_name)||"",employee_id:(null===e||void 0===e?void 0:e.employee_id)||"",department:(null===e||void 0===e?void 0:e.department)||"",position:(null===e||void 0===e?void 0:e.position)||"",phone:(null===e||void 0===e?void 0:e.phone)||"",address:(null===e||void 0===e?void 0:e.address)||""}),i(!1)},className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-sm sm:text-base",children:"Cancel"})]})]})})]})})]}),(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsxs)("div",{className:"bg-gradient-to-r from-slate-800 via-gray-800 to-slate-900 p-6",children:[(0,oa.jsxs)("h3",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)(D_,{className:"w-6 h-6"}),(0,oa.jsx)("span",{children:"Account Settings"})]}),(0,oa.jsx)("p",{className:"text-slate-300 text-sm font-medium mt-1",children:"Manage your security preferences"})]}),(0,oa.jsxs)("div",{className:"p-6 space-y-6",children:[(0,oa.jsx)("div",{className:"bg-gray-50 rounded-2xl border border-gray-200 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,oa.jsxs)("div",{className:"flex-1",children:[(0,oa.jsxs)("h4",{className:"font-bold text-gray-900 flex items-center space-x-2",children:[(0,oa.jsx)(S_,{className:"w-5 h-5 text-blue-600"}),(0,oa.jsx)("span",{children:"Face Recognition"})]}),(0,oa.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:null!==e&&void 0!==e&&e.face_encoding?"Face profile is active for secure attendance":"Set up face recognition for secure check-in"})]}),(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,oa.jsxs)("button",{onClick:()=>x(!0),disabled:w,className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center space-x-2 text-sm",children:[w?(0,oa.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,oa.jsx)(S_,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:null!==e&&void 0!==e&&e.face_encoding?"Update":"Setup"})]}),(null===e||void 0===e?void 0:e.face_encoding)&&(0,oa.jsxs)("button",{onClick:()=>{E(!0)},disabled:w,className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white font-medium rounded-xl hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center justify-center space-x-2 text-sm",children:[(0,oa.jsx)(P_,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:"Remove"})]})]})]})}),(0,oa.jsx)("div",{className:"bg-gray-50 rounded-2xl border border-gray-200 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,oa.jsxs)("div",{className:"flex-1",children:[(0,oa.jsxs)("h4",{className:"font-bold text-gray-900 flex items-center space-x-2",children:[(0,oa.jsx)(_a,{className:"w-5 h-5 text-blue-600"}),(0,oa.jsx)("span",{children:"Change Password"})]}),(0,oa.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Update your account password for better security"})]}),(0,oa.jsxs)("button",{onClick:()=>h(!0),className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2 text-sm",children:[(0,oa.jsx)(_a,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:"Change"})]})]})}),(0,oa.jsx)("div",{className:"bg-red-50 rounded-2xl border border-red-200 p-4 sm:p-6",children:(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,oa.jsxs)("div",{className:"flex-1",children:[(0,oa.jsxs)("h4",{className:"font-bold text-red-900 flex items-center space-x-2",children:[(0,oa.jsx)(P_,{className:"w-5 h-5 text-red-600"}),(0,oa.jsx)("span",{children:"Delete Account"})]}),(0,oa.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Permanently delete your account and all data"})]}),(0,oa.jsxs)("button",{onClick:()=>p(!0),className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white font-medium rounded-xl hover:bg-red-700 transition-colors flex items-center justify-center space-x-2 text-sm",children:[(0,oa.jsx)(P_,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:"Delete"})]})]})})]})]}),d&&(0,oa.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,oa.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8 w-full max-w-md shadow-2xl border border-gray-200/50",children:[(0,oa.jsxs)("h3",{className:"text-base sm:text-lg font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-4 sm:mb-6 flex items-center justify-center sm:justify-start space-x-2",children:[(0,oa.jsx)(_a,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600"}),(0,oa.jsx)("span",{children:"Change Password"})]}),(0,oa.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),S.newPassword===S.confirmPassword)if(S.newPassword.length<6)nn.error("Password must be at least 6 characters long");else{v(!0);try{const{error:e}=await ra.auth.updateUser({password:S.newPassword});if(e)throw e;nn.success("Password updated successfully!"),h(!1),N({currentPassword:"",newPassword:"",confirmPassword:""})}catch(t){console.error("Password change error:",t),nn.error(t.message||"Failed to update password")}finally{v(!1)}}else nn.error("New passwords do not match")},className:"space-y-3 sm:space-y-4",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"newPassword",className:"label",children:"New Password"}),(0,oa.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",required:!0,className:"px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80",value:S.newPassword,onChange:P,placeholder:"Enter new password"})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{htmlFor:"confirmPassword",className:"label",children:"Confirm New Password"}),(0,oa.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",required:!0,className:"px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80",value:S.confirmPassword,onChange:P,placeholder:"Confirm new password"})]}),(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 pt-3 sm:pt-4",children:[(0,oa.jsx)("button",{type:"submit",disabled:m,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",children:m?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Updating..."]}):"Update Password"}),(0,oa.jsx)("button",{type:"button",onClick:()=>{h(!1),N({currentPassword:"",newPassword:"",confirmPassword:""})},className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-sm sm:text-base",children:"Cancel"})]})]})]})}),f&&(0,oa.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,oa.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8 w-full max-w-md shadow-2xl border border-gray-200/50",children:[(0,oa.jsxs)("h3",{className:"text-base sm:text-lg font-bold bg-gradient-to-r from-red-900 to-red-700 bg-clip-text text-transparent mb-4 sm:mb-6 flex items-center justify-center sm:justify-start space-x-2",children:[(0,oa.jsx)(P_,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-600"}),(0,oa.jsx)("span",{children:"Delete Account"})]}),(0,oa.jsxs)("div",{className:"mb-3 sm:mb-4",children:[(0,oa.jsx)("p",{className:"text-gray-600 mb-2 text-sm sm:text-base text-center sm:text-left",children:"This action cannot be undone. This will permanently delete your account and all associated data."}),(0,oa.jsxs)("p",{className:"text-xs sm:text-sm text-gray-500 text-center sm:text-left",children:["Please type ",(0,oa.jsx)("strong",{children:"DELETE"})," to confirm:"]})]}),(0,oa.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),"DELETE"===T){y(!0);try{if(r){const{error:e}=await ra.from("profiles").delete().eq("id",r.id);e&&console.error("Profile deletion error:",e);const{error:t}=await ra.from("attendance_records").delete().eq("user_id",r.id);t&&console.error("Attendance records deletion error:",t)}await ra.auth.signOut(),nn.success("Account deletion initiated. Please contact support to complete the process.")}catch(t){console.error("Account deletion error:",t),nn.error(t.message||"Failed to delete account")}finally{y(!1)}}else nn.error('Please type "DELETE" to confirm account deletion')},className:"space-y-3 sm:space-y-4",children:[(0,oa.jsx)("div",{children:(0,oa.jsx)("input",{type:"text",required:!0,className:"px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-200 rounded-xl sm:rounded-2xl focus:outline-none focus:ring-2 focus:ring-red-500/20 focus:border-red-400 w-full text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80",value:T,onChange:e=>I(e.target.value),placeholder:"Type DELETE to confirm"})}),(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 pt-3 sm:pt-4",children:[(0,oa.jsx)("button",{type:"button",onClick:()=>{p(!1),I("")},className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-sm sm:text-base sm:order-1",children:"Cancel"}),(0,oa.jsx)("button",{type:"submit",disabled:g||"DELETE"!==T,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base sm:order-2",children:g?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)(Sa,{size:"sm",className:"mr-2"}),"Deleting..."]}):"Delete Account"})]})]})]})}),_&&(0,oa.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,oa.jsx)("div",{className:"bg-white/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8 w-full max-w-md shadow-2xl border border-gray-200/50",children:(0,oa.jsxs)("div",{className:"text-center",children:[(0,oa.jsx)("div",{className:"mx-auto flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-red-100 mb-4",children:(0,oa.jsx)(S_,{className:"w-6 h-6 sm:w-8 sm:h-8 text-red-600"})}),(0,oa.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-2",children:"Remove Face Profile?"}),(0,oa.jsx)("p",{className:"text-sm sm:text-base text-gray-600 mb-6 leading-relaxed",children:"Are you sure you want to remove your face profile? This will disable facial recognition for attendance check-in."}),(0,oa.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:gap-6",children:[(0,oa.jsx)("button",{onClick:async()=>{E(!1),k(!0);try{const{error:e}=await ra.from("profiles").update({face_encoding:null}).eq("id",null===r||void 0===r?void 0:r.id);if(e)throw e;await n({face_encoding:void 0}),nn.success("Face profile removed successfully!")}catch(e){console.error("Face removal error:",e),nn.error(e.message||"Failed to remove face profile")}finally{k(!1)}},disabled:w,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base sm:order-2",children:w?(0,oa.jsxs)("div",{className:"flex items-center justify-center",children:[(0,oa.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Removing..."]}):"Remove Profile"}),(0,oa.jsx)("button",{onClick:()=>E(!1),className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-xl sm:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 text-sm sm:text-base sm:order-1",children:"Cancel"})]})]})})}),b&&(0,oa.jsx)(O_,{mode:null!==e&&void 0!==e&&e.face_encoding?"update":"setup",existingFaceEncoding:null===e||void 0===e?void 0:e.face_encoding,onSuccess:async e=>{k(!0);try{const{error:t}=await ra.from("profiles").update({face_encoding:e}).eq("id",null===r||void 0===r?void 0:r.id);if(t)throw t;await n({face_encoding:e}),nn.success("Face profile updated successfully!"),x(!1)}catch(t){console.error("Face setup error:",t),nn.error(t.message||"Failed to update face profile")}finally{k(!1)}},onCancel:()=>x(!1)})]})})},F_=da("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),L_=da("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),B_=da("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function U_(e){Va(1,arguments);var t=Ha(e);return t.setDate(1),t.setHours(0,0,0,0),t}function z_(e){Va(1,arguments);var t=Ha(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function W_(e,t){return Va(2,arguments),function(e,t){Va(2,arguments);var n=Ha(e),r=Ga(t);if(isNaN(r))return new Date(NaN);if(!r)return n;var o=n.getDate(),a=new Date(n.getTime());return a.setMonth(n.getMonth()+r+1,0),o>=a.getDate()?a:(n.setFullYear(a.getFullYear(),a.getMonth(),o),n)}(e,-Ga(t))}const V_=()=>{const{user:e}=ia(),[n,r]=(0,t.useState)({start:Mi(U_(new Date),"yyyy-MM-dd"),end:Mi(z_(new Date),"yyyy-MM-dd")}),[o,a]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[u,l]=(0,t.useState)(!0),[c,d]=(0,t.useState)("summary"),h=(0,t.useCallback)(async()=>{if(!e)return;const{data:t,error:r}=await ra.from("attendance_summary").select("*").eq("user_id",e.id).gte("date",n.start).lte("date",n.end).order("date",{ascending:!0});r?console.error("Error fetching summary data:",r):s(t||[])},[e,n]),f=(0,t.useCallback)(async()=>{if(!e)return;const{data:t,error:r}=await ra.from("attendance_records").select("\n        *,\n        session_types (\n          name,\n          start_time,\n          end_time,\n          description\n        )\n      ").eq("user_id",e.id).gte("check_in_time","".concat(n.start,"T00:00:00")).lte("check_in_time","".concat(n.end,"T23:59:59")).order("check_in_time",{ascending:!1});r?console.error("Error fetching detailed data:",r):a(t||[])},[e,n]),p=(0,t.useCallback)(async()=>{l(!0);try{"summary"===c?await h():await f()}catch(e){console.error("Error fetching report data:",e)}finally{l(!1)}},[c,h,f]);(0,t.useEffect)(()=>{e&&p()},[e,p]);const m=(()=>{if("summary"===c){const e=i.reduce((e,t)=>e+(t.total_hours||0),0),t=i.reduce((e,t)=>e+(t.overtime_hours||0),0),n=i.filter(e=>"present"===e.status).length,r=i.filter(e=>"late"===e.status).length,o=i.filter(e=>"absent"===e.status).length,a=i.length;return{totalHours:e,totalOvertimeHours:t,presentDays:n,lateDays:r,absentDays:o,attendanceRate:a>0?Math.round(n/a*100):0,averageHoursPerDay:a>0?e/a:0}}{const e=o.reduce((e,t)=>e+(t.total_hours||0),0),t=o.length,n=o.filter(e=>e.check_out_time).length;return{totalHours:e,totalSessions:t,completedSessions:n,incompleteSessions:t-n,averageHoursPerSession:t>0?e/t:0}}})();return(0,oa.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50/30 p-4 sm:p-6 lg:p-8",children:(0,oa.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6 sm:space-y-8",children:[(0,oa.jsxs)("div",{className:"relative overflow-hidden bg-white/60 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 p-6 sm:p-8",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-50/50 via-white/30 to-gray-50/50"}),(0,oa.jsxs)("div",{className:"relative flex items-center justify-between",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-gray-900 via-gray-800 to-gray-700 bg-clip-text text-transparent flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Reports"}),(0,oa.jsx)(F_,{className:"w-7 h-7 text-gray-500"})]}),(0,oa.jsxs)("p",{className:"text-gray-600 font-medium flex items-center space-x-2 mt-2",children:[(0,oa.jsx)("span",{className:"w-2 h-2 bg-gray-500 rounded-full animate-pulse"}),(0,oa.jsx)("span",{children:"Analyze your attendance data and performance metrics"})]})]}),(0,oa.jsxs)("button",{onClick:()=>{const e="summary"===c?i:o,t=[("summary"===c?["Date","Total Hours","Overtime Hours","Sessions Completed","Status"]:["Date","Session","Check In","Check Out","Total Hours","Status"]).join(","),...e.map(e=>{if("summary"===c){const t=e;return[t.date,t.total_hours,t.overtime_hours,t.sessions_completed,t.status].join(",")}{var t;const n=e;return[Mi(new Date(n.check_in_time),"yyyy-MM-dd"),(null===(t=n.session_types)||void 0===t?void 0:t.name)||"",n.check_in_time?Mi(new Date(n.check_in_time),"HH:mm"):"",n.check_out_time?Mi(new Date(n.check_out_time),"HH:mm"):"",n.total_hours||0,n.status].join(",")}})].join("\n"),r=new Blob([t],{type:"text/csv"}),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download="attendance-report-".concat(n.start,"-to-").concat(n.end,".csv"),s.click(),window.URL.revokeObjectURL(a)},className:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center space-x-2",children:[(0,oa.jsx)(L_,{className:"w-5 h-5"}),(0,oa.jsx)("span",{children:"Export CSV"})]})]})]}),(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsxs)("div",{className:"bg-gradient-to-r from-gray-800 via-gray-800 to-gray-900 p-6",children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"Filters & Settings"}),(0,oa.jsx)(B_,{className:"w-6 h-6 text-gray-400"})]}),(0,oa.jsx)("p",{className:"text-gray-200 text-sm font-medium mt-1",children:"Customize your report view and date range"})]}),(0,oa.jsx)("div",{className:"p-6 sm:p-8",children:(0,oa.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Report Type"}),(0,oa.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-gray-500/20 focus:border-gray-400 text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80",children:[(0,oa.jsx)("option",{value:"summary",children:"Summary View"}),(0,oa.jsx)("option",{value:"detailed",children:"Detailed View"})]})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Start Date"}),(0,oa.jsx)("input",{type:"date",value:n.start,onChange:e=>r(ze(ze({},n),{},{start:e.target.value})),className:"w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-gray-500/20 focus:border-gray-400 text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80"})]}),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"End Date"}),(0,oa.jsx)("input",{type:"date",value:n.end,onChange:e=>r(ze(ze({},n),{},{end:e.target.value})),className:"w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-gray-500/20 focus:border-gray-400 text-sm transition-all duration-300 shadow-sm hover:shadow-md backdrop-blur-sm bg-white/80"})]}),(0,oa.jsxs)("div",{className:"flex flex-col justify-end space-y-3",children:[(0,oa.jsxs)("button",{onClick:()=>{const e=W_(new Date,1);r({start:Mi(U_(e),"yyyy-MM-dd"),end:Mi(z_(e),"yyyy-MM-dd")})},className:"px-4 py-3 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 font-semibold rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 hover:scale-105 flex items-center justify-center space-x-2",children:[(0,oa.jsx)(Pa,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:"Last Month"})]}),(0,oa.jsxs)("button",{onClick:p,className:"px-4 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white font-semibold rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105 flex items-center justify-center space-x-2",children:[(0,oa.jsx)(j_,{className:"w-4 h-4"}),(0,oa.jsx)("span",{children:"Refresh"})]})]})]})})]}),u?(0,oa.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,oa.jsx)(Sa,{size:"lg"})}):(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-blue-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/70 to-cyan-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(fa,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-blue-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Da,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Total Hours"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-blue-800 bg-clip-text text-transparent",children:[Math.floor(m.totalHours),"h ",Math.round(m.totalHours%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Hours worked"})]})]})]})]}),"summary"===c?(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-emerald-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50/70 to-teal-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(La,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-emerald-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Pa,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Present Days"}),(0,oa.jsx)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-emerald-800 bg-clip-text text-transparent",children:m.presentDays}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Days attended"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-amber-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-50/70 to-orange-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-amber-500 to-orange-500 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(ja,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-amber-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Ma,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Attendance Rate"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-amber-800 bg-clip-text text-transparent",children:[m.attendanceRate,"%"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Performance metric"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-purple-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/70 to-pink-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(ma,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-purple-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Oa,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Avg Hours/Day"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-purple-800 bg-clip-text text-transparent",children:[Math.floor(m.averageHoursPerDay),"h ",Math.round(m.averageHoursPerDay%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Daily average"})]})]})]})]})]}):(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-emerald-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50/70 to-teal-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(Fa,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-emerald-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Da,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Total Sessions"}),(0,oa.jsx)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-emerald-800 bg-clip-text text-transparent",children:m.totalSessions}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Sessions completed"})]})]})]})]}),(0,oa.jsxs)("div",{className:"group relative overflow-hidden bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-500 border border-gray-200/50 hover:border-purple-300/50",children:[(0,oa.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/70 to-pink-50/70"}),(0,oa.jsxs)("div",{className:"relative p-6",children:[(0,oa.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,oa.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:scale-110 transition-transform duration-300",children:(0,oa.jsx)(ma,{className:"w-7 h-7 text-white"})}),(0,oa.jsx)("div",{className:"text-purple-500 opacity-20 group-hover:opacity-40 transition-all duration-300 group-hover:rotate-12",children:(0,oa.jsx)(Oa,{className:"w-8 h-8"})})]}),(0,oa.jsxs)("div",{className:"space-y-2",children:[(0,oa.jsx)("p",{className:"text-sm font-bold text-gray-600 uppercase tracking-wider",children:"Avg Hours/Session"}),(0,oa.jsxs)("p",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-purple-800 bg-clip-text text-transparent",children:[Math.floor(m.averageHoursPerSession),"h ",Math.round(m.averageHoursPerSession%1*60),"m"]}),(0,oa.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,oa.jsx)("div",{className:"w-2.5 h-2.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full animate-pulse"}),(0,oa.jsx)("p",{className:"text-xs text-gray-500 font-semibold",children:"Session average"})]})]})]})]})]})]}),(0,oa.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-gray-200/50 overflow-hidden",children:[(0,oa.jsxs)("div",{className:"bg-gradient-to-r from-gray-800 via-gray-800 to-gray-900 p-6",children:[(0,oa.jsxs)("h3",{className:"text-lg sm:text-xl font-bold text-white flex items-center space-x-2",children:[(0,oa.jsx)("span",{children:"summary"===c?"Daily Summary":"Detailed Records"}),(0,oa.jsx)(F_,{className:"w-6 h-6 text-gray-400"})]}),(0,oa.jsx)("p",{className:"text-gray-200 text-sm font-medium mt-1",children:"Complete attendance data breakdown"})]}),(0,oa.jsx)("div",{className:"p-6",children:(0,oa.jsx)("div",{className:"overflow-x-auto",children:(0,oa.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,oa.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:(0,oa.jsx)("tr",{children:"summary"===c?(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Date"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Hours"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Overtime"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Sessions"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Status"})]}):(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Date"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Session"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Check In"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Check Out"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Hours"}),(0,oa.jsx)("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Status"})]})})}),(0,oa.jsx)("tbody",{className:"bg-white/50 divide-y divide-gray-200",children:"summary"===c?i.map((e,t)=>(0,oa.jsxs)("tr",{className:"hover:bg-gray-50/80 transition-colors duration-200 ".concat(t%2===0?"bg-white/30":"bg-gray-50/30"),children:[(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:Mi(new Date(e.date),"MMM dd, yyyy")}),(0,oa.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Math.floor(e.total_hours),"h ",Math.round(e.total_hours%1*60),"m"]}),(0,oa.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[Math.floor(e.overtime_hours),"h ",Math.round(e.overtime_hours%1*60),"m"]}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.sessions_completed}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,oa.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold ".concat("present"===e.status?"bg-green-100 text-green-800":"late"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})})]},e.id)):o.map((e,t)=>{var n;return(0,oa.jsxs)("tr",{className:"hover:bg-gray-50/80 transition-colors duration-200 ".concat(t%2===0?"bg-white/30":"bg-gray-50/30"),children:[(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:Mi(new Date(e.check_in_time),"MMM dd, yyyy")}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:null===(n=e.session_types)||void 0===n?void 0:n.name}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.check_in_time?Mi(new Date(e.check_in_time),"h:mm a"):"-"}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.check_out_time?Mi(new Date(e.check_out_time),"h:mm a"):"-"}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_hours?"".concat(Math.floor(e.total_hours),"h ").concat(Math.round(e.total_hours%1*60),"m"):"-"}),(0,oa.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,oa.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold ".concat("present"===e.status?"bg-green-100 text-green-800":"late"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})})]},e.id)})})]})})})]})]})]})})},H_=e=>{let{children:t}=e;const{user:n,loading:r,session:o}=ia();return r?(0,oa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,oa.jsx)("div",{className:"text-center",children:(0,oa.jsx)(Sa,{size:"lg"})})}):n&&o?(0,oa.jsx)(oa.Fragment,{children:t}):(0,oa.jsx)(pe,{to:"/login",replace:!0})},q_=e=>{let{children:t}=e;const{user:n,loading:r,session:o}=ia();return r?(0,oa.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,oa.jsx)("div",{className:"text-center",children:(0,oa.jsx)(Sa,{size:"lg"})})}):n&&o?(0,oa.jsx)(pe,{to:"/dashboard",replace:!0}):(0,oa.jsx)(oa.Fragment,{children:t})};const G_=function(){return(0,oa.jsx)(sa,{children:(0,oa.jsx)(Te,{children:(0,oa.jsxs)("div",{className:"App",children:[(0,oa.jsx)(tn,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#fff",color:"#374151",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"12px 16px"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}}),(0,oa.jsxs)(ye,{children:[(0,oa.jsx)(ve,{path:"/login",element:(0,oa.jsx)(q_,{children:(0,oa.jsx)(Na,{})})}),(0,oa.jsx)(ve,{path:"/register",element:(0,oa.jsx)(q_,{children:(0,oa.jsx)(Aa,{})})}),(0,oa.jsxs)(ve,{path:"/",element:(0,oa.jsx)(H_,{children:(0,oa.jsx)(wa,{})}),children:[(0,oa.jsx)(ve,{index:!0,element:(0,oa.jsx)(pe,{to:"/dashboard",replace:!0})}),(0,oa.jsx)(ve,{path:"dashboard",element:(0,oa.jsx)(Fi,{})}),(0,oa.jsx)(ve,{path:"attendance",element:(0,oa.jsx)(I_,{})}),(0,oa.jsx)(ve,{path:"profile",element:(0,oa.jsx)(M_,{})}),(0,oa.jsx)(ve,{path:"reports",element:(0,oa.jsx)(V_,{})})]}),(0,oa.jsx)(ve,{path:"*",element:(0,oa.jsx)(pe,{to:"/login",replace:!0})})]})]})})})};o.createRoot(document.getElementById("root")).render((0,oa.jsx)(t.StrictMode,{children:(0,oa.jsx)(G_,{})}))})()})();